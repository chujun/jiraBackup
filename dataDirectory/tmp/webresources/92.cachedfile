/* module-key = 'jira.webresources:calendar', location = '/includes/lib/calendar/Calendar.js' */
Calendar=function(firstDayOfWeek,dateStr,onSelected,onClose){this.activeDiv=null;this.currentDateEl=null;this.getDateStatus=null;this.getDateToolTip=null;this.getDateText=null;this.timeout=null;this.onSelected=onSelected||null;this.onClose=onClose||null;this.dragging=false;this.hidden=false;this.minYear=1970;this.maxYear=2050;this.dateFormat=Calendar._TT["DEF_DATE_FORMAT"];this.ttDateFormat=Calendar._TT["TT_DATE_FORMAT"];this.isPopup=true;this.weekNumbers=true;this.firstDayOfWeek=typeof firstDayOfWeek=="number"?firstDayOfWeek:Calendar._FD;this.showsOtherMonths=false;this.dateStr=dateStr;this.ar_days=null;this.showsTime=false;this.time24=true;this.yearStep=2;this.hiliteToday=true;this.multiple=null;this.table=null;this.element=null;this.tbody=null;this.firstdayname=null;this.monthsCombo=null;this.yearsCombo=null;this.hilitedMonth=null;this.activeMonth=null;this.hilitedYear=null;this.activeYear=null;this.dateClicked=false;if(typeof Calendar._SDN=="undefined"){if(typeof Calendar._SDN_len=="undefined"){Calendar._SDN_len=3}var ar=new Array();for(var i=8;i>0;){ar[--i]=Calendar._DN[i].substr(0,Calendar._SDN_len)}Calendar._SDN=ar;if(typeof Calendar._SMN_len=="undefined"){Calendar._SMN_len=3}ar=new Array();for(var i=12;i>0;){ar[--i]=Calendar._MN[i].substr(0,Calendar._SMN_len)}Calendar._SMN=ar}};Calendar._C=null;Calendar.is_ie=(/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent));Calendar.is_ie5=(Calendar.is_ie&&/msie 5\.0/i.test(navigator.userAgent));Calendar.is_ie6=(Calendar.is_ie&&/msie 6\.0/i.test(navigator.userAgent));Calendar.is_opera=/opera/i.test(navigator.userAgent);Calendar.is_khtml=/Konqueror|Safari|KHTML/i.test(navigator.userAgent);Calendar.getAbsolutePos=function(el){var coords=jQuery(el).offset();coords.x=coords.left;coords.y=coords.top;return coords};Calendar.isRelated=function(el,evt){var related=evt.relatedTarget;if(!related){var type=evt.type;if(type=="mouseover"){related=evt.fromElement}else{if(type=="mouseout"){related=evt.toElement}}}while(related){if(related==el){return true}related=related.parentNode}return false};Calendar.removeClass=function(el,className){if(!(el&&el.className)){return }var cls=el.className.split(" ");var ar=new Array();for(var i=cls.length;i>0;){if(cls[--i]!=className){ar[ar.length]=cls[i]}}el.className=ar.join(" ")};Calendar.addClass=function(el,className){Calendar.removeClass(el,className);el.className+=" "+className};Calendar.getElement=function(ev){var f=Calendar.is_ie?window.event.srcElement:ev.currentTarget;while(f.nodeType!=1||/^div$/i.test(f.tagName)){f=f.parentNode}return f};Calendar.getTargetElement=function(ev){var f=Calendar.is_ie?window.event.srcElement:ev.target;while(f.nodeType!=1){f=f.parentNode}return f};Calendar.stopEvent=function(ev){if(!ev){ev=window.event}if(ev.stopPropagation){ev.preventDefault();ev.stopPropagation()}else{ev.cancelBubble=true;ev.returnValue=false}return false};Calendar.addEvent=function(el,evname,func){if(el.attachEvent){el.attachEvent("on"+evname,func)}else{if(el.addEventListener){el.addEventListener(evname,func,true)}else{el["on"+evname]=func}}};Calendar.removeEvent=function(el,evname,func){if(el.detachEvent){el.detachEvent("on"+evname,func)}else{if(el.removeEventListener){el.removeEventListener(evname,func,true)}else{el["on"+evname]=null}}};Calendar.createElement=function(type,parent){var el=null;if(document.createElementNS){el=document.createElementNS("http://www.w3.org/1999/xhtml",type)}else{el=document.createElement(type)}if(typeof parent!="undefined"){parent.appendChild(el)}return el};Calendar._add_evs=function(el){with(Calendar){addEvent(el,"mouseover",dayMouseOver);addEvent(el,"mousedown",dayMouseDown);addEvent(el,"mouseout",dayMouseOut);if(is_ie){addEvent(el,"dblclick",dayMouseDblClick);el.setAttribute("unselectable",true)}}};Calendar.findMonth=function(el){if(typeof el.month!="undefined"){return el}else{if(typeof el.parentNode.month!="undefined"){return el.parentNode}}return null};Calendar.findYear=function(el){if(typeof el.year!="undefined"){return el}else{if(typeof el.parentNode.year!="undefined"){return el.parentNode}}return null};Calendar.showMonthsCombo=function(){var cal=Calendar._C;if(!cal){return false}var cal=cal;var cd=cal.activeDiv;var mc=cal.monthsCombo;if(cal.hilitedMonth){Calendar.removeClass(cal.hilitedMonth,"hilite")}if(cal.activeMonth){Calendar.removeClass(cal.activeMonth,"active")}var mon=cal.monthsCombo.getElementsByTagName("div")[cal.date.getMonth()];Calendar.addClass(mon,"active");cal.activeMonth=mon;var s=mc.style;s.display="block";if(cd.navtype<0){s.left=cd.offsetLeft+"px"}else{var mcw=mc.offsetWidth;if(typeof mcw=="undefined"){mcw=50}s.left=(cd.offsetLeft+cd.offsetWidth-mcw)+"px"}s.top=(cd.offsetTop+cd.offsetHeight)+"px"};Calendar.showYearsCombo=function(fwd){var cal=Calendar._C;if(!cal){return false}var cal=cal;var cd=cal.activeDiv;var yc=cal.yearsCombo;if(cal.hilitedYear){Calendar.removeClass(cal.hilitedYear,"hilite")}if(cal.activeYear){Calendar.removeClass(cal.activeYear,"active")}cal.activeYear=null;var Y=cal.date.getFullYear()+(fwd?1:-1);var yr=yc.firstChild;var show=false;for(var i=12;i>0;--i){if(Y>=cal.minYear&&Y<=cal.maxYear){yr.innerHTML=Y;yr.year=Y;yr.style.display="block";show=true}else{yr.style.display="none"}yr=yr.nextSibling;Y+=fwd?cal.yearStep:-cal.yearStep}if(show){var s=yc.style;s.display="block";if(cd.navtype<0){s.left=cd.offsetLeft+"px"}else{var ycw=yc.offsetWidth;if(typeof ycw=="undefined"){ycw=50}s.left=(cd.offsetLeft+cd.offsetWidth-ycw)+"px"}s.top=(cd.offsetTop+cd.offsetHeight)+"px"}};Calendar.tableMouseUp=function(ev){var cal=Calendar._C;if(!cal){return false}if(cal.timeout){clearTimeout(cal.timeout)}var el=cal.activeDiv;if(!el){return false}var target=Calendar.getTargetElement(ev);ev||(ev=window.event);Calendar.removeClass(el,"active");if(target==el||target.parentNode==el){Calendar.cellClick(el,ev)}var mon=Calendar.findMonth(target);var date=null;if(mon){date=new Date(cal.date);if(mon.month!=date.getMonth()){date.setMonth(mon.month);cal.setDate(date);cal.dateClicked=false;cal.callHandler()}}else{var year=Calendar.findYear(target);if(year){date=new Date(cal.date);if(year.year!=date.getFullYear()){date.setFullYear(year.year);cal.setDate(date);cal.dateClicked=false;cal.callHandler()}}}with(Calendar){removeEvent(document,"mouseup",tableMouseUp);removeEvent(document,"mouseover",tableMouseOver);removeEvent(document,"mousemove",tableMouseOver);cal._hideCombos();_C=null;return stopEvent(ev)}};Calendar.tableMouseOver=function(ev){var cal=Calendar._C;if(!cal){return }var el=cal.activeDiv;var target=Calendar.getTargetElement(ev);if(target==el||target.parentNode==el){Calendar.addClass(el,"hilite active");Calendar.addClass(el.parentNode,"rowhilite")}else{if(typeof el.navtype=="undefined"||(el.navtype!=50&&(el.navtype==0||Math.abs(el.navtype)>2))){Calendar.removeClass(el,"active")}Calendar.removeClass(el,"hilite");Calendar.removeClass(el.parentNode,"rowhilite")}ev||(ev=window.event);if(el.navtype==50&&target!=el){var pos=Calendar.getAbsolutePos(el);var w=el.offsetWidth;var x=ev.clientX;var dx;var decrease=true;if(x>pos.x+w){dx=x-pos.x-w;decrease=false}else{dx=pos.x-x}if(dx<0){dx=0}var range=el._range;var current=el._current;var count=Math.floor(dx/10)%range.length;for(var i=range.length;--i>=0;){if(range[i]==current){break}}while(count-->0){if(decrease){if(--i<0){i=range.length-1}}else{if(++i>=range.length){i=0}}}var newval=range[i];el.innerHTML=newval;cal.onUpdateTime()}var mon=Calendar.findMonth(target);if(mon){if(mon.month!=cal.date.getMonth()){if(cal.hilitedMonth){Calendar.removeClass(cal.hilitedMonth,"hilite")}Calendar.addClass(mon,"hilite");cal.hilitedMonth=mon}else{if(cal.hilitedMonth){Calendar.removeClass(cal.hilitedMonth,"hilite")}}}else{if(cal.hilitedMonth){Calendar.removeClass(cal.hilitedMonth,"hilite")}var year=Calendar.findYear(target);if(year){if(year.year!=cal.date.getFullYear()){if(cal.hilitedYear){Calendar.removeClass(cal.hilitedYear,"hilite")}Calendar.addClass(year,"hilite");cal.hilitedYear=year}else{if(cal.hilitedYear){Calendar.removeClass(cal.hilitedYear,"hilite")}}}else{if(cal.hilitedYear){Calendar.removeClass(cal.hilitedYear,"hilite")}}}return Calendar.stopEvent(ev)};Calendar.tableMouseDown=function(ev){if(Calendar.getTargetElement(ev)==Calendar.getElement(ev)){return Calendar.stopEvent(ev)}};Calendar.calDragIt=function(ev){var cal=Calendar._C;if(!(cal&&cal.dragging)){return false}var posX;var posY;if(Calendar.is_ie){posY=window.event.clientY+document.body.scrollTop;posX=window.event.clientX+document.body.scrollLeft}else{posX=ev.pageX;posY=ev.pageY}var st=cal.element.style;st.left=(posX-cal.xOffs)+"px";st.top=(posY-cal.yOffs)+"px";return Calendar.stopEvent(ev)};Calendar.calDragEnd=function(ev){var cal=Calendar._C;if(!cal){return false}cal.dragging=false;with(Calendar){removeEvent(document,"mousemove",calDragIt);removeEvent(document,"mouseup",calDragEnd);tableMouseUp(ev)}};Calendar.dayMouseDown=function(ev){var el=Calendar.getElement(ev);if(el.disabled){return false}var cal=el.calendar;cal.activeDiv=el;Calendar._C=cal;if(el.navtype!=300){with(Calendar){if(el.navtype==50){el._current=el.innerHTML;addEvent(document,"mousemove",tableMouseOver)}else{addEvent(document,Calendar.is_ie5?"mousemove":"mouseover",tableMouseOver)}addClass(el,"hilite active");addEvent(document,"mouseup",tableMouseUp)}}else{if(cal.isPopup){cal._dragStart(ev)}}if(el.navtype==-1||el.navtype==1){if(cal.timeout){clearTimeout(cal.timeout)}cal.timeout=setTimeout("Calendar.showMonthsCombo()",250)}else{if(el.navtype==-2||el.navtype==2){if(cal.timeout){clearTimeout(cal.timeout)}cal.timeout=setTimeout((el.navtype>0)?"Calendar.showYearsCombo(true)":"Calendar.showYearsCombo(false)",250)}else{cal.timeout=null}}return Calendar.stopEvent(ev)};Calendar.dayMouseDblClick=function(ev){Calendar.cellClick(Calendar.getElement(ev),ev||window.event);if(Calendar.is_ie){document.selection.empty()}};Calendar.dayMouseOver=function(ev){var el=Calendar.getElement(ev);if(Calendar.isRelated(el,ev)||Calendar._C||el.disabled){return false}if(el.ttip){if(el.ttip.substr(0,1)=="_"){el.ttip=el.caldate.print(el.calendar.ttDateFormat)+el.ttip.substr(1)}el.calendar.tooltips.innerHTML=el.ttip}if(el.navtype!=300){Calendar.addClass(el,"hilite");if(el.caldate){Calendar.addClass(el.parentNode,"rowhilite")}}return Calendar.stopEvent(ev)};Calendar.dayMouseOut=function(ev){with(Calendar){var el=getElement(ev);if(isRelated(el,ev)||_C||el.disabled){return false}removeClass(el,"hilite");if(el.caldate){removeClass(el.parentNode,"rowhilite")}if(el.calendar){el.calendar.tooltips.innerHTML=_TT["SEL_DATE"]}return stopEvent(ev)}};Calendar.cellClick=function(el,ev){var cal=el.calendar;var closing=false;var newdate=false;var date=null;if(typeof el.navtype=="undefined"){if(cal.currentDateEl){Calendar.removeClass(cal.currentDateEl,"selected");Calendar.addClass(el,"selected");closing=(cal.currentDateEl==el);if(!closing){cal.currentDateEl=el}}cal.date.setDateOnly(el.caldate);date=cal.date;var other_month=!(cal.dateClicked=!el.otherMonth);if(!other_month&&!cal.currentDateEl){cal._toggleMultipleDate(new Date(date))}else{newdate=!el.disabled}if(other_month){cal._init(cal.firstDayOfWeek,date)}}else{if(el.navtype==200){Calendar.removeClass(el,"hilite");cal.callCloseHandler();return }date=new Date(cal.date);if(el.navtype==0){date.setDateOnly(new Date())}cal.dateClicked=false;var year=date.getFullYear();var mon=date.getMonth();function setMonth(m){var day=date.getDate();var max=date.getMonthDays(m);if(day>max){date.setDate(max)}date.setMonth(m)}switch(el.navtype){case 400:Calendar.removeClass(el,"hilite");var text=Calendar._TT["ABOUT"];if(typeof text!="undefined"){text+=cal.showsTime?Calendar._TT["ABOUT_TIME"]:""}else{text="Help and about box text is not translated into this language.\n"+"If you know this language and you feel generous please update\n"+'the corresponding file in "lang" subdir to match calendar-en.js\n'+"and send it back to <mihai_bazon@yahoo.com> to get it into the distribution  ;-)\n\n"+"Thank you!\n"+"http://dynarch.com/mishoo/calendar.epl\n"}alert(text);return ;case -2:if(year>cal.minYear){date.setFullYear(year-1)}break;case -1:if(mon>0){setMonth(mon-1)}else{if(year-->cal.minYear){date.setFullYear(year);setMonth(11)}}break;case 1:if(mon<11){setMonth(mon+1)}else{if(year<cal.maxYear){date.setFullYear(year+1);setMonth(0)}}break;case 2:if(year<cal.maxYear){date.setFullYear(year+1)}break;case 100:cal.setFirstDayOfWeek(el.fdow);return ;case 50:var range=el._range;var current=el.innerHTML;for(var i=range.length;--i>=0;){if(range[i]==current){break}}if(ev&&ev.shiftKey){if(--i<0){i=range.length-1}}else{if(++i>=range.length){i=0}}var newval=range[i];el.innerHTML=newval;cal.onUpdateTime();return ;case 0:if((typeof cal.getDateStatus=="function")&&cal.getDateStatus(date,date.getFullYear(),date.getMonth(),date.getDate())){return false}break}if(!date.equalsTo(cal.date)){cal.setDate(date);newdate=true}else{if(el.navtype==0){newdate=closing=true}}}if(newdate){ev&&cal.callHandler()}if(closing){Calendar.removeClass(el,"hilite");ev&&cal.callCloseHandler()}};Calendar.prototype.create=function(_par){var parent=null;if(!_par){parent=document.getElementsByTagName("body")[0];this.isPopup=true}else{parent=_par;this.isPopup=false}if(this.dateStr){this.date=new Date(this.dateStr)}if(!this.date||isNaN(this.date)){this.date=new Date()}var table=Calendar.createElement("table");this.table=table;table.cellSpacing=0;table.cellPadding=0;table.calendar=this;Calendar.addEvent(table,"mousedown",Calendar.tableMouseDown);var div=Calendar.createElement("div");this.element=div;div.className="calendar";if(this.isPopup){div.style.position="absolute";div.style.display="none"}div.appendChild(table);var thead=Calendar.createElement("thead",table);var cell=null;var row=null;var cal=this;var hh=function(text,cs,navtype){cell=Calendar.createElement("td",row);cell.colSpan=cs;cell.className="button";if(navtype!=0&&Math.abs(navtype)<=2){cell.className+=" nav"}Calendar._add_evs(cell);cell.calendar=cal;cell.navtype=navtype;cell.innerHTML="<div unselectable='on'>"+text+"</div>";return cell};row=Calendar.createElement("tr",thead);var title_length=6;(this.isPopup)&&--title_length;(this.weekNumbers)&&++title_length;hh("?",1,400).ttip=Calendar._TT["INFO"];this.title=hh("",title_length,300);this.title.className="title";if(this.isPopup){this.title.ttip=Calendar._TT["DRAG_TO_MOVE"];this.title.style.cursor="move";hh("&#x00d7;",1,200).ttip=Calendar._TT["CLOSE"]}row=Calendar.createElement("tr",thead);row.className="headrow";this._nav_py=hh("&#x00ab;",1,-2);this._nav_py.ttip=Calendar._TT["PREV_YEAR"];this._nav_pm=hh("&#x2039;",1,-1);this._nav_pm.ttip=Calendar._TT["PREV_MONTH"];this._nav_now=hh(Calendar._TT["TODAY"],this.weekNumbers?4:3,0);this._nav_now.ttip=Calendar._TT["GO_TODAY"];this._nav_nm=hh("&#x203a;",1,1);this._nav_nm.ttip=Calendar._TT["NEXT_MONTH"];this._nav_ny=hh("&#x00bb;",1,2);this._nav_ny.ttip=Calendar._TT["NEXT_YEAR"];row=Calendar.createElement("tr",thead);row.className="daynames";if(this.weekNumbers){cell=Calendar.createElement("td",row);cell.className="name wn";cell.innerHTML=Calendar._TT["WK"]}for(var i=7;i>0;--i){cell=Calendar.createElement("td",row);if(!i){cell.navtype=100;cell.calendar=this;Calendar._add_evs(cell)}}this.firstdayname=(this.weekNumbers)?row.firstChild.nextSibling:row.firstChild;this._displayWeekdays();var tbody=Calendar.createElement("tbody",table);this.tbody=tbody;for(i=6;i>0;--i){row=Calendar.createElement("tr",tbody);if(this.weekNumbers){cell=Calendar.createElement("td",row)}for(var j=7;j>0;--j){cell=Calendar.createElement("td",row);cell.calendar=this;Calendar._add_evs(cell)}}if(this.showsTime){row=Calendar.createElement("tr",tbody);row.className="time";cell=Calendar.createElement("td",row);cell.className="time";cell.colSpan=2;cell.innerHTML=Calendar._TT["TIME"]||"&nbsp;";cell=Calendar.createElement("td",row);cell.className="time";cell.colSpan=this.weekNumbers?4:3;(function(){function makeTimePart(className,init,range_start,range_end){var part=Calendar.createElement("span",cell);part.className=className;part.innerHTML=init;part.calendar=cal;part.ttip=Calendar._TT["TIME_PART"];part.navtype=50;part._range=[];if(typeof range_start!="number"){part._range=range_start}else{for(var i=range_start;i<=range_end;++i){var txt;if(i<10&&range_end>=10){txt="0"+i}else{txt=""+i}part._range[part._range.length]=txt}}Calendar._add_evs(part);return part}var hrs=cal.date.getHours();var mins=cal.date.getMinutes();var t12=!cal.time24;var pm=(hrs>12);if(t12&&pm){hrs-=12}var H=makeTimePart("hour",hrs,t12?1:0,t12?12:23);var span=Calendar.createElement("span",cell);span.innerHTML=":";span.className="colon";var M=makeTimePart("minute",mins,0,59);var AP=null;cell=Calendar.createElement("td",row);cell.className="time";cell.colSpan=2;if(t12){AP=makeTimePart("ampm",pm?Calendar._TT["PM"]:Calendar._TT["AM"],[Calendar._TT["am"],Calendar._TT["pm"]])}else{cell.innerHTML="&nbsp;"}cal.onSetTime=function(){var pm,hrs=this.date.getHours(),mins=this.date.getMinutes();if(t12){pm=(hrs>=12);if(pm){hrs-=12}if(hrs==0){hrs=12}AP.innerHTML=pm?Calendar._TT["pm"]:Calendar._TT["am"]}H.innerHTML=(hrs<10)?("0"+hrs):hrs;M.innerHTML=(mins<10)?("0"+mins):mins};cal.onUpdateTime=function(){var date=this.date;var h=parseInt(H.innerHTML,10);if(t12){if(new RegExp(Calendar._TT["pm"],"i").test(AP.innerHTML)&&h<12){h+=12}else{if(new RegExp(Calendar._TT["am"],"i").test(AP.innerHTML)&&h==12){h=0}}}var d=date.getDate();var m=date.getMonth();var y=date.getFullYear();date.setHours(h);date.setMinutes(parseInt(M.innerHTML,10));date.setFullYear(y);date.setMonth(m);date.setDate(d);this.dateClicked=false;this.callHandler()}})()}else{this.onSetTime=this.onUpdateTime=function(){}}var tfoot=Calendar.createElement("tfoot",table);row=Calendar.createElement("tr",tfoot);row.className="footrow";cell=hh(Calendar._TT["SEL_DATE"],this.weekNumbers?8:7,300);cell.className="ttip";if(this.isPopup){cell.ttip=Calendar._TT["DRAG_TO_MOVE"];cell.style.cursor="move"}this.tooltips=cell;div=Calendar.createElement("div",this.element);this.monthsCombo=div;div.className="combo";for(i=0;i<Calendar._MN.length;++i){var mn=Calendar.createElement("div");mn.className=Calendar.is_ie?"label-IEfix":"label";mn.month=i;mn.innerHTML=Calendar._SMN[i];div.appendChild(mn)}div=Calendar.createElement("div",this.element);this.yearsCombo=div;div.className="combo";for(i=12;i>0;--i){var yr=Calendar.createElement("div");yr.className=Calendar.is_ie?"label-IEfix":"label";div.appendChild(yr)}this._init(this.firstDayOfWeek,this.date);parent.appendChild(this.element);Calendar.addEvent(this.element,"mousedown",function(ev){ev.preventDefault?ev.preventDefault():ev.returnValue=false})};Calendar._upkeyEvent=function(e){if(e.keyCode===27){window.setTimeout(function(){var cal=window._dynarch_popupCalendar;if(!cal||cal.multiple){return false}else{cal.callCloseHandler()}},0)}};Calendar._keyEvent=function(ev){var cal=window._dynarch_popupCalendar;if(!cal||cal.multiple){return false}var act=(Calendar.is_ie||ev.type=="keydown"),K=ev.keyCode;if(ev.ctrlKey){switch(K){case 37:act&&Calendar.cellClick(cal._nav_pm);break;case 38:act&&Calendar.cellClick(cal._nav_py);break;case 39:act&&Calendar.cellClick(cal._nav_nm);break;case 40:act&&Calendar.cellClick(cal._nav_ny);break}}else{switch(K){case 32:Calendar.cellClick(cal._nav_now);break;case 37:case 38:case 39:case 40:if(act){var prev,x,y,ne,el,step;prev=K==37||K==38;step=(K==37||K==39)?1:7;function setVars(){el=cal.currentDateEl;var p=el.pos;x=p&15;y=p>>4;ne=cal.ar_days[y][x]}setVars();function prevMonth(){var date=new Date(cal.date);date.setDate(date.getDate()-step);cal.setDate(date)}function nextMonth(){var date=new Date(cal.date);date.setDate(date.getDate()+step);cal.setDate(date)}while(1){switch(K){case 37:if(--x>=0){ne=cal.ar_days[y][x]}else{x=6;K=38;continue}break;case 38:if(--y>=0){ne=cal.ar_days[y][x]}else{prevMonth();setVars()}break;case 39:if(++x<7){ne=cal.ar_days[y][x]}else{x=0;K=40;continue}break;case 40:if(++y<cal.ar_days.length){ne=cal.ar_days[y][x]}else{nextMonth();setVars()}break}break}if(ne){if(!ne.disabled){Calendar.cellClick(ne)}else{if(prev){prevMonth()}else{nextMonth()}}}}break;case 13:if(act){Calendar.cellClick(cal.currentDateEl,ev)}break}}return Calendar.stopEvent(ev)};Calendar.prototype._init=function(firstDayOfWeek,date){var today=new Date(),TY=today.getFullYear(),TM=today.getMonth(),TD=today.getDate();this.table.style.visibility="hidden";var year=date.getFullYear();if(year<this.minYear){year=this.minYear;date.setFullYear(year)}else{if(year>this.maxYear){year=this.maxYear;date.setFullYear(year)}}this.firstDayOfWeek=firstDayOfWeek;this.date=new Date(date);var month=date.getMonth();var mday=date.getDate();var no_days=date.getMonthDays();date.setDate(1);var day1=(date.getDay()-this.firstDayOfWeek)%7;if(day1<0){day1+=7}date.setDate(-day1);date.setDate(date.getDate()+1);var row=this.tbody.firstChild;var MN=Calendar._SMN[month];var ar_days=this.ar_days=new Array();var weekend=Calendar._TT["WEEKEND"];var dates=this.multiple?(this.datesCells={}):null;for(var i=0;i<6;++i,row=row.nextSibling){var cell=row.firstChild;if(this.weekNumbers){cell.className="day wn";var monthStartDate=date;if(month==0&&i==0&&Date.useISO8601WeekNumbers==false){monthStartDate=new Date(year,month,1)}cell.innerHTML=monthStartDate.getWeekNumber(this.firstDayOfWeek);cell=cell.nextSibling}row.className="daysrow";var hasdays=false,iday,dpos=ar_days[i]=[];for(var j=0;j<7;++j,cell=cell.nextSibling,date.setDate(iday+1)){iday=date.getDate();var wday=date.getDay();cell.className="day day-"+iday;cell.pos=i<<4|j;dpos[j]=cell;var current_month=(date.getMonth()==month);if(!current_month){if(this.showsOtherMonths){cell.className+=" othermonth";cell.otherMonth=true}else{cell.className="emptycell";cell.innerHTML="&nbsp;";cell.disabled=true;continue}}else{cell.otherMonth=false;hasdays=true}cell.disabled=false;cell.innerHTML=this.getDateText?this.getDateText(date,iday):iday;if(dates){dates[date.print("%Y%m%d")]=cell}if(this.getDateStatus){var status=this.getDateStatus(date,year,month,iday);if(this.getDateToolTip){var toolTip=this.getDateToolTip(date,year,month,iday);if(toolTip){cell.title=toolTip}}if(status===true){cell.className+=" disabled";cell.disabled=true}else{if(/disabled/i.test(status)){cell.disabled=true}cell.className+=" "+status}}if(!cell.disabled){cell.caldate=new Date(date);cell.ttip="_";if(!this.multiple&&current_month&&iday==mday&&this.hiliteToday){cell.className+=" selected";this.currentDateEl=cell}if(date.getFullYear()==TY&&date.getMonth()==TM&&iday==TD){cell.className+=" today";cell.ttip+=Calendar._TT["PART_TODAY"]}if(weekend.indexOf(wday.toString())!=-1){cell.className+=cell.otherMonth?" oweekend":" weekend"}}}if(!(hasdays||this.showsOtherMonths)){row.className="emptyrow"}}this.title.innerHTML=Calendar._MN[month]+", "+year;this.onSetTime();this.table.style.visibility="visible";this._initMultipleDates()};Calendar.prototype._initMultipleDates=function(){if(this.multiple){for(var i in this.multiple){var cell=this.datesCells[i];var d=this.multiple[i];if(!d){continue}if(cell){cell.className+=" selected"}}}};Calendar.prototype._toggleMultipleDate=function(date){if(this.multiple){var ds=date.print("%Y%m%d");var cell=this.datesCells[ds];if(cell){var d=this.multiple[ds];if(!d){Calendar.addClass(cell,"selected");this.multiple[ds]=date}else{Calendar.removeClass(cell,"selected");delete this.multiple[ds]}}}};Calendar.prototype.setDateToolTipHandler=function(unaryFunction){this.getDateToolTip=unaryFunction};Calendar.prototype.setDate=function(date){if(!date.equalsTo(this.date)){this._init(this.firstDayOfWeek,date)}};Calendar.prototype.refresh=function(){this._init(this.firstDayOfWeek,this.date)};Calendar.prototype.setFirstDayOfWeek=function(firstDayOfWeek){this._init(firstDayOfWeek,this.date);this._displayWeekdays()};Calendar.prototype.setDateStatusHandler=Calendar.prototype.setDisabledHandler=function(unaryFunction){this.getDateStatus=unaryFunction};Calendar.prototype.setRange=function(a,z){this.minYear=a;this.maxYear=z};Calendar.prototype.callHandler=function(){if(this.onSelected){this.onSelected(this,this.date.print(this.dateFormat))}};Calendar.prototype.callCloseHandler=function(){if(this.onClose){this.onClose(this)}};Calendar.prototype.destroy=function(){var el=this.element.parentNode;el.removeChild(this.element);Calendar._C=null;window._dynarch_popupCalendar=null};Calendar.prototype.reparent=function(new_parent){var el=this.element;el.parentNode.removeChild(el);new_parent.appendChild(el)};Calendar._checkCalendar=function(ev){var calendar=window._dynarch_popupCalendar;if(!calendar){return false}var el=Calendar.is_ie?Calendar.getElement(ev):Calendar.getTargetElement(ev);for(;el!=null&&el!=calendar.element;el=el.parentNode){}if(el==null){window._dynarch_popupCalendar.callCloseHandler();return Calendar.stopEvent(ev)}};Calendar.prototype.show=function(){if(this.params.inputField.disabled){return }var rows=this.table.getElementsByTagName("tr");for(var i=rows.length;i>0;){var row=rows[--i];Calendar.removeClass(row,"rowhilite");var cells=row.getElementsByTagName("td");for(var j=cells.length;j>0;){var cell=cells[--j];Calendar.removeClass(cell,"hilite");Calendar.removeClass(cell,"active")}}Calendar.current=this;this.element.style.display="block";this.element.className+=" active";this.hidden=false;if(this.isPopup){window._dynarch_popupCalendar=this;Calendar.addEvent(document,"keyup",Calendar._upkeyEvent);Calendar.addEvent(document,"keydown",Calendar._keyEvent);Calendar.addEvent(document,"mousedown",Calendar._checkCalendar)}};Calendar.prototype.hide=function(){if(this.isPopup){Calendar.removeEvent(document,"keyup",Calendar._upkeyEvent);Calendar.removeEvent(document,"keydown",Calendar._keyEvent);Calendar.removeEvent(document,"mousedown",Calendar._checkCalendar)}Calendar.current=null;this.element.style.display="none";this.element.className=this.element.className.replace(/active/gi,"");this.hidden=true};Calendar.prototype.showAt=function(x,y){var s=this.element.style;s.left=x+"px";s.top=y+"px";this.show()};Calendar.prototype.showAtElement=function(el,opts){var self=this;var p=Calendar.getAbsolutePos(el);if(!opts||typeof opts!="string"){this.showAt(p.x,p.y+el.offsetHeight);return true}function fixPosition(box){if(box.x<0){box.x=0}if(box.y<0){box.y=0}var cp=document.createElement("div");var s=cp.style;s.position="absolute";s.right=s.bottom=s.width=s.height="0px";document.body.appendChild(cp);var br=Calendar.getAbsolutePos(cp);document.body.removeChild(cp);br.y+=jQuery(window).scrollTop();br.x+=jQuery(window).scrollLeft();var tmp=box.x+box.width-br.x;if(tmp>0){box.x-=tmp}tmp=box.y+box.height-br.y;if(tmp>0){box.y-=tmp}}this.element.style.display="block";Calendar.continuation_for_the_khtml_browser=function(){var w=jQuery(self.element).outerWidth();var h=jQuery(self.element).outerHeight();self.element.style.display="none";var valign=opts.substr(0,1);var halign="l";if(opts.length>1){halign=opts.substr(1,1)}switch(valign){case"T":p.y-=h;break;case"B":p.y+=jQuery(el).outerHeight();break;case"C":p.y+=(jQuery(el).outerHeight()-h)/2;break;case"t":p.y+=jQuery(el).outerHeight()-h;break;case"b":break}switch(halign){case"L":p.x-=w;break;case"R":p.x+=jQuery(el).outerWidth();break;case"C":p.x+=(jQuery(el).outerWidth()-w)/2;break;case"l":p.x+=jQuery(el).outerWidth()-w;break;case"r":break}p.width=w;p.height=h+40;self.monthsCombo.style.display="none";fixPosition(p);self.showAt(p.x,p.y)};Calendar.continuation_for_the_khtml_browser()};Calendar.prototype.setDateFormat=function(str){this.dateFormat=str};Calendar.prototype.setTtDateFormat=function(str){this.ttDateFormat=str};Calendar.prototype.parseDate=function(str,fmt){if(!fmt){fmt=this.dateFormat}this.setDate(Date.parseDate(str,fmt))};Calendar.prototype._displayWeekdays=function(){var fdow=this.firstDayOfWeek;var cell=this.firstdayname;var weekend=Calendar._TT["WEEKEND"];for(var i=0;i<7;++i){cell.className="day name";var realday=(i+fdow)%7;if(i){cell.ttip=Calendar._TT["DAY_FIRST"].replace("%s",Calendar._DN[realday]);cell.navtype=100;cell.calendar=this;cell.fdow=realday;Calendar._add_evs(cell)}if(weekend.indexOf(realday.toString())!=-1){Calendar.addClass(cell,"weekend")}cell.innerHTML=Calendar._SDN[(i+fdow)%7];cell=cell.nextSibling}};Calendar.prototype._hideCombos=function(){this.monthsCombo.style.display="none";this.yearsCombo.style.display="none"};Calendar.prototype._dragStart=function(ev){if(this.dragging){return }this.dragging=true;var posX;var posY;if(Calendar.is_ie){posY=window.event.clientY+document.body.scrollTop;posX=window.event.clientX+document.body.scrollLeft}else{posY=ev.clientY+window.scrollY;posX=ev.clientX+window.scrollX}var st=this.element.style;this.xOffs=posX-parseInt(st.left);this.yOffs=posY-parseInt(st.top);with(Calendar){addEvent(document,"mousemove",calDragIt);addEvent(document,"mouseup",calDragEnd)}};Date._MD=new Array(31,28,31,30,31,30,31,31,30,31,30,31);Date.SECOND=1000;Date.MINUTE=60*Date.SECOND;Date.HOUR=60*Date.MINUTE;Date.DAY=24*Date.HOUR;Date.WEEK=7*Date.DAY;Date._multisplit=function(s,seps){if(s==null){return null}if(seps==null){seps=""}var arr=[];var len=s.length;var token="";var inWord=false;for(i=0;i<len;i++){var c=s.charAt(i);if(seps.indexOf(c)==-1){inWord=true;token+=c}else{if(inWord){arr[arr.length]=token;token="";inWord=false}}}if(token.length>0){arr[arr.length]=token}if(arr.length==0){arr[arr.length]=""}return arr};Date._parseNonDateFormatChars=function(s){var magicChars="aAbBCdeHIJklmMnpPRSstUWVuwyY%";var nonMagicChars="";var len=s.length;var inMagic=false;for(i=0;i<len;i++){var c=s.charAt(i);if(c=="%"){var peekc="";if(i+1<len){peekc=s.charAt(i+1)}i=i+1;if(peekc.length>0&&magicChars.indexOf(peekc)!=-1){continue}else{if(nonMagicChars.indexOf(c)==-1){nonMagicChars+=c}if(peekc.length>0&&nonMagicChars.indexOf(peekc)==-1){nonMagicChars+=peekc}}}else{if(nonMagicChars.indexOf(c)==-1){nonMagicChars+=c}}}return nonMagicChars};Date.parseDate=function(str,fmt){var today=new Date();var y=0;var m=-1;var d=0;var seps=Date._parseNonDateFormatChars(fmt);var a=Date._multisplit(str,seps);var b=fmt.match(/%./g);var i=0,j=0;var hr=0;var min=0;for(i=0;i<a.length;++i){if(!a[i]){continue}switch(b[i]){case"%d":case"%e":d=parseInt(a[i],10);break;case"%m":m=parseInt(a[i],10)-1;break;case"%Y":case"%y":y=parseInt(a[i],10);(y<100)&&(y+=(y>29)?1900:2000);break;case"%b":case"%B":var monthName=a[i].toLowerCase();var found=false;if(b[i]=="%b"){for(j=0;j<12;++j){if(Calendar._SMN[j].substr(0,monthName.length).toLowerCase()==monthName){m=j;found=true;break}}}if(!found){for(j=0;j<12;++j){if(Calendar._MN[j].substr(0,monthName.length).toLowerCase()==monthName){m=j;break}}}break;case"%H":case"%I":case"%k":case"%l":hr=parseInt(a[i],10);break;case"%P":case"%p":if(/pm/i.test(a[i])&&hr<12){hr+=12}else{if(/am/i.test(a[i])&&hr>=12){hr-=12}}break;case"%M":min=parseInt(a[i],10);break;case"%R":var hrMinString=a[i];var hrMinSeparator=hrMinString.indexOf(":");var hrString=hrMinString.substring(0,hrMinSeparator);var minString=hrMinSeparator==-1?0:hrMinString.substring(hrMinSeparator+1);hr=parseInt(hrString,10);min=parseInt(minString,10);break}}if(isNaN(y)){y=today.getFullYear()}if(isNaN(m)){m=today.getMonth()}if(isNaN(d)){d=today.getDate()}if(isNaN(hr)){hr=today.getHours()}if(isNaN(min)){min=today.getMinutes()}if(y!=0&&m!=-1&&d!=0){return new Date(y,m,d,hr,min,0)}y=0;m=-1;d=0;for(i=0;i<a.length;++i){if(a[i].search(/[a-zA-Z]+/)!=-1){var t=-1;for(j=0;j<12;++j){if(Calendar._MN[j].substr(0,a[i].length).toLowerCase()==a[i].toLowerCase()){t=j;break}}if(t!=-1){if(m!=-1){d=m+1}m=t}}else{if(parseInt(a[i],10)<=12&&m==-1){m=a[i]-1}else{if(parseInt(a[i],10)>31&&y==0){y=parseInt(a[i],10);(y<100)&&(y+=(y>29)?1900:2000)}else{if(d==0){d=a[i]}}}}}if(y==0){y=today.getFullYear()}if(m!=-1&&d!=0){return new Date(y,m,d,hr,min,0)}return today};Date.prototype.getMonthDays=function(month){var year=this.getFullYear();if(typeof month=="undefined"){month=this.getMonth()}if(((0==(year%4))&&((0!=(year%100))||(0==(year%400))))&&month==1){return 29}else{return Date._MD[month]}};Date.prototype.getDayOfYear=function(){var now=new Date(this.getFullYear(),this.getMonth(),this.getDate(),0,0,0);var then=new Date(this.getFullYear(),0,0,0,0,0);var time=now-then;return Math.floor(time/Date.DAY)};Date.prototype.getWeekNumber=function(startOfWeek){if(Date.useISO8601WeekNumbers){return this.getISO8601WeekNumber()}else{return this.getSimpleWeekNumber(startOfWeek)}};Date.prototype.getISO8601WeekNumber=function(){function gregdaynumber(year,month,day){y=year;m=month;if(month<3){y=y-1}if(month<3){m=m+12}return Math.floor(365.25*y)-Math.floor(y/100)+Math.floor(y/400)+Math.floor(30.6*(m+1))+day-62}function isocalendar1(date){year=date.getFullYear();month=date.getMonth();day=date.getDate();wday=date.getDay();weekday=((wday+6)%7)+1;isoyear=year;d0=gregdaynumber(year,1,0);weekday0=((d0+4)%7)+1;d=gregdaynumber(year,month+1,day);isoweeknr=Math.floor((d-d0+weekday0+6)/7)-Math.floor((weekday0+3)/7);if((month==11)&&((day-weekday)>27)){isoweeknr=1;isoyear=isoyear+1}if((month==0)&&((weekday-day)>3)){d0=gregdaynumber(year-1,1,0);weekday0=((d0+4)%7)+1;isoweeknr=Math.floor((d-d0+weekday0+6)/7)-Math.floor((weekday0+3)/7);isoyear=isoyear-1}return isoweeknr}return isocalendar1(this)};Date.prototype.getSimpleWeekNumber=function(startOfWeek){function OddWkNo1(D,d1,d2){var Yr=D.getFullYear(),Jan1=new Date(Yr,0,1),Q;Q=Math.round((D-Jan1)/86400000);if(d1!=null){Q-=(7+d1-Jan1.getDay())%7}if(d2!=null){Q+=d2}return[Yr,1+Q/7|0,1+(7+Q)%7]}return OddWkNo1(this,startOfWeek?startOfWeek:6,6)[1]};Date.prototype.equalsTo=function(date){return((this.getFullYear()==date.getFullYear())&&(this.getMonth()==date.getMonth())&&(this.getDate()==date.getDate())&&(this.getHours()==date.getHours())&&(this.getMinutes()==date.getMinutes()))};Date.prototype.setDateOnly=function(date){var tmp=new Date(date);this.setDate(1);this.setFullYear(tmp.getFullYear());this.setMonth(tmp.getMonth());this.setDate(tmp.getDate())};Date.prototype.print=function(str){var m=this.getMonth();var d=this.getDate();var y=this.getFullYear();var wn=this.getWeekNumber();var w=this.getDay();var s={};var hr=this.getHours();var pm=(hr>=12);var ir=(pm)?(hr-12):hr;var dy=this.getDayOfYear();if(ir==0){ir=12}var min=this.getMinutes();var sec=this.getSeconds();s["%a"]=Calendar._SDN[w];s["%A"]=Calendar._DN[w];s["%b"]=Calendar._SMN[m];s["%B"]=Calendar._MN[m];s["%C"]=1+Math.floor(y/100);s["%d"]=(d<10)?("0"+d):d;s["%e"]=d;s["%H"]=(hr<10)?("0"+hr):hr;s["%I"]=(ir<10)?("0"+ir):ir;s["%j"]=(dy<100)?((dy<10)?("00"+dy):("0"+dy)):dy;s["%k"]=hr;s["%l"]=ir;s["%m"]=(m<9)?("0"+(1+m)):(1+m);s["%M"]=(min<10)?("0"+min):min;s["%n"]="\n";s["%p"]=pm?Calendar._TT["PM"]:Calendar._TT["AM"];s["%P"]=pm?Calendar._TT["PM"]:Calendar._TT["AM"];s["%R"]=s["%k"]+":"+s["%M"];s["%s"]=Math.floor(this.getTime()/1000);s["%S"]=(sec<10)?("0"+sec):sec;s["%t"]="\t";s["%U"]=s["%W"]=s["%V"]=(wn<10)?("0"+wn):wn;s["%u"]=w+1;s["%w"]=w;s["%y"]=(""+y).slice(-2);s["%Y"]=y;s["%%"]="%";var re=/%./g;if(!Calendar.is_ie5&&!Calendar.is_khtml){return str.replace(re,function(par){return s[par]||par})}var a=str.match(re);for(var i=0;i<a.length;i++){var tmp=s[a[i]];if(tmp){re=new RegExp(a[i],"g");str=str.replace(re,tmp)}}return str};Date.prototype.__msh_oldSetFullYear=Date.prototype.setFullYear;Date.prototype.setFullYear=function(y){var d=new Date(this);d.__msh_oldSetFullYear(y);if(d.getMonth()!=this.getMonth()){this.setDate(28)}this.__msh_oldSetFullYear(y)};window._dynarch_popupCalendar=null;
/* module-key = 'jira.webresources:calendar', location = '/includes/lib/calendar/Calendar.setup.js' */
Calendar.setup=function(params){function param_default(pname,def){if(typeof params[pname]=="undefined"){params[pname]=def}}param_default("inputField",null);param_default("context",null);param_default("displayArea",null);param_default("button",null);param_default("eventName","click");param_default("ifFormat","%Y/%m/%d");param_default("daFormat","%Y/%m/%d");param_default("singleClick",true);param_default("disableFunc",null);param_default("dateStatusFunc",params["disableFunc"]);param_default("dateText",null);param_default("firstDay",null);param_default("align","Br");param_default("range",[1900,2999]);param_default("weekNumbers",true);param_default("useISO8601WeekNumbers",false);param_default("flat",null);param_default("flatCallback",null);param_default("onSelect",null);param_default("onClose",null);param_default("onUpdate",null);param_default("date",null);param_default("showsTime",false);param_default("timeFormat","24");param_default("electric",true);param_default("step",1);param_default("position",null);param_default("cache",false);param_default("showOthers",false);param_default("multiple",null);var tmp=["inputField","displayArea","button"];for(var i in tmp){if(typeof params[tmp[i]]=="string"){var id="#"+params[tmp[i]].escapejQuerySelector();if(params.context){params[tmp[i]]=AJS.$(params.context).find(id).get(0)}else{params[tmp[i]]=AJS.$(id).get(0)}}}if(!(params.flat||params.multiple||params.inputField||params.displayArea||params.button)){AJS.log("Calendar.setup:\n  Nothing to setup (no fields found).  Please check your code");return false}if(params.firstDay&&params.firstDay!==null){params.firstDay=+params.firstDay}function onSelect(cal){var p=cal.params;var update=(cal.dateClicked||p.electric);if(update&&p.inputField){p.inputField.value=cal.date.print(p.ifFormat);jQuery(p.inputField).change()}if(update&&p.displayArea){p.displayArea.innerHTML=cal.date.print(p.daFormat)}if(update&&typeof p.onUpdate=="function"){p.onUpdate(cal)}if(update&&p.flat){if(typeof p.flatCallback=="function"){p.flatCallback(cal)}}if(p.singleClick==="true"){p.singleClick=true}else{if(p.singleClick==="false"){p.singleClick=false}}if(update&&p.singleClick&&cal.dateClicked){cal.callCloseHandler()}}if(params.flat!=null){if(typeof params.flat=="string"){params.flat=document.getElementById(params.flat)}if(!params.flat){AJS.log("Calendar.setup:\n  Flat specified but can't find parent.");return false}var cal=new Calendar(params.firstDay,params.date,params.onSelect||onSelect);cal.showsOtherMonths=params.showOthers;cal.showsTime=params.showsTime;cal.time24=(params.timeFormat=="24");cal.params=params;cal.weekNumbers=params.weekNumbers;cal.setRange(params.range[0],params.range[1]);cal.setDateStatusHandler(params.dateStatusFunc);cal.getDateText=params.dateText;if(params.ifFormat){cal.setDateFormat(params.ifFormat)}if(params.inputField&&typeof params.inputField.value=="string"){cal.parseDate(params.inputField.value)}cal.create(params.flat);cal.show();return false}var triggerEl=params.button||params.displayArea||params.inputField;jQuery(triggerEl).bind(params.eventName,function(e){e.preventDefault();createCalendar()});if(params.inputField){enhanceInputField()}function createCalendar(){if(Calendar._UNSUPPORTED===true){alert("The JIRA Calendar does not currently support your language.");return }var dateEl=params.inputField||params.displayArea;var dateFmt=params.inputField?params.ifFormat:params.daFormat;var mustCreate=false;var cal=window.calendar;if(cal){cal.hide()}if(dateEl){if(dateEl.value||dateEl.innerHTML){params.date=Date.parseDate(dateEl.value||dateEl.innerHTML,dateFmt)}}if(!(cal&&params.cache)){window.calendar=cal=new Calendar(params.firstDay,params.date,params.onSelect||onSelect,params.onClose||function(cal){cal.hide()});cal.showsTime=params.showsTime;cal.time24=(params.timeFormat=="24");cal.weekNumbers=params.weekNumbers;Date.useISO8601WeekNumbers=params.useISO8601WeekNumbers;if(params.useISO8601WeekNumbers){cal.firstDayOfWeek=1}mustCreate=true}else{if(params.date){cal.setDate(params.date)}cal.hide()}if(params.multiple){cal.multiple={};for(var i=params.multiple.length;--i>=0;){var d=params.multiple[i];var ds=d.print("%Y%m%d");cal.multiple[ds]=d}}cal.showsOtherMonths=params.showOthers;cal.yearStep=params.step;cal.setRange(params.range[0],params.range[1]);cal.params=params;cal.setDateStatusHandler(params.dateStatusFunc);cal.getDateText=params.dateText;cal.setDateFormat(dateFmt);if(mustCreate){cal.create()}cal.refresh();if(!params.position){cal.showAtElement(params.button||params.displayArea||params.inputField,params.align)}else{cal.showAt(params.position[0],params.position[1])}return false}function enhanceInputField(){var $inputField=jQuery(params.inputField);if(params.button){jQuery(params.button).mousedown(function(e){e.preventDefault();if(!$inputField.is(":focus")&&$inputField.is(":enabled")){$inputField.focus()}})}$inputField.keydown(function(e){var cal=window.calendar;if(e.keyCode===40){if(!cal||cal.hidden){setTimeout(function(){createCalendar()},1)}}})}return cal};
/* module-key = 'jira.webresources:autocomplete', location = '/includes/jira/dropdown/Dropdown.js' */
JIRA.Dropdown=function(){var instances=[];return{addInstance:function(){instances.push(this)},hideInstances:function(){var that=this;jQuery(instances).each(function(){if(that!==this){this.hideDropdown()}})},getHash:function(){if(!this.hash){this.hash={container:this.dropdown,hide:this.hideDropdown,show:this.displayDropdown}}return this.hash},displayDropdown:function(){if(JIRA.Dropdown.current===this){return }this.hideInstances();JIRA.Dropdown.current=this;this.dropdown.css({display:"block"});this.displayed=true;var dd=this.dropdown;if(!window.top.JIRA.Dialog.current){setTimeout(function(){var win=jQuery(window);var minScrollTop=dd.offset().top+dd.prop("offsetHeight")-win.height()+10;if(win.scrollTop()<minScrollTop){jQuery("html,body").animate({scrollTop:minScrollTop},300,"linear")}},100)}},hideDropdown:function(){if(this.displayed===false){return }JIRA.Dropdown.current=null;this.dropdown.css({display:"none"});this.displayed=false},init:function(trigger,dropdown){var that=this;this.addInstance(this);this.dropdown=jQuery(dropdown);this.dropdown.css({display:"none"});jQuery(document).keydown(function(e){if(e.keyCode===9){that.hideDropdown()}});if(trigger.target){jQuery.aop.before(trigger,function(){if(!that.displayed){that.displayDropdown()}})}else{that.dropdown.css("top",jQuery(trigger).outerHeight()+"px");trigger.click(function(e){if(!that.displayed){that.displayDropdown();e.stopPropagation()}else{that.hideDropdown()}e.preventDefault()})}jQuery(document.body).click(function(){if(that.displayed){that.hideDropdown()}})}}}();JIRA.Dropdown.Standard=function(trigger,dropdown){var that=begetObject(JIRA.Dropdown);that.init(trigger,dropdown);return that};JIRA.Dropdown.AutoComplete=function(trigger,dropdown){var that=begetObject(JIRA.Dropdown);that.init=function(trigger,dropdown){this.addInstance(this);this.dropdown=jQuery(dropdown).click(function(e){e.stopPropagation()});this.dropdown.css({display:"none"});if(trigger.target){jQuery.aop.before(trigger,function(){if(!that.displayed){that.displayDropdown()}})}else{trigger.click(function(e){if(!that.displayed){that.displayDropdown();e.stopPropagation()}})}jQuery(document.body).click(function(){if(that.displayed){that.hideDropdown()}})};that.init(trigger,dropdown);return that};AJS.namespace("jira.widget.dropdown",null,JIRA.Dropdown);
/* module-key = 'jira.webresources:autocomplete', location = '/includes/jira/autocomplete/AutoComplete.js' */
JIRA.AutoComplete=function(){var inFocus;var delay=function(callback,l){if(delay.t){clearTimeout(delay.t);delay.t=undefined}delay.t=setTimeout(callback,l*1000)};var INVALID_KEYS={9:true,13:true,14:true,25:true,27:true,38:true,40:true,224:true};return{dispatcher:function(){},getSavedResponse:function(){},saveResponse:function(){},renderSuggestions:function(){},disable:function(){this.disabled=true},enable:function(){this.disabled=false},set:function(options){for(var name in options){if(options.hasOwnProperty(name)){this[name]=options[name]}}},completeField:function(value){if(value){this.field.val(value).focus();this.field.trigger("change")}},textToSuggestionCursorPosition:function(){return this.field.val()},_makeRequest:function(options){var that=this,requestParams=AJS.copyObject(options);if(this.pendingRequest){this.pendingRequest.abort()}requestParams.complete=function(){that.pendingRequest=null};requestParams.error=function(xhr){if(!xhr.aborted&&xhr.status!==0&&options.error){options.error.apply(this,arguments)}};return this.pendingRequest=JIRA.SmartAjax.makeRequest(requestParams)},addSuggestionControls:function(suggestionNodes){var that=this;var evaluateIndex=function(idx,max){var minBoundary=(that.autoSelectFirst===false)?-1:0;if(that.allowArrowCarousel){if(idx>max){return minBoundary}else{if(idx<minBoundary){return max}else{return idx}}}else{if(idx>max){return max}else{if(idx<minBoundary){that.responseContainer.scrollTop(0);return minBoundary}else{return idx}}}};var setActive=function(idx){if(that.selectedIndex!==undefined&&that.selectedIndex>-1){that.suggestionNodes[that.selectedIndex][0].removeClass("active")}that.selectedIndex=evaluateIndex(idx,that.suggestionNodes.length-1);if(that.selectedIndex>-1){that.suggestionNodes[that.selectedIndex][0].addClass("active")}};var evaluateIfActive=function(){return that.suggestionNodes&&that.suggestionNodes[that.selectedIndex]&&that.suggestionNodes[that.selectedIndex][0].hasClass("active")};var keyPressHandler=function(e){if(that.responseContainer.is(":visible")){if(e.keyCode===13){if(evaluateIfActive()&&!that.pendingRequest){that.completeField(that.suggestionNodes[that.selectedIndex][1])}e.preventDefault();e.stopPropagation()}}};var keyboardNavigateHandler=function(e){if(that.responseContainer.is(":visible")){if(that.field[0]!==document.activeElement){that.field.focus()}if(e.keyCode===40){setActive(that.selectedIndex+1);if(that.selectedIndex>=0){var containerHeight=that.responseContainer.height();var bottom=that.suggestionNodes[that.selectedIndex][0].position().top+that.suggestionNodes[that.selectedIndex][0].outerHeight();if(bottom-containerHeight>0){that.responseContainer.scrollTop(that.responseContainer.scrollTop()+bottom-containerHeight+2)}}else{that.responseContainer.scrollTop(0)}e.preventDefault()}else{if(e.keyCode===38){setActive(that.selectedIndex-1);if(that.selectedIndex>=0){var top=that.suggestionNodes[that.selectedIndex][0].position().top;if(top<0){that.responseContainer.scrollTop(that.responseContainer.scrollTop()+top-2)}}e.preventDefault()}else{if(e.keyCode===9){if(evaluateIfActive()){that.completeField(that.suggestionNodes[that.selectedIndex][1]);e.preventDefault()}else{that.dropdownController.hideDropdown()}}}}}};if(suggestionNodes.length){this.selectedIndex=0;this.suggestionNodes=suggestionNodes;for(var i=0;i<that.suggestionNodes.length;i++){var eventData={instance:this,index:i};this.suggestionNodes[i][0].bind("mouseover",eventData,activate).bind("mouseout",eventData,deactivate).bind("click",eventData,complete)}if(!this.keyboardHandlerBinded){jQuery(this.field).keypress(keyPressHandler);if(jQuery.browser.mozilla){jQuery(this.field).keypress(keyboardNavigateHandler)}else{jQuery(this.field).keydown(keyboardNavigateHandler)}this.keyboardHandlerBinded=true}if(that.autoSelectFirst===false){setActive(-1)}else{setActive(0)}inFocus=this}function activate(event){if(that.dropdownController.displayed){setActive(event.data.index)}}function deactivate(event){if(event.data.index===0){that.selectedIndex=-1}jQuery(this).removeClass("active")}function complete(event){that.completeField(that.suggestionNodes[event.data.index][1])}},clearResponseContainer:function(){this.responseContainer.empty();this.suggestionNodes=undefined},delay:delay,buildResponseContainer:function(){var inputParent=this.field.parent().addClass("atlassian-autocomplete");this.responseContainer=jQuery(document.createElement("div"));this.responseContainer.addClass("suggestions");this.positionResponseContainer();this.responseContainer.appendTo(inputParent)},positionResponseContainer:function(){this.responseContainer.css({top:this.field.outerHeight()})},keyUpHandler:(function(){var isIe8=jQuery.browser.msie&&jQuery.browser.version==8;function callback(){if(!this.responseContainer){this.buildResponseContainer()}this.dispatcher(this.field.val())}return function(e){if(this.field.val().length>=this.minQueryLength){if(!(e.keyCode in INVALID_KEYS)||(this.responseContainer&&!this.responseContainer.is(":visible")&&(e.keyCode==38||e.keyCode==40))){if(isIe8){delay(jQuery.proxy(callback,this),0.2)}else{callback.call(this)}}}return e}})(),addMultiSelectAdvice:function(delim){var that=this;var alertUserValueAlreadyExists=function(val){if(!alertUserValueAlreadyExists.isAlerting){alertUserValueAlreadyExists.isAlerting=true;var userAlert=jQuery(document.createElement("div")).css({"float":"left",display:"none"}).addClass("warningBox").html("Oops! You have already entered the value <em>"+val+"</em>").appendTo(that.field.parent()).show("fast",function(){that.delay(function(){userAlert.hide("fast",function(){userAlert.remove();alertUserValueAlreadyExists.isAlerting=false})},4)})}};jQuery.aop.before({target:this,method:"dispatcher"},function(innvocation){var val=this.field.val();innvocation[0]=jQuery.trim(val.slice(val.lastIndexOf(delim)+1));return innvocation});jQuery.aop.before({target:this,method:"completeField"},function(args){var valueToAdd=args[0],untrimmedVals=this.field.val().split(delim);var trimmedVals=jQuery(untrimmedVals).map(function(){return jQuery.trim(this)}).get();if(!this.allowDuplicates&&new RegExp("(?:^|[\\s"+delim+"])"+valueToAdd+"\\s*"+delim).test(this.field.val())){alertUserValueAlreadyExists(valueToAdd);trimmedVals[trimmedVals.length-1]=""}else{trimmedVals[trimmedVals.length-1]=valueToAdd;trimmedVals[trimmedVals.length]=""}args[0]=trimmedVals.join(delim.replace(/([^\s]$)/,"$1 "));return args})},addDropdownAdvice:function(){var that=this;jQuery.aop.after({target:this,method:"buildResponseContainer"},function(args){this.dropdownController=JIRA.Dropdown.AutoComplete({target:this,method:"renderSuggestions"},this.responseContainer);jQuery.aop.after({target:this.dropdownController,method:"hideDropdown"},function(){this.dropdown.removeClass("dropdown-ready")});return args});jQuery.aop.after({target:this,method:"renderSuggestions"},function(args){if(args&&args.length>0){this.dropdownController.displayDropdown();if(this.maxHeight&&this.dropdownController.dropdown.prop("scrollHeight")>this.maxHeight){this.dropdownController.dropdown.css({height:this.maxHeight,overflowX:"visible",overflowY:"scroll"})}else{if(this.maxHeight){this.dropdownController.dropdown.css({height:"",overflowX:"",overflowY:""})}}this.dropdownController.dropdown.addClass("dropdown-ready")}else{this.dropdownController.hideDropdown()}return args});jQuery.aop.after({target:this,method:"completeField"},function(args){this.dropdownController.hideDropdown();return args});jQuery.aop.after({target:this,method:"keyUpHandler"},function(e){if((!(this.field.val().length>=this.minQueryLength)||e.keyCode===27)&&this.dropdownController&&this.dropdownController.displayed){this.dropdownController.hideDropdown();if(e.keyCode===27){e.stopPropagation()}}return e})},init:function(options){var that=this;this.set(options);this.field=this.field||jQuery("#"+this.fieldID);this.field.attr("autocomplete","off").keyup(function(e){if(!that.disabled){that.keyUpHandler(e)}}).keydown(function(e){var ESC_KEY=27;if(e.keyCode===ESC_KEY&&that.responseContainer&&that.responseContainer.is(":visible")){e.preventDefault()}}).click(function(e){if(inFocus===that){e.stopPropagation()}}).blur(function(){if(that.pendingRequest){that.pendingRequest.abort()}});this.addDropdownAdvice();if(options.delimChar){this.addMultiSelectAdvice(options.delimChar)}}}}();AJS.namespace("jira.widget.autocomplete",null,JIRA.AutoComplete);
/* module-key = 'jira.webresources:autocomplete', location = '/includes/jira/autocomplete/RESTAutoComplete.js' */
JIRA.RESTAutoComplete=function(){var that=begetObject(JIRA.AutoComplete);that.dispatcher=function(reqFieldVal){var that=this;if(reqFieldVal.length<this.minQueryLength){return }if(!this.getSavedResponse(reqFieldVal)){this.delay(function(){var params=that.getAjaxParams();params.data.query=reqFieldVal;params.success=function(data){that.saveResponse(reqFieldVal,data);that.responseContainer.scrollTop(0);that.renderSuggestions(data)};that._makeRequest(params)},that.queryDelay)}else{that.renderSuggestions(that.getSavedResponse(reqFieldVal));that.responseContainer.scrollTop(0)}};that.getAjaxParams=function(){};that.getSavedResponse=function(val){if(!this.requested){this.requested={}}return this.requested[val]};that.saveResponse=function(val,response){if(typeof val==="string"&&typeof response==="object"){if(!this.requested){this.requested={}}this.requested[val]=response}};return that}();AJS.namespace("jira.widget.autocomplete.REST",null,JIRA.RESTAutoComplete);
/* module-key = 'jira.webresources:autocomplete', location = '/includes/jira/autocomplete/IssueAutoComplete.js' */
JIRA.IssueAutoComplete=function(options){var that=begetObject(JIRA.RESTAutoComplete);that.getAjaxParams=function(){return{url:contextPath+"/rest/api/1.0/issues/picker",data:options.ajaxData,dataType:"json",type:"GET"}};that.renderSuggestions=function(response){var resultsContainer,suggestionNodes=[];this.clearResponseContainer();if(response&&response.sections&&response.sections.length>0){resultsContainer=AJS.$("<ul/>").appendTo(this.responseContainer);AJS.$(response.sections).each(function(){var section=this;var subSection=AJS.$("<div/>").attr("id",options.fieldID+"_s_"+section.id).addClass("yag").text(section.label);if(section.sub){subSection.append(AJS.$("<span/>").addClass("yagt").text("("+section.sub+")"))}resultsContainer.append(AJS.$("<li/>").append(subSection).mouseover(function(){AJS.$(this).addClass("active")}).mouseout(function(){AJS.$(this).removeClass("active")}));if(section.msg){var msg=AJS.$("<div/>").attr("id",options.fieldID+"_i_"+section.id+"_n").addClass("yad").text(section.msg);resultsContainer.append(AJS.$("<li/>").append(msg).mouseover(function(){AJS.$(this).addClass("active")}).mouseout(function(){AJS.$(this).removeClass("active")}))}if(section.issues&&section.issues.length>0){AJS.$(section.issues).each(function(){var imgUrl;if(/^http/.test(this.img)){imgUrl=this.img}else{imgUrl=contextPath+this.img}var issueNode=AJS.$("<li/>").append(AJS.$("<div/>").attr("id",options.fieldID+"_i_"+section.id+"_"+this.key).addClass("yad").append(AJS.$("<table/>").addClass("yat").attr({cellpadding:"0",cellspacing:"0"}).append(AJS.$("<tr/>").append(AJS.$("<td/>").append(AJS.$("<img/>").attr("src",imgUrl))).append(AJS.$("<td/>").append(AJS.$("<div/>").addClass("yak").html(this.keyHtml))).append(AJS.$("<td/>").css("width","100%").html(this.summary)))));resultsContainer.append(issueNode);suggestionNodes.push([issueNode,this.key])})}});that.addSuggestionControls(suggestionNodes);return suggestionNodes}};options.minQueryLength=1;options.queryDelay=0.25;that.init(options);return that};JIRA.IssueAutoComplete.init=function(){AJS.$("fieldset.issue-picker-params").each(function(){var params=JIRA.parseOptionsFromFieldset(AJS.$(this)),$container=AJS.$("#"+params.fieldId+"-container").add("#"+params.fieldName+"_container");$container.find("a.popup-trigger").click(function(e){var url=contextPath+"/secure/popups/IssuePicker.jspa?";url+="currentIssue="+params.currentIssueKey+"&";url+="singleSelectOnly="+params.singleSelectOnly+"&";url+="showSubTasks="+params.showSubTasks+"&";url+="showSubTasksParent="+params.showSubTaskParent;if(params.currentProjectId&&params.currentProjectId!=""){url+="&selectedProjectId="+params.currentProjectId}JIRA.IssuePicker.callback=function(keysMap){var $formElement,keys=[];keysMap=JSON.parse(keysMap);if(params.fieldId&&keys){$formElement=AJS.$("#"+params.fieldId);if($formElement){AJS.$.each(keysMap,function(){keys.push(this.value)});$formElement.val(keys.join(", "))}}};var vWinUsers=window.open(url,"IssueSelectorPopup","status=no,resizable=yes,top=100,left=200,width=620,height=500,scrollbars=yes,resizable");vWinUsers.opener=self;vWinUsers.focus();e.preventDefault()});if(!params.fieldId){params.fieldId=params.fieldName}if(params.issuePickerEnabled===true){JIRA.IssueAutoComplete({fieldID:params.fieldId,delimChar:params.singleSelectOnly===true?undefined:",",ajaxData:params})}})};AJS.namespace("jira.widget.autocomplete.Issues",null,JIRA.IssueAutoComplete);
/* module-key = 'jira.webresources:autocomplete', location = '/includes/jira/autocomplete/UserAutoComplete.js' */
JIRA.UserAutoComplete=function(options){var that=begetObject(JIRA.RESTAutoComplete);that.getAjaxParams=function(){return{url:contextPath+"/rest/api/1.0/users/picker",data:{fieldName:options.fieldID},dataType:"json",type:"GET"}};function fieldsFormHasBeenSubmitted(field){var submitting=false,form=field.closest("form");if(form.length&&form.hasClass("submitting")){submitting=true}return submitting}that.renderSuggestions=function(response){if(fieldsFormHasBeenSubmitted(this.field)||!AJS.isSelenium()&&!AJS.elementIsFocused(this.field)){return false}var resultsContainer,suggestionNodes=[];this.clearResponseContainer();if(response&&response.users&&response.users.length>0){resultsContainer=jQuery("<ul/>").appendTo(this.responseContainer);jQuery(response.users).each(function(){suggestionNodes.push([jQuery("<li/>").html(this.html).appendTo(resultsContainer),this.name])})}if(response.footer){this.responseContainer.append(jQuery("<div/>").addClass("yui-ac-ft").html(response.footer).css("display","block"))}if(suggestionNodes.length>0){that.addSuggestionControls(suggestionNodes);AJS.$(".atlassian-autocomplete div.yad, .atlassian-autocomplete .labels li").textOverflow({autoUpdate:true})}return suggestionNodes};options.minQueryLength=2;options.queryDelay=0.25;that.init(options);return that};JIRA.UserAutoComplete.init=function(parent){AJS.$("fieldset.user-picker-params",parent).each(function(){var params=JIRA.parseOptionsFromFieldset(AJS.$(this)),field=(params.fieldId||params.fieldName),$container=AJS.$("#"+field+"_container");$container.find("a.popup-trigger").click(function(e){var url=contextPath,vWinUsers;e.preventDefault();if(!params.formName){params.formName=$container.find("#"+field).parents("form").attr("name")}if(params.actionToOpen){url=url+params.actionToOpen}else{url=url+"/secure/popups/UserPickerBrowser.jspa"}url+="?formName="+params.formName+"&";url+="multiSelect="+params.multiSelect+"&";url+="decorator=popup&";url+="element="+field;vWinUsers=window.open(url,"UserPicker","status=yes,resizable=yes,top=100,left=100,width=800,height=750,scrollbars=yes");vWinUsers.opener=self;vWinUsers.focus()});if(params.userPickerEnabled===true){JIRA.UserAutoComplete({field:parent?parent.find("#"+field):null,fieldID:field,delimChar:params.multiSelect===false?undefined:",",ajaxData:{fieldName:params.fieldName}})}})};AJS.namespace("jira.widget.autocomplete.Users",null,JIRA.UserAutoComplete);
/* module-key = 'jira.webresources:autocomplete', location = '/includes/jira/autocomplete/initAutoCompleteFields.js' */
JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){JIRA.UserAutoComplete.init(context);JIRA.IssueAutoComplete.init(context)}});JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){AJS.$("fieldset.user-searcher-params",context).each(function(){var params=JIRA.parseOptionsFromFieldset(AJS.$(this)),$container=AJS.$("#"+params.fieldId+"_container",context);if(params.userPickerEnabled===true){var autocompleter=JIRA.UserAutoComplete({fieldID:params.fieldId,delimChar:params.multiSelect===true?",":undefined,ajaxData:{fieldName:params.fieldName}})}var setupFields=function(related){var field=AJS.$("#"+params.fieldId,context);var userImage=AJS.$("#"+params.fieldId+"Image",context);var groupImage=AJS.$("#"+params.fieldId+"GroupImage",context);var fieldDesc=AJS.$("#"+params.fieldId+"_desc",context);if(related==="select.list.none"){field.val("").attr("disabled","true");userImage.hide();groupImage.hide();fieldDesc.hide()}else{field.removeAttr("disabled");if(related==="select.list.group"){userImage.hide();groupImage.show();if(params.userPickerEnabled===true){autocompleter.disable();fieldDesc.hide()}}else{userImage.show();groupImage.hide();if(params.userPickerEnabled===true){autocompleter.enable();fieldDesc.show()}}}};AJS.$("#"+params.userSelect,context).change(function(){var related=AJS.$(this).find("option:selected").attr("rel");setupFields(related)}).find("option:selected").each(function(){setupFields(AJS.$(this).attr("rel"))});$container.find("a.user-popup-trigger").click(function(e){var url=contextPath+"/secure/popups/UserPickerBrowser.jspa?";url+="formName="+params.formName+"&";url+="multiSelect="+params.multiSelect+"&";url+="decorator=popup&";url+="element="+params.fieldId;var vWinUsers=window.open(url,"UserPicker","status=yes,resizable=yes,top=100,left=100,width=800,height=750,scrollbars=yes");vWinUsers.opener=self;vWinUsers.focus();e.preventDefault()});$container.find("a.group-popup-trigger").click(function(e){var url=contextPath+"/secure/popups/GroupPickerBrowser.jspa?";url+="formName="+params.formName+"&";url+="multiSelect="+params.multiSelect+"&";url+="decorator=popup&";url+="element="+params.fieldId;var vWinUsers=window.open(url,"GroupPicker","status=yes,resizable=yes,top=100,left=100,width=800,height=750,scrollbars=yes");vWinUsers.opener=self;vWinUsers.focus();e.preventDefault()})})}});
/* module-key = 'jira.webresources:group-pickers', location = '/includes/jira/field/groupPickerUtil.js' */
JIRA.GroupPickerUtil={formatResponse:function(data){var ret=[];AJS.$(data).each(function(i,suggestions){var groupDescriptor=new AJS.GroupDescriptor({weight:i,label:suggestions.header});AJS.$(suggestions.groups).each(function(){groupDescriptor.addItem(new AJS.ItemDescriptor({value:this.name,label:this.name,html:this.html,highlighted:true}))});ret.push(groupDescriptor)});return ret}};
/* module-key = 'jira.webresources:group-pickers', location = '/includes/jira/field/initMultiGroupPickers.js' */
(function(){function initMultiGroupPickers(ctx){ctx.find(".js-default-multi-group-picker").each(function(){var $el=jQuery(this);new AJS.MultiSelect({element:this,itemAttrDisplayed:"label",showDropdownButton:false,ajaxOptions:{data:function(query){return{query:query,exclude:$el.val()}},url:JIRA.REST_BASE_URL+"/groups/picker",query:true,formatResponse:JIRA.GroupPickerUtil.formatResponse}})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){initMultiGroupPickers(context)}})})();
/* module-key = 'jira.webresources:user-pickers', location = '/includes/jira/field/userPickerUtil.js' */
(function($){JIRA.UserPickerUtil={formatResponse:function(data){var ret=[];$(data).each(function(i,suggestions){var groupDescriptor=new AJS.GroupDescriptor({weight:i,label:suggestions.footer});$(suggestions.users).each(function(){groupDescriptor.addItem(new AJS.ItemDescriptor({value:this.name,label:this.displayName,html:this.html,icon:this.avatarUrl,allowDuplicate:false,highlighted:true}))});ret.push(groupDescriptor)});return ret}}})(AJS.$);
/* module-key = 'jira.webresources:user-pickers', location = '/includes/jira/field/initSingleUserPickers.js' */
(function($){function createSingleUserPickers(ctx){var restPath="/rest/api/1.0/users/picker";$(".js-default-user-picker",ctx).each(function(){var $this=$(this);if($this.data("aui-ss")){return }var data={showAvatar:true},inputText=$this.data("inputValue");new AJS.SingleSelect({element:$this,submitInputVal:true,showDropdownButton:!!$this.data("show-dropdown-button"),errorMessage:AJS.format("There is no user \'\'{0}\'\'.","'{0}'"),ajaxOptions:{url:contextPath+restPath,query:true,data:data,formatResponse:JIRA.UserPickerUtil.formatResponse},inputText:inputText})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){createSingleUserPickers(context)}})})(AJS.$);
/* module-key = 'jira.webresources:user-pickers', location = '/includes/jira/field/NoBrowseUserNamePicker.js' */
AJS.NoBrowseUserNamePicker=AJS.MultiSelect.extend({_getDefaultOptions:function(){return AJS.$.extend(true,this._super(),{errorMessage:"The requested user does not exist.",showDropdownButton:false,removeOnUnSelect:true,itemAttrDisplayed:"label"})},_handleCharacterInput:function(){},_setSuggestions:function(){},_handleServerError:function(smartAjaxResult){if(smartAjaxResult.status===404){this.showErrorMessage()}else{this._super()}},_deactivate:function(){this.validateAndAdd()},validateAndAdd:function(){var instance=this;if(AJS.$.trim(this.$field.val())===""){this.hideErrorMessage()}else{jQuery.ajax({url:contextPath+"/rest/api/2/user",data:{username:AJS.$.trim(instance.getQueryVal())},success:function(user){instance.hideErrorMessage();instance.$field.val("");instance.addItem(new AJS.ItemDescriptor({label:user.displayName,value:user.name}))},error:function(){instance.showErrorMessage()}})}},_handleSpace:function(){this.validate()},_handleServerSuggestions:function(){this.hideErrorMessage();this.handleFreeInput()},handleFreeInput:function(){var value=AJS.$.trim(this.$field.val());if(value!==""){this.addItem({value:value,label:value});this.model.$element.trigger("change")}this.$field.val("")},keys:{"Return":function(event){event.preventDefault();this.validateAndAdd()},"Spacebar":function(event){event.preventDefault();this.validateAndAdd()}}});
/* module-key = 'jira.webresources:user-pickers', location = '/includes/jira/field/initMultiUserPickers.js' */
(function(){function initMultiUserPicker(ctx){ctx.find(".js-default-multi-user-picker").each(function(){var $el=jQuery(this);if(AJS.params.currentUserCanBrowseUsers){new AJS.MultiSelect({element:this,itemAttrDisplayed:"label",showDropdownButton:false,removeOnUnSelect:true,submitInputVal:true,ajaxOptions:{url:contextPath+"/rest/api/1.0/users/picker",query:true,data:function(query){return{showAvatar:true,query:query,exclude:$el.val()}},formatResponse:JIRA.UserPickerUtil.formatResponse}})}else{new AJS.NoBrowseUserNamePicker({element:this})}})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){initMultiUserPicker(context)}})})();
/* module-key = 'jira.webresources:ie-imitation-placeholder', location = '/includes/jira/field/IEImitationPlaceholder.js' */
(function($){$.fn.ieImitationPlaceholder=function(){if($.browser.msie){var form=this,fields=form.find("[placeholder]");fields.focus(clearTextIfUnchanged);fields.blur(setTextFromPlaceholder);form.submit(clearAllIfUnchanged);fields.each(setTextFromPlaceholder);function setTextFromPlaceholder(){var field=$(this);if(field.val()===""){field.val(field.attr("placeholder"));field.addClass("input-placeholder")}}function clearTextIfUnchanged(){var field=$(this);if(field.val()===field.attr("placeholder")){field.val("");field.removeClass("input-placeholder")}}function clearAllIfUnchanged(){fields.each(clearTextIfUnchanged)}}}})(AJS.$);
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/field-templates.soy' */
// This file was automatically generated from field-templates.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.Fields == 'undefined') { JIRA.Templates.Fields = {}; }


JIRA.Templates.Fields.username = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.escape) ? soy.$$escapeHtml(opt_data.displayName) : opt_data.displayName);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Fields.recipientUsername = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li data-username="', soy.$$escapeHtml(opt_data.username), '" title=', soy.$$escapeHtml(opt_data.username), '><span><span class="user-hover" rel="', soy.$$escapeHtml(opt_data.username), '"><img src="', soy.$$escapeHtml(opt_data.icon), '" title="');
  JIRA.Templates.Fields.username(opt_data, output);
  output.append('"><span title="');
  JIRA.Templates.Fields.username(opt_data, output);
  output.append('">');
  JIRA.Templates.Fields.username(opt_data, output);
  output.append('</span></span>', (! opt_data.readOnly) ? '<span class="remove-recipient item-delete"/>' : '', '</span></li>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Fields.recipientEmail = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li data-email="', soy.$$escapeHtml(opt_data.email), '" title=', soy.$$escapeHtml(opt_data.email), '><span><img src="', soy.$$escapeHtml(opt_data.icon), '" title="', soy.$$escapeHtml(opt_data.email), '"><span title="', soy.$$escapeHtml(opt_data.email), '">', soy.$$escapeHtml(opt_data.email), '</span><span class="remove-recipient item-delete"/></span></li>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/IssuePicker.js' */
JIRA.IssuePicker=AJS.MultiSelect.extend({_formatResponse:function(response){var ret=[],canonicalBaseUrl=(function(){var uri=parseUri(window.location);return uri.protocol+"://"+uri.authority})();if(response&&response.sections){AJS.$(response.sections).each(function(i,section){var groupDescriptor=new AJS.GroupDescriptor({weight:i,label:section.label,description:section.sub});if(section.issues&&section.issues.length>0){AJS.$(section.issues).each(function(){groupDescriptor.addItem(new AJS.ItemDescriptor({highlighted:true,value:this.key,label:this.key+" - "+this.summaryText,icon:this.img?canonicalBaseUrl+contextPath+this.img:null,html:this.keyHtml+" - "+this.summary}))})}ret.push(groupDescriptor)})}return ret},_getDefaultOptions:function(){return AJS.$.extend(true,this._super(),{ajaxOptions:{formatResponse:this._formatResponse}})},_launchPopup:function(){function getWithDefault(value,def){if(typeof value=="undefined"||value==null){return def}else{return value}}var url,urlParam,vWinUsers,options,instance=this;JIRA.IssuePicker.callback=function(items){if(typeof items==="string"){items=JSON.parse(items)}instance._addMultipleItems(items,true);instance.$field.focus()};options=this.options.ajaxOptions.data;url=contextPath+"/secure/popups/IssuePicker.jspa?";urlParam={singleSelectOnly:"false",decorator:"popup",currentIssue:options.currentIssueKey||"",showSubTasks:getWithDefault(options.showSubTasks,false),showSubTasksParent:getWithDefault(options.showSubTaskParent,false)};if(options.currentProjectId){urlParam["currentProjectId"]=options.currentProjectId}url+=AJS.$.param(urlParam);vWinUsers=window.open(url,"IssueSelectorPopup","status=no,resizable=yes,top=100,left=200,width="+this.options.popupWidth+",height="+this.options.popupHeight+",scrollbars=yes,resizable");vWinUsers.opener=self;vWinUsers.focus()},_createFurniture:function(disabled){var $popupLink;this._super(disabled);$popupLink=this._render("popupLink");this._assignEvents("popupLink",$popupLink);this.$container.addClass("jira-issue-picker");this.$container.addClass("hasIcon");this.$container.after($popupLink)},handleFreeInput:function(){var values=this.$field.val().toUpperCase().match(/\S+/g);if(values){this._addMultipleItems(jQuery.map(values,function(value){return{value:value,label:value}}))}this.$field.val("")},_events:{popupLink:{click:function(e){this._launchPopup();e.preventDefault()}}},_renders:{popupLink:function(){return AJS.$("<a class='issue-picker-popup' />").attr({href:"#",title:this.options.popupLinkMessage}).text(""+this.options.popupLinkMessage+"")}}});AJS.namespace("jira.issuepicker",null,JIRA.IssuePicker);AJS.namespace("AJS.IssuePicker",null,JIRA.IssuePicker);
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/LabelPicker.js' */
JIRA.LabelPicker=AJS.MultiSelect.extend({_getDefaultOptions:function(){return AJS.$.extend(true,this._super(),{ajaxOptions:{url:contextPath+"/includes/js/ajs/layer/labeldata.js",query:true,formatResponse:this._formatResponse},removeDuplicates:true,removeOnUnSelect:true,userEnteredOptionsMsg:"\u65B0\u6807\u7B7E"})},isValidItem:function(itemValue){return !/\s/.test(itemValue)},_handleServerSuggestions:function(data){if(data&&data.token){if(AJS.$.trim(this.$field.val())!==data.token){return }}this._super(data)},_handleSpace:function(){if(AJS.$.trim(this.$field.val())!==""){if(this.handleFreeInput()){this.hideSuggestions()}}},keys:{"Spacebar":function(event){this._handleSpace();event.preventDefault()}},_formatResponse:function(data){var optgroup=new AJS.GroupDescriptor({label:"\u5EFA\u8BAE",type:"optgroup",styleClass:"labels-suggested"});if(data&&data.suggestions){AJS.$.each(data.suggestions,function(){optgroup.addItem(new AJS.ItemDescriptor({value:this.label,label:this.label,html:this.html,highlighted:true}))})}return[optgroup]},handleFreeInput:function(){var values=AJS.$.trim(this.$field.val()).match(/\S+/g);if(values){for(var value,i=0;value=values[i];i++){this.addItem({value:value,label:value})}this.model.$element.trigger("change")}this.$field.val("")}});AJS.namespace("AJS.LabelPicker",null,JIRA.LabelPicker);
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/MultiUserListPicker.js' */
(function($){JIRA.MultiUserListPicker=AJS.MultiSelect.extend({init:function(options){var instance=this,restPath="/rest/api/1.0/users/picker";function formatResponse(response){var ret=[];$(response).each(function(i,suggestions){var groupDescriptor=new AJS.GroupDescriptor({weight:i,label:suggestions.footer});$(suggestions.users).each(function(){groupDescriptor.addItem(new AJS.ItemDescriptor({value:this.name,label:this.displayName,html:this.html,icon:this.avatarUrl,allowDuplicate:false,highlighted:true}))});ret.push(groupDescriptor)});return ret}$.extend(options,{itemAttrDisplayed:"label",userEnteredOptionsMsg:"\u7535\u5B50\u90AE\u4EF6\u5730\u5740",showDropdownButton:false,removeOnUnSelect:true,ajaxOptions:{url:contextPath+restPath,query:true,data:{showAvatar:true},formatResponse:formatResponse},suggestionsHandler:AJS.UserListSuggestHandler,itemGroup:new AJS.Group(),itemBuilder:function(descriptor){return new JIRA.MultiUserListPicker.Item({descriptor:descriptor,container:this.$selectedItemsContainer})}});this._super(options)},_createFurniture:function(disabled){this._super(disabled);if(this.options.description){this._render("description",this.options.description).insertAfter(this.$field)}},updateItemsIndent:$.noop,_renders:{selectedItemsWrapper:function(){return $('<div class="recipients"></div>')},selectedItemsContainer:function(){return $("<ol />")},description:function(description){return $("<div />").addClass("description").text(description)}}})}(AJS.$));
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/MultiUserListPicker.Item.js' */
JIRA.MultiUserListPicker.Item=AJS.Control.extend({init:function(options){this._setOptions(options);this.$lozenge=this._render("item");this.$removeButton=this.$lozenge.find(".remove-recipient");this._assignEvents("instance",this);this._assignEvents("lozenge",this.$lozenge);this._assignEvents("removeButton",this.$removeButton);this.$lozenge.prependTo(this.options.container)},_getDefaultOptions:function(){return{label:null,title:null,container:null,focusClass:"focused"}},_renders:{"item":function(){var descriptor=this.options.descriptor;var data;if(descriptor.noExactMatch()!==true){data={escape:false,username:descriptor.value(),icon:descriptor.icon(),displayName:AJS.escapeHtml(descriptor.label())};return AJS.$(JIRA.Templates.Fields.recipientUsername(data))}else{data={email:descriptor.value(),icon:AJS.Meta.get("default-avatar-url")};return AJS.$(JIRA.Templates.Fields.recipientEmail(data))}}},_events:{"instance":{"remove":function(){this.$lozenge.remove()}},"removeButton":{"click":function(e){e.stopPropagation();this.trigger("remove")}}}});
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initCascadingSelects.js' */
(function(){function initCascadingSelect(el){AJS.$(el||document.body).find("div.aui-field-cascadingselect").add("tr.aui-field-cascadingselect").add("td.aui-field-cascadingselect").each(function(){var $container=AJS.$(this),parent=$container.find(".cascadingselect-parent"),parentOptions=parent.find("option"),oldClass="",child=$container.find(".cascadingselect-child"),childOptions=child.find("option"),selectedChild=child.find(":selected");function update(){var placeholder,currentClass=parent.find("option:selected").attr("class");if(currentClass!==oldClass){placeholder=jQuery("<span />").insertAfter(child);child.detach();child.find("option").each(function(i,elem){elem.parentNode.removeChild(this)});child.insertAfter(placeholder);placeholder.remove();childOptions.filter("."+parent.find("option:selected").attr("class")).appendTo(child);if(selectedChild.hasClass(parent.find("option:selected").attr("class"))){child.val(selectedChild.val())}else{child.val(child.find("option:first").val())}oldClass=currentClass}}parent.bind("cascadingSelectChanged",update).change(function(){AJS.$(this).trigger("cascadingSelectChanged")}).trigger("cascadingSelectChanged")})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){initCascadingSelect(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initComponentPickers.js' */
(function(){function createPicker($selectField){new AJS.MultiSelect({element:$selectField,itemAttrDisplayed:"label",errorMessage:"{0} \u4E0D\u662F\u4E00\u4E2A\u6709\u6548\u7684\u6A21\u5757\u3002",maxInlineResultsDisplayed:15})}function locateSelect(parent){var $parent=AJS.$(parent),$selectField;if($parent.is("select")){$selectField=$parent}else{$selectField=$parent.find("select")}return $selectField}var DEFAULT_SELECTORS=["div.aui-field-componentspicker.frother-control-renderer","td.aui-field-componentspicker.frother-control-renderer","tr.aui-field-componentspicker.frother-control-renderer"];function findComponentSelectAndConvertToPicker(context,selector){selector=selector||DEFAULT_SELECTORS.join(", ");AJS.$(selector,context).each(function(){var $selectField=locateSelect(this);if($selectField.length){createPicker($selectField)}})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){findComponentSelectAndConvertToPicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initMultiselectPickers.js' */
(function(){function createPicker($selectField){new AJS.MultiSelect({element:$selectField,itemAttrDisplayed:"label",errorMessage:"{0} is not a valid value.",maxInlineResultsDisplayed:15,submitInputVal:true})}function locateSelect(parent){var $parent=AJS.$(parent),$selectField;if($parent.is("select")){$selectField=$parent}else{$selectField=$parent.find("select")}return $selectField}var DEFAULT_SELECTORS=["div.aui-field-multiselectpicker.frother-control-renderer"];function findComponentSelectAndConvertToPicker(context,selector){selector=selector||DEFAULT_SELECTORS.join(", ");AJS.$(selector,context).each(function(){var $selectField=locateSelect(this);if($selectField.length){createPicker($selectField)}})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){findComponentSelectAndConvertToPicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initDatePickers.js' */
(function(){function initDatePicker(el){AJS.$(el||document.body).find("div.aui-field-datepicker").add("tr.aui-field-datepicker").add("td.aui-field-datepicker").each(function(){var $container=AJS.$(this),field=$container.find("input:text"),defaultCheckbox=$container.find("#useCurrentDate"),params=JIRA.parseOptionsFromFieldset($container.find("fieldset.datepicker-params"));params.context=el;Calendar.setup(params);function toggleField(){field.prop("disabled",defaultCheckbox.is(":checked"))}if(defaultCheckbox.length){toggleField();defaultCheckbox.click(toggleField)}})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){initDatePicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initLegacyGroupPickers.js' */
(function(){function initLegacyGroupPicker(el){AJS.$(el||document.body).find("div.aui-field-grouppicker").add("tr.aui-field-grouppicker").add("td.aui-field-grouppicker").each(function(){var $container=AJS.$(this),trigger=$container.find("a.grouppicker-trigger"),url=trigger.attr("href");function openGroupPickerWindow(e){e.preventDefault();window.open(url,"GroupPicker","status=yes,resizable=yes,top=100,left=100,width=800,height=750,scrollbars=yes")}trigger.click(openGroupPickerWindow)})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){initLegacyGroupPicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initIssuePickers.js' */
(function(){function initIssuePicker(el){AJS.$(el||document.body).find(".aui-field-issuepicker").each(function(){new JIRA.IssuePicker({element:AJS.$(this),userEnteredOptionsMsg:"\u8F93\u5165\u95EE\u9898\u952E\u503C\u3002",uppercaseUserEnteredOnSelect:true})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){initIssuePicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initLabelPickers.js' */
(function(){function createPicker($fieldset,context){var opts=JIRA.parseOptionsFromFieldset($fieldset),$select=AJS.$("#"+opts.id,context),issueId=opts.issueId,data={};if(/customfield_\d/.test(opts.id)){data.customFieldId=parseInt(opts.id.replace("customfield_",""),10)}new JIRA.LabelPicker({element:$select,ajaxOptions:{url:contextPath+"/rest/api/1.0/labels"+(issueId?"/"+issueId:"")+"/suggest",data:data}})}function locateFieldset(parent){var $parent=AJS.$(parent),$fieldset;if($parent.is(FIELDSET_SELECTOR)){$fieldset=$parent}else{$fieldset=$parent.find(FIELDSET_SELECTOR)}return $fieldset}var FIELDSET_SELECTOR="fieldset.labelpicker-params";function findLabelsFieldsetAndConvertToPicker(context,selector){selector=selector||".aui-field-labelpicker";AJS.$(selector,context).each(function(){var $fieldset=locateFieldset(this);if($fieldset.length>0){createPicker($fieldset,context)}})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){findLabelsFieldsetAndConvertToPicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initVersionPickers.js' */
(function(){function createPicker($selectField){new AJS.MultiSelect({element:$selectField,itemAttrDisplayed:"label",removeOnUnSelect:false,submitInputVal:true,errorMessage:"{0} \u4E0D\u662F\u4E00\u4E2A\u6709\u6548\u7684\u7248\u672C\u3002",maxInlineResultsDisplayed:15})}function locateSelect(parent){var $parent=AJS.$(parent),$selectField;if($parent.is("select")){$selectField=$parent}else{$selectField=$parent.find("select")}return $selectField}function findVersionSelectAndConvertToPicker(context,selector){selector=selector||".aui-field-versionspicker.frother-control-renderer";AJS.$(selector,context).each(function(){var $selectField=locateSelect(this);if($selectField.length){createPicker($selectField)}})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){findVersionSelectAndConvertToPicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initCommentControls.js' */
(function($){function applyCommentControls($contexts){if($contexts.attr("id")==="addcomment"){$contexts=$contexts.find("#issue-comment-add")}$contexts.each(function(){var $context=$(this);var $commentLevel=$context.find("#commentLevel");if($commentLevel.length>0){new AJS.SecurityLevelSelect($commentLevel)}$context.find(".wiki-js-prefs").each(function(){JIRA.wikiPreview(this,$context).init()})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context){applyCommentControls(context)})})(AJS.$);
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/ProjectIssueTypeSelect.js' */
JIRA.ProjectIssueTypeSelect=Class.extend({init:function(options){var val,instance=this;this.$project=options.project;this.backgroundImages=this.removeBackgroundImages(options.issueTypeSelect);this.$refIssueTypeSelect=jQuery(options.issueTypeSelect).clone(true,true);this.$issueTypeSelect=options.issueTypeSelect;this.$projectIssueTypesSchemes=options.projectIssueTypesSchemes;this.$issueTypeSchemeIssueDefaults=options.issueTypeSchemeIssueDefaults;this.projectIssueTypeSchemes=this.getProjectIssueTypeSchemesFromDom();this.issueTypesSchemeDefaults=this.getIssueTypeSchemeIssueDefaults();if(instance.$project.length>0){val=instance.$project.val();instance.setIssueTypeScheme(instance.getIssueTypeSchemeForProject(val));if(this.$project.is("select")){this.$project.change(function(){var val=instance.$project.val();instance.lastIssueType=instance.$issueTypeSelect.find(":selected:first").val();instance.$refIssueTypeSelect.val("");instance.setIssueTypeScheme(instance.getIssueTypeSchemeForProject(val));instance.$issueTypeSelect.trigger("reset")})}}},getIssueTypeSchemeForProject:function(projectId){return this.projectIssueTypeSchemes[projectId]},getDefaultIssueTypeForScheme:function(issueTypeSchemeId){return this.issueTypesSchemeDefaults[issueTypeSchemeId]},removeBackgroundImages:function(issueTypeSelect){var map={};jQuery(issueTypeSelect).find("option[style]").each(function(){map[jQuery(this).attr("id")]=jQuery(this).css("background-image");jQuery(this).attr("style","");jQuery(this).removeAttr("style")});return map},addBackgroundImages:function(){var that=this;this.$issueTypeSelect.find("option").each(function(){jQuery(this).css("background-image",that.backgroundImages[jQuery(this).attr("id")])})},setIssueTypeScheme:function(issueTypeSchemeId){var selectedIssueType,instance=this,$toSelect,$placeholder=jQuery("<span class='hidden' />"),$optgroups=this.$refIssueTypeSelect.find("optgroup");$placeholder.insertAfter(this.$issueTypeSelect);this.$issueTypeSelect.detach().empty();if($optgroups.length){$optgroups.each(function(){var $optgroup=jQuery(this);if($optgroup.is("[data-scheme-id='"+issueTypeSchemeId+"']")){instance.$issueTypeSelect.append($optgroup.clone(true).children());return false}})}else{this.$issueTypeSelect.append(this.$refIssueTypeSelect.children())}selectedIssueType=this.$issueTypeSelect.find("option[data-selected]").val()||"";if(instance.lastIssueType){$toSelect=this.$issueTypeSelect.find("option[value='"+instance.lastIssueType+"']")}else{if(selectedIssueType){$toSelect=this.$issueTypeSelect.find("option[value='"+selectedIssueType+"']")}}if($toSelect&&$toSelect.length!==0){$toSelect.attr("selected","selected");this.$issueTypeSelect.val($toSelect.val())}else{this.setDefaultIssueType(issueTypeSchemeId)}this.$issueTypeSelect.insertAfter($placeholder);this.addBackgroundImages();this.$issueTypeSelect.attr("data-project",this.$project.val());$placeholder.remove()},setDefaultIssueType:function(issueTypeSchemeId){var defaultIssueType=this.getDefaultIssueTypeForScheme(issueTypeSchemeId);if(defaultIssueType!==""){this.$issueTypeSelect.find("option[value='"+defaultIssueType+"']").attr("selected","selected")}else{this.$issueTypeSelect.find("option").each(function(i,option){if(this.value&&this.value!==""){jQuery(option).attr("selected","selected");return false}})}},getProjectIssueTypeSchemesFromDom:function(){var projectIssueTypes={};this.$projectIssueTypesSchemes.find("input").each(function(i,input){var $input=jQuery(input),project=$input.attr("title"),issueTypes=$input.val();projectIssueTypes[project]=issueTypes});return projectIssueTypes},getIssueTypeSchemeIssueDefaults:function(){var issueTypesSchemeDefaults={};this.$issueTypeSchemeIssueDefaults.find("input").each(function(i,input){var $input=jQuery(input),issueTypeScheme=$input.attr("title"),defaultIssueType=$input.val();issueTypesSchemeDefaults[issueTypeScheme]=defaultIssueType});return issueTypesSchemeDefaults}});
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initProjectIssueTypeSelect.js' */
(function(){function findProjectAndIssueTypeSelectAndConvertToPicker(ctx){var $ctx=ctx||jQuery("body"),$project=$ctx.find(".project-field, .project-field-readonly"),$issueTypeSelect=$ctx.find(".issuetype-field"),$projectIssueTypes=$ctx.find(".project-issue-types"),$defaultProjectIssueTypes=$ctx.find(".default-project-issue-type");$project.each(function(i){new JIRA.ProjectIssueTypeSelect({project:jQuery(this),issueTypeSelect:$issueTypeSelect.eq(i),projectIssueTypesSchemes:$projectIssueTypes.eq(i),issueTypeSchemeIssueDefaults:$defaultProjectIssueTypes.eq(i)})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){findProjectAndIssueTypeSelectAndConvertToPicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initIssueTypePickers.js' */
(function(){function createissueTypePicker(context){context.find(".issuetype-field").each(function(){var $select=jQuery(this);$select.bind("reset",function(){$select.find("option[value='']").remove()}).trigger("reset");new AJS.SingleSelect({element:this,revertOnInvalid:true})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){createissueTypePicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initProjectPickers.js' */
(function(){function createProjectPicker(context){context.find(".project-field").each(function(){new AJS.SingleSelect({element:this,revertOnInvalid:true})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){createProjectPicker(context)}})})();
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initLogWorkControls.js' */
(function($){JIRA.Events.VALIDATE_TIMETRACKING="validateTimeTracking";function toggleTimeTrackingContainer(context,activate){var $logWorkContainer=$(context).find("#worklog-logworkcontainer"),$timeTrackingContainer=$(context).find("#worklog-timetrackingcontainer"),$logWorkCheckbox=$(context).find("#log-work-activate");if(activate){$logWorkContainer.removeClass("hidden");$timeTrackingContainer.addClass("hidden");$logWorkCheckbox.prop("checked",true)}else{$logWorkContainer.addClass("hidden");$timeTrackingContainer.removeClass("hidden");$logWorkCheckbox.prop("checked",false)}}function applyLogworkControls(context){$("#log-work-adjust-estimate-new-value, #log-work-adjust-estimate-manual-value",context).attr("disabled","disabled");$("#log-work-adjust-estimate-"+$("input[name=worklog_adjustEstimate]:checked,input[name=adjustEstimate]:checked",context).val()+"-value",context).removeAttr("disabled");$("input[name=worklog_adjustEstimate],input[name=adjustEstimate]",context).change(function(){$("#log-work-adjust-estimate-new-value,#log-work-adjust-estimate-manual-value",context).attr("disabled","disabled");$("#log-work-adjust-estimate-"+$(this).val()+"-value",context).removeAttr("disabled")});$(context).find("#log-work-activate").change(function(){toggleTimeTrackingContainer(context,$(this).is(":checked"))})}JIRA.bind(JIRA.Events.VALIDATE_TIMETRACKING,function(e,context){toggleTimeTrackingContainer(context,true)});JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){applyLogworkControls(context)}})})(AJS.$);
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initPriorityPickers.js' */
(function($){function createPriorityPicker(context){context.find("select#priority").each(function(i,el){new AJS.SingleSelect({element:el,revertOnInvalid:true})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){createPriorityPicker(context)}})})(AJS.$);
/* module-key = 'jira.webresources:jira-fields', location = '/includes/jira/field/initInlineAttach.js' */
(function(){function createInlineAttach(context){context.find("input[type=file]:not('.ignore-inline-attach')").inlineAttach()}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){createInlineAttach(context)}})})();
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-form', location = 'js/QuickForm/namespace.js' */
jQuery.namespace("JIRA.Forms");
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-form', location = 'js/QuickForm/util.js' */
Class.prototype.triggerEvent=function(C,A,B){jQuery(this).trigger(C,A);
if(B&&this.globalEventNamespaces){jQuery.each(this.globalEventNamespaces,function(E,D){jQuery(AJS).trigger(D+"."+C,A)
})
}return this
};
Class.prototype.bind=function(A,B){jQuery(this).bind(A,B);
return this
};
JIRA.makePropertyFunc=function(A){if(jQuery.isFunction(A)){return A
}else{return function(){return A
}
}};
JIRA.Dialog.getAttrFromActiveTrigger=function(B){var C=JIRA.Dialog.current,A=C.$activeTrigger;
if(A){return A.attr(B)
}};
JIRA.Dialog.getIssueActionTitle=function(B){var A=JIRA.Dialog.getActionIssueKey();
if(!A){return B
}return B+" : "+A
};
JIRA.Dialog.getActionIssueKey=function(){var A=JIRA.Dialog.getAttrFromActiveTrigger("data-issueKey");
if(!A&&JIRA.Issue){A=JIRA.Issue.getIssueKey()
}if(!A&&JIRA.IssueNavigator){A=JIRA.IssueNavigator.getSelectedIssueKey()
}if(!A&&JIRA.Issues){A=JIRA.Issues.Api.getSelectedIssueKey()
}return A
};
JIRA.activateTabWithChild=function(E){var C,B,A,D=E.closest(".tabs-pane");
if(D.length){B=D.closest(".aui-tabs");
C=D.attr("id");
A=B.find("a[href='#"+C+"']");
A.click()
}};
JIRA.applyErrorsToForm=function(B,C){var A;
jQuery.each(C,function(E,H){var G,D,F=B.find(":input[name='"+E+"']").last();
if(F.length===1){if(!A){A=F
}D=jQuery("<div class='error' />").attr("data-field",E).text(H);
G=F.closest(".field-group, .group");
G.find(".error").remove();
G.append(D)
}});
JIRA.activateTabWithChild(B.find(".error:first"));
if(A){A.focus()
}};
JIRA.extractScripts=function(B){var A=jQuery(B);
return{html:A.not("script"),scripts:A.filter("script")}
};
JIRA.applyMessageToForm=function(A,C,B,E){var D=C.find(".aui-message-context");
if(!D.length){D=jQuery("<div class='aui-message-context' />");
if(JIRA.useLegacyDecorator()){D.prependTo(C.find(".content-body"))
}else{D.prependTo(C.find(".form-body"))
}}D.empty();
AJS.messages[A](D,{shadowed:false,closeable:E,body:B})
};
JIRA.useLegacyDecorator=function(){return !JIRA.Version.isGreaterThanOrEqualTo("5.0")
};
JIRA.applyErrorMessageToForm=function(B,A){return JIRA.applyMessageToForm("error",B,A,false)
};
JIRA.applySuccessMessageToForm=function(B,A){return JIRA.applyMessageToForm("success",B,A,true)
};
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-form', location = 'js/QuickForm/model.js' */
JIRA.Forms.Model=Class.extend({init:function(A){this.userFieldsResource=A.userFieldsResource;
this.fieldsResource=A.fieldsResource;
this.retainedFields=[];
this._hasRetainFeature=false;
this._hasVisibilityFeature=true
},getFieldsResource:function(){return this.fieldsResource
},getAtlToken:function(){return this.atlToken
},getActiveFieldIds:function(){return this.getUserFields()
},addFieldToRetainValue:function(A){if(this._hasRetainFeature){this.removeFieldToRetainValue(A);
this.retainedFields.push(A)
}else{throw new Error("getFieldsWithRetainedValues: cannot be called. Must enable retain feature first by specifiying [_hasRetainFeature=true]")
}},clearRetainedFields:function(){this.retainedFields=[]
},removeFieldToRetainValue:function(B){if(this._hasRetainFeature){var A=jQuery.inArray(B,this.retainedFields);
if(A!=-1){this.retainedFields.splice(A,1)
}}else{throw new Error("getFieldsWithRetainedValues: cannot be called. Must enable retain feature first by specifiying [_hasRetainFeature=true]")
}},getFieldsWithRetainedValues:function(){if(this._hasRetainFeature){return this.retainedFields
}else{throw new Error("getFieldsWithRetainedValues: cannot be called. Must enable retain feature first by specifiying [_hasRetainFeature=true]")
}},hasRetainedValue:function(A){if(this._hasRetainFeature){return jQuery.inArray(A.id,this.retainedFields)!==-1
}else{throw new Error("HasRetainedValue: cannot be called. Must enable retain feature first by specifiying [_hasRetainFeature=true]")
}},refresh:function(C){var A=this,B=jQuery.Deferred(),D;
if(C){D=C+"&retainValues=true"
}JIRA.SmartAjax.makeRequest({url:this.getFieldsResource(),type:"POST",data:D,success:function(E){A.atlToken=E.atl_token;
A.fields=E.fields;
A.sortedTabs=E.sortedTabs;
A.userPreferences=E.userPreferences
},complete:function(F,G,E){if(E.successful){B.resolveWith(A,arguments)
}else{A.triggerEvent("serverError",[E]);
B.rejectWith(A,[E])
}}});
return B.promise()
},setFields:function(A){this.fields=A
},getConfigurableFields:function(){return this.getFields()
},getFields:function(){var A=this,B=jQuery.Deferred();
if(!this.fields){this.refresh().done(function(){B.resolve(A.fields)
})
}else{B.resolve(A.fields)
}return B.promise()
},_mungeTabs:function(B){var A=0,C=[];
jQuery.each(B,function(D,E){A++;
if(E.tab){if(!C[E.tab.position]){C[E.tab.position]=AJS.copyObject(E.tab)
}if(E.tab.position===0){C[E.tab.position].isFirst=true
}if(!C[E.tab.position].fields){C[E.tab.position].fields=[]
}C[E.tab.position].fields.push(AJS.copyObject(E))
}});
return C
},getTabs:function(){var A=this,B=jQuery.Deferred();
this.getFields().done(function(C){var D=A._mungeTabs(C);
B.resolve(D)
});
return B.promise()
},getSortedTabs:function(){var A=jQuery.Deferred();
if(!this.sortedTabs){this.refresh().done(function(){A.resolve(this.sortedTabs)
})
}else{A.resolve(this.sortedTabs)
}return A.promise()
},getUserFields:function(){var A=this,B=jQuery.Deferred();
if(!this.userPreferences){this.refresh().done(function(){B.resolve(A.userPreferences.fields)
})
}else{B.resolve(A.userPreferences.fields)
}return B.promise()
},setUserFields:function(A){var B={};
B.fields=A;
return this.updateUserPrefs(B)
},hasRetainFeature:function(){return !!this._hasRetainFeature
},hasVisibilityFeature:function(){return !!this._hasVisibilityFeature
},getUseConfigurableForm:function(){var A=this,B=jQuery.Deferred();
if(!this.userPreferences){this.refresh().done(function(){B.resolve(A.userPreferences.useQuickForm)
}).fail(function(){B.reject()
})
}else{B.resolve(A.userPreferences.useQuickForm)
}return B.promise()
},setUseConfigurableForm:function(A){var B={};
B.useQuickForm=A;
return this.updateUserPrefs(B)
},updateUserPrefs:function(C){var B=jQuery.Deferred(),A=this;
if(AJS.Meta.get("remote-user")===""){B.done();
return B.promise()
}if(!this.userPreferences){console.log("JIRA.Forms.Model: Cannot update user preferences if there are none to update");
B.reject();
return B.promise()
}if(!C.fields){C.fields=this.userPreferences.fields
}if(typeof C.showWelcomeScreen==="undefined"){C.showWelcomeScreen=this.userPreferences.showWelcomeScreen
}if(typeof C.useQuickForm==="undefined"){C.useQuickForm=this.userPreferences.useQuickForm
}return JIRA.SmartAjax.makeRequest({url:this.userFieldsResource,type:"POST",data:JSON.stringify(C),dataType:"json",contentType:"application/json",complete:function(E,F,D){if(D.successful){A.userPreferences=C
}else{A.triggerEvent("serverError",[D])
}}})
}});
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-form', location = 'js/QuickForm/quickform.soy' */
// This file was automatically generated from quickform.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.QuickForm == 'undefined') { JIRA.Templates.QuickForm = {}; }


JIRA.Templates.QuickForm.field = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(opt_data.editHtml);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.QuickForm.fieldPicker = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="qf-picker"><div class="qf-picker-header"><dl><dt>', soy.$$escapeHtml("Show Fields:"), '</dt>', (opt_data.isConfigurable) ? '<dd><a class="qf-unconfigurable" href="#">' + soy.$$escapeHtml("\u5168\u90e8") + '</a></dd><dd>' + soy.$$escapeHtml("Custom") + '</dd>' : '<dd>' + soy.$$escapeHtml("\u5168\u90e8") + '</dd><dd><a class="qf-configurable" href="#">' + soy.$$escapeHtml("Custom") + '</a></dd>', '</dl></div><div class="qf-picker-content ', (! opt_data.isConfigurable) ? 'qf-picker-unconfigurable' : '', '"></div><div class="qf-picker-footer"></div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.QuickForm.configurablePickerButton = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a title="', soy.$$escapeHtml(opt_data.label), '" data-field-id="', soy.$$escapeHtml(opt_data.fieldId), '" class="qf-picker-button', (opt_data.isActive) ? ' qf-active' : '', '" href="#">', soy.$$escapeHtml(opt_data.label), (opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '', '</a>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.QuickForm.unconfigurablePickerButton = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span title="', soy.$$escapeHtml(opt_data.label), '" data-field-id="', soy.$$escapeHtml(opt_data.fieldId), '" class="qf-picker-button', (opt_data.isActive) ? ' qf-active' : '', '" href="#">', soy.$$escapeHtml(opt_data.label), (opt_data.required) ? '<span class="aui-icon icon-required"></span>' : '', '</span>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.QuickForm.errorMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message error"><span class="aui-icon icon-error"></span>', soy.$$escapeHtml(opt_data.message), '</div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-form', location = 'js/QuickForm/field.js' */
JIRA.Forms.ConfigurableField=AJS.Control.extend({init:function(A){this.descriptor=A;
this.$element=jQuery("<div />").attr("id","qf-field-"+this.getId())
},focus:function(){this.$element.find(":input:first").focus()
},highlight:function(){var A=this;
this.$element.css("backgroundColor","#fff").animate({backgroundColor:"lightyellow"},function(){A.$element.animate({backgroundColor:"#fff"},function(){A.$element.css("backgroundColor","")
})
})
},getLabel:function(){return this.descriptor.label
},getId:function(){return this.descriptor.id
},activate:function(B){var A;
this.active=true;
this.$element.addClass("qf-field-active").show();
this.$element.find("textarea").trigger("refreshInputHeight");
if(!B){A=this.render();
this.$element.append(A.scripts);
this.focus();
JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$element]);
this.$element.scrollIntoView();
this.triggerEvent("activated")
}},hasVisibilityFeature:function(){return !!this.descriptor.hasVisibilityFeature
},hasRetainFeature:function(){return !!this.descriptor.hasRetainFeature
},isActive:function(){return this.active
},disable:function(A){this.render();
this.active=false;
this.$element.removeClass("qf-field-active").hide();
if(!A){this.triggerEvent("disabled")
}},render:function(){var B=JIRA.Templates.QuickForm.field(this.descriptor),A=JIRA.extractScripts(B);
this.$element.html(A.html).addClass("qf-field").data("model",this);
return{element:this.$element,scripts:A.scripts}
}});
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-form', location = 'js/QuickForm/picker.js' */
JIRA.Forms.FieldPicker=AJS.Control.extend({INLINE_DIALOG_ID:"field_picker_popup",init:function(){this.buttons=[]
},switchToAll:function(A){this.isConfigurable=false;
if(A!==true){this.hideCallback=function(){this.remove()
};
this.inlineDialog.hide();
this.triggerEvent("switchedToAll")
}},setForm:function(A){this.form=A
},switchToCustom:function(A){this.isConfigurable=true;
if(A!==true){this.hideCallback=function(){this.remove()
};
this.inlineDialog.hide();
this.triggerEvent("switchedToCustom")
}},hideCallback:function(){},bindInlineDialog:function(){var B=this,A=this.getInlineDialogTrigger();
function C(F,D,E){B.render().done(function(G){if(F.find(".qf-picker").length===0){F.html(G);
F.click(function(K){K.stopPropagation()
})
}var J=jQuery("#qf-field-picker-trigger:visible").offset().top-jQuery(window).scrollTop(),I=jQuery(window).height(),H=I-J-110;
F.find(".qf-picker-content").css("maxHeight",H);
E()
})
}if(this.inlineDialog){this.inlineDialog.remove()
}this.inlineDialog=AJS.InlineDialog(A,this.INLINE_DIALOG_ID,C,{width:400,upfrontCallback:function(){A.parent().addClass("active")
},hideCallback:function(){A.parent().removeClass("active")
},nobind:true});
A.click(function(D){if(jQuery("#inline-dialog-"+B.INLINE_DIALOG_ID).is(":visible")){B.inlineDialog.hide()
}else{B.inlineDialog.show()
}});
return this.inlineDialog
},getInlineDialogTrigger:function(){return this.form.$element.find("#qf-field-picker-trigger")
},renderButtons:function(B){var A=this,C=jQuery('<ul class="qf-picker-buttons" />').appendTo(this.$content);
jQuery.each(B,function(E,F){var G,D;
if(A.isConfigurable){A.form.getFieldById(F.id).done(function(I){if(I&&I.hasVisibilityFeature()){var J=jQuery("<li />").appendTo(C);
var H=new JIRA.Forms.FieldPicker.ConfigurableButton({field:I});
H.render().appendTo(J);
A.buttons.push(H)
}})
}else{D=new JIRA.Forms.FieldPicker.UnconfigurableButton(F);
G=jQuery("<li />").appendTo(C);
D.render().appendTo(G)
}});
if(C.children().length===0){C.addClass("qf-no-fields").append("<li><em>"+"No fields can be configured for this tab"+"</em></li>")
}},renderContents:function(){var A=this,B=jQuery.Deferred();
this.form.model.getSortedTabs().done(function(C){if(C.length===1){A.renderButtons(C[0].fields)
}else{jQuery.each(C,function(D,E){if(E.fields.length>0){jQuery("<h4><span></span></h4>").appendTo(A.$content).find("span").text(E.label);
A.renderButtons(E.fields)
}})
}B.resolveWith(A,[A.$element])
});
return B.promise()
},show:function(){this.inlineDialog.show()
},render:function(){this.$element=jQuery(JIRA.Templates.QuickForm.fieldPicker({isConfigurable:this.isConfigurable}));
this.$content=this.$element.find(".qf-picker-content");
this._assignEvents("switchToCustom",this.$element.find(".qf-configurable"));
this._assignEvents("switchToAll",this.$element.find(".qf-unconfigurable"));
return this.renderContents()
},_events:{switchToCustom:{click:function(A){this.switchToCustom();
A.preventDefault()
}},switchToAll:{click:function(A){this.switchToAll();
A.preventDefault()
}}}});
JIRA.Forms.FieldPicker.UnconfigurableButton=AJS.Control.extend({init:function(A){this.descriptor=A
},render:function(){this.$element=jQuery(JIRA.Templates.QuickForm.unconfigurablePickerButton({required:this.descriptor.required,label:this.descriptor.label,fieldId:this.descriptor.id,isActive:true}));
return this.$element
}});
JIRA.Forms.FieldPicker.ConfigurableButton=AJS.Control.extend({init:function(B){var A=this;
this.field=B.field;
this.field.bind("disabled",function(){A.$element.removeClass("qf-active")
}).bind("activated",function(){A.$element.addClass("qf-active")
})
},toggle:function(){if(this.field.isActive()){this.field.disable()
}else{this.field.activate()
}},getId:function(){return this.field.getId()
},render:function(){this.$element=jQuery(JIRA.Templates.QuickForm.configurablePickerButton({required:this.field.descriptor.required,label:this.field.getLabel(),fieldId:this.field.getId(),isActive:this.field.isActive()}));
this._assignEvents("button",this.$element);
return this.$element
},_events:{button:{click:function(A){this.toggle();
A.preventDefault()
}}}});
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-form', location = 'js/QuickForm/form.js' */
JIRA.Forms.AbstractForm=AJS.Control.extend({submit:function(){var A=this;
A.getForm().addClass("submitting");
return JIRA.SmartAjax.makeRequest({url:this.getAction(),type:"POST",beforeSend:function(){A.disable()
},data:this.serialize(),complete:function(G,H,C){var E=C.data;
A.getForm().find(".aui-message-context").remove();
A.enable();
A.getForm().find(".error").remove();
if(C.successful){A.performAnalytics();
if(E&&E.fields){A.invalidateFieldsCache();
A.model.setFields(E.fields)
}if(typeof E==="string"){var F=AJS.$(AJS.extractBodyFromResponse(E));
var D=F.find("#atl_token").val();
if(D){A.model.atlToken=D;
A.getForm().find('input[name="atl_token"]').val(D)
}var B=new JIRA.FormDialog({offsetTarget:"body",content:F});
B._handleServerSuccess=function(){if(B.prev){B.prev._removeStackState();
B.prev._resetWindowTitle();
B._removeStackState()
}B.hide();
A.triggerEvent("sessionComplete",[],true);
A.handleSubmitSuccess()
};
B._handleServerError=function(I){B.hide();
A.handleSubmitError(I)
};
B.show()
}else{A.handleSubmitSuccess(C.data)
}}else{A.handleSubmitError(G)
}A.getForm().removeClass("submitting")
}})
},disable:function(){this.getForm().find(":input").attr("disabled","disabled").trigger("disable");
this.getForm().find(":submit").attr("disabled","disabled")
},enable:function(){this.getForm().find(":input").removeAttr("disabled").trigger("enable");
this.getForm().find(":submit").removeAttr("disabled")
},getActiveFieldIds:function(){throw new Error("getActiveFieldIds: Abstract, must be implemented by sub class")
},serialize:function(C){var A=this,B=this.getForm().serialize();
if(this.model.hasRetainFeature()){this.model.clearRetainedFields();
jQuery.each(this.getActiveFieldIds(),function(E,D){A.model.addFieldToRetainValue(D,C)
});
jQuery.each(this.model.getFieldsWithRetainedValues(),function(D,E){B=B+"&fieldsToRetain="+E
})
}return B
},invalidateFieldsCache:function(){delete this.fields
},setInitialFocus:function(){this.getFormContent().find(":input:first").focus()
},handleSubmitSuccess:function(){this.triggerEvent("submitted");
AJS.reloadViaWindowLocation()
},performAnalytics:function(){var A=function(D,E){var C="***** Analytics log ["+D+"]";
if(E){C+="["+JSON.stringify(E)+"]"
}AJS.log(C);
if(AJS.EventQueue){AJS.EventQueue.push({name:D,properties:E||{}})
}};
var B=function(E){var C={};
var F=_.filter(E,function(G){return !_.contains(["isCreateIssue","isEditIssue","atl_token","hasWorkStarted"],G.name)
});
var D=_.filter(F,function(G){return G.value!=""
});
_.each(D,function(H){var G=H.name;
if(!_.has(C,G)){C[G]=[]
}C[G].push(H.value)
});
return C
};
this.previousAnalytics=(function(K,O){var F=B(K);
var M=_.keys(F);
var G=_.keys(O.data);
var J=_.difference(M,G);
var N=_.difference(G,M);
var L=_.intersection(G,M);
var D=_.filter(L,function(P){return _.isEqual(O.data[P],F[P])
});
var C=_.difference(L,D);
var I=O.count+1;
var H=(JIRA.Dialog.current.options.id==="edit-issue-dialog");
var E={"atlassian.numCreates":I,"edit.form":H};
_.each(J,function(P){E[P]="added"
});
_.each(N,function(P){E[P]="removed"
});
_.each(D,function(P){E[P]="same"
});
_.each(C,function(P){E[P]="changed"
});
A("quick.create.fields",E);
return{data:F,count:I}
})(this.getForm().serializeArray(),this.previousAnalytics||{data:{},count:0})
},handleSubmitError:function(C){var A=this;
var D;
try{D=JSON.parse(C.responseText)
}catch(B){}if(D){if(D.errorMessages&&D.errorMessages.length){JIRA.applyErrorMessageToForm(this.getForm(),D.errorMessages[0])
}if(D&&D.errors&&C.status===400){if(this.getFieldById){jQuery.each(D.errors,function(E){if(/^timetracking/.test(E)){A.getFieldById("timetracking").done(function(F){JIRA.trigger(JIRA.Events.VALIDATE_TIMETRACKING,[A.$element]);
F.activate(true)
})
}else{if(/^worklog/.test(E)){A.getFieldById("worklog").done(function(F){JIRA.trigger(JIRA.Events.VALIDATE_TIMETRACKING,[A.$element]);
F.activate(true)
})
}else{A.getFieldById(E).done(function(F){F.activate(true)
})
}}})
}JIRA.applyErrorsToForm(this.getForm(),D.errors);
this.triggerEvent("validationError",[this,D.errors],true)
}}},getAction:function(){return this.action
},getFormContent:function(){return this.$element.find("div.content")
},getForm:function(){return this.$element.find("form")
},createField:function(){throw new Error("JIRA.Forms.AbstractForm: You must implement [createField] method in subclass.")
},render:function(C){var B=jQuery.Deferred(),A=this;
if(C){this.invalidateFieldsCache();
this.model.refresh(C).done(function(){A._render().done(function(E,D){A.triggerEvent("rendered",[A.$element]);
B.resolveWith(A,[A.$element,D])
})
})
}else{A._render().done(function(E,D){A.triggerEvent("rendered",[A.$element]);
B.resolveWith(A,[A.$element,D])
})
}return B.promise()
}});
JIRA.Forms.AbstractConfigurableForm=JIRA.Forms.AbstractForm.extend({getFields:function(){var B=jQuery.Deferred(),A=this;
if(!this.fields){this.fields=[];
this.model.getConfigurableFields().done(function(C){jQuery.each(C,function(D,F){var E=A.createField(F);
A.fields.push(E)
});
B.resolveWith(A,[A.fields])
})
}else{B.resolveWith(this,[this.fields])
}return B.promise()
},getActiveFieldIds:function(){var B=[],A=this.$element.find(".qf-field.qf-field-active:not(.qf-required)");
jQuery.each(A,function(D,E){var C=jQuery(E);
B.push(C.data("model").getId())
});
return B
},createField:function(C){C.hasVisibilityFeature=this.model.hasVisibilityFeature(C);
if(this.model.hasRetainFeature(C)){C.hasRetainFeature=true;
C.retainValue=this.model.hasRetainedValue(C)
}var A=this,B=new JIRA.Forms.ConfigurableField(C);
if(C.hasVisibilityFeature){B.bind("activated",function(){A.model.setUserFields(A.getActiveFieldIds());
B.highlight();
A.triggerEvent("QuickForm.fieldAdded",[B])
}).bind("disabled",function(){A.model.setUserFields(A.getActiveFieldIds());
A.triggerEvent("QuickForm.fieldRemoved",[B])
})
}return B
},getFieldById:function(C){var A=this,B=jQuery.Deferred();
this.getFields().done(function(D){jQuery.each(D,function(E,F){if(F.getId()===C){B.resolveWith(A,[F])
}});
B.rejectWith(A,[])
});
return B.promise()
},hasNoVisibleFields:function(){var A=jQuery.Deferred();
A.resolve(this.getActiveFieldIds().length===0);
return A.promise()
},renderFormContents:function(){var C=jQuery.Deferred(),B=jQuery(),A=this;
A.getFields().done(function(D){A.model.getActiveFieldIds().done(function(E){jQuery.each(D,function(){var F=this.render();
B=B.add(F.scripts);
A.getFormContent().append(F.element)
});
jQuery.each(E,function(G,F){jQuery.each(D,function(){if(this.getId()===F){this.activate(true)
}})
});
jQuery.each(D,function(){if(!this.isActive()){this.disable(true)
}});
A.hasNoVisibleFields().done(function(G){if(G===true){for(var F=0;
F<3;
F++){if(D[F]){D[F].activate(true)
}}}C.resolveWith(this,[A.$element,B])
})
})
});
return C.promise()
}});
JIRA.Forms.AbstractUnconfigurableForm=JIRA.Forms.AbstractForm.extend({getFieldsHtml:function(){var A=this,B=jQuery.Deferred(),C={};
this.model.getTabs().done(function(D){if(D.length===1){C.fields=D[0].fields
}else{C.tabs=D;
C.hasTabs=true
}B.resolveWith(A,[JIRA.Templates.Issue.issueFields(C)])
});
return B.promise()
},getActiveFieldIds:function(){var A=[];
this.model.getFields().done(function(B){jQuery.each(B,function(C,D){A.push(D.id)
})
});
return A
},getFields:function(){var B=jQuery.Deferred(),A=this;
if(!this.fields){this.fields=[];
this.model.getFields().done(function(C){jQuery.each(C,function(D,F){var E=A.createField(F);
A.fields.push(E)
});
B.resolveWith(A,[A.fields])
})
}else{B.resolveWith(this,[this.fields])
}return B.promise()
}});
JIRA.Forms.Error=AJS.Control.extend({getErrorMessageFromSmartAjax:function(A){var B,C;
if(A.hasData&&A.status!==401){try{C=JSON.parse(A.data);
if(C.errorMessages&&C.errorMessages.length>0){B=JIRA.Templates.QuickForm.errorMessage({message:C.errorMessages[0]})
}else{B=JIRA.SmartAjax.buildDialogErrorContent(A,true).html()
}}catch(D){B=JIRA.SmartAjax.buildDialogErrorContent(A,true).html()
}}else{B=JIRA.SmartAjax.buildDialogErrorContent(A,true).html()
}return B
},render:function(B){var A=this.getErrorMessageFromSmartAjax(B);
return this._render(A)
}});
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-form', location = 'js/QuickForm/container.js' */
JIRA.Forms.Container=AJS.Control.extend({init:function(A){this.$element=jQuery("<div />").addClass("qf-container");
this.options=JIRA.makePropertyFunc(A);
this.fieldPicker=new JIRA.Forms.FieldPicker();
this.successData=[]
},decorateRenderers:function(){var A=this;
if(!this.fieldPicker.decorated){this.fieldPicker.bind("switchedToAll",function(){A.unconfigurableForm.render(A.currentView.serialize(true)).done(function(){A.fieldPicker.show()
})
});
this.fieldPicker.bind("switchedToCustom",function(){A.configurableForm.render(A.currentView.serialize(true)).done(function(){A.fieldPicker.show()
})
});
this.fieldPicker.decorated=true
}if(!this.configurableForm.decorated){this.configurableForm.bind("rendered",function(C,B){A.currentView=A.configurableForm;
A.fieldPicker.switchToCustom(true);
A.fieldPicker.setForm(A.configurableForm);
A.fieldPicker.bindInlineDialog();
A.applyGlobalDecorator(B);
A.model.setUseConfigurableForm(true);
A.triggerEvent("configurableFormRendered")
});
this.configurableForm.bind("submitted",function(C,B){A.successData.push(B);
A.triggerEvent("configurableFormSubmitted")
});
this.configurableForm.decorated=true
}if(!this.unconfigurableForm.decorated){this.unconfigurableForm.bind("rendered",function(C,B){A.fieldPicker.switchToAll(true);
A.fieldPicker.setForm(A.unconfigurableForm);
A.fieldPicker.bindInlineDialog();
A.currentView=A.unconfigurableForm;
A.applyGlobalDecorator(B);
A.model.setUseConfigurableForm(false);
A.triggerEvent("unconfigurableFormRendered")
});
this.unconfigurableForm.bind("submitted",function(C,B){A.successData.push(B);
A.triggerEvent("unconfigurableFormSubmitted")
});
this.unconfigurableForm.decorated=true
}},applyGlobalDecorator:function(C){function B(){if(A.currentView.setInitialFocus){A.currentView.setInitialFocus()
}}var A=this;
C.detach();
this.$element.html(C);
this.triggerEvent("contentRefreshed",[this.$element]);
if(jQuery.browser.msie){window.setTimeout(B,0)
}else{B()
}},asDialog:function(B){var A=this,C;
this.dialog=C=new JIRA.FormDialog({id:B.id,trigger:B.trigger,windowTitle:B.windowTitle,width:JIRA.Dialog.WIDTH_PRESETS.large,delayShowUntil:JIRA.Dialogs.waitForSavesToComplete,content:function(D){A.render().done(function(){D(A.$element)
});
A.triggerEvent("dialogShown")
},submitHandler:function(E,D){E.preventDefault();
A.currentView.submit().then(D,D)
},stacked:true});
if(B.id==="edit-issue-dialog"){jQuery(this.dialog).on("beforeShow",function(D){if(!jira.app.issue.getIssueKey()&&!jira.app.issuenavigator.isRowSelected()){D.preventDefault()
}})
}this.dialog._focusFirstField=function(){JIRA.FormDialog.prototype._focusFirstField.apply(this,["div.content :input:visible:first"])
};
this.bind("initialized",function(){this.unconfigurableForm.bind("sessionComplete",function(){C.hide()
});
this.configurableForm.bind("sessionComplete",function(){C.hide()
})
}).bind("contentRefreshed",function(){C.notifyOfNewContent()
});
C.bind("Dialog.hide",function(){if(A.successData.length){A.triggerEvent("sessionComplete",[A.successData],true);
A.successData=[]
}});
A.$element.ajaxStart(function(){C.showFooterLoadingIndicator()
}).ajaxStop(function(){C.hideFooterLoadingIndicator()
});
C.getQuickForm=function(){return A
};
C.dirtyFormWarning();
return C
},lazyInit:function(){var A=this,B=this.options.call(this);
this.model=B.model;
this.errorHandler=B.errorHandler;
this.globalEventNamespaces=B.globalEventNamespaces;
this.configurableForm=B.configurableForm;
this.unconfigurableForm=B.unconfigurableForm;
this.sessionComplete=B.sessionComplete;
this.model.clearRetainedFields();
this.configurableForm.invalidateFieldsCache();
this.model.bind("serverError",function(D,C){A.$element.html(A.errorHandler.render(C));
A.triggerEvent("contentRefreshed",[this.$element])
});
this.triggerEvent("initialized");
this.decorateRenderers()
},render:function(){var A=this,B=jQuery.Deferred();
this.lazyInit();
A.model.getUseConfigurableForm().done(function(C){if(C===true){A.configurableForm.render().done(function(E,D){B.resolveWith(A,[A.$element]);
A.$element.append(D)
})
}else{A.unconfigurableForm.render().done(function(E,D){B.resolveWith(A,[A.$element,D]);
A.$element.append(D)
})
}}).fail(function(){B.resolveWith(A,[A.$element])
});
return B.promise()
}});
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-edit-issue', location = 'js/Issue/edit.js' */
JIRA.Forms.EditIssueModel=JIRA.Forms.Model.extend({getUnconfigurableTabs:function(){var A=this,B=jQuery.Deferred();
A.getTabs().done(function(D){var C=D.slice(0);
C[0].fields=C[0].fields.slice(0);
jQuery.each(C[0].fields,function(E,F){if(F.id==="comment"){C[0].fields.splice(E,1);
return false
}});
B.resolve(C)
});
return B.promise()
},getCommentField:function(){var A=jQuery.Deferred();
this.getFields().done(function(B){jQuery.each(B,function(C,D){if(D.id==="comment"){A.resolve(D)
}});
A.reject()
});
return A.promise()
}});
JIRA.Forms.EditIssueError=JIRA.Forms.Error.extend({_render:function(A){return jQuery(JIRA.Templates.Issue.editIssueError({errorHtml:A,useLegacyDecorator:JIRA.useLegacyDecorator()}))
}});
JIRA.Forms.UnconfigurableEditIssueForm=JIRA.Forms.AbstractUnconfigurableForm.extend({init:function(A){this.globalEventNamespaces=A.globalEventNamespaces||[];
this.model=A.model;
this.issueId=A.issueId;
this.title=A.title;
this.action=contextPath+"/secure/QuickEditIssue.jspa?issueId="+A.issueId+"&decorator=none";
this.$element=jQuery("<div class='qf-unconfigurable-form' />")
},getFieldsHtml:function(){var A=this,B=jQuery.Deferred(),C={};
this.model.getUnconfigurableTabs().done(function(D){if(D.length===1){C.fields=D[0].fields
}else{C.tabs=D;
C.hasTabs=true
}B.resolveWith(A,[JIRA.Templates.Issue.issueFields(C)])
});
return B.promise()
},handleSubmitSuccess:function(A){this.triggerEvent("submitted",[A]);
this.triggerEvent("issueEdited",[A]);
this.triggerEvent("sessionComplete")
},_render:function(){var B=jQuery.Deferred(),A=this;
this.getFieldsHtml().done(function(C){var D={fieldsHtml:C,title:A.title,issueId:A.issueId,atlToken:A.model.getAtlToken(),useLegacyDecorator:JIRA.useLegacyDecorator(),modifierKey:AJS.Navigator.modifierKey(),showFieldConfigurationToolBar:!JIRA.Users.LoggedInUser.isAnonymous()};
this.model.getCommentField().then(function(G){var F,E;
D.commentField=G;
F=JIRA.Templates.Issue.editIssueForm(D);
E=JIRA.extractScripts(F);
A.$element.html(E.html);
B.resolveWith(A,[A.$element,E.scripts])
},function(){var F=JIRA.Templates.Issue.editIssueForm(D),E=JIRA.extractScripts(F);
A.$element.html(E.html);
B.resolveWith(A,[A.$element,E.scripts])
})
});
return B.promise()
}});
JIRA.Forms.ConfigurableEditIssueForm=JIRA.Forms.AbstractConfigurableForm.extend({init:function(A){this.model=A.model;
this.globalEventNamespaces=A.globalEventNamespaces||[];
this.issueId=A.issueId;
this.title=A.title;
this.action=contextPath+"/secure/QuickEditIssue.jspa?issueId="+A.issueId+"&decorator=none";
this.$element=jQuery("<div />").addClass("qf-form qf-configurable-form")
},handleSubmitSuccess:function(A){this.triggerEvent("submitted",[A]);
this.triggerEvent("issueEdited",[A]);
this.triggerEvent("sessionComplete")
},hasNoVisibleFields:function(){var A=jQuery.Deferred(),B=this.getActiveFieldIds();
this.model.getUserFields().done(function(C){if(C.length===1&&C[0]==="comment"){A.resolve(false)
}else{if(B.length===0||(B.length===1&&B[0]==="comment")){A.resolve(true)
}else{A.resolve(false)
}}});
return A.promise()
},_render:function(){var B=jQuery.Deferred(),A=this,C=JIRA.Templates.Issue.editIssueForm({issueId:this.issueId,title:this.title,atlToken:A.model.getAtlToken(),isConfigurable:true,useLegacyDecorator:JIRA.useLegacyDecorator(),modifierKey:AJS.Navigator.modifierKey(),showFieldConfigurationToolBar:!JIRA.Users.LoggedInUser.isAnonymous()});
this.$element.html(C);
A.renderFormContents().done(function(E,D){A.getFieldById("comment").done(function(F){A.getFormContent().append(F.$element)
});
B.resolveWith(A,[A.$element,D])
});
return B.promise()
}});
JIRA.Forms.Model.createQuickEditIssueModel=function(A){return new JIRA.Forms.EditIssueModel({fieldsResource:contextPath+"/secure/QuickEditIssue!default.jspa?issueId="+A+"&decorator=none",userFieldsResource:contextPath+"/rest/quickedit/1.0/userpreferences/edit"})
};
JIRA.Dialog.shouldShowIssueKeyInTitle=function(){return JIRA.Issues||JIRA.IssueNavigator.isNavigator()||JIRA.Dialog.getAttrFromActiveTrigger("data-issueKey")
};
JIRA.Forms.createEditIssueForm=function(){function A(C){var D=JIRA.Dialog.getAttrFromActiveTrigger("data-issueId");
if(jQuery.isFunction(C.issueId)){return C.issueId(C)
}else{if(C.issueId){return C.issueId
}else{if(D){return D
}else{return JIRA.Issue.getIssueId()||JIRA.IssueNavigator.getSelectedIssueId()
}}}}function B(){var C="\u7F16\u8F91\u95EE\u9898";
if(JIRA.Dialog.shouldShowIssueKeyInTitle()){return JIRA.Dialog.getIssueActionTitle(C)
}else{return C
}}return function(C){C=C||{};
return new JIRA.Forms.Container(function(){var H=A(C),G=B(),D=JIRA.Forms.Model.createQuickEditIssueModel(H),F=new JIRA.Forms.ConfigurableEditIssueForm({title:G,model:D,issueId:H,globalEventNamespaces:["QuickEdit"]}),E=new JIRA.Forms.UnconfigurableEditIssueForm({title:G,model:D,issueId:H,globalEventNamespaces:["QuickEdit"]});
return{globalEventNamespaces:["QuickEdit"],model:D,errorHandler:new JIRA.Forms.EditIssueError(),configurableForm:F,unconfigurableForm:E}
})
}
}();
jQuery(function(){JIRA.Forms.createEditIssueForm().asDialog({windowTitle:function(){return JIRA.Dialog.getIssueActionTitle("\u7F16\u8F91\u95EE\u9898")
},trigger:".issueaction-edit-issue",id:"edit-issue-dialog"});
jQuery(document).bind("dialogContentReady",function(){AJS.tabs.setup()
})
});
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-edit-issue', location = 'js/Issue/issue.soy' */
// This file was automatically generated from issue.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.Issue == 'undefined') { JIRA.Templates.Issue = {}; }


JIRA.Templates.Issue.editIssueError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<h2>', soy.$$escapeHtml("\u7f16\u8f91\u95ee\u9898"), '</h2><div class="', (opt_data.useLegacyDecorator) ? 'content-body' : 'form-body', '">', opt_data.errorHtml, '</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.editIssueForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" name="jiraform" class="aui"><h2>', (opt_data.showFieldConfigurationToolBar) ? '<div class="qf-form-operations aui-toolbar"><div class="toolbar-split toolbar-split-right"><div class="toolbar-group"><span class="toolbar-item"><a href="#" class="toolbar-trigger" id="qf-field-picker-trigger"><span class="icon icon-tools"></span>' + soy.$$escapeHtml("Configure Fields") + '<span class="icon drop-menu"></span></a></span></div></div></div>' : '', opt_data.title, '</h2><div class="', (opt_data.useLegacyDecorator) ? 'content-body' : 'form-body', '"><input type="hidden" name="id" value="', soy.$$escapeHtml(opt_data.issueId), '" /><input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /><div class="content">', (opt_data.fieldsHtml) ? opt_data.fieldsHtml : '', (opt_data.commentField) ? opt_data.commentField.editHtml : '', '<!-- fields inserted here via javascript --></div></div><div class="buttons-container ', (opt_data.useLegacyDecorator) ? 'content-footer' : 'form-footer', '"><div class="buttons"><input accesskey="', soy.$$escapeHtml("s"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.modifierKey)), '" class="button" id="edit-issue-submit" name="Edit" type="submit" value="', soy.$$escapeHtml("\u66f4\u65b0"), '" /><a href="#" accesskey="', soy.$$escapeHtml("`"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.modifierKey)), '" class="cancel">', soy.$$escapeHtml("\u53d6\u6d88"), '</a></div></div></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.issueFields = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.hasTabs) {
    output.append('<div class="aui-tabs horizontal-tabs" id="horizontal"><ul class="tabs-menu">');
    var tabList66 = opt_data.tabs;
    var tabListLen66 = tabList66.length;
    for (var tabIndex66 = 0; tabIndex66 < tabListLen66; tabIndex66++) {
      var tabData66 = tabList66[tabIndex66];
      output.append((tabData66) ? '<li class="menu-item ' + ((tabData66.isFirst) ? 'first active-tab' : '') + ' "><a href="#tab-' + soy.$$escapeHtml(tabData66.position) + '" ><strong>' + soy.$$escapeHtml(tabData66.label) + '</strong></a></li>' : '');
    }
    output.append('</ul>');
    var tabList80 = opt_data.tabs;
    var tabListLen80 = tabList80.length;
    for (var tabIndex80 = 0; tabIndex80 < tabListLen80; tabIndex80++) {
      var tabData80 = tabList80[tabIndex80];
      if (tabData80) {
        output.append('<div class="tabs-pane ', (tabData80.isFirst) ? 'active-pane' : '', '" id="tab-', soy.$$escapeHtml(tabData80.position), '">');
        var fieldList90 = tabData80.fields;
        var fieldListLen90 = fieldList90.length;
        for (var fieldIndex90 = 0; fieldIndex90 < fieldListLen90; fieldIndex90++) {
          var fieldData90 = fieldList90[fieldIndex90];
          output.append((fieldData90.editHtml) ? fieldData90.editHtml : '');
        }
        output.append('</div>');
      }
    }
    output.append('</div>');
  } else {
    var fieldList100 = opt_data.fields;
    var fieldListLen100 = fieldList100.length;
    for (var fieldIndex100 = 0; fieldIndex100 < fieldListLen100; fieldIndex100++) {
      var fieldData100 = fieldList100[fieldIndex100];
      output.append((fieldData100.editHtml) ? fieldData100.editHtml : '');
    }
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.createIssueForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form name="jiraform" action="#" class="aui"><h2>', (opt_data.showFieldConfigurationToolBar) ? '<div class="qf-form-operations aui-toolbar"><div class="toolbar-split toolbar-split-right"><div class="toolbar-group"><span class="toolbar-item"><a href="#" class="toolbar-trigger" id="qf-field-picker-trigger"><span class="icon icon-tools"></span>' + soy.$$escapeHtml("Configure Fields") + '<span class="icon drop-menu"></span></a></span></div></div></div>' : '', soy.$$escapeHtml(opt_data.title), '</h2><div class="', (opt_data.useLegacyDecorator) ? 'content-body' : 'form-body', '">');
  if (opt_data.issueSetupFields) {
    output.append('<div class="issue-setup-fields">');
    var fieldList124 = opt_data.issueSetupFields;
    var fieldListLen124 = fieldList124.length;
    for (var fieldIndex124 = 0; fieldIndex124 < fieldListLen124; fieldIndex124++) {
      var fieldData124 = fieldList124[fieldIndex124];
      output.append('<div class="qf-field qf-field-', soy.$$escapeHtml(fieldData124.id), ' qf-required">', fieldData124.editHtml, '</div>');
    }
    output.append('</div>');
  }
  output.append((opt_data.parentIssueId) ? '<input type="hidden" name="parentIssueId" value="' + soy.$$escapeHtml(opt_data.parentIssueId) + '" />' : '', '<input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /><div class="content">', (opt_data.fieldsHtml) ? opt_data.fieldsHtml : '', '<!-- fields inserted here via javascript --></div></div><div class="buttons-container ', (opt_data.useLegacyDecorator) ? 'content-footer' : 'form-footer', '"><div class="buttons"><label for="qf-create-another" class="qf-create-another"><input id="qf-create-another" type="checkbox" ', (opt_data.multipleMode) ? 'checked="checked"' : '', ' />', soy.$$escapeHtml("Create another"), '</label><input accesskey="', soy.$$escapeHtml("s"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.modifierKey)), '" class="button" id="create-issue-submit" name="Edit" type="submit" value="', soy.$$escapeHtml("\u521b\u5efa"), '" /><a href="#" accesskey="', soy.$$escapeHtml("`"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.modifierKey)), '" class="cancel">', soy.$$escapeHtml("\u53d6\u6d88"), '</a></div></div></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.createIssueError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<h2>', soy.$$escapeHtml("\u521b\u5efa\u95ee\u9898"), '</h2><div class="', (opt_data.useLegacyDecorator) ? 'content-body' : 'form-footer', '">', opt_data.errorHtml, '</div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-share-plugin:share-resources', location = 'templates/share-dialog.soy' */
// This file was automatically generated from share-dialog.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.Dialogs == 'undefined') { JIRA.Templates.Dialogs = {}; }
if (typeof JIRA.Templates.Dialogs.Share == 'undefined') { JIRA.Templates.Dialogs.Share = {}; }


JIRA.Templates.Dialogs.Share.contentPopup = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" class="aui recipients-form share-content-popup ', (opt_data.shareData.issue) ? ' viewissue ' : (opt_data.shareData.filter) ? ' issuenav ' : '', '">');
  JIRA.Templates.Dialogs.Share.shareLink(opt_data, output);
  output.append('<fieldset class="padding">');
  if (opt_data.showForm) {
    JIRA.Templates.Dialogs.Share.shareForm(opt_data, output);
  } else {
    JIRA.Templates.Dialogs.Share.disabledMailMessage(null, output);
  }
  output.append('</fieldset></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Dialogs.Share.shareForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<label for="sharenames-multi-select">', soy.$$escapeHtml("User name or email"), '</label><div class="autocomplete-user-target"><select id="sharenames" name="sharenames" class="share-user-picker hidden" multiple="multiple"></select></div><ol class="recipients"></ol><div><label for="note">', soy.$$escapeHtml("Note"), '</label></div><textarea class="textarea long-field" id="note" placeholder="', soy.$$escapeHtml("Add an optional note"), '"/><div class="button-panel"><div class="status"><div class="icon"></div><div class="progress-messages"></div></div><div class="buttons"><input accesskey="', soy.$$escapeHtml("s"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.modifierKey)), '" class="button submit" type="submit" value="', soy.$$escapeHtml("Share"), '" disabled/> <a accesskey="', soy.$$escapeHtml("`"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.modifierKey)), '" class="close-dialog" href="javascript:">', soy.$$escapeHtml("Cancel"), '</a></div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Dialogs.Share.disabledMailMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  aui.message.generic({content: '<p>' + soy.$$escapeHtml("Outgoing mail is not configured. Please contact your JIRA administrator to enable sharing.") + '</p>', extraClasses: 'disabled-mail-message'}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Dialogs.Share.shareLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.shareData.permlink) ? '<div class="issuenav-permalink padding"><label>' + ((opt_data.shareData.issue) ? soy.$$escapeHtml("Link to Issue") : (opt_data.shareData.filter) ? soy.$$escapeHtml("Link to Filter") : '') + '</label><input class="permalink text long-field" value="' + soy.$$escapeHtml(opt_data.shareData.permlink) + '" readonly></div>' : '');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-share-plugin:share-resources', location = 'js/share-user-multi-select.js' */
(function(A){function B(C){A(".share-user-picker",C).each(function(){var D=new JIRA.MultiUserListPicker({layerId:A(this).attr("id")+"-layer",element:A(this),freeEmailInput:true});A(document).trigger("ready.multi-select.share-user",D)})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(E,C,D){if(D!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){B(C)}})}(AJS.$));
/* module-key = 'com.atlassian.jira.jira-share-plugin:share-resources', location = 'js/share-dialog.js' */
(function(B){var A;function C(Q,D){var J,P,I;function M(R){if(R){B(document).one("hideLayer",function(U,T,S){if(T==="inlineDialog"&&S.popup===J){B(document).unbind(".share-dialog");P.empty();P=undefined;I=undefined}})}J.hide();return false}function K(){return AJS.$(this).attr("data-username")}function H(){return AJS.$(this).attr("data-email")}function N(V,S){B("button,input,textarea",this).attr("disabled","disabled");var T=P.find(".button-panel .icon");T.addClass("throbber loading");var U=P.find(".progress-messages");U.text("Sending");var R=AJS.contextPath()+"/rest/share/1.0";if(S.issue){R+="/issue/"+S.issueKey}else{if(S.filter){if(S.filterId){R+="/filter/"+S.filterId}else{V.jql=S.jql;R+="/search"}}}JIRA.trace("jira.plugins.share.send",_.defaults({url:R},V));JIRA.SmartAjax.makeRequest({type:"POST",contentType:"application/json",dataType:"json",url:R,data:JSON.stringify(V),success:function(){T.removeClass("throbber loading");T.addClass("icon-tick");U.text("Sent");setTimeout(function(){M(true)},1000)},error:function(){T.removeClass("throbber loading");T.addClass("icon-cross");U.text("Error while sending")}})}function L(T){var R=P.find(".recipients");var W=R.find("li[data-username]").map(K).toArray();var V=R.find("li[data-email]").map(H).toArray();if(!(W.length||V.length)){return false}var S=P.find("#note").val();var U={usernames:W,emails:V,message:S};N(U,T);return false}function E(R){P.find(".submit").prop("disabled",!R)}function O(R){AJS.$(R).handleAccessKeys({selective:false})}function G(U){var R=jQuery(U),T,S;if(R.hasClass("viewissue-share")){T="issue";S=AJS.Meta.get("viewissue-permlink")}else{if(R.hasClass("issuenav-share")){T="filter";S=AJS.Meta.get("issuenav-permlink")}}var V={issueKey:JIRA.Meta.getIssueKey(),filterId:AJS.Meta.get("filter-id"),jql:AJS.Meta.get("filter-jql"),permlink:S};V[T]=true;return V}function F(U,R,S){var T=G(R);if(P&&I===T.permlink){P=U;S();return }I=T.permlink;P=U;P.html(JIRA.Templates.Dialogs.Share.contentPopup({shareData:T,modifierKey:AJS.Navigator.modifierKey(),showForm:AJS.Meta.get("outgoing-mail-enabled")}));if(AJS.$.browser.msie){P.find("form").ieImitationPlaceholder()}E(false);P.find("#sharenames").bind("change unselect",function(){var V=B(this).val();E(V&&V.length)});P.find(".close-dialog").click(function(){M(true)});P.find("form").submit(function(){L(T);return false});P.find(".issuenav-permalink .text").click(function(V){V.target.select();return false});B(document).bind("keyup.share-dialog",function(V){if(V.keyCode===B.ui.keyCode.ESCAPE){return M(false)}return true});B(document).bind("showLayer.share-dialog",function(X,W,V){if(W==="inlineDialog"&&V.popup===J){P.find("#sharenames-textarea").focus()}});O(AJS.$("form",P));S();JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[P,JIRA.CONTENT_ADDED_REASON.shareDialogOpened])}AJS.toInit(function(U){var T=true;JIRA.bind(AJS.InlineLayer.EVENTS.beforeShow,function(W,V,X){if(X==="sharenames-layer"){T=false}});JIRA.bind(AJS.InlineLayer.EVENTS.hide,function(X,V,W,Y){if(Y==="sharenames-layer"){setTimeout(function(){T=true},0)}});var R=(Q.indexOf("issuenav")!==-1)?-110:-170;var S={preHideCallback:function(){return T},hideCallback:function(){U(".dashboard-actions .explanation").hide()},offsetY:17,offsetX:R,hideDelay:3600000,useLiveEvents:true,initCallback:function(){U(D).scrollIntoViewForAuto({complete:function(){var V=U(this).add(window);_.delay(function(){V.one("scroll",function(){AJS.$(document.activeElement).blur();M(false)})})}})}};J=AJS.InlineDialog(U(D),Q,F,S);J[0].popup._validateClickToClose=function(V){return J.has(V.target).length===0};U(D).live("click",function(){if(J.find(".contents:visible").length){J.find("a.close-dialog").click()}});AJS.$(document).bind("keydown",function(V){if(V.keyCode===U.ui.keyCode.ESCAPE&&AJS.InlineDialog.current!==J&&J.is(":visible")){if(AJS.InlineDialog.current){AJS.InlineDialog.current.hide()}J.hide()}})})}C("share-entity-popup-viewissue","#jira-share-trigger.viewissue-share");C("share-entity-popup-issuenav","#jira-share-trigger.issuenav-share")})(AJS.$);
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/rpc.js' */
var gadgets=gadgets||{};gadgets.rpc=function(){var CALLBACK_NAME="__cb";var DEFAULT_NAME="";var FE_G2C_CHANNEL="__g2c_rpc";var FE_C2G_CHANNEL="__c2g_rpc";var services={};var iframePool=[];var relayUrl={};var useLegacyProtocol={};var authToken={};var callId=0;var callbacks={};var setup={};var sameDomain={};var params={};if(gadgets.util){params=gadgets.util.getUrlParameters()}authToken[".."]=params.rpctoken||params.ifpctok||0;function getRelayChannel(){return typeof window.postMessage==="function"?"wpm":typeof document.postMessage==="function"?"dpm":navigator.product==="Gecko"?"fe":"ifpc"}function setupChannel(){if(relayChannel==="dpm"||relayChannel==="wpm"){window.addEventListener("message",function(packet){process(gadgets.json.parse(packet.data))},false)}}var relayChannel=getRelayChannel();setupChannel();services[DEFAULT_NAME]=function(){throw new Error("Unknown RPC service: "+this.s)};services[CALLBACK_NAME]=function(callbackId,result){var callback=callbacks[callbackId];if(callback){delete callbacks[callbackId];callback(result)}};function setupFrame(frameId){if(setup[frameId]){return }if(relayChannel==="fe"){try{var frame=document.getElementById(frameId);frame[FE_G2C_CHANNEL]=function(args){process(gadgets.json.parse(args))}}catch(e){}}setup[frameId]=true}function encodeLegacyData(args){var stringify=gadgets.json.stringify;var argsEscaped=[];for(var i=0,j=args.length;i<j;++i){argsEscaped.push(encodeURIComponent(stringify(args[i])))}return argsEscaped.join("&")}function process(rpc){if(rpc&&typeof rpc.s==="string"&&typeof rpc.f==="string"&&rpc.a instanceof Array){if(authToken[rpc.f]){if(authToken[rpc.f]!=rpc.t){if(AJS.debug){console.log("Invalid auth token received for operation: "+rpc.s)}return }}if(rpc.c){rpc.callback=function(result){gadgets.rpc.call(rpc.f,CALLBACK_NAME,null,rpc.c,result)}}var result=(services[rpc.s]||services[DEFAULT_NAME]).apply(rpc,rpc.a);if(rpc.c&&typeof result!="undefined"){gadgets.rpc.call(rpc.f,CALLBACK_NAME,null,rpc.c,result)}}}function callFrameElement(targetId,serviceName,from,rpcData,callArgs){try{if(from!=".."){var fe=window.frameElement;if(typeof fe[FE_G2C_CHANNEL]==="function"){if(typeof fe[FE_G2C_CHANNEL][FE_C2G_CHANNEL]!=="function"){fe[FE_G2C_CHANNEL][FE_C2G_CHANNEL]=function(args){process(gadgets.json.parse(args))}}fe[FE_G2C_CHANNEL](rpcData);return }}else{var frame=document.getElementById(targetId);if(typeof frame[FE_G2C_CHANNEL]==="function"&&typeof frame[FE_G2C_CHANNEL][FE_C2G_CHANNEL]==="function"){frame[FE_G2C_CHANNEL][FE_C2G_CHANNEL](rpcData);return }}}catch(e){}callIfpc(targetId,serviceName,from,rpcData,callArgs)}function callIfpc(targetId,serviceName,from,rpcData,callArgs){var relay=gadgets.rpc.getRelayUrl(targetId);if(!relay){throw new Error("No relay file assigned for IFPC")}var src=null;if(useLegacyProtocol[targetId]){src=[relay,"#",encodeLegacyData([from,callId,1,0,encodeLegacyData([from,serviceName,"","",from].concat(callArgs))])].join("")}else{src=[relay,"#",targetId,"&",from,"@",callId,"&1&0&",encodeURIComponent(rpcData)].join("")}emitInvisibleIframe(src)}function emitInvisibleIframe(src){var iframe;for(var i=iframePool.length-1;i>=0;--i){var ifr=iframePool[i];try{if(ifr&&(ifr.recyclable||ifr.readyState==="complete")){ifr.parentNode.removeChild(ifr);if(window.ActiveXObject){iframePool[i]=ifr=null;iframePool.splice(i,1)}else{ifr.recyclable=false;iframe=ifr;break}}}catch(e){}}if(!iframe){iframe=document.createElement("iframe");iframe.style.border=iframe.style.width=iframe.style.height="0px";iframe.style.visibility="hidden";iframe.style.position="absolute";iframe.onload=function(){this.recyclable=true};iframePool.push(iframe)}iframe.src=src;setTimeout(function(){document.body.appendChild(iframe)},0)}function callSameDomain(target,rpc){if(typeof sameDomain[target]==="undefined"){sameDomain[target]=false;var targetEl=null;if(target===".."){targetEl=parent}else{targetEl=frames[target]}try{sameDomain[target]=targetEl.gadgets.rpc.receiveSameDomain}catch(e){}}if(typeof sameDomain[target]==="function"){sameDomain[target](rpc);return true}return false}if(gadgets.config){function init(config){if(config.rpc.parentRelayUrl.substring(0,7)==="http://"){relayUrl[".."]=config.rpc.parentRelayUrl}else{var params=document.location.search.substring(0).split("&");var parentParam="";for(var i=0,param;param=params[i];++i){if(param.indexOf("parent=")===0){parentParam=decodeURIComponent(param.substring(7));break}}relayUrl[".."]=parentParam+config.rpc.parentRelayUrl}useLegacyProtocol[".."]=!!config.rpc.useLegacyProtocol}var requiredConfig={parentRelayUrl:gadgets.config.NonEmptyStringValidator};gadgets.config.register("rpc",requiredConfig,init)}return{register:function(serviceName,handler){if(serviceName==CALLBACK_NAME){throw new Error("Cannot overwrite callback service")}if(serviceName==DEFAULT_NAME){throw new Error("Cannot overwrite default service:"+" use registerDefault")}services[serviceName]=handler},unregister:function(serviceName){if(serviceName==CALLBACK_NAME){throw new Error("Cannot delete callback service")}if(serviceName==DEFAULT_NAME){throw new Error("Cannot delete default service:"+" use unregisterDefault")}delete services[serviceName]},registerDefault:function(handler){services[""]=handler},unregisterDefault:function(){delete services[""]},call:function(targetId,serviceName,callback,var_args){++callId;targetId=targetId||"..";if(callback){callbacks[callId]=callback}var from="..";if(targetId===".."){from=window.name}var rpc={s:serviceName,f:from,c:callback?callId:0,a:Array.prototype.slice.call(arguments,3),t:authToken[targetId]};if(callSameDomain(targetId,rpc)){return }var rpcData=gadgets.json.stringify(rpc);var channelType=relayChannel;if(useLegacyProtocol[targetId]){channelType="ifpc"}switch(channelType){case"dpm":var targetDoc=targetId===".."?parent.document:frames[targetId].document;targetDoc.postMessage(rpcData);break;case"wpm":var targetWin=targetId===".."?parent:frames[targetId];targetWin.postMessage(rpcData,relayUrl[targetId]);break;case"fe":callFrameElement(targetId,serviceName,from,rpcData,rpc.a);break;default:callIfpc(targetId,serviceName,from,rpcData,rpc.a);break}},getRelayUrl:function(targetId){return relayUrl[targetId]},setRelayUrl:function(targetId,url,opt_useLegacy){relayUrl[targetId]=url;useLegacyProtocol[targetId]=!!opt_useLegacy},setAuthToken:function(targetId,token){authToken[targetId]=token;setupFrame(targetId)},getRelayChannel:function(){return relayChannel},receive:function(fragment){if(fragment.length>4){process(gadgets.json.parse(decodeURIComponent(fragment[fragment.length-1])))}},receiveSameDomain:function(rpc){rpc.a=Array.prototype.slice.call(rpc.a);window.setTimeout(function(){process(rpc)},0)}}}();
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/util.js' */
Function.prototype.inherits=function(parentCtor){function tempCtor(){}tempCtor.prototype=parentCtor.prototype;this.superClass_=parentCtor.prototype;this.prototype=new tempCtor();this.prototype.constructor=this};
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/json.js' */
var gadgets=gadgets||{};gadgets.json=function(){function f(n){return n<10?"0"+n:n}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",f(this.getUTCMonth()+1),"-",f(this.getUTCDate()),"T",f(this.getUTCHours()),":",f(this.getUTCMinutes()),":",f(this.getUTCSeconds()),"Z"].join("")};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function stringify(value){var a,i,k,l,r=/["\\\x00-\x1f\x7f-\x9f]/g,v;switch(typeof value){case"string":return r.test(value)?'"'+value.replace(r,function(a){var c=m[a];if(c){return c}c=a.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"':'"'+value+'"';case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}a=[];if(typeof value.length==="number"&&!(value.propertyIsEnumerable("length"))){l=value.length;for(i=0;i<l;i+=1){a.push(stringify(value[i])||"null")}return"["+a.join(",")+"]"}for(k in value){if(value.hasOwnProperty(k)){if(typeof k==="string"){v=stringify(value[k]);if(v){a.push(stringify(k)+":"+v)}}}}return"{"+a.join(",")+"}"}}return{stringify:stringify,parse:function(text){if(/^[\],:{}\s]*$/.test(text.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return eval("("+text+")")}return false}}}();
/* module-key = 'com.atlassian.gadgets.embedded:gadget-core-resources', location = 'js/gadgets-core.js' */
var gadgets=gadgets||{};gadgets.error={};gadgets.error.SUBCLASS_RESPONSIBILITY="subclass responsibility";gadgets.error.TO_BE_DONE="to be done";gadgets.log=function(message){if(window.console&&console.log){console.log(message)}else{var logEntry=document.createElement("div");logEntry.className="gadgets-log-entry";logEntry.innerHTML=message;document.body.appendChild(logEntry)}};gadgets.Extensible=function(){};gadgets.Extensible.prototype.setDependencies=function(dependencies){for(var p in dependencies){this[p]=dependencies[p]}};gadgets.Extensible.prototype.getDependencies=function(name){return this[name]};gadgets.UserPrefStore=function(){};gadgets.UserPrefStore.prototype.getPrefs=function(gadget){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.UserPrefStore.prototype.savePrefs=function(gadget){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.DefaultUserPrefStore=function(){gadgets.UserPrefStore.call(this)};gadgets.DefaultUserPrefStore.inherits(gadgets.UserPrefStore);gadgets.DefaultUserPrefStore.prototype.getPrefs=function(gadget){};gadgets.DefaultUserPrefStore.prototype.savePrefs=function(gadget){};gadgets.GadgetService=function(){};gadgets.GadgetService.prototype.setHeight=function(elementId,height){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.GadgetService.prototype.setTitle=function(gadget,title){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.GadgetService.prototype.setUserPref=function(id){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.IfrGadgetService=function(){gadgets.GadgetService.call(this);var service=this;gadgets.rpc.register("resize_iframe",function(){service.setHeight.apply(this,arguments)});gadgets.rpc.register("set_pref",function(){service.setUserPref.apply(this,arguments)});gadgets.rpc.register("set_title",function(){service.setTitle.apply(this,arguments)});gadgets.rpc.register("requestNavigateTo",function(){service.requestNavigateTo.apply(this,arguments)})};gadgets.IfrGadgetService.inherits(gadgets.GadgetService);gadgets.IfrGadgetService.prototype.setHeight=function(height){if(height>gadgets.container.maxheight_){height=gadgets.container.maxheight_}var element=document.getElementById(this.f);if(element){element.style.height=height+"px"}};gadgets.IfrGadgetService.prototype.requestNavigateTo=function(view,opt_params){var id=this.getGadgetIdFromModuleId(this.f);var url=this.getUrlForView(view);if(opt_params){var paramStr=JSON.stringify(opt_params);if(paramStr.length>0){url+="&appParams="+encodeURIComponent(paramStr)}}if(url&&document.location.href.indexOf(url)==-1){document.location.href=url}};gadgets.IfrGadgetService.prototype.getUrlForView=function(view){if(view==="canvas"){return"/canvas"}else{if(view==="profile"){return"/profile"}else{return null}}};gadgets.IfrGadgetService.prototype.getGadgetIdFromModuleId=function(moduleId){return parseInt(moduleId.match(/_([0-9]+)$/)[1],10)};gadgets.LayoutManager=function(){};gadgets.LayoutManager.prototype.getGadgetChrome=function(gadget){throw Error(gadgets.error.SUBCLASS_RESPONSIBILITY)};gadgets.StaticLayoutManager=function(){gadgets.LayoutManager.call(this)};gadgets.StaticLayoutManager.inherits(gadgets.LayoutManager);gadgets.StaticLayoutManager.prototype.setGadgetChromeIds=function(gadgetChromeIds){this.gadgetChromeIds_=gadgetChromeIds};gadgets.StaticLayoutManager.prototype.getGadgetChrome=function(gadget){var chromeId=this.gadgetChromeIds_[gadget.id];return chromeId?document.getElementById(chromeId):null};gadgets.FloatLeftLayoutManager=function(layoutRootId){gadgets.LayoutManager.call(this);this.layoutRootId_=layoutRootId};gadgets.FloatLeftLayoutManager.inherits(gadgets.LayoutManager);gadgets.FloatLeftLayoutManager.prototype.getGadgetChrome=function(gadget){var layoutRoot=document.getElementById(this.layoutRootId_);if(layoutRoot){var chrome=document.createElement("div");chrome.className="gadgets-gadget-chrome";chrome.style.cssFloat="left";layoutRoot.appendChild(chrome);return chrome}else{return null}};
/* module-key = 'com.atlassian.gadgets.embedded:gadget-container-resources', location = 'js/gadgets-container.js' */
gadgets.Container=function(){this.parentUrl_="http://"+document.location.host;this.country_="ALL";this.language_="ALL";this.view_="default";this.nocache_=1;this.maxheight_=2147483647};gadgets.Container.inherits(gadgets.Extensible);gadgets.Container.prototype.userPrefStore=new gadgets.DefaultUserPrefStore();gadgets.Container.prototype.gadgetService=new gadgets.GadgetService();gadgets.Container.prototype.layoutManager=new gadgets.StaticLayoutManager();gadgets.Container.prototype.setParentUrl=function(url){this.parentUrl_=url};gadgets.Container.prototype.setCountry=function(country){this.country_=country};gadgets.Container.prototype.setNoCache=function(nocache){this.nocache_=nocache};gadgets.Container.prototype.setLanguage=function(language){this.language_=language};gadgets.Container.prototype.setView=function(view){this.view_=view};gadgets.Container.prototype.setMaxHeight=function(maxheight){this.maxheight_=maxheight};gadgets.Container.prototype.getGadgetKey_=function(instanceId){return"gadget_"+instanceId};gadgets.IfrContainer=function(){gadgets.Container.call(this)};gadgets.IfrContainer.inherits(gadgets.Container);gadgets.IfrContainer.prototype.gadgetService=new gadgets.IfrGadgetService();gadgets.IfrContainer.prototype.setParentUrl=function(url){if(!url.match(/^http[s]?:\/\//)){url=document.location.href.match(/^[^?#]+\//)[0]+url}this.parentUrl_=url};gadgets.container=new gadgets.IfrContainer();
/* module-key = 'com.atlassian.gadgets.embedded:gadget-standalone-resources', location = 'js/gadgets-standalone.js' */
new gadgets.IfrGadgetService();gadgets.IfrGadgetService.prototype.setTitle=function(title){};
/* module-key = 'jira.webresources:jquery-easing', location = '/includes/jquery/plugins/easing/jquery.easing.1.3.js' */
jQuery.easing["jswing"]=jQuery.easing["swing"];jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(x,t,b,c,d){return jQuery.easing[jQuery.easing.def](x,t,b,c,d)},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b},easeOutQuad:function(x,t,b,c,d){return -c*(t/=d)*(t-2)+b},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t+b}return -c/2*((--t)*(t-2)-1)+b},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t+b}return c/2*((t-=2)*t*t+2)+b},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b},easeOutQuart:function(x,t,b,c,d){return -c*((t=t/d-1)*t*t*t-1)+b},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t+b}return -c/2*((t-=2)*t*t*t-2)+b},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t*t*t+b}return c/2*((t-=2)*t*t*t*t+2)+b},easeInSine:function(x,t,b,c,d){return -c*Math.cos(t/d*(Math.PI/2))+c+b},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b},easeInOutSine:function(x,t,b,c,d){return -c/2*(Math.cos(Math.PI*t/d)-1)+b},easeInExpo:function(x,t,b,c,d){return(t==0)?b:c*Math.pow(2,10*(t/d-1))+b},easeOutExpo:function(x,t,b,c,d){return(t==d)?b+c:c*(-Math.pow(2,-10*t/d)+1)+b},easeInOutExpo:function(x,t,b,c,d){if(t==0){return b}if(t==d){return b+c}if((t/=d/2)<1){return c/2*Math.pow(2,10*(t-1))+b}return c/2*(-Math.pow(2,-10*--t)+2)+b},easeInCirc:function(x,t,b,c,d){return -c*(Math.sqrt(1-(t/=d)*t)-1)+b},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1){return -c/2*(Math.sqrt(1-t*t)-1)+b}return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*0.3}if(a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return -(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0){return b}if((t/=d)==1){return b+c}if(!p){p=d*0.3}if(a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0){return b}if((t/=d/2)==2){return b+c}if(!p){p=d*(0.3*1.5)}if(a<Math.abs(c)){a=c;var s=p/4}else{var s=p/(2*Math.PI)*Math.asin(c/a)}if(t<1){return -0.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b}return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*0.5+c+b},easeInBack:function(x,t,b,c,d,s){if(s==undefined){s=1.70158}return c*(t/=d)*t*((s+1)*t-s)+b},easeOutBack:function(x,t,b,c,d,s){if(s==undefined){s=1.70158}return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined){s=1.70158}if((t/=d/2)<1){return c/2*(t*t*(((s*=(1.525))+1)*t-s))+b}return c/2*((t-=2)*t*(((s*=(1.525))+1)*t+s)+2)+b},easeInBounce:function(x,t,b,c,d){return c-jQuery.easing.easeOutBounce(x,d-t,0,c,d)+b},easeOutBounce:function(x,t,b,c,d){if((t/=d)<(1/2.75)){return c*(7.5625*t*t)+b}else{if(t<(2/2.75)){return c*(7.5625*(t-=(1.5/2.75))*t+0.75)+b}else{if(t<(2.5/2.75)){return c*(7.5625*(t-=(2.25/2.75))*t+0.9375)+b}else{return c*(7.5625*(t-=(2.625/2.75))*t+0.984375)+b}}}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2){return jQuery.easing.easeInBounce(x,t*2,0,c,d)*0.5+b}return jQuery.easing.easeOutBounce(x,t*2-d,0,c,d)*0.5+c*0.5+b}});
/* module-key = 'jira.webresources:jquery-fancybox', location = '/includes/jquery/plugins/fancybox/jquery.fancybox-1.3.4.js' */
(function($){var tmp,loading,overlay,wrap,outer,content,close,title,nav_left,nav_right,selectedIndex=0,selectedOpts={},selectedArray=[],currentIndex=0,currentOpts={},currentArray=[],ajaxLoader=null,imgPreloader=new Image(),imgRegExp=/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i,swfRegExp=/[^\.]\.(swf)\s*$/i,loadingTimer,loadingFrame=1,titleHeight=0,titleStr="",start_pos,final_pos,busy=false,fx=$.extend($("<div/>")[0],{prop:0}),isIE6=$.browser.msie&&$.browser.version<7&&!window.XMLHttpRequest,_abort=function(){loading.hide();imgPreloader.onerror=imgPreloader.onload=null;if(ajaxLoader){ajaxLoader.abort()}tmp.empty()},_error=function(){if(false===selectedOpts.onError(selectedArray,selectedIndex,selectedOpts)){loading.hide();busy=false;return }selectedOpts.titleShow=false;selectedOpts.width="auto";selectedOpts.height="auto";tmp.html('<p id="fancybox-error">The requested content cannot be loaded.<br />Please try again later.</p>');_process_inline()},_start=function(){var obj=selectedArray[selectedIndex],href,type,title,str,emb,ret;_abort();selectedOpts=$.extend({},$.fn.fancybox.defaults,(typeof $(obj).data("fancybox")=="undefined"?selectedOpts:$(obj).data("fancybox")));ret=selectedOpts.onStart(selectedArray,selectedIndex,selectedOpts);if(ret===false){busy=false;return }else{if(typeof ret=="object"){selectedOpts=$.extend(selectedOpts,ret)}}title=selectedOpts.title||(obj.nodeName?$(obj).attr("title"):obj.title)||"";if(obj.nodeName&&!selectedOpts.orig){selectedOpts.orig=$(obj).children("img:first").length?$(obj).children("img:first"):$(obj)}if(title===""&&selectedOpts.orig&&selectedOpts.titleFromAlt){title=selectedOpts.orig.attr("alt")}href=selectedOpts.href||(obj.nodeName?$(obj).attr("href"):obj.href)||null;if((/^(?:javascript)/i).test(href)||href=="#"){href=null}if(selectedOpts.type){type=selectedOpts.type;if(!href){href=selectedOpts.content}}else{if(selectedOpts.content){type="html"}else{if(href){if(href.match(imgRegExp)){type="image"}else{if(href.match(swfRegExp)){type="swf"}else{if($(obj).hasClass("iframe")){type="iframe"}else{if(href.indexOf("#")===0){type="inline"}else{type="ajax"}}}}}}}if(!type){_error();return }if(type=="inline"){obj=href.substr(href.indexOf("#"));type=$(obj).length>0?"inline":"ajax"}selectedOpts.type=type;selectedOpts.href=href;selectedOpts.title=title;if(selectedOpts.autoDimensions){if(selectedOpts.type=="html"||selectedOpts.type=="inline"||selectedOpts.type=="ajax"){selectedOpts.width="auto";selectedOpts.height="auto"}else{selectedOpts.autoDimensions=false}}if(selectedOpts.modal){selectedOpts.overlayShow=true;selectedOpts.hideOnOverlayClick=false;selectedOpts.hideOnContentClick=false;selectedOpts.enableEscapeButton=false;selectedOpts.showCloseButton=false}selectedOpts.padding=parseInt(selectedOpts.padding,10);selectedOpts.margin=parseInt(selectedOpts.margin,10);tmp.css("padding",(selectedOpts.padding+selectedOpts.margin));$(".fancybox-inline-tmp").unbind("fancybox-cancel").bind("fancybox-change",function(){$(this).replaceWith(content.children())});switch(type){case"html":tmp.html(selectedOpts.content);_process_inline();break;case"inline":if($(obj).parent().is("#fancybox-content")===true){busy=false;return }$('<div class="fancybox-inline-tmp" />').hide().insertBefore($(obj)).bind("fancybox-cleanup",function(){$(this).replaceWith(content.children())}).bind("fancybox-cancel",function(){$(this).replaceWith(tmp.children())});$(obj).appendTo(tmp);_process_inline();break;case"image":busy=false;$.fancybox.showActivity();imgPreloader=new Image();imgPreloader.onerror=function(){_error()};imgPreloader.onload=function(){busy=true;imgPreloader.onerror=imgPreloader.onload=null;_process_image()};imgPreloader.src=href;break;case"swf":selectedOpts.scrolling="no";str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"><param name="movie" value="'+href+'"></param>';emb="";$.each(selectedOpts.swf,function(name,val){str+='<param name="'+name+'" value="'+val+'"></param>';emb+=" "+name+'="'+val+'"'});str+='<embed src="'+href+'" type="application/x-shockwave-flash" width="'+selectedOpts.width+'" height="'+selectedOpts.height+'"'+emb+"></embed></object>";tmp.html(str);_process_inline();break;case"ajax":busy=false;$.fancybox.showActivity();selectedOpts.ajax.win=selectedOpts.ajax.success;ajaxLoader=$.ajax($.extend({},selectedOpts.ajax,{url:href,data:selectedOpts.ajax.data||{},error:function(XMLHttpRequest,textStatus,errorThrown){if(XMLHttpRequest.status>0){_error()}},success:function(data,textStatus,XMLHttpRequest){var o=typeof XMLHttpRequest=="object"?XMLHttpRequest:ajaxLoader;if(o.status==200){if(typeof selectedOpts.ajax.win=="function"){ret=selectedOpts.ajax.win(href,data,textStatus,XMLHttpRequest);if(ret===false){loading.hide();return }else{if(typeof ret=="string"||typeof ret=="object"){data=ret}}}tmp.html(data);_process_inline()}}}));break;case"iframe":_show();break}},_process_inline=function(){var w=selectedOpts.width,h=selectedOpts.height;if(w.toString().indexOf("%")>-1){w=parseInt(($(window).width()-(selectedOpts.margin*2))*parseFloat(w)/100,10)+"px"}else{w=w=="auto"?"auto":w+"px"}if(h.toString().indexOf("%")>-1){h=parseInt(($(window).height()-(selectedOpts.margin*2))*parseFloat(h)/100,10)+"px"}else{h=h=="auto"?"auto":h+"px"}tmp.wrapInner('<div style="width:'+w+";height:"+h+";overflow: "+(selectedOpts.scrolling=="auto"?"auto":(selectedOpts.scrolling=="yes"?"scroll":"hidden"))+';position:relative;"></div>');selectedOpts.width=tmp.width();selectedOpts.height=tmp.height();_show()},_process_image=function(){selectedOpts.width=imgPreloader.width;selectedOpts.height=imgPreloader.height;$("<img />").attr({"id":"fancybox-img","src":imgPreloader.src,"alt":selectedOpts.title}).appendTo(tmp);_show()},_show=function(){var pos,equal;loading.hide();if(wrap.is(":visible")&&false===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)){$.event.trigger("fancybox-cancel");busy=false;return }busy=true;$(content.add(overlay)).unbind();$(window).unbind("resize.fb scroll.fb");$(document).unbind("keydown.fb");if(wrap.is(":visible")&&currentOpts.titlePosition!=="outside"){wrap.css("height",wrap.height())}currentArray=selectedArray;currentIndex=selectedIndex;currentOpts=selectedOpts;if(currentOpts.overlayShow){overlay.css({"background-color":currentOpts.overlayColor,"opacity":currentOpts.overlayOpacity,"cursor":currentOpts.hideOnOverlayClick?"pointer":"auto","height":$(document).height()});if(!overlay.is(":visible")){if(isIE6){$("select:not(#fancybox-tmp select)").filter(function(){return this.style.visibility!=="hidden"}).css({"visibility":"hidden"}).one("fancybox-cleanup",function(){this.style.visibility="inherit"})}overlay.show()}}else{overlay.hide()}final_pos=_get_zoom_to();_process_title();if(wrap.is(":visible")){$(close.add(nav_left).add(nav_right)).hide();pos=wrap.position(),start_pos={top:pos.top,left:pos.left,width:wrap.width(),height:wrap.height()};equal=(start_pos.width==final_pos.width&&start_pos.height==final_pos.height);content.fadeTo(currentOpts.changeFade,0.3,function(){var finish_resizing=function(){content.html(tmp.contents()).fadeTo(currentOpts.changeFade,1,_finish)};$.event.trigger("fancybox-change");content.empty().removeAttr("filter").css({"border-width":currentOpts.padding,"width":final_pos.width-currentOpts.padding*2,"height":selectedOpts.autoDimensions?"auto":final_pos.height-titleHeight-currentOpts.padding*2});if(equal){finish_resizing()}else{fx.prop=0;$(fx).animate({prop:1},{duration:currentOpts.changeSpeed,easing:currentOpts.easingChange,step:_draw,complete:finish_resizing})}});return }wrap.removeAttr("style");content.css("border-width",currentOpts.padding);if(currentOpts.transitionIn=="elastic"){start_pos=_get_zoom_from();content.html(tmp.contents());wrap.show();if(currentOpts.opacity){final_pos.opacity=0}fx.prop=0;$(fx).animate({prop:1},{duration:currentOpts.speedIn,easing:currentOpts.easingIn,step:_draw,complete:_finish});return }if(currentOpts.titlePosition=="inside"&&titleHeight>0){title.show()}content.css({"width":final_pos.width-currentOpts.padding*2,"height":selectedOpts.autoDimensions?"auto":final_pos.height-titleHeight-currentOpts.padding*2}).html(tmp.contents());wrap.css(final_pos).fadeIn(currentOpts.transitionIn=="none"?0:currentOpts.speedIn,_finish)},_format_title=function(title){if(title&&title.length){if(currentOpts.titlePosition=="float"){return'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+title+'</td><td id="fancybox-title-float-right"></td></tr></table>'}return'<div id="fancybox-title-'+currentOpts.titlePosition+'">'+title+"</div>"}return false},_process_title=function(){titleStr=currentOpts.title||"";titleHeight=0;title.empty().removeAttr("style").removeClass();if(currentOpts.titleShow===false){title.hide();return }titleStr=$.isFunction(currentOpts.titleFormat)?currentOpts.titleFormat(titleStr,currentArray,currentIndex,currentOpts):_format_title(titleStr);if(!titleStr||titleStr===""){title.hide();return }title.addClass("fancybox-title-"+currentOpts.titlePosition).html(titleStr).appendTo("body").show();switch(currentOpts.titlePosition){case"inside":title.css({"width":final_pos.width-(currentOpts.padding*2),"marginLeft":currentOpts.padding,"marginRight":currentOpts.padding});titleHeight=title.outerHeight(true);title.appendTo(outer);final_pos.height+=titleHeight;break;case"over":title.css({"marginLeft":currentOpts.padding,"width":final_pos.width-(currentOpts.padding*2),"bottom":currentOpts.padding}).appendTo(outer);break;case"float":title.css("left",parseInt((title.width()-final_pos.width-40)/2,10)*-1).appendTo(wrap);break;default:title.css({"width":final_pos.width-(currentOpts.padding*2),"paddingLeft":currentOpts.padding,"paddingRight":currentOpts.padding}).appendTo(wrap);break}title.hide()},_set_navigation=function(){if(currentOpts.enableEscapeButton||currentOpts.enableKeyboardNav){$(document).bind("keydown.fb",function(e){if(e.keyCode==27&&currentOpts.enableEscapeButton){e.preventDefault();$.fancybox.close()}else{if((e.keyCode==37||e.keyCode==39)&&currentOpts.enableKeyboardNav&&e.target.tagName!=="INPUT"&&e.target.tagName!=="TEXTAREA"&&e.target.tagName!=="SELECT"){e.preventDefault();$.fancybox[e.keyCode==37?"prev":"next"]()}}})}if(!currentOpts.showNavArrows){nav_left.hide();nav_right.hide();return }if((currentOpts.cyclic&&currentArray.length>1)||currentIndex!==0){nav_left.show()}if((currentOpts.cyclic&&currentArray.length>1)||currentIndex!=(currentArray.length-1)){nav_right.show()}},_finish=function(){if(!$.support.opacity){content.get(0).style.removeAttribute("filter");wrap.get(0).style.removeAttribute("filter")}if(selectedOpts.autoDimensions){content.css("height","auto")}wrap.css("height","auto");if(titleStr&&titleStr.length){title.show()}if(currentOpts.showCloseButton){close.show()}_set_navigation();if(currentOpts.hideOnContentClick){content.bind("click",$.fancybox.close)}if(currentOpts.hideOnOverlayClick){overlay.bind("click",$.fancybox.close)}$(window).bind("resize.fb",$.fancybox.resize);if(currentOpts.centerOnScroll){$(window).bind("scroll.fb",$.fancybox.center)}if(currentOpts.type=="iframe"){$('<iframe id="fancybox-frame" name="fancybox-frame'+new Date().getTime()+'" frameborder="0" hspace="0" '+($.browser.msie?'allowtransparency="true""':"")+' scrolling="'+selectedOpts.scrolling+'" src="'+currentOpts.href+'"></iframe>').appendTo(content)}wrap.show();busy=false;$.fancybox.center();currentOpts.onComplete(currentArray,currentIndex,currentOpts);_preload_images()},_preload_images=function(){var href,objNext;if((currentArray.length-1)>currentIndex){href=currentArray[currentIndex+1].href;if(typeof href!=="undefined"&&href.match(imgRegExp)){objNext=new Image();objNext.src=href}}if(currentIndex>0){href=currentArray[currentIndex-1].href;if(typeof href!=="undefined"&&href.match(imgRegExp)){objNext=new Image();objNext.src=href}}},_draw=function(pos){var dim={width:parseInt(start_pos.width+(final_pos.width-start_pos.width)*pos,10),height:parseInt(start_pos.height+(final_pos.height-start_pos.height)*pos,10),top:parseInt(start_pos.top+(final_pos.top-start_pos.top)*pos,10),left:parseInt(start_pos.left+(final_pos.left-start_pos.left)*pos,10)};if(typeof final_pos.opacity!=="undefined"){dim.opacity=pos<0.5?0.5:pos}wrap.css(dim);content.css({"width":dim.width-currentOpts.padding*2,"height":dim.height-(titleHeight*pos)-currentOpts.padding*2})},_get_viewport=function(){return[$(window).width()-(currentOpts.margin*2),$(window).height()-(currentOpts.margin*2),$(document).scrollLeft()+currentOpts.margin,$(document).scrollTop()+currentOpts.margin]},_get_zoom_to=function(){var view=_get_viewport(),to={},resize=currentOpts.autoScale,double_padding=currentOpts.padding*2,ratio;if(currentOpts.width.toString().indexOf("%")>-1){to.width=parseInt((view[0]*parseFloat(currentOpts.width))/100,10)}else{to.width=currentOpts.width+double_padding}if(currentOpts.height.toString().indexOf("%")>-1){to.height=parseInt((view[1]*parseFloat(currentOpts.height))/100,10)}else{to.height=currentOpts.height+double_padding}if(resize&&(to.width>view[0]||to.height>view[1])){if(selectedOpts.type=="image"||selectedOpts.type=="swf"){ratio=(currentOpts.width)/(currentOpts.height);if((to.width)>view[0]){to.width=view[0];to.height=parseInt(((to.width-double_padding)/ratio)+double_padding,10)}if((to.height)>view[1]){to.height=view[1];to.width=parseInt(((to.height-double_padding)*ratio)+double_padding,10)}}else{to.width=Math.min(to.width,view[0]);to.height=Math.min(to.height,view[1])}}to.top=parseInt(Math.max(view[3]-20,view[3]+((view[1]-to.height-40)*0.5)),10);to.left=parseInt(Math.max(view[2]-20,view[2]+((view[0]-to.width-40)*0.5)),10);return to},_get_obj_pos=function(obj){var pos=obj.offset();pos.top+=parseInt(obj.css("paddingTop"),10)||0;pos.left+=parseInt(obj.css("paddingLeft"),10)||0;pos.top+=parseInt(obj.css("border-top-width"),10)||0;pos.left+=parseInt(obj.css("border-left-width"),10)||0;pos.width=obj.width();pos.height=obj.height();return pos},_get_zoom_from=function(){var orig=selectedOpts.orig?$(selectedOpts.orig):false,from={},pos,view;if(orig&&orig.length){pos=_get_obj_pos(orig);from={width:pos.width+(currentOpts.padding*2),height:pos.height+(currentOpts.padding*2),top:pos.top-currentOpts.padding-20,left:pos.left-currentOpts.padding-20}}else{view=_get_viewport();from={width:currentOpts.padding*2,height:currentOpts.padding*2,top:parseInt(view[3]+view[1]*0.5,10),left:parseInt(view[2]+view[0]*0.5,10)}}return from},_animate_loading=function(){if(!loading.is(":visible")){clearInterval(loadingTimer);return }$("div",loading).css("top",(loadingFrame*-40)+"px");loadingFrame=(loadingFrame+1)%12};$.fn.fancybox=function(options){if(!$(this).length){return this}$(this).data("fancybox",$.extend({},options,($.metadata?$(this).metadata():{}))).unbind("click.fb").bind("click.fb",function(e){e.preventDefault();if(busy){return }busy=true;$(this).blur();selectedArray=[];selectedIndex=0;var rel=$(this).attr("rel")||"";if(!rel||rel==""||rel==="nofollow"){selectedArray.push(this)}else{selectedArray=$("a[rel="+rel+"], area[rel="+rel+"]");selectedIndex=selectedArray.index(this)}_start();return });return this};$.fancybox=function(obj){var opts;if(busy){return }busy=true;opts=typeof arguments[1]!=="undefined"?arguments[1]:{};selectedArray=[];selectedIndex=parseInt(opts.index,10)||0;if($.isArray(obj)){for(var i=0,j=obj.length;i<j;i++){if(typeof obj[i]=="object"){$(obj[i]).data("fancybox",$.extend({},opts,obj[i]))}else{obj[i]=$({}).data("fancybox",$.extend({content:obj[i]},opts))}}selectedArray=jQuery.merge(selectedArray,obj)}else{if(typeof obj=="object"){$(obj).data("fancybox",$.extend({},opts,obj))}else{obj=$({}).data("fancybox",$.extend({content:obj},opts))}selectedArray.push(obj)}if(selectedIndex>selectedArray.length||selectedIndex<0){selectedIndex=0}_start()};$.fancybox.showActivity=function(){clearInterval(loadingTimer);loading.show();loadingTimer=setInterval(_animate_loading,66)};$.fancybox.hideActivity=function(){loading.hide()};$.fancybox.next=function(){return $.fancybox.pos(currentIndex+1)};$.fancybox.prev=function(){return $.fancybox.pos(currentIndex-1)};$.fancybox.pos=function(pos){if(busy){return }pos=parseInt(pos);selectedArray=currentArray;if(pos>-1&&pos<currentArray.length){selectedIndex=pos;_start()}else{if(currentOpts.cyclic&&currentArray.length>1){selectedIndex=pos>=currentArray.length?0:currentArray.length-1;_start()}}return };$.fancybox.cancel=function(){if(busy){return }busy=true;$.event.trigger("fancybox-cancel");_abort();selectedOpts.onCancel(selectedArray,selectedIndex,selectedOpts);busy=false};$.fancybox.close=function(){if(busy||wrap.is(":hidden")){return }busy=true;if(currentOpts&&false===currentOpts.onCleanup(currentArray,currentIndex,currentOpts)){busy=false;return }_abort();$(close.add(nav_left).add(nav_right)).hide();$(content.add(overlay)).unbind();$(window).unbind("resize.fb scroll.fb");$(document).unbind("keydown.fb");content.find("iframe").attr("src",isIE6&&/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank");if(currentOpts.titlePosition!=="inside"){title.empty()}wrap.stop();function _cleanup(){overlay.fadeOut("fast");title.empty().hide();wrap.hide();$.event.trigger("fancybox-cleanup");content.empty();currentOpts.onClosed(currentArray,currentIndex,currentOpts);currentArray=selectedOpts=[];currentIndex=selectedIndex=0;currentOpts=selectedOpts={};busy=false}if(currentOpts.transitionOut=="elastic"){start_pos=_get_zoom_from();var pos=wrap.position();final_pos={top:pos.top,left:pos.left,width:wrap.width(),height:wrap.height()};if(currentOpts.opacity){final_pos.opacity=1}title.empty().hide();fx.prop=1;$(fx).animate({prop:0},{duration:currentOpts.speedOut,easing:currentOpts.easingOut,step:_draw,complete:_cleanup})}else{wrap.fadeOut(currentOpts.transitionOut=="none"?0:currentOpts.speedOut,_cleanup)}};$.fancybox.resize=function(){if(overlay.is(":visible")){overlay.css("height",$(document).height())}$.fancybox.center(true)};$.fancybox.center=function(){var view,align;if(busy){return }align=arguments[0]===true?1:0;view=_get_viewport();if(!align&&(wrap.width()>view[0]||wrap.height()>view[1])){return }wrap.stop().animate({"top":parseInt(Math.max(view[3]-20,view[3]+((view[1]-content.height()-40)*0.5)-currentOpts.padding)),"left":parseInt(Math.max(view[2]-20,view[2]+((view[0]-content.width()-40)*0.5)-currentOpts.padding))},typeof arguments[0]=="number"?arguments[0]:200)};$.fancybox.init=function(){if($("#fancybox-wrap").length){return }$("body").append(tmp=$('<div id="fancybox-tmp"></div>'),loading=$('<div id="fancybox-loading"><div></div></div>'),overlay=$('<div id="fancybox-overlay"></div>'),wrap=$('<div id="fancybox-wrap"></div>'));outer=$('<div id="fancybox-outer"></div>').append('<div class="fancybox-bg" id="fancybox-bg-n"></div><div class="fancybox-bg" id="fancybox-bg-ne"></div><div class="fancybox-bg" id="fancybox-bg-e"></div><div class="fancybox-bg" id="fancybox-bg-se"></div><div class="fancybox-bg" id="fancybox-bg-s"></div><div class="fancybox-bg" id="fancybox-bg-sw"></div><div class="fancybox-bg" id="fancybox-bg-w"></div><div class="fancybox-bg" id="fancybox-bg-nw"></div>').appendTo(wrap);outer.append(content=$('<div id="fancybox-content"></div>'),close=$('<a id="fancybox-close"></a>'),title=$('<div id="fancybox-title"></div>'),nav_left=$('<a href="javascript:;" id="fancybox-left"><span class="fancy-ico" id="fancybox-left-ico"></span></a>'),nav_right=$('<a href="javascript:;" id="fancybox-right"><span class="fancy-ico" id="fancybox-right-ico"></span></a>'));close.click($.fancybox.close);loading.click($.fancybox.cancel);nav_left.click(function(e){e.preventDefault();$.fancybox.prev()});nav_right.click(function(e){e.preventDefault();$.fancybox.next()});if($.fn.mousewheel){wrap.bind("mousewheel.fb",function(e,delta){if(busy){e.preventDefault()}else{if($(e.target).get(0).clientHeight==0||$(e.target).get(0).scrollHeight===$(e.target).get(0).clientHeight){e.preventDefault();$.fancybox[delta>0?"prev":"next"]()}}})}if(!$.support.opacity){wrap.addClass("fancybox-ie")}if(isIE6){loading.addClass("fancybox-ie6");wrap.addClass("fancybox-ie6");$('<iframe id="fancybox-hide-sel-frame" src="'+(/^https/i.test(window.location.href||"")?"javascript:void(false)":"about:blank")+'" scrolling="no" border="0" frameborder="0" tabindex="-1"></iframe>').prependTo(outer)}};$.fn.fancybox.defaults={padding:10,margin:40,opacity:false,modal:false,cyclic:false,scrolling:"auto",width:560,height:340,autoScale:true,autoDimensions:true,centerOnScroll:false,ajax:{},swf:{wmode:"transparent"},hideOnOverlayClick:true,hideOnContentClick:false,overlayShow:true,overlayOpacity:0.7,overlayColor:"#777",titleShow:true,titlePosition:"float",titleFormat:null,titleFromAlt:false,transitionIn:"fade",transitionOut:"fade",speedIn:300,speedOut:300,changeSpeed:300,changeFade:"fast",easingIn:"swing",easingOut:"swing",showCloseButton:true,showNavArrows:true,enableEscapeButton:true,enableKeyboardNav:true,onStart:function(){},onCancel:function(){},onComplete:function(){},onCleanup:function(){},onClosed:function(){},onError:function(){}};$(document).ready(function(){$.fancybox.init()})})(jQuery);
/* module-key = 'jira.webresources:jquery-fancybox', location = '/includes/jquery/plugins/fancybox/jquery.fancybox.jira.js' */
AJS.$.fn.fancybox.defaults.titleFormat=function(title){if(title&&title.length){title=AJS.escapeHtml(title);if(this.titlePosition=="float"){return'<table id="fancybox-title-float-wrap" cellpadding="0" cellspacing="0"><tr><td id="fancybox-title-float-left"></td><td id="fancybox-title-float-main">'+title+'</td><td id="fancybox-title-float-right"></td></tr></table>'}return'<div id="fancybox-title-'+this.titlePosition+'">'+title+"</div>"}};
/* module-key = 'jira.webresources:jquery-livestamp', location = '/includes/jquery/plugins/livestamp/moment.js' */
(function(undefined){var moment,VERSION="2.0.0",round=Math.round,i,languages={},hasModule=(typeof module!=="undefined"&&module.exports),aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,parseMultipleFormatChunker=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{1,4}/,parseTokenSixDigits=/[+\-]?\d{1,6}/,parseTokenWord=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/i,parseTokenT=/T/i,parseTokenTimestampMs=/[\+\-]?\d+(\.\d{1,3})?/,isoRegex=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,isoFormat="YYYY-MM-DDTHH:mm:ssZ",isoTimes=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,proxyGettersAndSetters="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),unitMillisecondFactors={"Milliseconds":1,"Seconds":1000,"Minutes":60000,"Hours":3600000,"Days":86400000,"Months":2592000000,"Years":31536000000},formatFunctions={},ordinalizeTokens="DDD w W M D d".split(" "),paddedTokens="M D H h m s w W".split(" "),formatTokenFunctions={M:function(){return this.month()+1},MMM:function(format){return this.lang().monthsShort(this,format)},MMMM:function(format){return this.lang().months(this,format)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(format){return this.lang().weekdaysMin(this,format)},ddd:function(format){return this.lang().weekdaysShort(this,format)},dddd:function(format){return this.lang().weekdays(this,format)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return leftZeroFill(this.year()%100,2)},YYYY:function(){return leftZeroFill(this.year(),4)},YYYYY:function(){return leftZeroFill(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),true)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),false)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return ~~(this.milliseconds()/100)},SS:function(){return leftZeroFill(~~(this.milliseconds()/10),2)},SSS:function(){return leftZeroFill(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-"}return b+leftZeroFill(~~(a/60),2)+":"+leftZeroFill(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";if(a<0){a=-a;b="-"}return b+leftZeroFill(~~(10*a/6),4)},X:function(){return this.unix()}};function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count)}}function ordinalizeToken(func){return function(a){return this.lang().ordinal(func.call(this,a))}}while(ordinalizeTokens.length){i=ordinalizeTokens.pop();formatTokenFunctions[i+"o"]=ordinalizeToken(formatTokenFunctions[i])}while(paddedTokens.length){i=paddedTokens.pop();formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2)}formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3);function Language(){}function Moment(config){extend(this,config)}function Duration(duration){var data=this._data={},years=duration.years||duration.year||duration.y||0,months=duration.months||duration.month||duration.M||0,weeks=duration.weeks||duration.week||duration.w||0,days=duration.days||duration.day||duration.d||0,hours=duration.hours||duration.hour||duration.h||0,minutes=duration.minutes||duration.minute||duration.m||0,seconds=duration.seconds||duration.second||duration.s||0,milliseconds=duration.milliseconds||duration.millisecond||duration.ms||0;this._milliseconds=milliseconds+seconds*1000+minutes*60000+hours*3600000;this._days=days+weeks*7;this._months=months+years*12;data.milliseconds=milliseconds%1000;seconds+=absRound(milliseconds/1000);data.seconds=seconds%60;minutes+=absRound(seconds/60);data.minutes=minutes%60;hours+=absRound(minutes/60);data.hours=hours%24;days+=absRound(hours/24);days+=weeks*7;data.days=days%30;months+=absRound(days/30);data.months=months%12;years+=absRound(months/12);data.years=years}function extend(a,b){for(var i in b){if(b.hasOwnProperty(i)){a[i]=b[i]}}return a}function absRound(number){if(number<0){return Math.ceil(number)}else{return Math.floor(number)}}function leftZeroFill(number,targetLength){var output=number+"";while(output.length<targetLength){output="0"+output}return output}function addOrSubtractDurationFromMoment(mom,duration,isAdding){var ms=duration._milliseconds,d=duration._days,M=duration._months,currentDate;if(ms){mom._d.setTime(+mom+ms*isAdding)}if(d){mom.date(mom.date()+d*isAdding)}if(M){currentDate=mom.date();mom.date(1).month(mom.month()+M*isAdding).date(Math.min(currentDate,mom.daysInMonth()))}}function isArray(input){return Object.prototype.toString.call(input)==="[object Array]"}function compareArrays(array1,array2){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(~~array1[i]!==~~array2[i]){diffs++}}return diffs+lengthDiff}Language.prototype={set:function(config){var prop,i;for(i in config){prop=config[i];if(typeof prop==="function"){this[i]=prop}else{this["_"+i]=prop}}},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(m){return this._months[m.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(m){return this._monthsShort[m.month()]},monthsParse:function(monthName){var i,mom,regex,output;if(!this._monthsParse){this._monthsParse=[]}for(i=0;i<12;i++){if(!this._monthsParse[i]){mom=moment([2000,i]);regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,"");this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")}if(this._monthsParse[i].test(monthName)){return i}}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(m){return this._weekdays[m.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(m){return this._weekdaysShort[m.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(m){return this._weekdaysMin[m.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(key){var output=this._longDateFormat[key];if(!output&&this._longDateFormat[key.toUpperCase()]){output=this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)});this._longDateFormat[key]=output}return output},meridiem:function(hours,minutes,isLower){if(hours>11){return isLower?"pm":"PM"}else{return isLower?"am":"AM"}},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(key,mom){var output=this._calendar[key];return typeof output==="function"?output.apply(mom):output},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return(typeof output==="function")?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)},pastFuture:function(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return typeof format==="function"?format(output):format.replace(/%s/i,output)},ordinal:function(number){return this._ordinal.replace("%d",number)},_ordinal:"%d",preparse:function(string){return string},postformat:function(string){return string},week:function(mom){return weekOfYear(mom,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}};function loadLang(key,values){values.abbr=key;if(!languages[key]){languages[key]=new Language()}languages[key].set(values);return languages[key]}function getLangDefinition(key){if(!key){return moment.fn._lang}if(!languages[key]&&hasModule){require("./lang/"+key)}return languages[key]}function removeFormattingTokens(input){if(input.match(/\[.*\]/)){return input.replace(/^\[|\]$/g,"")}return input.replace(/\\/g,"")}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output="";for(i=0;i<length;i++){output+=typeof array[i].call==="function"?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){var i=5;function replaceLongDateFormatTokens(input){return m.lang().longDateFormat(input)||input}while(i--&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens)}if(!formatFunctions[format]){formatFunctions[format]=makeFormatFunction(format)}return formatFunctions[format](m)}function getParseRegexForToken(token){switch(token){case"DDDD":return parseTokenThreeDigits;case"YYYY":return parseTokenFourDigits;case"YYYYY":return parseTokenSixDigits;case"S":case"SS":case"SSS":case"DDD":return parseTokenOneToThreeDigits;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return parseTokenWord;case"X":return parseTokenTimestampMs;case"Z":case"ZZ":return parseTokenTimezone;case"T":return parseTokenT;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return parseTokenOneOrTwoDigits;default:return new RegExp(token.replace("\\",""))}}function addTimeToArrayFromToken(token,input,config){var a,b,datePartArray=config._a;switch(token){case"M":case"MM":datePartArray[1]=(input==null)?0:~~input-1;break;case"MMM":case"MMMM":a=getLangDefinition(config._l).monthsParse(input);if(a!=null){datePartArray[1]=a}else{config._isValid=false}break;case"D":case"DD":case"DDD":case"DDDD":if(input!=null){datePartArray[2]=~~input}break;case"YY":datePartArray[0]=~~input+(~~input>68?1900:2000);break;case"YYYY":case"YYYYY":datePartArray[0]=~~input;break;case"a":case"A":config._isPm=((input+"").toLowerCase()==="pm");break;case"H":case"HH":case"h":case"hh":datePartArray[3]=~~input;break;case"m":case"mm":datePartArray[4]=~~input;break;case"s":case"ss":datePartArray[5]=~~input;break;case"S":case"SS":case"SSS":datePartArray[6]=~~(("0."+input)*1000);break;case"X":config._d=new Date(parseFloat(input)*1000);break;case"Z":case"ZZ":config._useUTC=true;a=(input+"").match(parseTimezoneChunker);if(a&&a[1]){config._tzh=~~a[1]}if(a&&a[2]){config._tzm=~~a[2]}if(a&&a[0]==="+"){config._tzh=-config._tzh;config._tzm=-config._tzm}break}if(input==null){config._isValid=false}}function dateFromArray(config){var i,date,input=[];if(config._d){return }for(i=0;i<7;i++){config._a[i]=input[i]=(config._a[i]==null)?(i===2?1:0):config._a[i]}input[3]+=config._tzh||0;input[4]+=config._tzm||0;date=new Date(0);if(config._useUTC){date.setUTCFullYear(input[0],input[1],input[2]);date.setUTCHours(input[3],input[4],input[5],input[6])}else{date.setFullYear(input[0],input[1],input[2]);date.setHours(input[3],input[4],input[5],input[6])}config._d=date}function makeDateFromStringAndFormat(config){var tokens=config._f.match(formattingTokens),string=config._i,i,parsedInput;config._a=[];for(i=0;i<tokens.length;i++){parsedInput=(getParseRegexForToken(tokens[i]).exec(string)||[])[0];if(parsedInput){string=string.slice(string.indexOf(parsedInput)+parsedInput.length)}if(formatTokenFunctions[tokens[i]]){addTimeToArrayFromToken(tokens[i],parsedInput,config)}}if(config._isPm&&config._a[3]<12){config._a[3]+=12}if(config._isPm===false&&config._a[3]===12){config._a[3]=0}dateFromArray(config)}function makeDateFromStringAndArray(config){var tempConfig,tempMoment,bestMoment,scoreToBeat=99,i,currentDate,currentScore;while(config._f.length){tempConfig=extend({},config);tempConfig._f=config._f.pop();makeDateFromStringAndFormat(tempConfig);tempMoment=new Moment(tempConfig);if(tempMoment.isValid()){bestMoment=tempMoment;break}currentScore=compareArrays(tempConfig._a,tempMoment.toArray());if(currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempMoment}}extend(config,bestMoment)}function makeDateFromString(config){var i,string=config._i;if(isoRegex.exec(string)){config._f="YYYY-MM-DDT";for(i=0;i<4;i++){if(isoTimes[i][1].exec(string)){config._f+=isoTimes[i][0];break}}if(parseTokenTimezone.exec(string)){config._f+=" Z"}makeDateFromStringAndFormat(config)}else{config._d=new Date(string)}}function makeDateFromInput(config){var input=config._i,matched=aspNetJsonRegex.exec(input);if(input===undefined){config._d=new Date()}else{if(matched){config._d=new Date(+matched[1])}else{if(typeof input==="string"){makeDateFromString(config)}else{if(isArray(input)){config._a=input.slice(0);dateFromArray(config)}else{config._d=input instanceof Date?new Date(+input):new Date(input)}}}}}function substituteTimeAgo(string,number,withoutSuffix,isFuture,lang){return lang.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime(milliseconds,withoutSuffix,lang){var seconds=round(Math.abs(milliseconds)/1000),minutes=round(seconds/60),hours=round(minutes/60),days=round(hours/24),years=round(days/365),args=seconds<45&&["s",seconds]||minutes===1&&["m"]||minutes<45&&["mm",minutes]||hours===1&&["h"]||hours<22&&["hh",hours]||days===1&&["d"]||days<=25&&["dd",days]||days<=45&&["M"]||days<345&&["MM",round(days/30)]||years===1&&["y"]||["yy",years];args[2]=withoutSuffix;args[3]=milliseconds>0;args[4]=lang;return substituteTimeAgo.apply({},args)}function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day();if(daysToDayOfWeek>end){daysToDayOfWeek-=7}if(daysToDayOfWeek<end-7){daysToDayOfWeek+=7}return Math.ceil(moment(mom).add("d",daysToDayOfWeek).dayOfYear()/7)}function makeMoment(config){var input=config._i,format=config._f;if(input===null||input===""){return null}if(typeof input==="string"){config._i=input=getLangDefinition().preparse(input)}if(moment.isMoment(input)){config=extend({},input);config._d=new Date(+input._d)}else{if(format){if(isArray(format)){makeDateFromStringAndArray(config)}else{makeDateFromStringAndFormat(config)}}else{makeDateFromInput(config)}}return new Moment(config)}moment=function(input,format,lang){return makeMoment({_i:input,_f:format,_l:lang,_isUTC:false})};moment.utc=function(input,format,lang){return makeMoment({_useUTC:true,_isUTC:true,_l:lang,_i:input,_f:format})};moment.unix=function(input){return moment(input*1000)};moment.duration=function(input,key){var isDuration=moment.isDuration(input),isNumber=(typeof input==="number"),duration=(isDuration?input._data:(isNumber?{}:input)),ret;if(isNumber){if(key){duration[key]=input}else{duration.milliseconds=input}}ret=new Duration(duration);if(isDuration&&input.hasOwnProperty("_lang")){ret._lang=input._lang}return ret};moment.version=VERSION;moment.defaultFormat=isoFormat;moment.lang=function(key,values){var i;if(!key){return moment.fn._lang._abbr}if(values){loadLang(key,values)}else{if(!languages[key]){getLangDefinition(key)}}moment.duration.fn._lang=moment.fn._lang=getLangDefinition(key)};moment.langData=function(key){if(key&&key._lang&&key._lang._abbr){key=key._lang._abbr}return getLangDefinition(key)};moment.isMoment=function(obj){return obj instanceof Moment};moment.isDuration=function(obj){return obj instanceof Duration};moment.fn=Moment.prototype={clone:function(){return moment(this)},valueOf:function(){return +this._d},unix:function(){return Math.floor(+this._d/1000)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return moment.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var m=this;return[m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds()]},isValid:function(){if(this._isValid==null){if(this._a){this._isValid=!compareArrays(this._a,(this._isUTC?moment.utc(this._a):moment(this._a)).toArray())}else{this._isValid=!isNaN(this._d.getTime())}}return !!this._isValid},utc:function(){this._isUTC=true;return this},local:function(){this._isUTC=false;return this},format:function(inputString){var output=formatMoment(this,inputString||moment.defaultFormat);return this.lang().postformat(output)},add:function(input,val){var dur;if(typeof input==="string"){dur=moment.duration(+val,input)}else{dur=moment.duration(input,val)}addOrSubtractDurationFromMoment(this,dur,1);return this},subtract:function(input,val){var dur;if(typeof input==="string"){dur=moment.duration(+val,input)}else{dur=moment.duration(input,val)}addOrSubtractDurationFromMoment(this,dur,-1);return this},diff:function(input,units,asFloat){var that=this._isUTC?moment(input).utc():moment(input).local(),zoneDiff=(this.zone()-that.zone())*60000,diff,output;if(units){units=units.replace(/s$/,"")}if(units==="year"||units==="month"){diff=(this.daysInMonth()+that.daysInMonth())*43200000;output=((this.year()-that.year())*12)+(this.month()-that.month());output+=((this-moment(this).startOf("month"))-(that-moment(that).startOf("month")))/diff;if(units==="year"){output=output/12}}else{diff=(this-that)-zoneDiff;output=units==="second"?diff/1000:units==="minute"?diff/60000:units==="hour"?diff/3600000:units==="day"?diff/86400000:units==="week"?diff/604800000:diff}return asFloat?output:absRound(output)},from:function(time,withoutSuffix){return moment.duration(this.diff(time)).lang(this.lang()._abbr).humanize(!withoutSuffix)},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix)},calendar:function(){var diff=this.diff(moment().startOf("day"),"days",true),format=diff<-6?"sameElse":diff<-1?"lastWeek":diff<0?"lastDay":diff<1?"sameDay":diff<2?"nextDay":diff<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(format,this))},isLeapYear:function(){var year=this.year();return(year%4===0&&year%100!==0)||year%400===0},isDST:function(){return(this.zone()<moment([this.year()]).zone()||this.zone()<moment([this.year(),5]).zone())},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return input==null?day:this.add({d:input-day})},startOf:function(units){units=units.replace(/s$/,"");switch(units){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}if(units==="week"){this.day(0)}return this},endOf:function(units){return this.startOf(units).add(units.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(input,units){units=typeof units!=="undefined"?units:"millisecond";return +this.clone().startOf(units)>+moment(input).startOf(units)},isBefore:function(input,units){units=typeof units!=="undefined"?units:"millisecond";return +this.clone().startOf(units)<+moment(input).startOf(units)},isSame:function(input,units){units=typeof units!=="undefined"?units:"millisecond";return +this.clone().startOf(units)===+moment(input).startOf(units)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return moment.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(input){var dayOfYear=round((moment(this).startOf("day")-moment(this).startOf("year"))/86400000)+1;return input==null?dayOfYear:this.add("d",(input-dayOfYear))},isoWeek:function(input){var week=weekOfYear(this,1,4);return input==null?week:this.add("d",(input-week)*7)},week:function(input){var week=this.lang().week(this);return input==null?week:this.add("d",(input-week)*7)},lang:function(key){if(key===undefined){return this._lang}else{this._lang=getLangDefinition(key);return this}}};function makeGetterAndSetter(name,key){moment.fn[name]=moment.fn[name+"s"]=function(input){var utc=this._isUTC?"UTC":"";if(input!=null){this._d["set"+utc+key](input);return this}else{return this._d["get"+utc+key]()}}}for(i=0;i<proxyGettersAndSetters.length;i++){makeGetterAndSetter(proxyGettersAndSetters[i].toLowerCase().replace(/s$/,""),proxyGettersAndSetters[i])}makeGetterAndSetter("year","FullYear");moment.fn.days=moment.fn.day;moment.fn.weeks=moment.fn.week;moment.fn.isoWeeks=moment.fn.isoWeek;moment.duration.fn=Duration.prototype={weeks:function(){return absRound(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*86400000+this._months*2592000000},humanize:function(withSuffix){var difference=+this,output=relativeTime(difference,!withSuffix,this.lang());if(withSuffix){output=this.lang().pastFuture(difference,output)}return this.lang().postformat(output)},lang:moment.fn.lang};function makeDurationGetter(name){moment.duration.fn[name]=function(){return this._data[name]}}function makeDurationAsGetter(name,factor){moment.duration.fn["as"+name]=function(){return +this/factor}}for(i in unitMillisecondFactors){if(unitMillisecondFactors.hasOwnProperty(i)){makeDurationAsGetter(i,unitMillisecondFactors[i]);makeDurationGetter(i.toLowerCase())}}makeDurationAsGetter("Weeks",604800000);moment.lang("en",{ordinal:function(number){var b=number%10,output=(~~(number%100/10)===1)?"th":(b===1)?"st":(b===2)?"nd":(b===3)?"rd":"th";return number+output}});if(hasModule){module.exports=moment}if(typeof ender==="undefined"){this["moment"]=moment}if(typeof define==="function"&&define.amd){define("moment",[],function(){return moment})}}).call(this);
/* module-key = 'jira.webresources:jquery-livestamp', location = '/includes/jquery/plugins/livestamp/moment.jira.i18n.js' */
(function(moment){var relativize=AJS.Meta.getBoolean("date-relativize"),meridiem=['上午','下午'],map={d:"D",y:"Y",a:"A",E:"d",u:"d",Z:"ZZ",z:"[GMT]ZZ",XX:"ZZ",XXX:"Z"};JIRA.translateSimpleDateFormat=function(pattern){var inQuote=false,skip=false,tmpBuffer="",actuallyTranslate=function(tmpBuffer){return map[tmpBuffer]||_.reduce(tmpBuffer,function(memo,value){return memo+(map[value]||value)},"")},reduction=_.reduce(pattern,function(memo,value,index,list){if(skip){skip=false}else{if(value==="'"){if(tmpBuffer){memo+=actuallyTranslate(tmpBuffer);tmpBuffer=""}if(list[index+1]==="'"){memo+=value;skip=true}else{memo+=!inQuote?"[":"]";inQuote=!inQuote}}else{if(inQuote){memo+=value}else{if(!/[a-zA-Z]/.test(value)){if(tmpBuffer){memo+=actuallyTranslate(tmpBuffer);tmpBuffer=""}memo+=value}else{if(!tmpBuffer||tmpBuffer[tmpBuffer.length-1]===value){tmpBuffer+=value}else{memo+=actuallyTranslate(tmpBuffer);tmpBuffer=value}}}}}return memo},"");if(tmpBuffer){reduction+=actuallyTranslate(tmpBuffer)}return reduction};moment.lang("jira",{months:['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],monthsShort:['一月','二月','三月','四月','五月','六月','七月','八月','九月','十月','十一月','十二月'],weekdays:['星期日','星期一','星期二','星期三','星期四','星期五','星期六'],weekdaysShort:['星期日','星期一','星期二','星期三','星期四','星期五','星期六'],weekdaysMin:['星期日','星期一','星期二','星期三','星期四','星期五','星期六'],longDateFormat:{LT:JIRA.translateSimpleDateFormat(AJS.Meta.get("date-time")),L:JIRA.translateSimpleDateFormat(AJS.Meta.get("date-day")),LL:JIRA.translateSimpleDateFormat(AJS.Meta.get("date-dmy")),LLL:JIRA.translateSimpleDateFormat(AJS.Meta.get("date-complete"))},meridiem:function(hours){return meridiem[+(hours>11)]},calendar:{sameDay:relativize?AJS.format("{0}Today{1} {2}","[","]","LT"):"LLL",nextDay:relativize?AJS.format("{0}Tomorrow{1} {2}","[","]","LT"):"LLL",nextWeek:relativize?AJS.format("{2}","[","]","L"):"LLL",lastDay:relativize?AJS.format("{0}Yesterday{1} {2}","[","]","LT"):"LLL",lastWeek:relativize?AJS.format("{0}Last{1} {2}","[","]","L"):"LLL",sameElse:"LLL"},relativeTime:{future:AJS.format("in {0}","%s"),past:AJS.format("{0} ago","%s"),s:"a few seconds",m:"a minute",mm:AJS.format("{0} minutes","%d"),h:"an hour",hh:AJS.format("{0} hours","%d"),d:"a day",dd:AJS.format("{0} days","%d"),M:"a month",MM:AJS.format("{0} months","%d"),y:"a year",yy:AJS.format("{0} years","%d")}})}(moment));
/* module-key = 'jira.webresources:jquery-livestamp', location = '/includes/jquery/plugins/livestamp/livestamp.js' */
(function($,moment){var timeout,updateInterval=6000,relativize=AJS.Meta.getBoolean("date-relativize"),livestamps=[],prep=function($el,timestamp){$el.data("livestampdata",timestamp);livestamps.push($el)},run=function(){update();clearTimeout(timeout);timeout=setTimeout(run,updateInterval)},update=function(){var now=moment(),sod=moment().startOf("day");livestamps=$.grep(livestamps,function($el){var timestamp=$el.data("livestampdata"),from,to;if(!moment.isMoment(timestamp)||!$el.closest("html").length){$el.removeData("livestampdata")}else{from=$el.text();if(relativize&&now.diff(timestamp,"hours")<=1){if(timestamp.isBefore(now)||$el.hasClass("allow-future")){to=timestamp.fromNow()}else{to=now.fromNow()}}else{to=timestamp.calendar();if(sod.diff(timestamp,"weeks")){$el.removeData("livestampdata")}}if(from!==to){$el.text(to)}}return !!$el.data("livestampdata")})},add=function($el){$el.each(function(){var $this=$(this),timestamp=$this.attr("datetime");if(timestamp){prep($this,moment(timestamp))}});run();return $el};$.fn.livestamp=function(){return add(this)}}(jQuery,moment));
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/issuecomponents.soy' */
// This file was automatically generated from issuecomponents.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.Issue == 'undefined') { JIRA.Templates.Issue = {}; }


JIRA.Templates.Issue.watchersWithBrowse = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" class="aui recipients-form"><a href="#" class="cancel aui-icon aui-icon-close"></a><fieldset><label for="watchers-multi-select">', soy.$$escapeHtml("\u6dfb\u52a0\u5173\u6ce8\u8005"), '</label><div class="autocomplete-user-target"><select id="watchers" name="watchers" data-description="', soy.$$escapeHtml("\u8f93\u5165\u7528\u6237\u540d"), '" class="watchers-user-picker hidden" multiple="multiple">');
  var watcherList8 = opt_data.watchers;
  var watcherListLen8 = watcherList8.length;
  for (var watcherIndex8 = 0; watcherIndex8 < watcherListLen8; watcherIndex8++) {
    var watcherData8 = watcherList8[watcherIndex8];
    output.append('<option style="background-image:url(\'', soy.$$escapeHtml(watcherData8.avatarUrls['16x16']), '\')" selected="selected" value="', soy.$$escapeHtml(watcherData8.name), '">', soy.$$escapeHtml(watcherData8.displayName), '</option>');
  }
  output.append('</select></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.watchersNoBrowse = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" method="post" class="aui recipients-form"><a href="#" class="cancel aui-icon aui-icon-close"></a><fieldset><label for="watchers-multi-select">', soy.$$escapeHtml("\u6dfb\u52a0\u5173\u6ce8\u8005"), '</label><div><input type="text" class="text" id="watchers-nosearch" /><div class="description">', soy.$$escapeHtml("Type username and press enter."), '</div></div><div class="recipients"><ol class="watchers">');
  var watcherList24 = opt_data.watchers;
  var watcherListLen24 = watcherList24.length;
  for (var watcherIndex24 = 0; watcherIndex24 < watcherListLen24; watcherIndex24++) {
    var watcherData24 = watcherList24[watcherIndex24];
    JIRA.Templates.Fields.recipientUsername({username: watcherData24.name, icon: watcherData24.avatarUrls['16x16'], displayName: watcherData24.displayName, escape: true}, output);
  }
  output.append('</ol></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.watchersReadOnly = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="aui recipients-form"><a href="#" class="cancel aui-icon aui-icon-close"></a><fieldset><div class="recipients"><ol class="watchers">');
  var watcherList34 = opt_data.watchers;
  var watcherListLen34 = watcherList34.length;
  for (var watcherIndex34 = 0; watcherIndex34 < watcherListLen34; watcherIndex34++) {
    var watcherData34 = watcherList34[watcherIndex34];
    JIRA.Templates.Fields.recipientUsername({username: watcherData34.name, icon: watcherData34.avatarUrls['16x16'], displayName: watcherData34.displayName, readOnly: true, escape: true}, output);
  }
  output.append('</ol></div></fieldset></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.error = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p>', soy.$$escapeHtml(opt_data.msg), '</p><ul>');
  var messageList47 = opt_data.errors;
  var messageListLen47 = messageList47.length;
  for (var messageIndex47 = 0; messageIndex47 < messageListLen47; messageIndex47++) {
    var messageData47 = messageList47[messageIndex47];
    output.append('<li>', soy.$$escapeHtml(messageData47), '</li>');
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'jira.webresources:viewissue', location = '/includes/jquery/plugins/shorten/shorten.js' */
AJS.Shortener=AJS.Control.extend({_getDefaultOptions:function(){return{items:"a, span",numRows:1,shortenText:"hide",shortenOnInit:true,persist:true,expandButtonTooltip:"\u70B9\u51FB\u663E\u793A\u4E0B {0} \u6761",collapseButtonTooltip:"\u9690\u85CF"}},init:function(options){if(typeof options==="string"){options={element:options}}options=options||{};this.options=AJS.$.extend(this._getDefaultOptions(),options);this._timerId=0;this.expanded=false;this.$container=AJS.$(this.options.element);this._assignEvents("body",document.body);this._ready()},_isValid:function(){return !this.initialized&&this.$container.is(":visible")&&this.$container.children().length>0},_ready:function(){if(this._isValid()){this.$items=this.$container.children(this.options.items);this.$expandButton=this._render("expandButton");this.$collapseButton=this._render("collapseButton");this._assignEvents("expand-button",".shortener-expand");this._assignEvents("collapse-button",".shortener-collapse");if(!jQuery.browser.msie||jQuery.browser.version>="9"){this._assignEvents("resize-region",window)}if(this._isCollapsedOnInit()){this.collapse()}else{this.expand()}this.initialized=true}},_renders:{"expandButton":function(){return AJS.$("<a href='#' class='ellipsis shortener-expand' title='"+this.options.expandButtonTooltip+"'></a><br>")},"collapseButton":function(){return AJS.$("<a title='Hide' class='icon icon-hide shortener-collapse' href='#'><span>"+this.options.collapseButtonTooltip+"</span></a>")}},_events:{"expand-button":{"click":function(event){if(event.currentTarget===this.$expandButton[0]){event.preventDefault();this.expand();this._saveState("expanded")}}},"collapse-button":{"click":function(event){if(event.currentTarget===this.$collapseButton[0]){event.preventDefault();this.collapse();this._saveState("collapsed");this.$container.scrollIntoView()}}},"resize-region":{"resize":function(){clearTimeout(this._timerId);if(!this.expanded){var instance=this;this._timerId=setTimeout(function(){instance.collapse()},400)}}},"body":{tabSelect:function(){this._ready()}}},_saveState:function(value){try{localStorage.setItem("AJS.Shortener#"+this.$container.closest("[id]").attr("id"),value)}catch(QUOTA_EXCEEDED_ERR){}},_loadState:function(){return localStorage.getItem("AJS.Shortener#"+this.$container.closest("[id]").attr("id"))},_isCollapsedOnInit:function(){var shortenOnInit=this._loadState();if(shortenOnInit!==null){return shortenOnInit!=="expanded"}return this.options.shortenOnInit},_removeButtons:function(){this.$expandButton.remove();this.$collapseButton.remove()},_getOverflowIndex:function(){if(this.$items.length>1){var currentRow=1;var prevItemPageX=-1;for(var i=0;i<this.$items.length;i++){var itemPageX=this.$items.eq(i).offset().left;if(itemPageX<=prevItemPageX){currentRow++;if(currentRow>this.options.numRows){return i}}prevItemPageX=itemPageX}}return -1},expand:function(){this._removeButtons();if(this._getOverflowIndex()>0){this.$collapseButton=this._render("collapseButton");this.$container.append(this.$collapseButton);this.$container.css("height","auto");if(jQuery.browser.msie&&jQuery.browser.version<"9"){AJS.$("body").toggleClass("reflow")}}this.expanded=true},collapse:function(){this._removeButtons();var i=this._getOverflowIndex();if(i>0){this.$container.css({"position":"absolute","visibility":"hidden","width":this.$container[0].clientWidth+"px"});var $expandButtonContent=this.$expandButton.first();do{var remainingItemCount=(this.$items.length-i);$expandButtonContent.text("("+remainingItemCount+")");this.$expandButton.insertBefore(this.$items[i]);i--;var oi=this.$items.eq(i).offset();var ob=this.$expandButton.offset();if(oi.left<ob.left&&ob.top<oi.top+10){break}}while(i>0);var height=(i<this.$items.length-1)?(this.$items.eq(i+1).offset().top-this.$container.offset().top)+"px":"auto";this.$container.css({"height":height,"position":"static","visibility":"visible","width":"auto"});$expandButtonContent.attr("title",AJS.format(this.options.expandButtonTooltip,remainingItemCount));if(jQuery.browser.msie&&jQuery.browser.version<"9"){AJS.$("body").toggleClass("reflow")}}else{this.$container.css("height","auto")}this.expanded=false}});jQuery.fn.shorten=function(options){var res=[];options=options||{};this.each(function(){options.element=this;res.push(new AJS.Shortener(options))});return res};
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/initShorten.js' */
JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,$ctx){AJS.$(".shorten",$ctx).shorten()});
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/initToggleBlock.js' */
AJS.$(function(){new JIRA.ToggleBlock({blockSelector:".toggle-wrap",triggerSelector:".mod-header .toggle-title",storageCollectionName:"block-states",});if(JIRA.Events.ISSUE_REFRESHED){JIRA.bind(JIRA.Events.ISSUE_REFRESHED,function(){if(JIRA.Events.REFRESH_TOGGLE_BLOCKS){JIRA.trigger(JIRA.Events.REFRESH_TOGGLE_BLOCKS)}})}});
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/initSlideshow.js' */
(function($){var defaultOpts={type:"image",centerOnScroll:true,onStart:AJS.disableKeyboardShortcuts,onClosed:AJS.enableKeyboardShortcuts};function initGallery($ctx){var transition=$.browser.msie&&$.browser.version<=8?"fade":"elastic";var galleryOpts=$.extend({},defaultOpts,{transitionIn:transition,transitionOut:transition});$ctx.find(".gallery, [id$='_thumb']").each(function(){$(this).fancybox(galleryOpts)});$ctx.find("#attachment_thumbnails .attachment-title").click(function(e){if(e.which===1){e.preventDefault();$(this).closest(".attachment-content").find(".gallery").click()}})}function initWorkflow($ctx){$ctx.find("a.issueaction-viewworkflow").each(function(){$(this).fancybox(defaultOpts)})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,$ctx,reason){initGallery($ctx);initWorkflow($ctx)});$(function(){if(JIRA.Events.PANEL_REFRESHED){JIRA.bind(JIRA.Events.PANEL_REFRESHED,function(e,panel,$new,$existing){if(panel==="attachmentmodule"){initGallery($new)}else{if(panel==="details-module"){initWorkflow($new)}}})}})})(AJS.$);
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/initComment.js' */
(function($){var commentForm=JIRA.Issue.CommentForm={setCaretAtEndOfCommentField:function(){var $field=this.getField(),field=$field[0],length;if($field.length){length=$field.val().length;$field.scrollTop($field.attr("scrollHeight"));if(field.setSelectionRange&&length>0){field.setSelectionRange(length,length)}}},disable:function(){this.getForm().find("textarea").attr("readonly","readonly");this.getForm().find(":submit").attr("disabled","disabled")},isDirty:function(){var field=this.getField();if(field.length){return field[0].value!==field[0].defaultValue}return false},handleBrowseAway:function(){var isDirty=commentForm.isDirty(),isVisible=commentForm.getForm()&&commentForm.getForm().is(":visible");if(isDirty&&isVisible){return "\u4F60\u5DF2\u7ECF\u4E3A\u95EE\u9898\u4E66\u5199\u4E86\u5907\u6CE8\u3002 \u5982\u679C\u4F60\u5728\u79BB\u5F00\u8FD9\u4E2A\u9875\u9762\u4E4B\u524D\u6CA1\u6709\u4FDD\u5B58, \u4E66\u5199\u7684\u5907\u6CE8\u5C06\u4E0D\u4F1A\u88AB\u63D0\u4EA4\u3002"}},setSubmitState:function(){if(jQuery.trim(this.getField().val()).length>0){this.getForm().find(":submit").removeAttr("disabled")}else{this.getForm().find(":submit").attr("disabled","disabled")}},enable:function(){this.getForm().find("textarea").removeAttr("readonly");this.getForm().find(":submit").removeAttr("disabled")},getCommentVisibility:function(){var visibility=$("#commentLevel :selected").val();if(visibility){var split_v=visibility.split(":");return{"type":split_v[0],"value":$("#commentLevel :selected").text()}}return null},ajaxSubmit:function(callback){var $loading=jQuery('<span class="icon throbber loading"></span>');var issueId=JIRA.Issue.getIssueId();var issueKey=JIRA.Issue.getIssueKey();var restURL=contextPath+"/rest/api/2/issue/"+issueKey+"/comment";var newComment={"body":this.getField()[0].value};var visibility=this.getCommentVisibility();if(visibility){newComment["visibility"]=visibility}$.ajax({url:restURL,type:"POST",contentType:"application/json",data:JSON.stringify(newComment),success:function(data){JIRA.trigger(JIRA.Events.UNLOCK_PANEL_REFRESHING,["addcommentmodule"]);JIRA.trigger(JIRA.Events.REFRESH_ISSUE_PAGE,[issueId,{complete:function(){var newCommentId="comment-"+data.id;jQuery("#"+newCommentId).scrollIntoView({marginBottom:200,marginTop:200});var $focusedTabs=$("#issue_actions_container > .issue-data-block.focused");$focusedTabs.removeClass("focused");var $newfocusedTab=$("#"+newCommentId);$newfocusedTab.addClass("focused");$loading.remove();footerComment.hide(true)}}])},error:function(xhr){function buildErrorDialog(errorMessage){var errorContent="<h2>"+"\u9519\u8BEF"+"</h2>"+'<div class="ajaxerror">'+'<div class="aui-message error">'+'<span class="aui-icon icon-warning"/>'+errorMessage+"</div>"+"</div>";return $(errorContent)}var response=$.parseJSON(xhr.responseText);var content;if(response&&response.errors&&response.errors.comment){content=buildErrorDialog(response.errors.comment)}else{content=JIRA.SmartAjax.buildDialogErrorContent(xhr)}new JIRA.FormDialog({content:content}).show();$loading.remove();commentForm.enable()}});$loading.appendTo(this.getForm().find(":submit").parent())},getForm:function(){var $form=$("form#issue-comment-add");if($form.length===1){this.$form=$form}return this.$form||$()},getField:function(){return this.getForm().find("#comment")},getSubmitButton:function(){return this.getForm().find("#issue-comment-add-submit")},hide:function(cancel){this.getForm().detach();if(JIRA.Events.UNLOCK_PANEL_REFRESHING){JIRA.trigger(JIRA.Events.UNLOCK_PANEL_REFRESHING,["addcommentmodule"])}if(cancel){this.cancel()}},show:function(){this.focus();if(JIRA.Events.LOCK_PANEL_REFRESHING){JIRA.trigger(JIRA.Events.LOCK_PANEL_REFRESHING,["addcommentmodule"])}},focus:function(){this.focusField();this.setCaretAtEndOfCommentField()},focusField:function(){this.getField().focus().trigger("keyup");this.getSubmitButton().scrollIntoView({marginBottom:200})},showNoCommentMsg:function(e){if(this.getField().val()===""){$("#emptyCommentErrMsg").show();return true}},cancel:function(){var instance=this;setTimeout(function(){instance.getField().val("")},100);$("#comment-preview_link.selected").click()}};var footerComment={getModule:function(){return $("#addcomment")},isActive:function(){return this.getModule().hasClass("active")},hide:function(cancel){if(this.isActive()){this.getModule().removeClass("active");commentForm.hide(cancel)}},ajaxSubmit:function(){commentForm.ajaxSubmit(function(){footerComment.hide()})},show:function(){if(!this.isActive()){this.getModule().addClass("active");this.appendForm();commentForm.show()}else{commentForm.focusField()}},appendForm:function(){this.getModule().find(".mod-content").append(commentForm.getForm())}};var oldBeforeUnload=window.onbeforeunload;$(document).delegate("body:not(.ka) #issue-comment-add","submit",function(e){window.onbeforeunload=oldBeforeUnload}).delegate(".ka #addcomment #issue-comment-add","submit",function(e){footerComment.ajaxSubmit();e.preventDefault()}).delegate(".issue-header #comment-issue","click",function(e){footerComment.show();e.preventDefault()}).delegate("#footer-comment-button","click",function(e){footerComment.show();e.preventDefault()}).delegate("#addcomment .cancel","click",function(e){e.preventDefault();footerComment.hide(true)}).delegate("#issue-comment-add","submit",function(){window.setTimeout(function(){commentForm.disable()},0)}).delegate("#issue-comment-add #comment","input",function(){commentForm.setSubmitState()}).delegate("#issue-comment-add input[type='submit']","click",function(e){if(commentForm.showNoCommentMsg()){e.preventDefault()}}).bind("showWikiInput",function(){var $commentField=commentForm.getField();if($commentField.is(":visible:enabled")){JIRA.Issue.getStalker().trigger("stalkerHeightUpdated");if($commentField.length>0){$commentField.focus()}}}).bind("showWikiInput",function(){commentForm.setCaretAtEndOfCommentField()}).bind("showWikiPreview",function(){JIRA.Issue.getStalker().trigger("stalkerHeightUpdated")});window.onbeforeunload=function(){return oldBeforeUnload.apply(this,arguments)||commentForm.handleBrowseAway.apply(this,arguments)};$(function(){new AJS.SecurityLevelSelect($("#commentLevel"))});JIRA.Issue.getDirtyCommentWarning=commentForm.handleBrowseAway;JIRA.Issue.invokeCommentTrigger=function(){var addIssueComment=AJS.$(".add-issue-comment");if(addIssueComment.length===0){return }var toolbarTrigger=addIssueComment.filter(".toolbar-trigger");if(toolbarTrigger.length>0){toolbarTrigger.click()}else{addIssueComment.click()}}})(AJS.$);AJS.$(function(){if(parseUri(window.location.href).anchor==="add-comment"){AJS.$("#footer-comment-button").click()}});
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/initCustomFieldTabs.js' */
(function($,scope){var activateTab=function(tabName){var tabTrigger;if(typeof tabName!=="string"&&tabName.length>0){return }if(tabName[0]!=="#"){tabName="#"+tabName}console.log("activating tab",tabName);tabTrigger=$("a[href='"+tabName+"']",scope);if(tabTrigger.length){AJS.tabs.change(tabTrigger)}};var revealer=function(e){var $containingTab=$(e.target).closest(".tabs-pane");if($containingTab.length>0){activateTab($containingTab.attr("id"))}};$(function(){if(JIRA.Events.NEW_CONTENT_ADDED){JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,$context){var $customFieldModule=$context.find(scope);$customFieldModule.unbind("reveal");$customFieldModule.bind("reveal",revealer);AJS.tabs.setup()})}if(JIRA.Events.PANEL_REFRESHED){JIRA.bind(JIRA.Events.PANEL_REFRESHED,function(e,panel,$new,$existing){if(panel==="details-module"){var $activeTab=$existing.find(scope).find(".active-tab");if($activeTab.length===1){activateTab($activeTab.find("a").attr("href"))}}})}$(scope).bind("reveal",revealer)})})(AJS.$,"#customfieldmodule");
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/initSetSelectedIssue.js' */
jQuery(function(){if(AJS.Meta.get("search-pos")){AJS.$.get(contextPath+"/secure/SetSelectedIssue.jspa",{atl_token:atl_token(),selectedIssueId:jQuery("#key-val").attr("rel"),nextIssueId:jQuery("#next-issue").attr("rel"),selectedIssueIndex:AJS.Meta.getNumber("search-pos")})}});
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/initSubtaskTimeLogging.js' */
(function($){$(document).delegate("#tt_include_subtasks input","click",function(e){if(AJS.$(this).is(":checked")){AJS.$("#tt_info_single").hide();AJS.$("#tt_info_aggregate").show()}else{AJS.$("#tt_info_aggregate").hide();AJS.$("#tt_info_single").show()}})})(AJS.$);
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/initWatchers.js' */
AJS.$(function(){var WatcherModel=Backbone.Model.extend({url:function(){return[AJS.contextPath(),"rest/api/2/issue",AJS.Meta.get("issue-key"),"watchers"].join("/")},initialize:function(){this.set("canBrowseUsers",AJS.Meta.get("can-search-users"));this.set("isReadOnly",!AJS.Meta.get("can-edit-watchers"))},_parseResponse:function(responseText){try{return JSON.parse(responseText)}catch(e){this._showFatalErrorMessage();return null}},_showFatalErrorMessage:function(){var msg="<p>"+"\u901A\u8BAF\u4E2D\u65AD"+"</p>"+"<p>"+"\u5173\u95ED\u8FD9\u4E2A\u5BF9\u8BDD\u6846\u5E76\u91CD\u65B0\u5237\u65B0\u6D4F\u89C8\u5668"+"</p>";JIRA.Messages.showErrorMsg(msg,{closeable:true})},getUser:function(username){return AJS.$.ajax({url:AJS.contextPath()+"/rest/api/2/user?username="+encodeURIComponent(username),error:_.bind(function(xhr){if(xhr.status!==404){this.handleErrorResponse(xhr,"There was an error adding watcher")}},this)})},handleErrorResponse:function(xhr,msg){var errorCollection=this._parseResponse(xhr.responseText);if(errorCollection.errorMessages){var html=JIRA.Templates.Issue.error({msg:msg,errors:errorCollection.errorMessages});JIRA.Messages.showErrorMsg(html,{closeable:true})}this.trigger("errorOccurred")},addWatcher:function(username){return AJS.$.ajax({type:"post",url:this.url(),global:false,data:JSON.stringify(username),contentType:"application/json",error:_.bind(function(xhr){this.handleErrorResponse(xhr,"There was an error adding watcher")},this)})},removeWatcher:function(username){return AJS.$.ajax({type:"delete",global:false,url:this.url()+"?username="+encodeURIComponent(username),error:_.bind(function(xhr){this.handleErrorResponse(xhr,"There was an error removing watcher")},this)})}});var AbstractWatchersView=Backbone.View.extend({initialize:function(){_.bindAll(this)},renderNoWatchers:function(){if(this.$(".recipients li").length===0){var $empty=AJS.$("<div class='aui-message info watchers-empty' />").html("<span class='aui-icon icon-info' /> "+"There are no watchers.");this.$("fieldset").append($empty)}else{this.$(".watchers-empty").remove()}},render:function(){var deferred=jQuery.Deferred();this.model.fetch().done(_.bind(function(){this._render();this.renderNoWatchers();deferred.resolve(this.$el);window.setTimeout(_.bind(function(){this.focus()},this),0)},this));return deferred.promise()},watch:function(){AJS.$("#watching-toggle").text("\u505C\u6B62\u5173\u6CE8\u8FD9\u4E2A\u95EE\u9898")},unwatch:function(){AJS.$("#watching-toggle").text("\u5173\u6CE8\u8FD9\u4E2A\u95EE\u9898")},focus:AJS.$.noop,_incrementWatcherCount:function(){var $el=AJS.$("#watcher-data");var currentCount=parseInt($el.text(),10);$el.text(currentCount+1);this.renderNoWatchers()},_decrementWatcherCount:function(){var $el=AJS.$("#watcher-data");var currentCount=parseInt($el.text(),10);$el.text(currentCount-1);this.renderNoWatchers()}});var WatchersView=AbstractWatchersView.extend({events:{selected:"addWatcherToModel",unselect:"removeWatcherFromModel"},_render:function(){this.$el.html(JIRA.Templates.Issue.watchersWithBrowse(this.model.toJSON()));var picker=new JIRA.MultiUserListPicker({element:this.$el.find(".watchers-user-picker"),width:220})},focus:function(){this.$el.find("#watchers-textarea").focus()},addWatcherToModel:function(e,descriptor){e.preventDefault();this.model.addWatcher(descriptor.value()).done(_.bind(function(){this._incrementWatcherCount();if(descriptor.value()===AJS.Meta.get("remote-user")){this.watch()}},this))},removeWatcherFromModel:function(e,descriptor){this.model.removeWatcher(descriptor.value()).done(_.bind(function(){this._decrementWatcherCount();if(descriptor.value()===AJS.Meta.get("remote-user")){this.unwatch();JIRA.trace("jira.issue.watcher.deleted")}},this))}});var WatchersNoBrowseView=AbstractWatchersView.extend({events:{"click .remove-recipient":"removeWatcher","submit":"addWatcher"},addWatcher:function(e){e.preventDefault();this.removeInlineError();var $field=AJS.$("#watchers-nosearch");var username=AJS.$.trim(AJS.$("#watchers-nosearch").val());$field.attr("disabled","disabled");if(this.hasUsername(username)){$field.removeAttr("disabled");this.showInlineError(AJS.format("User {0} is already watching this issue",username));$field.val("")}else{this.model.getUser(username).done(_.bind(function(data){var html=JIRA.Templates.Fields.recipientUsername({icon:data.avatarUrls["16x16"],username:data.name,displayName:data.displayName});if(username===AJS.Meta.get("remote-user")){this.watch()}$field.val("");this.$(".watchers").append(html);this.model.addWatcher(data.name);this._incrementWatcherCount()},this)).fail(_.bind(function(xhr){if(xhr.status===404){this.showInlineError("\u7528\u6237\u4E0D\u5B58\u5728")}},this)).always(function(){$field.removeAttr("disabled").focus()})}},hasUsername:function(username){var result=false;this.$(".watchers li").each(function(){if(AJS.$(this).attr("data-username")===username){result=true;return false}});return result},removeInlineError:function(){this.$(".error").remove()},showInlineError:function(msg){AJS.$("<div />").addClass("error").text(msg).insertAfter(this.$(".description"))},focus:function(){AJS.$("#watchers-nosearch").focus()},removeWatcher:function(e){e.preventDefault();var $item=AJS.$(e.target).closest("li");var username=$item.attr("data-username");if(username){$item.remove();this.model.removeWatcher(username);this._decrementWatcherCount();if(username===AJS.Meta.get("remote-user")){this.unwatch()}}JIRA.trace("jira.issue.watcher.deleted")},_render:function(){this.$el.html(JIRA.Templates.Issue.watchersNoBrowse(this.model.toJSON()))}});var WatchersReadOnly=AbstractWatchersView.extend({_render:function(){this.$el.html(JIRA.Templates.Issue.watchersReadOnly(this.model.toJSON()))}});function getView(model){if(model.get("isReadOnly")){return WatchersReadOnly}else{if(model.get("canBrowseUsers")){return WatchersView}else{return WatchersNoBrowseView}}}var dialog=AJS.InlineDialog("#view-watcher-list","watchers",function(contents,trigger,doShowPopup){var loadingIcon=AJS.$("#watching-toggle").next(".icon");var model=new WatcherModel();loadingIcon.addClass("loading");var view=getView(model);new view({model:model}).render().done(function(viewHtml){contents.html(viewHtml);contents.find(".cancel").click(function(e){dialog.hide();e.preventDefault()});loadingIcon.removeClass("loading");doShowPopup()});model.on("errorOccurred",function(){dialog.hide()})},{width:240,useLiveEvents:true,items:"#view-watcher-list",preHideCallback:function(){return !AJS.InlineLayer.current}});AJS.$(document).bind("keydown",function(e){if(e.keyCode===27&&AJS.InlineDialog.current!=dialog&&dialog.is(":visible")){if(AJS.InlineDialog.current){AJS.InlineDialog.current.hide()}dialog.hide()}});AJS.$(document).click(function(e){var currentDialog=AJS.InlineDialog.current;if(currentDialog&&currentDialog.id==="watchers"){if(!jQuery(e.target).closest("#inline-dialog-watchers, #watchers-suggestions").length){currentDialog.hide()}}});AJS.$(document).bind("showLayer",function(e,type,hash){if(type&&type==="inlineDialog"&&hash&&hash.id&&hash.id==="watchers"){AJS.$("body").unbind("click.watchers.inline-dialog-check")}})});
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/ViewIssueTabs.js' */
JIRA.ViewIssueTabs=(function(){var useHistoryApi=AJS.Meta.get("viewissue-use-history-api")!==false;var AJAX_LOAD_CLASS="ajax-activity-content";var AJAX_LINK_SELECTOR=AJS.format("a.{0}",AJAX_LOAD_CLASS);var issueTabLoadedListeners=[];var $tabWrapper,$tabContents;var xhrInProgress;function dispatchIssueTabLoadedEvent(container){container=container||document;AJS.$.each(issueTabLoadedListeners,function(i,fn){fn(container)})}function bindToTabDivs(container){var $newTabWrapper=AJS.$(container).find(".issuePanelWrapper");var $newTabContents=AJS.$(container).find("#issue_actions_container");$tabContents=$newTabContents.length?$newTabContents:$tabContents;$tabWrapper=$newTabWrapper.length?$newTabWrapper:$tabWrapper}function dispatchIssueTabErrorEvent(smartAjaxResult,activeTabKey){var errorPopup=new JIRA.FormDialog({id:"issue-tab-error-dialog",widthClass:"small",content:JIRA.SmartAjax.buildDialogErrorContent(smartAjaxResult,false)});setActiveTab(activeTabKey);$tabContents.show();errorPopup.show()}function setActiveTab(activeTabKey){AJS.$("#issue-tabs li").each(function(){var $li=AJS.$(this);var tabKey=$li.data("key");var labelHtml=AJS.format("<strong>{0}</strong>",$li.data("label"));if(tabKey==activeTabKey){$li.addClass("active");$li.html(labelHtml)}else{$li.removeClass("active");var id=$li.data("id");var href=$li.data("href");$li.html(AJS.format('<a id="{0}" href="{1}" class="{2}">{3}</a>',id,href,AJAX_LOAD_CLASS,labelHtml))}});enableAjaxOnLinks(AJS.$("#issue-tabs"))}function putTabInLoadingState(activeTabKey){setActiveTab(activeTabKey)}function enableAjaxOnLinks(context){var activeTabKey=AJS.$(context).find("li.active").data("key");AJS.$(context).find(AJAX_LINK_SELECTOR).click(function(event){if(event.metaKey){return }event.preventDefault();if(xhrInProgress){xhrInProgress.abort()}var $a=AJS.$(this);var containerID="#activitymodule div.mod-content";var loadingTabKey=$a.parent().data("key");if(loadingTabKey){putTabInLoadingState(loadingTabKey)}var xhr=JIRA.SmartAjax.makeRequest({jqueryAjaxFn:useHistoryApi?AJS.$.pjax:AJS.$.ajax,headers:{"X-PJAX":true},container:containerID,url:$a.attr("href"),timeout:null,complete:function(xhr,status,smartAjaxResult){if(status!="abort"){xhrInProgress=null;if(!smartAjaxResult.successful){if(smartAjaxResult.status<300||smartAjaxResult.status>=400){dispatchIssueTabErrorEvent(smartAjaxResult,activeTabKey)}return }var container=AJS.$(containerID);var newElements=AJS.$(smartAjaxResult.data);if(!useHistoryApi){smartUpdate(container,newElements)}dispatchIssueTabLoadedEvent(container);JIRA.trace("jira.issue.tab.loaded")}}});jQuery(xhr).throbber({target:$tabWrapper});xhrInProgress=xhr})}function smartUpdate(container,newElements){var newTabs=newElements.filter(".tabwrap");var oldTabs=container.find(".tabwrap");var newContents=newElements.find(".issuePanelContainer");var oldContents=$tabContents.contents();if(newTabs.length&&oldTabs.length&&newContents.length&&oldContents.length){oldTabs.replaceWith(newTabs);$tabContents.append(newContents);var newContentHeight=newContents.height();var visibleHeightDifference=AJS.$(window).scrollTop()+AJS.$(window).height()-($tabContents.offset().top+newContentHeight);if(visibleHeightDifference>0){$tabContents.css("height",newContentHeight+visibleHeightDifference);oldContents.remove();setTimeout(function(){var animationSpeed=500;$tabContents.animate({height:newContentHeight},visibleHeightDifference/animationSpeed*1000,"easeOutQuart",function(){$tabContents.css("height","auto")})},150)}else{$tabContents.empty().append(newContents)}newElements.filter("script").each(function(){AJS.$.globalEval(this.text||this.textContent||this.innerHTML||"")})}else{container.empty().append(newElements)}}function appendHashCodeToLinks(context){AJS.$(context).find(AJAX_LINK_SELECTOR).each(function(){var $a=AJS.$(this);$a.attr("href",$a.attr("href")+"#issue-tabs")})}function processActivityModuleLinks(context){if(!useHistoryApi||AJS.$.support.pjax){enableAjaxOnLinks(context)}else{appendHashCodeToLinks(context)}}function setupMouseoverBehaviour(context){if(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)===7){jQuery("a.twixi",context).bind("focus",function(e){e.preventDefault()})}else{jQuery(context).bind("moveToFinished",function(event,target){jQuery("a.twixi:visible",target).focus()})}}function initLivestamp(context){context.find("time.livestamp").livestamp()}function onTabReady(listener){if(jQuery.inArray(listener,issueTabLoadedListeners)<0){issueTabLoadedListeners.push(listener)}}onTabReady(bindToTabDivs);onTabReady(processActivityModuleLinks);onTabReady(setupMouseoverBehaviour);onTabReady(JIRA.userhover);onTabReady(initLivestamp);return{onTabReady:onTabReady,domReady:dispatchIssueTabLoadedEvent}})();AJS.$(function(){if(JIRA.Events.PANEL_REFRESHED){JIRA.bind(JIRA.Events.PANEL_REFRESHED,function(e,panel,$new,$existing){if(panel==="activitymodule"){var $focusedTab=$existing.find("#issue_actions_container > .issue-data-block.focused");if($focusedTab.length===1){$new.find("#"+$focusedTab.attr("id")).addClass("focused")}}})}});JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(event,$el){JIRA.ViewIssueTabs.domReady($el)});
/* module-key = 'jira.webresources:viewissue', location = '/includes/jira/viewissue/WatchersAndVoters.js' */
AJS.$(function(){var toggleVotingAndWatching=function(trigger,className,resultContainer,issueOpTrigger,i18n){var classNameOn=className+"-on",classNameOff=className+"-off",restPath="/voters",spinner=trigger.next(".icon"),data,method="POST";if(trigger.hasClass(classNameOn)){method="DELETE"}if(className.indexOf("watch")!==-1){restPath="/watchers"}trigger.removeClass(classNameOn).removeClass(classNameOff);if(method==="POST"){data={dummy:true}}AJS.$(JIRA.SmartAjax.makeRequest({url:contextPath+"/rest/api/1.0/issues/"+trigger.attr("rel")+restPath,type:method,dataType:"json",data:data,contentType:"application/json",complete:function(xhr,textStatus,smartAjaxResult){var optIn=method==="POST";if(smartAjaxResult.successful){if(optIn){trigger.addClass(classNameOn);trigger.text(i18n.titleOn);issueOpTrigger.attr("title",i18n.titleOn).text(i18n.textOn)}else{trigger.addClass(classNameOff);trigger.text(i18n.titleOff);issueOpTrigger.attr("title",i18n.titleOff).text(i18n.textOff)}resultContainer.text(smartAjaxResult.data.count);resultContainer[optIn?"addClass":"removeClass"](classNameOn);resultContainer[optIn?"removeClass":"addClass"](classNameOff)}else{if(!smartAjaxResult.aborted){alert(JIRA.SmartAjax.buildSimpleErrorContent(smartAjaxResult,{alert:true}))}if(optIn){trigger.addClass(classNameOff);trigger.text(i18n.titleOff);issueOpTrigger.attr("title",i18n.titleOff).text(i18n.textOff)}else{trigger.addClass(classNameOn);trigger.text(i18n.titleOn);issueOpTrigger.attr("title",i18n.titleOn).text(i18n.textOn)}}}})).throbber({target:spinner})};AJS.$(document).delegate(".toggle-vote-issue","click",function(e){e.preventDefault();AJS.$("#vote-toggle").click()});AJS.$(document).delegate("#toggle-watch-issue","click",function(e){e.preventDefault();AJS.$("#watching-toggle").click()});var addI18nErrorCodes=function(i18n){AJS.$("input[type=hidden][id|=error]").each(function(index,elem){var i18n_id=elem.id.replace("error-","");i18n[i18n_id]=elem.value})};AJS.$(document).delegate("#vote-toggle","click",function(e){e.preventDefault();var i18n={titleOn:"\u53D6\u6D88\u5BF9\u8FD9\u4E2A\u95EE\u9898\u7684\u6295\u7968",titleOff:"\u4E3A\u8FD9\u4E2A\u95EE\u9898\u6295\u7968",textOn:"\u53D6\u6D88\u6295\u7968",textOff:"\u6295\u7968",actionTextOff:"\u6295\u7968",actionTextOn:"\u5DF2\u6295\u7968"};addI18nErrorCodes(i18n);toggleVotingAndWatching(AJS.$(this),"vote-state",AJS.$("#vote-data"),AJS.$("#toggle-vote-issue"),i18n)});AJS.$(document).delegate("#watching-toggle","click",function(e){e.preventDefault();var i18n={titleOn:"\u505C\u6B62\u5173\u6CE8\u8FD9\u4E2A\u95EE\u9898",titleOff:"\u5173\u6CE8\u8FD9\u4E2A\u95EE\u9898",textOn:"\u53D6\u6D88\u5173\u6CE8",textOff:"\u5173\u6CE8",actionTextOff:"\u5173\u6CE8",actionTextOn:"\u6B63\u5728\u5173\u6CE8"};addI18nErrorCodes(i18n);toggleVotingAndWatching(AJS.$(this),"watch-state",AJS.$("#watcher-data"),AJS.$("#toggle-watch-issue"),i18n)})});
/* module-key = 'com.atlassian.jira.plugins.jira-bitbucket-connector-plugin:requiredResourceForAjaxCommitsTab', location = 'javascripts/dvcs-issue-tabs.js' */
function showChangesetByFork(D,B,C,A){AJS.$("#"+D+" .CommitPanel").each(function(F,E){$(E).hide()
});
AJS.$("#"+D+"-"+B).show();
registerForksTooltip(D,C,A)
}function registerForksTooltip(C,B,A){registerInlineDialogTooltip(AJS.$("#fork-drop-down-"+C),"This changeset is present in multiple repositories (forks). Currently showing <a href='"+A+"' target='_blank'>"+B+"</a>.")
}function registerInlineDialogTooltip(B,A){return AJS.InlineDialog(AJS.$(B),"tooltip_"+AJS.$(B).attr("id"),function(D,C,E){D.css({padding:"10px"}).html(A);
E();
return false
},{onHover:true,hideDelay:200,showDelay:1000,arrowOffsetX:-8,offsetX:-80,addActiveClass:false})
};
/* module-key = 'com.atlassian.jira.jira-view-issue-plugin:draggableattachment', location = 'viewissue/initDraggableAttachment.js' */
(function($) {
    $.event.props.push("dataTransfer");

    $('[draggable=true]').live("dragstart", function(evt) {
        var $this = AJS.$(this);
        var dataTransfer = evt.dataTransfer;
        dataTransfer.effectAllowed = 'copy';
        dataTransfer.dropEffect = 'copy';
        dataTransfer.setData("DownloadURL", $this.data('downloadurl'));
        if (!$this.find('img').length) {
            dataTransfer.setDragImage($this.closest('li').find('img:visible')[0], 8, 8);
        }
    });
})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-view-issue-plugin:expandablecomments', location = 'viewissue/comments-expanding.js' */
AJS.$(function($) {
    $(document).on('simpleClick', '.collapsed-comments', function(e) {
        e.preventDefault();

        var collapsedLink = $(this);
        var collapsedLinkBlock = collapsedLink.closest('.message-container');
        var container = collapsedLink.closest('.issuePanelContainer');
        var module = collapsedLink.closest('.module');
        var numCommentsBefore = collapsedLinkBlock.prevAll('.activity-comment').length;
        var numCollapsed = collapsedLink.find('.show-more-comments').data('collapsed-count');

        showLoading();
        makeRequest();

        function showLoading() {
            collapsedLink.find('.show-more-comments').text("\u6B63\u5728\u52A0\u8F7D...");
        }

        function makeRequest() {
            var url = collapsedLink.attr('href');
            JIRA.SmartAjax.makeRequest({
                url: url,
                method: 'GET',
                headers: { "X-PJAX": true } // needed for the ViewIssue action to return only the activity panel
            }).done(showCollapsed);
        }

        function showCollapsed(html) {
            var commentsToShow = $(html).find('.activity-comment').slice(numCommentsBefore, numCommentsBefore + numCollapsed);
            collapsedLinkBlock.replaceWith(commentsToShow);
            JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED, [module, JIRA.CONTENT_ADDED_REASON.panelRefreshed]);

            // Expand the twixi for the first comment
            container.find('.activity-comment:first').removeClass('collapsed').addClass('expanded');
        }
    });
});

/* module-key = 'com.atlassian.jirafisheyeplugin:css', location = 'script/fisheye.js' */
AJS.$(function(){AJS.JFEP=AJS.JFEP||{};var a=function(b){AJS.$(".review-filter",b).live("change",function(d){var f=AJS.$(d.target).val(),c=AJS.$(d.target).is(":checked")?"block":"none";AJS.$(".review-status-"+f).css("display",c)});AJS.$(".tab-content",b).find(".project-activity:gt(0)").addClass("hidden");AJS.$("#activity-filter",b).live("change",function(c){var d=AJS.$("#activity-filter").val();AJS.$(".project-activity").addClass("hidden");AJS.$(".limit-"+d).removeClass("hidden")})};AJS.$("#preview-hide-tab",AJS.$(document)).live("click",function(b){AJS.$("#preview_form").submit();b.preventDefault()});if(JIRA.ViewIssueTabs){JIRA.ViewIssueTabs.onTabReady(a)}else{a(document)}AJS.JFEP.reviewIssueToggle=function(){AJS.$(".review-issue-target").addClass("hidden");AJS.$(".review-issue-trigger").click(function(c){c.preventDefault();var b=AJS.$(this).attr("href");AJS.$(b).toggleClass("hidden")})};AJS.JFEP.ignoreCookieName=function(){var b=AJS.$("#header-details-user-fullname").attr("data-username");if(!b){b="__ANON"}return"JFEP.ignoredAppLinks."+b};AJS.JFEP.ignoreAppLink=function(f){var e;var c=document.cookie;if(c.indexOf(AJS.JFEP.ignoreCookieName()+"=")>-1){var d=new RegExp(AJS.JFEP.ignoreCookieName()+"=([^;]*)");e=d.exec(c)[1]}else{e=""}if(e.indexOf(f)==-1){e+=(e.length>0?"|":"")+f;var b=new Date();b.setDate(b.getDate()+365);document.cookie=AJS.JFEP.ignoreCookieName()+"="+e+"; expires="+b.toUTCString()+"; path="+contextPath}};AJS.JFEP.clearIgnoredAppLinks=function(){var b=new Date();b.setDate(b.getDate()-5);document.cookie=AJS.JFEP.ignoreCookieName()+"=expired;expires="+b.toUTCString()+"; path="+contextPath};AJS.$(".ignore-applink").live("click",function(){var b=AJS.$(this).attr("data-id");AJS.JFEP.ignoreAppLink(b);AJS.$(this).parents(".credentials-required-message").slideUp()});AJS.$(".clear-ignored-applinks").live("click",function(){AJS.JFEP.clearIgnoredAppLinks();document.location.reload(true)});AJS.JFEP.loadMoreChangesets=function(c,b,d,e){jQuery("#more-changesets-action-spinner").show();jQuery("#more-changesets-blurb").hide();JIRA.SmartAjax.makeRequest({url:c+"/rest/tabs/1.0/more-changesets/"+b+d,type:"GET",dataType:"json",contentType:"application/json",complete:function(i,f,h){if(!h.successful){var g=(h.status!==401||h.statusText===JIRA.SmartAjax.SmartAjaxResult.TIMEOUT)?JSON.parse(h.data).errorMessages:JIRA.SmartAjax.buildSimpleErrorContent(h);jQuery(document).trigger(JIRA.SERVER_ERROR_EVENT,g)}else{e(h.data.changesets)}}})}});
/* module-key = 'com.atlassian.jira.plugin.ext.bamboo:css', location = 'templates/plugins/bamboo/script/common.js' */
(function(b,a){if(typeof a.CONFIG==="undefined"){a.CONFIG={$planSelect:b(),$buildTypes:b(),buildResultsContainerId:"bamboo-build-results",stagesContainerId:"bamboo-plan-stages",variablesContainerId:"bamboo-override-variables",initialised:false,updateTimeout:null,init:function(){if(a.CONFIG.initialised){return}b(document).bind("dialogContentReady",function(f){var d=a.CONFIG.buildResultsContainerId,c=a.CONFIG.stagesContainerId,g=a.CONFIG.variablesContainerId;a.CONFIG.$planSelect=b("#bamboo-plan").change(a.CONFIG.onPlanChange);a.CONFIG.BuildResults.init({container:{id:d,insertAfter:a.CONFIG.$planSelect.closest(".field-group")}});a.CONFIG.Stages.init({container:{id:c,insertAfter:"#"+d}});a.CONFIG.Variables.init({container:{id:g,insertAfter:"#"+c}});a.CONFIG.$buildTypes=b("input:radio[name='buildType']").change(a.CONFIG.onBuildTypeChange).filter(":checked").change().end()});a.CONFIG.initialised=true}};a.CONFIG.Spinner=function(c,d){this.beforeShow=d;this.add=function(){return b(bamboo.components.icon({type:"loading"})).appendTo(c)}};a.CONFIG.Spinner.prototype.show=function(){var c=this.$spinner;this.beforeShow();if(!c||(c&&(!c.length||!c.parent().length))){this.$spinner=this.add()}else{c.show()}return this};a.CONFIG.Spinner.prototype.hide=function(){this.$spinner.hide();return this}}a.CONFIG.onPlanChange=function(j){var f=b("#existing-build").is(":checked"),i=b(this),d=i.add(a.CONFIG.$buildTypes).attr("disabled",true),m=i.find("option:selected"),h=(f?m.attr("data-selected-build-result"):null),n=(f?null:m.attr("data-selected-stages")),k=(f?null:m.attr("data-selected-variables")),l,g,c;if(k){k=b.parseJSON(k)}a.CONFIG.BuildResults.updateSelectedBuildResult(h);a.CONFIG.Stages.updateSelectedStages(n);a.CONFIG.Variables.updateSelectedVariables(k);a.CONFIG.Variables.hide();if(f){a.CONFIG.Stages.hide();a.CONFIG.BuildResults.showSpinner();l=a.restURL+"history/"+a.jiraProjectKey+"/"+i.val()+"/5";g={continuable:true,buildstate:"successful"};c=function(e){if(e.results.result&&e.results.result.length){a.CONFIG.BuildResults.show(e.results.result)}else{a.CONFIG.BuildResults.showNoResultsMsg()}d.attr("disabled",false)}}else{a.CONFIG.BuildResults.hide();a.CONFIG.Stages.showSpinner();l=a.restURL+"plan/"+a.jiraProjectKey+"/"+i.val();c=function(e){if(e.stages.stage&&e.stages.stage.length){a.CONFIG.Stages.show(e.stages.stage)}else{a.CONFIG.Stages.showNoStagesMsg()}if(e.variableContext.variable&&e.variableContext.variable.length){a.CONFIG.Variables.show(e.variableContext.variable)}d.attr("disabled",false)}}b.ajax({url:l,dataType:"json",data:g,beforeSend:function(){i.attr("disabled","true")},success:c,error:function(u,v){var q,t,o,p,r=b('<div class="form-body"></div><div class="form-footer"><a class="cancel">Cancel</a></div>');r.find(".cancel").click(function(w){if(a.CONFIG.FormDialog&&a.CONFIG.FormDialog.hide){a.CONFIG.FormDialog.hide()}});try{p=u.responseText||u.response;if(p){q=b.parseJSON(p);t=q.message;o=(q.messageBody?"<p>"+q.messageBody+"</p>":null);if(q.oauthCallback){r.filter(".content-footer").prepend('<a href="'+q.oauthCallback+"&amp;redirectUrl="+encodeURIComponent(a.baseURL)+'">Login &amp; Approve</a> | ')}}else{throw"noJSONResponse"}}catch(s){t="An error occurred while trying to retrieve the build information."}AJS.messages.warning(r.filter(".form-body"),{title:t,body:o,closeable:false});i.closest("form").replaceWith(r)},ajaxComplete:function(){i.attr("disabled","false")}})};a.CONFIG.onBuildTypeChange=function(g){var c=b(this),f=c.closest("fieldset.group"),d=f.nextAll(".field-group,.group"),h=b("#"+a.CONFIG.buildResultsContainerId);switch(c.val()){case"no-build":d.hide();f.css({"margin-bottom":0,"padding-bottom":0});break;case"new-build":d.show();h.hide();f.css({"margin-bottom":"","padding-bottom":""});a.CONFIG.$planSelect.change();break;case"existing-build":d.show();f.css({"margin-bottom":"","padding-bottom":""});a.CONFIG.$planSelect.change();break}};a.CONFIG.Stages=(function(){var d={container:{id:null,insertAfter:null,i18n:{legend:"Stages"}},selectedStages:null},k,j,f,g=function(){j=b("<fieldset/>",{id:k.container.id,"class":"group",html:f}).insertAfter(k.container.insertAfter).delegate("input:checkbox","click",h)},c=function(m){var l=false,v,o,x;for(o=0,x=m.length;o<x;o++){var q=m[o],r=!!(q.state&&q.state!="Unknown"),w=!!(q.manual),n=!!(!q.manual||r),p,t,u="stage-"+o,s;if(!l&&q.manual&&!r){l=true}t=b('<input type="checkbox" />').attr({name:"selectedStages",id:u,"class":"checkbox",checked:w,disabled:n}).val(q.name);s=b("<label />",{text:q.name,"for":u});p=b("<div/>",{"class":"checkbox"+(q.manual?(r?" already-run":" manual"):"")+(!l?" selected":"")}).append(t).append(s).appendTo(j);if(!r&&w){v=p}}if(v){v.find("input:checkbox").trigger("click",true)}},e=function(){j.find("div.checkbox,p").remove()},h=function(p,l){if(l){p.preventDefault()}var m=b(this),o=m.is(":checked"),n=false;m.closest("div.checkbox").toggleClass("selected",o).prevAll("div.checkbox").each(function(s){var r=b(this),t=r.children("input:checkbox"),q=r.hasClass("manual");if(o){r.addClass("selected");if(q){t.attr("checked","checked").attr("disabled","disabled")}}else{if(q&&!n){t.removeAttr("disabled");n=true}}}).end().nextAll("div.checkbox").each(function(r){var q=b(this);if(q.hasClass("manual")){return false}else{q.toggleClass("selected",o)}})},i;return{init:function(l){k=b.extend(true,d,l);f="<legend><span>"+k.container.i18n.legend+"</span></legend>";g();i=new a.CONFIG.Spinner(j,e)},show:function(l){j.html(f).show();c(l)},hide:function(){j.hide().html(f)},showNoStagesMsg:function(){i.hide();j.append(b("<p/>",{text:"No stages found."}))},showSpinner:function(){i.show()},updateSelectedStages:function(l){k.selectedStages=l}}})();a.CONFIG.Variables=(function(){var c={container:{id:null,insertAfter:null,i18n:{legend:"Build Variables"}},selectedVariables:null},l,j,k,g,h=function(){j=b("<fieldset/>",{id:l.container.id,"class":"group",html:g}).insertAfter(l.container.insertAfter).delegate("#override-another","click",i).delegate(".bamboo-icon-variable-delete","click",f).delegate("select","change",e)},d=function(r){var m,q,o,p;k=b("<select/>",{"class":"select"});for(o=0,p=r.length;o<p;o++){var n=r[o];if(m!=n.variableType){m=n.variableType;q=b("<optgroup/>",{label:m}).appendTo(k)}b("<option/>",{text:n.key,data:{"server-value":n.value}}).appendTo(q)}},i=function(){var n=k.clone(true),o,p,q,m="";if(arguments.length==2){p=n.find("option[text='"+arguments[0]+"']");m=arguments[1]}else{p=n.find("option:first")}p.attr("selected","selected");q=b('<input type="text" />').attr({name:"variable_"+p.val(),placeholder:p.data("server-value"),"class":"text medium-field"}).val(m);o=b("<div/>",{"class":"field-group"}).append(n).append(q).append(bamboo.components.icon({type:"variable-delete"})).insertBefore(j.children("a"))},f=function(m){b(this).closest(".field-group").remove()},e=function(o){var m=b(this),n=m.find("option:selected");m.nextAll(".text").attr({name:"variable_"+n.val(),placeholder:n.data("server-value")})};return{init:function(m){l=b.extend(true,c,m);g="<legend><span>"+l.container.i18n.legend+'</span></legend><a id="override-another" class="aui-button aui-button-link">Override variable<span class="icon icon-edit-sml"></span></a>';h()},show:function(m){d(m);if(l.selectedVariables&&l.selectedVariables.variables){b.each(l.selectedVariables.variables,i)}j.show()},hide:function(){j.hide().html(g)},updateSelectedVariables:function(m){l.selectedVariables=m}}})();a.CONFIG.BuildResults=(function(){var e={container:{id:null,insertAfter:null,i18n:{legend:"Existing Build"}},selectedBuildResult:null},k,j,g,h=function(){j=b("<fieldset/>",{id:k.container.id,"class":"group",html:g}).insertAfter(k.container.insertAfter).delegate("input:radio","change",f).delegate("a","click",function(l){l.preventDefault();window.open(this.href)})},d=function(p){var o,q,n="build-result-"+p.number,l,m=(p.lifeCycleState=="Finished"?(p.continuable?"SuccessfulPartial":p.state):p.lifeCycleState);q=b('<input type="radio" />').attr({name:"buildResult",id:n,"class":"radio",checked:(p.key==k.selectedBuildResult)}).val(p.key).data("stages",(p.stages.stage&&p.stages.stage.length?p.stages.stage:[]));l=b("<label />",{html:'<a href="'+a.bambooBaseURL+"/browse/"+p.key+'" class="'+m+'">#'+p.number+'</a><span class="trigger-reason">'+a.replaceWithBambooIcon(p.buildReason)+"</span>","for":n}).prepend(bamboo.components.icon({type:m}));o=b("<div/>",{"class":"radio"}).append(q).append(l).appendTo(j)},c=function(){j.find("div.radio,p").remove()},f=function(l){var m=b(this).data("stages");if(m&&m.length){a.CONFIG.Stages.show(m)}else{a.CONFIG.Stages.showNoStagesMsg()}},i;return{init:function(l){k=b.extend(true,e,l);g="<legend><span>"+k.container.i18n.legend+"</span></legend>";h();i=new a.CONFIG.Spinner(j,c)},show:function(n){j.html(g).show();for(var l=0,m=n.length;l<m;l++){d(n[l])}},hide:function(){j.hide().html(g)},showNoResultsMsg:function(){i.hide();j.append(b("<p/>",{text:"No builds found with unbuilt manual stages."})).show()},showSpinner:function(){i.show()},updateSelectedBuildResult:function(l){k.selectedBuildResult=l}}})();a.CheckReleaseBuildStatus=function(d,c){b.ajax({url:a.restURL+"status/"+a.jiraVersionId+"/"+d,dataType:"json",success:function(h){var f=h.bamboo,g=(f.lifeCycleState=="Finished"?(f.continuable?"SuccessfulPartial":f.state):f.lifeCycleState),e;if((f.lifeCycleState!="InProgress"&&f.lifeCycleState!="Queued")||(h.jira&&h.jira.forceRefresh)){AJS.reloadViaWindowLocation()}else{if(f.lifeCycleState=="InProgress"&&f.progress){if(!c){e=b("#build-details");c=b(bamboo.components.buildDetail({key:"Duration",keyClass:"duration",value:f.progress.prettyBuildTime+" &ndash; <span>"+f.progress.prettyTimeRemaining+"</span>"})).appendTo(e).find("dd");e.find(".build + dd > span.bamboo-icon").replaceWith(bamboo.components.icon({type:g}))}else{c.html(f.progress.prettyBuildTime+" &ndash; <span>"+f.progress.prettyTimeRemaining+"</span>")}}}clearTimeout(a.CONFIG.updateTimeout);a.CONFIG.updateTimeout=setTimeout(function(){a.CheckReleaseBuildStatus(d,c)},5000)},error:function(l,m){var i,k,g,h,f=b("#build-details").empty();try{h=l.responseText||l.response;if(h){i=b.parseJSON(h);k=i.message;g=(i.messageBody?"<p>"+i.messageBody+"</p>":"");if(i.oauthCallback){g+='<p><a href="'+i.oauthCallback+"&amp;redirectUrl="+encodeURIComponent(a.baseURL)+'">Login &amp; Approve</a></p>'}}else{throw"noJSONResponse"}}catch(j){k="An error occurred while trying to retrieve the build information."}AJS.messages.warning(f,{title:k,body:g,closeable:false})}})};a.ShowBuildReleaseDetails=function(e){var d=b("#build-details"),c=b(bamboo.components.icon({type:"loading"}));if(d.length){c.appendTo(d);b.ajax({url:a.restURL+"status/"+a.jiraVersionId+"/"+e,dataType:"json",success:function(i){var f=i.bamboo,g=(f.lifeCycleState=="Finished"?(f.continuable?"SuccessfulPartial":f.state):f.lifeCycleState),h;if(i.jira&&i.jira.forceRefresh){AJS.reloadViaWindowLocation()}c.remove();d.append(bamboo.components.buildDetail({key:"Build",keyClass:"build",value:bamboo.components.icon({type:g})+' <a href="'+a.bambooBaseURL+"/browse/"+e+'"><span class="'+g+'">#'+f.number+"</span> "+f.planName+"</a>"}));d.append(bamboo.components.buildDetail({key:"Trigger",keyClass:"trigger",value:a.replaceWithBambooIcon(f.buildReason)}));if(f.vcsRevisionKey){d.append(bamboo.components.buildDetail({key:"Revision",keyClass:"revision",value:f.vcsRevisionKey}))}if(f.labels.label&&f.labels.label.length){d.append(bamboo.components.buildDetail({key:"Labels",keyClass:"labels",value:bamboo.components.labels({baseBambooUrl:a.bambooBaseURL,labels:f.labels.label})}))}if(f.lifeCycleState=="InProgress"||f.lifeCycleState=="Queued"){if(f.lifeCycleState=="InProgress"&&f.progress){h=b(bamboo.components.buildDetail({key:"Duration",keyClass:"duration",value:f.progress.prettyBuildTime+" &ndash; <span>"+f.progress.prettyTimeRemaining+"</span>"})).appendTo(d).find("dd")}clearTimeout(a.CONFIG.updateTimeout);a.CONFIG.updateTimeout=setTimeout(function(){a.CheckReleaseBuildStatus(e,h)},5000)}else{if(f.lifeCycleState=="Finished"){if(f.buildCompletedTime){d.append(bamboo.components.buildDetail({key:"Completed",keyClass:"completed",value:'<time datetime="'+f.buildCompletedTime+'">'+f.prettyBuildCompletedTime+" &ndash; <span>"+f.buildRelativeTime+"</span></time>"}))}if(f.buildDuration){d.append(bamboo.components.buildDetail({key:"Duration",keyClass:"duration",value:f.buildDurationDescription}))}}else{if(f.lifeCycleState=="NotBuilt"){if(f.buildStartedTime){d.append(bamboo.components.buildDetail({key:"Started",keyClass:"started",value:'<time datetime="'+f.buildStartedTime+'">'+f.prettyBuildStartedTime+"</time>"}))}if(f.buildCompletedTime){d.append(bamboo.components.buildDetail({key:"Completed",keyClass:"completed",value:'<time datetime="'+f.buildCompletedTime+'">'+f.prettyBuildCompletedTime+" &ndash; <span>"+f.buildRelativeTime+"</span></time>"}))}d.append(bamboo.components.buildDetail({key:"Status",keyClass:"status",value:(f.buildStartedTime&&!f.buildCompletedTime?"Reason for not completing is unknown":"Reason for not building is unknown")}))}}}if(f.artifacts.artifact&&f.artifacts.artifact.length){d.append(bamboo.components.buildDetail({key:"Artifacts",keyClass:"artifacts",value:bamboo.components.artifacts({artifacts:f.artifacts.artifact})}))}},error:function(k,l){var h,j,f,g;c.remove();try{g=k.responseText||k.response;if(g){h=b.parseJSON(g);j=h.message;f=(h.messageBody?"<p>"+h.messageBody+"</p>":"");if(h.oauthCallback){f+='<p><a href="'+h.oauthCallback+"&amp;redirectUrl="+encodeURIComponent(a.baseURL)+'">Login &amp; Approve</a></p>'}}else{throw"noJSONResponse"}}catch(i){j="An error occurred while trying to retrieve the build information."}AJS.messages.warning(d,{title:j,body:f,closeable:false})}})}};a.replaceWithBambooIcon=function(c){return c.replace(/(\b)icon(\b)/g,"$1bamboo-icon$2")};a.init=(function(){a.CONFIG.init();b(function(){var c=b("#runRelease");if(c.length){a.CONFIG.FormDialog=new JIRA.FormDialog({trigger:c,widthClass:"large",autoClose:true});if(/showReleaseDialog=true/.test(window.location.href)){c.click()}}})})()}(AJS.$,window.JBAM=(window.JBAM||{})));
/* module-key = 'com.atlassian.auiplugin:aui-experimental-tooltips', location = 'experimental/js/external/jquery/jquery.tipsy.js' */
(function(E){function D(H,G){return(typeof H=="function")?(H.call(G)):H}function F(G){while(G=G.parentNode){if(G==document){return true}}return false}var A=0;function B(){var G=A++;return"tipsyuid"+G}function C(H,G){this.$element=E(H);this.options=G;this.enabled=true;this.fixTitle()}C.prototype={show:function(){var P=this.getTitle();if(P&&this.enabled){var I=this.tip();I.find(".tipsy-inner")[this.options.html?"html":"text"](P);I[0].className="tipsy";I.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var L=this;function H(){L.hoverTooltip=true}function M(){if(L.hoverState=="in"){return }L.hoverTooltip=false;if(L.options.trigger!="manual"){var R=L.options.trigger=="hover"?"mouseleave.tipsy":"blur.tipsy";L.$element.trigger(R)}}if(this.options.hoverable){I.hover(H,M)}var N=E.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var G=I[0].offsetWidth,K=I[0].offsetHeight,Q=D(this.options.gravity,this.$element[0]);var O;switch(Q.charAt(0)){case"n":O={top:N.top+N.height+this.options.offset,left:N.left+N.width/2-G/2};break;case"s":O={top:N.top-K-this.options.offset,left:N.left+N.width/2-G/2};break;case"e":O={top:N.top+N.height/2-K/2,left:N.left-G-this.options.offset};break;case"w":O={top:N.top+N.height/2-K/2,left:N.left+N.width+this.options.offset};break}if(Q.length==2){if(Q.charAt(1)=="w"){O.left=N.left+N.width/2-15}else{O.left=N.left+N.width/2-G+15}}I.css(O).addClass("tipsy-"+Q);I.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+Q.charAt(0);if(this.options.className){I.addClass(D(this.options.className,this.$element[0]))}if(this.options.fade){I.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity})}else{I.css({visibility:"visible",opacity:this.options.opacity})}if(this.options.aria){var J=B();I.attr("id",J);this.$element.attr("aria-describedby",J)}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){E(this).remove()})}else{this.tip().remove()}if(this.options.aria){this.$element.removeAttr("aria-describedby")}},fixTitle:function(){var G=this.$element;if(G.attr("title")||typeof (G.attr("original-title"))!="string"){G.attr("original-title",G.attr("title")||"").removeAttr("title")}},getTitle:function(){var I,G=this.$element,H=this.options;this.fixTitle();var I,H=this.options;if(typeof H.title=="string"){I=G.attr(H.title=="title"?"original-title":H.title)}else{if(typeof H.title=="function"){I=H.title.call(G[0])}}I=(""+I).replace(/(^\s*|\s*$)/,"");return I||H.fallback},tip:function(){if(!this.$tip){this.$tip=E('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>').attr("role","tooltip");this.$tip.data("tipsy-pointee",this.$element[0])}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};E.fn.tipsy=function(J){if(J===true){return this.data("tipsy")}else{if(typeof J=="string"){var L=this.data("tipsy");if(L){L[J]()}return this}}J=E.extend({},E.fn.tipsy.defaults,J);if(J.hoverable){J.delayOut=J.delayOut||20}function I(N){var O=E.data(N,"tipsy");if(!O){O=new C(N,E.fn.tipsy.elementOptions(N,J));E.data(N,"tipsy",O)}return O}function M(){var N=I(this);N.hoverState="in";if(J.delayIn==0){N.show()}else{N.fixTitle();setTimeout(function(){if(N.hoverState=="in"){N.show()}},J.delayIn)}}function H(){var N=I(this);N.hoverState="out";if(J.delayOut==0){N.hide()}else{setTimeout(function(){if(N.hoverState=="out"&&!N.hoverTooltip){N.hide()}},J.delayOut)}}if(!J.live){this.each(function(){I(this)})}if(J.trigger!="manual"){var K=J.trigger=="hover"?"mouseenter.tipsy":"focus.tipsy",G=J.trigger=="hover"?"mouseleave.tipsy":"blur.tipsy";if(J.live){E(this.context).on(K,this.selector,M).on(G,this.selector,H)}else{this.bind(K,M).bind(G,H)}}return this};E.fn.tipsy.defaults={aria:false,className:null,delayIn:0,delayOut:0,fade:false,fallback:"",gravity:"n",html:false,live:false,hoverable:false,offset:0,opacity:0.8,title:"title",trigger:"hover"};E.fn.tipsy.revalidate=function(){E(".tipsy").each(function(){var G=E.data(this,"tipsy-pointee");if(!G||!F(G)){E(this).remove()}})};E.fn.tipsy.elementOptions=function(H,G){return E.metadata?E.extend({},G,E(H).metadata()):G};E.fn.tipsy.autoNS=function(){return E(this).offset().top>(E(document).scrollTop()+E(window).height()/2)?"s":"n"};E.fn.tipsy.autoWE=function(){return E(this).offset().left>(E(document).scrollLeft()+E(window).width()/2)?"e":"w"};E.fn.tipsy.autoBounds=function(H,G){return function(){var I={ns:G[0],ew:(G.length>1?G[1]:false)},L=E(document).scrollTop()+H,J=E(document).scrollLeft()+H,K=E(this);if(K.offset().top<L){I.ns="n"}if(K.offset().left<J){I.ew="w"}if(E(window).width()+E(document).scrollLeft()-K.offset().left<H){I.ew="e"}if(E(window).height()+E(document).scrollTop()-K.offset().top<H){I.ns="s"}return I.ns+(I.ew?I.ew:"")}}})(jQuery);
/* module-key = 'com.atlassian.auiplugin:aui-experimental-tooltips', location = 'experimental/js/atlassian/tooltip.js' */
(function(A){A.fn.tooltip=function(B){if(typeof B!="object"){return this.tipsy(B)}var E=A.extend({},A.fn.tooltip.defaults,B),C=this.tipsy(E);if(E.hideOnClick&&(E.trigger=="hover"||!E.trigger&&this.tipsy.defaults.trigger=="hover")){var D=function(){A(this).tipsy("hide")};if(E.live){A(this.context).on("click.tipsy",this.selector,D)}else{this.bind("click.tipsy",D)}}return C};A.fn.tooltip.defaults={opacity:1,offset:1,delayIn:500,hoverable:true,hideOnClick:true}}(jQuery));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:backbone-ext', location = 'content/js/base/AttributesMixinCreator.js' */
AJS.namespace("JIRA.Issues.AttributesMixinCreator");(function(){JIRA.Issues.AttributesMixinCreator={create:function(b){var a={};if(_.indexOf(b,"id")===-1){b.unshift("id")}_.each(b,function(d){var e=JIRA.Issues.Mixins.createMethodName("set",d);a[e]=function(h,f){var g={};g[d]=h;this.set(g,f);return this};var c=JIRA.Issues.Mixins.createMethodName("get",d);a[c]=function(){return this.get(d)}});return a}}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:backbone-ext', location = 'content/js/base/EventsMixinCreator.js' */
(function(){JIRA.Issues.EventsMixinCreator={create:function(b){var a={};var c=function(e){var d=JIRA.Issues.Mixins.createMethodName("bind",e);a[d]=function(){return this.bind.apply(this,[e].concat(_.toArray(arguments)))};var g=JIRA.Issues.Mixins.createMethodName("unbind",e);a[g]=function(){return this.unbind.apply(this,[e].concat(_.toArray(arguments)))};var f=JIRA.Issues.Mixins.createMethodName("trigger",e);a[f]=function(){return this.trigger.apply(this,[e].concat(_.toArray(arguments)))};var h=JIRA.Issues.Mixins.createMethodName("one",e);a[h]=function(){var i=this;var j=arguments[0];var l=function(){i.unbind(e,l);j(arguments)};var k=_.toArray(arguments).slice(1);return this.bind.apply(this,[e,l].concat(k))}};_.each(b,_.bind(c,this));return a}}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:backbone-ext', location = 'content/js/base/Extensions.js' */
AJS.namespace("JIRA.Issues.BaseModel");AJS.namespace("JIRA.Issues.BaseCollection");AJS.namespace("JIRA.Issues.BaseView");AJS.namespace("JIRA.Issues.BaseRouter");(function(){function applyMixin(ctor,mixin){_.forEach(_.keys(mixin),function(key){var proto=ctor.prototype;if("initialize"===key){var oldInitialize=proto.initialize;proto.initialize=function(){mixin.initialize.apply(this,arguments);if(oldInitialize){oldInitialize.apply(this,arguments)}};return}if("validate"===key){var oldValidate=proto.validate;proto.validate=function(){var errors=mixin.validate.apply(this,arguments);if(errors){return errors}if(oldValidate){return oldValidate.apply(this,arguments)}};return}if("defaults"===key){var defaults=proto.defaults||(proto.defaults={});var mixinDefaults=mixin[key];for(var id in mixinDefaults){if(defaults.hasOwnProperty(id)){throw"Mixin error: object "+ctor+" already has default "+id+" defined for mixin "+mixin}defaults[id]=mixinDefaults[id]}return}if("properties"===key){if(!_.isArray(mixin[key])){throw"Expects properties member on mixin to be an array"}if(!proto.properties){proto.properties=[]}proto.properties=proto.properties.concat(mixin[key]);return}if("namedEvents"===key){if(!_.isArray(mixin[key])){throw"Expects events member on mixin to be an array"}if(!proto.namedEvents){proto.namedEvents=[]}proto.namedEvents=proto.namedEvents.concat(mixin[key]);return}if(proto.hasOwnProperty(key)){throw"Mixin error: object "+ctor+" already has property "+key+" for mixin "+mixin}proto[key]=mixin[key]},this)}function generateMixinExtend(oldExtend){return function(protoProps,classProps){var child;var cleanProtoProps=_.extend({},protoProps);var mixins;if(protoProps&&protoProps.mixins){mixins=protoProps.mixins;delete cleanProtoProps.mixins}child=oldExtend.call(this,cleanProtoProps,classProps);if(mixins){_.each(protoProps.mixins,function(mixin){applyMixin(child,mixin)})}if(child.prototype.namedEvents){applyMixin(child,JIRA.Issues.EventsMixinCreator.create(child.prototype.namedEvents))}if(child.prototype.properties){applyMixin(child,JIRA.Issues.AttributesMixinCreator.create(child.prototype.properties))}child.extend=arguments.callee;return child}}function overrideSetGet(ctor,childCtor){var proto=ctor.prototype;var childProto=childCtor.prototype;childProto.set=function(key,value,options){var attrs,properties=this.properties;if(properties){if(_.isObject(key)||key==null){attrs=key}else{attrs={};attrs[key]=value}for(var attr in attrs){if(_.indexOf(properties,attr)<0){throw"Property '"+attr+"' does not exist"}}}return proto.set.apply(this,arguments)};childProto.get=function(attr){if(this.properties&&_.indexOf(this.properties,attr)<0){throw"Property '"+attr+"' does not exist"}return proto.get.apply(this,arguments)}}function addListenMethods(ctor,childCtor){var proto=ctor.prototype;var childProto=childCtor.prototype;childProto.addListener=function(other,event,callback,context){if(arguments.length<3){throw"The 'other', 'event', and 'callback' arguments are mandatory"}var capitalisedEvent=event.charAt(0).toUpperCase()+event.slice(1);var registerMethodName="on"+capitalisedEvent;var unregisterMethodName="off"+capitalisedEvent;var braceRegisterMethodName="bind"+capitalisedEvent;var braceUnregisterMethodName="unbind"+capitalisedEvent;var finalRegisterName;var finalUnRegisterName;if(other[registerMethodName]){finalRegisterName=registerMethodName;finalUnRegisterName=unregisterMethodName||braceUnregisterMethodName;if(typeof other[finalRegisterName]!=="function"){throw"object does not have method "+registerMethodName+"'"}if(typeof other[finalUnRegisterName]!=="function"){throw"object does not have method "+unregisterMethodName+"'"}}else{finalRegisterName=braceRegisterMethodName;finalUnRegisterName=braceUnregisterMethodName;if(typeof other[finalRegisterName]!=="function"){throw"object does not have event ["+event+"] registered'"}}other[finalRegisterName](callback,context);this._cleanerUppers=this._cleanerUppers||[];this._cleanerUppers.push(function(){other[finalUnRegisterName](callback,context)})};childProto.removeListeners=function(){if(this._cleanerUppers){_.each(this._cleanerUppers,function(cleanerUpper){cleanerUpper()})}}}function addViewCleanupMethods(ctor,childCtor){var proto=ctor.prototype;var childProto=childCtor.prototype;var superRemove=proto.remove;childProto.remove=function(){this.removeListeners();return superRemove.apply(this,arguments)};proto.deactivate=function(){this.undelegateEvents();this.removeListeners()}}function applyExtensions(ctor){var child=ctor.extend();var oldExtend=ctor.extend;child.extend=generateMixinExtend(oldExtend);return child}function applyModelExtensions(ctor){var child=applyExtensions(ctor);overrideSetGet(ctor,child);return child}function applyViewExtensions(ctor){var child=applyExtensions(ctor);addListenMethods(ctor,child);addViewCleanupMethods(ctor,child);return child}JIRA.Issues.BaseModel=applyModelExtensions(Backbone.Model);JIRA.Issues.BaseCollection=applyExtensions(Backbone.Collection);JIRA.Issues.BaseView=applyViewExtensions(Backbone.View);JIRA.Issues.BaseRouter=applyExtensions(Backbone.Router);var Evented=function(){this.initialize.apply(this,arguments)};_.extend(Evented.prototype,Backbone.Events,{initialize:function(){}});Evented.extend=Backbone.Model.extend;JIRA.Issues.BaseEvented=applyExtensions(Evented);_.mixin({lambda:function(x){return function(){return x}},isNotBlank:function(object){return !!object}});Backbone.define=function(name,ctor){eval("Backbone['Class: "+name+"'] = function() { Backbone['Class: "+name+"'].__ctor.apply(this, arguments); }");var cls=Backbone["Class: "+name];cls.__ctor=ctor;ctor.prototype.name=name;cls.prototype=ctor.prototype;_.extend(cls,ctor);_.each(ctor.prototype,function(fn,fnName){if(typeof fn==="function"){fn.displayName=name+"."+fnName}});var context=window;var parts=name.split(".");_.each(parts,function(part,i){if(i===parts.length-1){context[part]=cls}else{context=context[part]==null?(context[part]={}):context[part]}});return cls}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:backbone-ext', location = 'content/js/base/Mixins.js' */
(function(){JIRA.Issues.Mixins={createMethodName:function(a,b){return a+b.charAt(0).toUpperCase()+b.substr(1)}}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:backbone-ext', location = 'content/js/base/ModelUtils.js' */
(function(){var b=function(d,c){return function(f,g,e){c[this.cid]={model:this};if(_.isObject(f)){c[this.cid].options=g;return d.call(this,f,_.extend(g||{},{silent:true}))}c[this.cid].options=e;return d.call(this,f,g,_.extend(e||{},{silent:true}))}};var a=function(){var e=Backbone.Model.prototype;if(typeof e._txModels!=="undefined"){return{publishChanges:function(){}}}var c=e._txModels={};var d=e.set;e.set=b(d,c);return{publishChanges:function(){e.set=d;_.each(c,function(f){f.model.change(f.options)});delete e._txModels}}};JIRA=JIRA||{};JIRA.Issues=JIRA.Issues||{};JIRA.Issues.ModelUtils=JIRA.Issues.ModelUtils||{};JIRA.Issues.ModelUtils.transaction=function(e,d){var c=a();e.apply(d);c.publishChanges();return undefined};JIRA.Issues.ModelUtils.makeTransactional=function(d){var e=function(f){return function(){var g=arguments;JIRA.Issues.ModelUtils.transaction(function(){f.apply(this,g)},this)}};var c=Array.prototype.slice.call(arguments,1);if(c.length===0){c=_.functions(d)}_.each(c,function(f){if(f.indexOf("_")!==0){d[f]=e(d[f])}})}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:backbone-ext', location = 'content/js/backbonepatch/backbone-0.9.2-navigate-patch.js' */
Backbone.History.prototype.navigate=function(c,b){if(!Backbone.History.started){return false}if(!b||b===true){b={trigger:b}}c=this.getFragment(c||"");if(this.fragment===c){return}this.fragment=c;var a=this.options.root+c;if(this._hasPushState){window.history[b.replace?"replaceState":"pushState"]({},document.title,a)}else{if(this._wantsHashChange){this._updateHash(window.location,c,b.replace);if(this.iframe&&(c!==this.getFragment(this.getHash(this.iframe)))){if(!b.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,c,b.replace)}}else{return window.location.assign(a)}}if(b.trigger){this.loadUrl(c)}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'lib/jquery.hoverIntent.min.js' */
/**
* hoverIntent r6 // 2011.02.26 // jQuery 1.5.1+
* <http://cherne.net/brian/resources/jquery.hoverIntent.html>
* 
* @param  f  onMouseOver function || An object with configuration options
* @param  g  onMouseOut function  || Nothing (use configuration options object)
* @author    Brian Cherne brian(at)cherne(dot)net
*/
(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev])}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev])};var handleHover=function(e){var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t)}if(e.type=="mouseenter"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob)},cfg.interval)}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob)},cfg.timeout)}}};return this.bind('mouseenter',handleHover).bind('mouseleave',handleHover)}})(jQuery);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/Utils.js' */
JIRA.Issues.Actions={DELETE:"delete",EDIT_COMMENT:"editComment",UPDATE:"update",INLINE_EDIT:"inlineEdit",ROW_UPDATE:"rowUpdate"};JIRA.Issues.Utils={isIssueDialog:function(a){return !!a.issueId||_.include(JIRA.Dialogs,a)},isDeleteDialog:function(a){return a.options.id==="delete-issue-dialog"},isEditCommentDialog:function(a){return a.options.id==="edit-comment"},getEffectiveIssueKeyForDialog:function(a){var b=a&&a.$activeTrigger&&a.$activeTrigger.data("issuekey");if(b){return b}else{return JIRA.Issues.Api.getSelectedIssue().getKey()}},getEffectiveIssueIdForDialog:function(a){if(a.issueId){return a.issueId}else{return JIRA.Issues.Api.getSelectedIssue().getId()}},getAction:function(a){if(this.isDeleteDialog(a)){return JIRA.Issues.Actions.DELETE}else{if(this.isEditCommentDialog(a)){return JIRA.Issues.Actions.EDIT_COMMENT}else{return JIRA.Issues.Actions.UPDATE}}},getMessage:function(a){if(!this.isEditCommentDialog(a)){return a.options.issueMsg||"thanks_issue_updated"}},getMeta:function(a){if(this.isEditCommentDialog(a)){return{commentId:a.$activeTrigger.attr("id").replace("edit_comment_","")}}else{return{}}},getUpdateCommandForDialog:function(b){var a=this;if(this.isIssueDialog(b)){return{key:a.getEffectiveIssueKeyForDialog(b),id:a.getEffectiveIssueIdForDialog(b),action:a.getAction(b),message:a.getMessage(b),meta:a.getMeta(b)}}},debounce:function(a,c){var b=Array.prototype.slice.call(arguments,2);if(!a){console.error("JIRA.Issues.Utils.debounce: ctx must be defined")}clearTimeout(a[c+"DebounceTimeout"]);a[c].apply(a,b);if(!a[c+"DebounceTimeout"]){a[c+"Original"]=a[c];a[c]=_.debounce(_.bind(function(){return a[c+"Original"].apply(this,arguments)},this),300)}a[c+"DebounceTimeout"]=setTimeout(_.bind(function(){a[c]=a[c+"Original"];a[c+"DebounceTimeout"]=null},this),500)},waitForDeferreds:function(e,d,a){a=a||window;var c=[];var b=jQuery.Deferred();_.each(e,function(){var f=d.apply(a,arguments);if(f&&f.promise){c.push(f)}});if(c.length){jQuery.when.apply(jQuery,c).then(function(){b.resolveWith(a)})}else{b.resolveWith(a)}return b.promise()},resolvedPromise:function(){return jQuery.Deferred().resolve().promise()}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/AuiOverrides.js' */
AJS.undim=function(){if(AJS.dim.$dim){AJS.dim.$dim.remove();AJS.dim.$dim=null;if(AJS.dim.shim){AJS.dim.shim.remove()}if(AJS.$.browser.msie&&parseInt(AJS.$.browser.version,10)<8){AJS.$("html").removeAttr("style")}else{AJS.$("body").removeAttr("style")}}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/ScrollIntoView.js' */
/*!
 * jQuery scrollintoview() plugin and :scrollable selector filter
 *
 * Version 1.8 (14 Jul 2011)
 * Requires jQuery 1.4 or newer
 *
 * Copyright (c) 2011 Robert Koritnik
 * Licensed under the terms of the MIT license
 * http://www.opensource.org/licenses/mit-license.php
 */
(function(g){var c={vertical:{x:false,y:true},horizontal:{x:true,y:false},both:{x:true,y:true},x:{x:true,y:false},y:{x:false,y:true}};var b={duration:0,direction:"y"};var f=/^(?:html)$/i;var h=function(l,k){k=k||(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(l,null):l.currentStyle);var j=document.defaultView&&document.defaultView.getComputedStyle?true:false;var i={top:(parseFloat(j?k.borderTopWidth:g.css(l,"borderTopWidth"))||0),left:(parseFloat(j?k.borderLeftWidth:g.css(l,"borderLeftWidth"))||0),bottom:(parseFloat(j?k.borderBottomWidth:g.css(l,"borderBottomWidth"))||0),right:(parseFloat(j?k.borderRightWidth:g.css(l,"borderRightWidth"))||0)};return{top:i.top,left:i.left,bottom:i.bottom,right:i.right,vertical:i.top+i.bottom,horizontal:i.left+i.right}};var d=function(i){var k=g(window);var j=f.test(i[0].nodeName);return{border:j?{top:0,left:0,bottom:0,right:0}:h(i[0]),scroll:{top:(j?k:i).scrollTop(),left:(j?k:i).scrollLeft()},scrollbar:{right:j?0:i.innerWidth()-i[0].clientWidth,bottom:j?0:i.innerHeight()-i[0].clientHeight},rect:(function(){var l=i[0].getBoundingClientRect();return{top:j?0:l.top,left:j?0:l.left,bottom:j?i[0].clientHeight:l.bottom,right:j?i[0].clientWidth:l.right}})()}};g.fn.extend({scrollIntoViewForAuto:function(k){k=g.extend({},b,k);k.direction=c[typeof(k.direction)==="string"&&k.direction.toLowerCase()]||c.both;var o="";if(k.direction.x===true){o="horizontal"}if(k.direction.y===true){o=o?"both":"vertical"}var m=this.eq(0);var j=m.closest(":scrollable("+o+")");if(j.length>0){j=j.eq(0);var n={e:d(m),s:d(j)};var i={top:n.e.rect.top-(n.s.rect.top+n.s.border.top),bottom:n.s.rect.bottom-n.s.border.bottom-n.s.scrollbar.bottom-n.e.rect.bottom,left:n.e.rect.left-(n.s.rect.left+n.s.border.left),right:n.s.rect.right-n.s.border.right-n.s.scrollbar.right-n.e.rect.right};var l={};if(k.direction.y===true){if(i.top<0){l.scrollTop=n.s.scroll.top+i.top-30}else{if(i.top>0&&i.bottom<0){l.scrollTop=n.s.scroll.top+Math.min(i.top,-i.bottom)+30}}}if(k.direction.x===true){if(i.left<0){l.scrollLeft=n.s.scroll.left+i.left}else{if(i.left>0&&i.right<0){l.scrollLeft=n.s.scroll.left+Math.min(i.left,-i.right)}}}if(!g.isEmptyObject(l)){if(f.test(j[0].nodeName)){j=g("html,body")}j.animate(l,k.duration).eq(0).queue(function(p){g.isFunction(k.complete)&&k.complete.call(j[0]);p()})}else{g.isFunction(k.complete)&&k.complete.call(j[0])}}return this}});var a={auto:true,scroll:true,visible:false,hidden:false};g.extend(g.expr[":"],{scrollable:function(l,j,o,i){var n=c[typeof(o[3])==="string"&&o[3].toLowerCase()]||c.both;var m=(document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(l,null):l.currentStyle);var p={x:a[m.overflowX.toLowerCase()]||false,y:a[m.overflowY.toLowerCase()]||false,isRoot:f.test(l.nodeName)};if(!p.x&&!p.y&&!p.isRoot){return false}var k={height:{scroll:l.scrollHeight,client:l.clientHeight},width:{scroll:l.scrollWidth,client:l.clientWidth},scrollableX:function(){return(p.x||p.isRoot)&&this.width.scroll>this.width.client},scrollableY:function(){return(p.y||p.isRoot)&&this.height.scroll>this.height.client}};return n.y&&k.scrollableY()||n.x&&k.scrollableX()}});var e=jQuery.fn.scrollIntoView;JIRA.Issues.overrideScrollIntoViewForSplit=function(){jQuery.fn.scrollIntoView=jQuery.fn.scrollIntoViewForAuto};JIRA.Issues.restoreScrollIntoViewForNormal=function(){jQuery.fn.scrollIntoView=e}})(jQuery);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/ClientAnalytics.js' */
AJS.namespace("JIRA.Issues.Analytics");JIRA.Issues.Analytics=_.clone(Backbone.Events);JIRA.Issues.Analytics.generateGuid=function(){return Math.random().toString(36).substring(2)+Math.random().toString(36).substring(2)};JIRA.Issues.Analytics.startTime=new Date().getTime();JIRA.Issues.Analytics.pageSessionGuid=JIRA.Issues.Analytics.generateGuid();JIRA.Issues.Analytics.stableSearchGuid=null;JIRA.Issues.Analytics.registerEventName=function(a){JIRA.Issues.Analytics.on(a,function(b){JIRA.Issues.Analytics.convertToLogEvent(a,b)})};JIRA.Issues.Analytics.registerEventNames=function(a){_.each(a,JIRA.Issues.Analytics.registerEventName)};JIRA.Issues.Analytics.initTrackers=function(b){var c={type:"click",handler:a,context:document};function a(f,d){JIRA.Issues.Analytics.convertToLogEvent(this.name,d)}_.each(b,function(d){_.defaults(d,c);JIRA.Issues.Analytics.registerEventName(d.name);AJS.$(d.context).delegate(d.selector,d.type,function(f){if(!f.preventFurtherAnalytics){d.handler.apply(d,Array().slice.call(arguments))}})})};JIRA.Issues.Analytics.convertToLogEvent=function(b,c){var a="***** Analytics log ["+b+"]";c=c||{};c.context_pageSession=JIRA.Issues.Analytics.pageSessionGuid;c.context_pageTime=new Date().getTime()-JIRA.Issues.Analytics.startTime;if(JIRA.Issues.Analytics.stableSearchGuid){c.context_stableSearch=JIRA.Issues.Analytics.stableSearchGuid}a+="["+JSON.stringify(c)+"]";AJS.log(a);if(AJS.EventQueue){AJS.EventQueue.push({name:b,properties:c||{}})}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/IssueNavFeatures.js' */
AJS.namespace("JIRA.Issues.Feature");JIRA.Issues.Feature=Class.extend({init:function(a){this.featureKey=a},enabled:function(){return AJS.DarkFeatures.isEnabled(this.featureKey)}});AJS.namespace("JIRA.Issues.GhettoFeature");JIRA.Issues.GhettoFeature=JIRA.Issues.Feature.extend({enabled:function(){return this._super()&&(!this._ieGhetto.enabled()||history.pushState)},_ieGhetto:new JIRA.Issues.Feature("ka.ghetto")});JIRA.Issues.KillSwitchFeature=JIRA.Issues.Feature.extend({enabled:function(){var a=AJS.DarkFeatures.isEnabled("ka.ghetto")&&!history.pushState;return this._super()||a}});AJS.namespace("JIRA.Issues.DarkFeatures");JIRA.Issues.DarkFeatures={KILL_SWITCH:new JIRA.Issues.KillSwitchFeature("ka.KILL_SWITCH"),NO_PREFETCH:new JIRA.Issues.GhettoFeature("ka.NO_PREFETCH"),PROJECT_SHORTCUTS:new JIRA.Issues.Feature("rotp.project.shortcuts")};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/analytics.js' */
(function(){JIRA.Issues.Analytics.registerEventNames(["kickass.search","kickass.switchtobasic","kickass.switchtoadvanced","kickass.returntosearch","kickass.editField","kickass.editMultipleFields","kickass.editClientDuration","kickass.editClientCancelledDuration","kickass.editSaveonserverDuration","kickass.issueLoadDuration","kickass.openIssueFromTable","kickass.issueTotalSaveDuration","kickass.focusshifteropened","kickass.queryTooComplexSwitchToAdvanced","kickass.basicModeCriteriaCountWhenSearching","kickass.criteriaAutoUpdateEnabled","kickass.issueTableRefresh","kickass.conditionalLoading"]);JIRA.Issues.Analytics.trigger("kickass.criteriaAutoUpdateEnabled",{enabled:AJS.Meta.getBoolean("hasCriteriaAutoUpdate")});JIRA.Issues.Analytics.initTrackers([{name:"kickass.clickedOnSystemFilter",selector:".system-filters a",handler:a},{name:"kickass.clickedOnFavouriteFilter",selector:".favourite-filters a.push-state"},{name:"kickass.clickedOnFavouriteFilterActionsMenu",selector:".favourite-filters a.filter-actions"},{name:"kickass.renamedFilterFromActionsMenu",selector:"#rename-filter-form",type:"submit"},{name:"kickass.deletedFilterFromActionsMenu",selector:"#delete-filter-form",type:"submit"},{name:"kickass.copiedFilterFromActionsMenu",selector:"#copy-filter-dialog form",type:"submit"},{name:"kickass.removeFilterFromFavouritesViaActionsMenu",selector:".unfavourite-filter"},{name:"kickass.saveACopyOfFilterFromSearchHeader",selector:"#save-filter-dialog form",type:"submit"},{name:"kickass.filterChangesSaved",selector:".header-section-primary .save-changes"},{name:"kickass.clickedOnShowFiltersDetailsDropDown",selector:".show-filter-details",type:"mousedown"},{name:"kickass.clickedOnChangePermissions",selector:".filter-permissions .change-permissions"},{name:"kickass.clickedOnUnfavouriteStar",selector:".filter-operations .fav-link.off"},{name:"kickass.clickedOnSaveFilterAs",selector:".save-as-new-filter",handler:f},{name:"kickass.clickedOnPagniationLink",selector:".pagination a",handler:e},{name:"kickass.inbrowsersearch",type:"keydown",handler:c},{name:"kickass.reloadPage",type:"keydown",handler:g},{name:"kickass.moreCriteriaNewlySelectedCount",type:AJS.InlineLayer.EVENTS.beforeHide,handler:d},{name:"kickass.createdNewSearch",selector:".new-search"},{name:"kickass.sortByColumn",selector:".sortable",handler:b},{name:"kickass.findFiltersClicked",selector:".find-filters"}]);function a(j){var i=AJS.$(j.target);JIRA.Issues.Analytics.trigger(this.name,{name:h(i.attr("href"))})}function f(){var j=AJS.$(".system-filters a.active").length===1,i=AJS.$(".favourite-filters a.active").length===1;JIRA.Issues.Analytics.trigger(this.name,{systemFilterSelected:j,favouriteFilterSelected:i})}function h(i){var j=parseUri(i);return j.queryKey.filter}function e(k){var j=AJS.$(k.target),i=j.text();JIRA.Issues.Analytics.trigger(this.name,{page:i})}function c(i){if(i.keyCode===70&&(i.metaKey||i.ctrlKey)){JIRA.Issues.Analytics.trigger(this.name)}}function g(i){if(i.keyCode===82&&(i.metaKey||i.ctrlKey)){JIRA.Issues.Analytics.trigger(this.name)}}function d(l,j){if(j&&j.find("#criteria-multi-select").length){var k=AJS.$("#criteria-multi-select");var i=k.find("input[checked]").length-k.find(".selected-group input[checked]").length;JIRA.Issues.Analytics.trigger(this.name,{count:i})}}function b(i){var j=jQuery(i.target);if(!j.is("th")){j=j.parent("th")}if(j.length){JIRA.Issues.Analytics.trigger(this.name,{direction:j.hasClass("ascending")?"descending":"ascending",column:j.data("id")})}}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/Stalker.js' */
(function(b){var a;b.fn.stalker=function(d){var e=this,h;if(!e.length||e.data("stalker-applied")){return}e.data("stalker-applied",true);d=d||{};d.offsetTop=d.offsetTop||0;function g(){if(a){e.css({position:"",top:"",left:"",right:"",height:""}).removeClass("detached");e.unbind("stalkerHeightUpdated",j);a.remove();a=null}}function f(){if(!a){a=jQuery("<div class='stalker-placeholder' />").css("visibility","hidden").addClass(e[0].className).height(e.outerHeight()).width(e.outerWidth()).insertBefore(e);e.bind("stalkerHeightUpdated",j);e.css({position:"fixed",top:d.offsetTop,left:h.left,right:h.right}).addClass("detached");if(typeof c.timeout==="undefined"){c()}}}function j(){a.height(e.height())}function i(){if(!e.is(":visible")){return}if(!h){h=e.offset()}if(b(window).scrollTop()+d.offsetTop>=h.top){f()}else{g()}}function c(){if(a){i();c.timeout=setTimeout(c,250)}else{delete c.timeout}}b(window).bind("resize scroll",i);i();return{unstalk:function(){g();b(window).unbind("resize scroll",i)}}}})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/Sidebar.js' */
/*!
 * jQuery UI Sidebar
 * http://jqueryui.com
 *
 * Depends:
 *   jquery.ui.widget.js
 */
(function(a){a.widget("ui.sidebar",{version:"0.1",options:{minWidth:function(b){return 50},maxWidth:function(b){return jQuery(window).width()},resize:a.noop},_create:function(){_.bindAll(this);if(!this.options.id){console.error("ui.sidebar: You must specify an id")}this._addHandle();this._restore();this.handle.mousedown(this._setContainment);this.handle.draggable({axis:"x",drag:this._handleDrag,stop:this._persist});a(window).resize(_.debounce(this.updatePosition,30))},_restore:function(){if(window.localStorage){var b=localStorage.getItem("ui.sidebar."+this.options.id);if(b){this._setWidth(b)}}},_persist:function(){if(window.localStorage){localStorage.setItem("ui.sidebar."+this.options.id,this.element.outerWidth())}},_setContainment:function(){var b=jQuery(window).height();this._elementLeft=this.element.offset().left;this._minLeft=this._elementLeft+this.options.minWidth(this);this._maxLeft=Math.max(this._minLeft,this._elementLeft+this.options.maxWidth(this));this.handle.draggable({containment:[this._minLeft,b,this._maxLeft,b]})},_handleDrag:function(d,b){var c=b.position.left-this._elementLeft;this._setWidth(c,true)},_setWidth:function(e,d){if(!d){var c=this.options.maxWidth(this);var b=this.options.minWidth(this);if(e>c){e=c}else{if(e<b){e=b}}}e-=this.element.outerWidth()-this.element.width();this.element.width(e);this.options.resize(e)},_addHandle:function(){this.handle=jQuery("<div />").addClass("ui-sidebar").appendTo(this.element);_.defer(this._setHandlePosition)},_setHandlePosition:function(){this._setContainment();if(this._minLeft===this._maxLeft){this.handle.hide()}else{var c=this.element.offset();var b=c.left+this.element.outerWidth();this.handle.css({top:c.top,left:b,height:this.element.outerHeight()}).show()}},updatePosition:function(){this._setHandlePosition();this._setWidth(this.handle.offset().left-this._elementLeft);this._persist()}})})(jQuery);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/PopoutSidebar.js' */
(function(a){a.widget("ui.popoutSidebar",{version:"0.1",options:{renderExpanded:a.noop,renderCollapsed:a.noop,persist:a.noop,collapsedWidth:30,expandedWidth:200,dockText:"Dock",undockText:"Undock",dockTitle:"Dock the filter panel so you can always see the list of filters",undockTitle:"Undock the filter panel so it is hidden when not being focused"},CLASS_NAMES:{popout:"ui-popout",placeholder:"ui-popout-placeholder",detached:"ui-popout-detached",expanding:"ui-popout-expanding",expanded:"ui-popout-expanded",collapsed:"ui-popout-collapsed",collapsing:"ui-popout-collapsing"},_create:function(){_.bindAll(this);if(!this.element.data("popoutsidebar")){this.element.data("popoutsidebar",true);this.element.bind("updateOffsets.popout",this.updateOffsets);this.element.bind("updateOffsets.reset",this.reset);this.element.delegate(".ui-dock","click",_.bind(function(b){AJS.$(b.currentTarget).tipsy("hide").removeData("tipsy");this.dock(true);b.preventDefault()},this));this.element.delegate(".ui-undock","click",_.bind(function(b){AJS.$(b.currentTarget).tipsy("hide").removeData("tipsy");this.undock(true);b.preventDefault()},this));this.isDocked=this.options.isDocked;this.useTransitions=!jQuery.browser.msie||parseInt(jQuery.browser.version,10)>8;if(this.options.isDocked){this._renderUnDock()}else{this._enableUndockedMode()}this.updateOffsets()}},_getUndockedClasses:function(){return[this.CLASS_NAMES.detached].join(" ")},_getUndockedStates:function(){return[this.CLASS_NAMES.collapsed,this.CLASS_NAMES.collapsing,this.CLASS_NAMES.expanding,this.CLASS_NAMES.expanded].join(" ")},_setUndockedState:function(b){this.element.removeClass(this._getUndockedStates());this.element.addClass(b)},unbindHoverIntent:function(){this.element.off("mouseleave mouseenter mousemove");this.element[0].hoverIntent_s=0},bindHoverIntent:function(){this.element.hoverIntent({interval:40,over:this.expand,out:this.collapse,sensitivity:8})},_unbindUnDockedEvents:function(){this.unbindHoverIntent();JIRA.unbind(AJS.InlineLayer.EVENTS.show,this._handleDropdown);a(window).unbind("scroll",this.updateOffsets)},_bindUnDockedEvents:function(b){this.bindHoverIntent();a(window).scroll(this.updateOffsets);this.element[0].hoverIntent_s=b?1:0},isUndocked:function(){return this.element.hasClass(this.CLASS_NAMES.detached)},_registerMousePos:function(b){this._clientX=b.clientX;this._clientY=b.clientY},_handleDropdown:function(){a(document).mousemove(this._registerMousePos);if(this.isUndocked()&&AJS.InlineLayer.current.offsetTarget().closest(this.element).size()){this.unbindHoverIntent();JIRA.one(AJS.InlineLayer.EVENTS.hide,_.bind(function(){_.defer(_.bind(function(){if(!AJS.InlineLayer.current){if(JIRA.Dialog.current||this._clientX>this.element.offset().left+this.element.outerWidth()){this.collapse(JIRA.Dialog.current?false:true);this.bindHoverIntent()}else{this.bindHoverIntent();this.element[0].hoverIntent_s=1}a(document).unbind("mousemove",this._registerMousePos)}},this))},this))}},updateOffsets:function(f){if(this.element.is(":visible")){var d=a("body").height()>a(window).height();if(d){this.element.addClass("ui-sidebar-scrollable")}else{this.element.removeClass("ui-sidebar-scrollable")}if(this.isUndocked()){var c=this._getPlaceholder().offset().top;var g=jQuery(window).scrollTop();var h=Math.max(c-g,0);var b=d?a(window).height()-h:Math.min(this._getPlaceholder().outerHeight(),a(window).height()-this._getPlaceholder().offset().top);var e={top:h,height:b};if(f){e.width=f}this.element.css(e)}}},_renderUnDock:function(){if(this.isDocked&&!this.element.find(".ui-undock").size()){this.element.find(".ui-dock").remove();this._renderDockingLink(this.options.undockText,this.options.undockTitle,"ui-undock")}},_renderDock:function(){if(this.isUndocked()&&!this.element.find(".ui-dock").size()){this.element.find(".ui-undock").remove();this._renderDockingLink(this.options.dockText,this.options.dockTitle,"ui-dock")}},_renderDockingLink:function(e,d,b){var c=a("<a class='aui-button aui-button-subtle' href='#'/>").addClass(b).append(a("<span class='icon'/>").text(e)).attr("title",d);c.tipsy({trigger:"manual"}).hoverIntent({interval:200,over:function(){AJS.$(this).tipsy("show")},out:function(){AJS.$(this).tipsy("hide")}});this._getContents().find(this.options.toggleTarget).append(c)},renderDockState:function(){if(this.isDocked){this._renderUnDock()}else{this._renderDock()}},_enableUndockedMode:function(b){this.element.addClass(this.CLASS_NAMES.popout);if(!this.isUndocked()){this._getPlaceholder().insertBefore(this.element);this.element.addClass(this.CLASS_NAMES.detached).addClass(this.CLASS_NAMES.collapsed).appendTo("body")}this.updateOffsets();this._bindUnDockedEvents(b);JIRA.bind(AJS.InlineLayer.EVENTS.show,this._handleDropdown)},_getPlaceholder:function(){if(!this.placeholder){this.placeholder=a("<div class='navigator-sidebar collapsed' />")}return this.placeholder},toggle:function(){if(!this.isExpanding()&&!this.isCollapsing()){if(this.isDocked){this.element.find(".ui-undock").tipsy("hide").removeData("tipsy");this.undock(false)}else{this.element.find(".ui-dock").tipsy("hide").removeData("tipsy");this.dock(false)}}},undock:function(b){if(!this.isUndocked()){this.isDocked=false;this.options.persist(false);this._getPlaceholder().insertBefore(this.element);this.element.addClass(this._getUndockedClasses()+" "+this.CLASS_NAMES.expanded).appendTo("body");if(b!==false&&this.useTransitions){this._getPlaceholder().width(this.options.expandedWidth).animate({width:this.options.collapsedWidth},200)}else{this._getPlaceholder().width(this.options.collapsedWidth)}this.updateOffsets(this.options.expandedWidth);this.collapse(b,_.bind(function(){this._enableUndockedMode(false)},this))}},dock:function(b){if(this.isUndocked()){this.isDocked=true;this._unbindUnDockedEvents();this.options.persist(true);if(b!==false&&this.useTransitions){this._getPlaceholder().animate({width:this.options.expandedWidth},200,_.bind(this._dockingComplete,this))}else{this._dockingComplete()}}},_dockingComplete:function(){this.element.removeClass(this._getUndockedClasses());this.element.removeClass(this._getUndockedStates());this.element.css({height:"",width:"",top:""}).insertBefore(this._getPlaceholder());this._getPlaceholder().remove();this.options.renderExpanded(this.element);this._renderUnDock();JIRA.Issues.triggerHorizontalResize()},_getContents:function(){if(!this.element.find(".ui-sidebar-content").size()){this.element.wrapInner("<div class='ui-sidebar-content' />")}return this.element.find(".ui-sidebar-content")},expand:function(b){if(this.isCollapsed()){this.updateOffsets();if(b!==false&&this.useTransitions){this._setUndockedState(this.CLASS_NAMES.expanding);this.element.animate({width:this.options.expandedWidth},150,_.bind(function(){this._setUndockedState(this.CLASS_NAMES.expanded);this.options.renderExpanded(this.element);this._renderDock();this._getContents().css("opacity",0).animate({opacity:1},200,_.bind(this._expandingComplete,this))},this))}else{this.options.renderExpanded(this.element);this._renderDock();this._expandingComplete()}}else{if(this.isCollapsing()){this.activityAfterTransition="expand"}else{if(this.isExpanding()){this.activityAfterTransition=null}}}},_expandingComplete:function(){JIRA.Issues.triggerHorizontalResize();this._bindUnDockedEvents(true);this._setUndockedState(this.CLASS_NAMES.expanded);if(this.activityAfterTransition==="collapse"){this.activityAfterTransition=null;this.collapse(true)}},collapse:function(b,c){if(this.isExpanded()){if(b!==false&&this.useTransitions){this._setUndockedState(this.CLASS_NAMES.collapsing);this._getContents().animate({opacity:0},150,_.bind(function(){this.options.renderCollapsed(this.element);this.element.width(this.options.expandedWidth);this.element.animate({width:this.options.collapsedWidth},150,_.bind(function(){this._collapsingComplete(c)},this))},this))}else{this.options.renderCollapsed(this.element);this.element.width("");this._collapsingComplete(c)}}else{if(this.isExpanding()){this.activityAfterTransition="collapse"}else{if(this.isCollapsing()){this.activityAfterTransition=null}}}},_collapsingComplete:function(b){this._setUndockedState(this.CLASS_NAMES.collapsed);JIRA.Issues.triggerHorizontalResize();this._bindUnDockedEvents(false);if(this.activityAfterTransition==="expand"){this.activityAfterTransition=null;this.expand(true)}if(typeof b==="function"){b()}},isCollapsed:function(){return this.element.hasClass(this.CLASS_NAMES.collapsed)},isCollapsing:function(){return this.element.hasClass(this.CLASS_NAMES.collapsing)},isExpanded:function(){return this.element.hasClass(this.CLASS_NAMES.expanded)},isExpanding:function(){return this.element.hasClass(this.CLASS_NAMES.expanding)}})}(jQuery));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/ResultsScrollingHelper.js' */
AJS.namespace("JIRA.Issues.ResultsScrollingHelper");JIRA.Issues.ResultsScrollingHelper=function(){var b=AJS.$(window),m,d=false,c,a,i,g,k;function l(){m=AJS.$(".results-panel").css({position:"static",visibility:"hidden"});g=AJS.$(".navigator-content");k=m.offset().top;a=AJS.$(window).height();i=a-g.offset().top;m.css({position:"fixed",visibility:""});i=i-parseInt(m.css("bottom"),10);g.height(i)}function j(){AJS.$(window).scrollTop(0);g.scrollTop(c)}function f(){var n=i+jQuery(window).scrollTop();if(n<a-k){g.height(n)}else{g.height(a-k)}}function e(){if(d){return}l();f();j();b.resize(l);b.scroll(f);d=true}function h(){if(d){var n=g.scrollTop();b.unbind("resize",l).unbind("scroll",f);m.css({position:"",visibility:""});g.css({height:""});AJS.$(window).scrollTop(n);d=false}}return{setup:function(n){n.bind("beforeIssueRequest",function(){c=AJS.$(window).scrollTop()}).bindIssueLoaded(e).bind("issueDismissed",h)}}}();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/HtmlCatchExceptions.js' */
(function(b){var a=function(c){return function(d){try{c.apply(this,arguments)}catch(f){if(console&&console.error&&typeof d==="string"){console.error("Error while evaluating HTML: "+f.message+", in: ",d)}}return this}};b.fn.htmlCatchExceptions=a(b.fn.html);b.fn.appendCatchExceptions=a(b.fn.append);b.fn.prependCatchExceptions=a(b.fn.prepend);b.catchExceptions=function(c){return b("<div>").htmlCatchExceptions(c).children()}})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/ScrollLock.js' */
(function(b){var a=30;b.fn.scrollLock=function(c,d){if(typeof c!=="string"){d=c;c=null}if(!d){d=a}this.on("DOMMouseScroll mousewheel",c,function(f){f.preventDefault();var g;if(f.originalEvent.wheelDelta){g=f.originalEvent.wheelDelta/120}if(f.originalEvent.detail){g=-f.originalEvent.detail/3}this.scrollTop-=g*d})}})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/mixin/SingleSelect.js' */
AJS.namespace("JIRA.Issues.Mixin.SingleSelect");JIRA.Issues.Mixin.SingleSelect={properties:["collection"],selectById:function(a){this.setSelected(this.getCollection().get(a))},selectAt:function(a){this.setSelected(this.getCollection().at(a))},clearSelection:function(){this.setSelected()},next:function(){var d=this.getSelected(),c=this.getCollection();if(!d){if(c.length>0){this.setSelected(c.first())}}else{var b=c.indexOf(d);var a=(b+1)%c.length;this.setSelected(c.at(a))}},prev:function(){var d=this.getSelected(),c=this.getCollection();if(!d){if(c.length>0){this.setSelected(c.last())}}else{var b=c.indexOf(d);var a=(b+c.length-1)%c.length;this.setSelected(c.at(a))}}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/mixin/LoadingClass.js' */
AJS.namespace("JIRA.Issues.Mixin.LoadingClass");JIRA.Issues.Mixin.LoadingClass={addLoadingClass:function(){this.$el.addClass("loading")},removeLoadingClass:function(){this.$el.removeClass("loading")}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/search/PageTitleView.js' */
AJS.namespace("JIRA.Issues.Mixin.PageTitleView");JIRA.Issues.Mixin.PageTitleView={initialize:function(){this._initialPageTitle=this._getDocumentTitle()},updatePageTitle:function(a){this._setDocumentTitle(a)},prependToPageTitle:function(b,c){var a=c?" ":"";this.updatePageTitle(b+a+this._getDocumentTitle())},appendToPageTitle:function(b,c){var a=c?" ":"";this.updatePageTitle(this._getDocumentTitle()+a+b)},restorePreviousPageTitle:function(){this._setDocumentTitle(this._initialPageTitle)},_getDocumentTitle:function(){return document.title},_setDocumentTitle:function(a){document.title=a}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/search/query/basic/SearcherDialog.js' */
JIRA.Issues.SearcherDialog=function(){return{initialize:function(b){if(!this.instance){this.instance=a(b)}}};function a(e){AJS.HIDE_REASON.switchLozenge="switchLozenge";var f=[AJS.HIDE_REASON.escPressed,AJS.HIDE_REASON.toggle,AJS.HIDE_REASON.cancelClicked,AJS.HIDE_REASON.submit,AJS.HIDE_REASON.tabbedOut];function d(i){return i?jQuery(".criteria-selector[data-id='"+i.getId()+"']"):jQuery()}var h;var c;var b;var g=new AJS.InlineLayer({width:"auto",alignment:AJS.LEFT,offsetTarget:function(){return d(c)},content:function(){b=new JIRA.Issues.SearcherEditDialogView({model:c});b.bindHideRequested(function(i){g.hide(i)});return b.renderDeferred()}});g.bind(AJS.InlineLayer.EVENTS.show,function(k,i){var j=i.find(":input:not(submit):visible:first");j.focus();if((AJS.$.browser.msie&&parseInt(AJS.$.browser.version,10)<9)){j.focus()}i.find(".aui-list-scroll").scrollTop(0)});g.bind(AJS.InlineLayer.EVENTS.beforeHide,function(l,j,k,m,i){if(k===AJS.HIDE_REASON.clickOutside&&i&&jQuery(i).closest(".calendar").length){l.preventDefault()}});g.bind(AJS.InlineLayer.EVENTS.hide,function(l,i,k){var j=c;if(_.contains(f,k)){d(j).focus()}if(k!==AJS.HIDE_REASON.cancelClicked&&k!==AJS.HIDE_REASON.escPressed&&k!==AJS.HIDE_REASON.tabbedOut){if(b.applyFilter()){h=c.createOrUpdateClauseWithQueryString();h.done(function(){if(j.hasErrorInEditHtml()){if(e.getSearchMode()==="basic"){JIRA.Issues.SearcherDialog.instance.show(j)}}if(AJS.InlineLayer.current){AJS.InlineLayer.current.setPosition()}});h.always(function(){h=null});j.clearEditHtml()}}else{JIRA.trace("jira.search.searchers.hiddenWithoutUpdate")}b.$el.remove();b=null;c=null});e.on("change:searchMode",function(){g.hide()});return{getCurrentSearcher:function(){return c},toggle:function(i){if(c!=null){if(c!==i){g.hide(AJS.HIDE_REASON.switchLozenge);this.show(i)}else{g.hide(AJS.HIDE_REASON.toggle)}}else{this.show(i)}},_show:function(i){_.defer(function(){c=i;g.show();g.setPosition()})},show:function(k){var j;if(JIRA.Issues.SearcherDialog.waitingToShow){j=true}var i=this;JIRA.Issues.SearcherDialog.waitingToShow=function(){i._show(k);JIRA.Issues.SearcherDialog.waitingToShow=null};if(!j){k.searchersReady().done(function(){if(h){h.done(function(){JIRA.Issues.SearcherDialog.waitingToShow()})}else{JIRA.Issues.SearcherDialog.waitingToShow()}})}},onShow:function(i){g.bind(AJS.InlineLayer.EVENTS.show,i)},hide:function(){g.hide()},onHide:function(i){g.bind(AJS.InlineLayer.EVENTS.hide,i)}}}}();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/QueryStringParser.js' */
AJS.namespace("JIRA.Issues.QueryStringParser");JIRA.Issues.QueryStringParser={parser:/(?:^|&)([^&=]*)=?([^&]*)/g,parse:function(b){if(!b&&b!==0){return{}}b=""+b;if("?"===b.charAt(0)){b=b.substring(1)}var a={};b.replace(this.parser,function(d,c,f){var e=decodeURIComponent((f||"").replace(/\+/g," "));a[decodeURIComponent(c)]=e});return a}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/IssueEventBus.js' */
JIRA.Issues.IssueEventBus=JIRA.Issues.BaseModel.extend({properties:["issueId"],namedEvents:["save","saveSuccess","savingStarted","saveError","panelRendered","replacedFocusedPanel","fieldSubmitted","dismiss","refreshIssue","issueRefreshed","updateFromDom","updateStatusColor","quickEditKeyPressed","openFocusShifter"]});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/DefaultMessageOptions.js' */
AJS.namespace("JIRA.Issues.getDefaultMessageOptions",window,function(){return{closeable:true,timeout:5}});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/viewissue/model/IssuePanelModel.js' */
Backbone.define("JIRA.Issues.IssuePanelModel",JIRA.Issues.BaseModel.extend({properties:["entity","updateLocked"],namedEvents:["updated"],initialize:function(){JIRA.bind(JIRA.Events.LOCK_PANEL_REFRESHING,_.bind(function(a,b){if(b===this.getEntity().id){this.setUpdateLocked(true)}},this));JIRA.bind(JIRA.Events.UNLOCK_PANEL_REFRESHING,_.bind(function(a,b){if(b===this.getEntity().id){this.setUpdateLocked(false)}},this))},applyUpdates:function(f,b,e,c){if((AJS.$.browser.msie&&parseInt(AJS.$.browser.version,10)<9)&&f.text()===b.text()){return false}var d,a,g=[];var h=_.any(c,function(i){return b.find(JIRA.Issues.IssueFieldUtil.getFieldSelector(i)).length===1});if(!h){a=f;d="replace";g.push(f)}else{_.each(e,function(k){var j=b.find(JIRA.Issues.IssueFieldUtil.getFieldSelector(k));if(j.length===1){var i=f.find(JIRA.Issues.IssueFieldUtil.getFieldSelector(k));if(i.length===1){j.replaceWith(i);g.push(i)}else{j.closest("li, dl").remove()}}});d="update";a=b}return{type:d,$existing:b,$el:a,updates:g}},update:function(a,b){if(!this.getUpdateLocked()){this.setEntity(a);this.triggerUpdated(b)}},getPanelId:function(){return(this.getEntity().prefix||"")+this.getEntity().id}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/viewissue/model/IssuePanelsModel.js' */
Backbone.define("JIRA.Issues.IssuePanelsModel",JIRA.Issues.BaseModel.extend({properties:["leftPanels","rightPanels","infoPanels"],namedEvents:["panelRemoved","panelAdded"],initialize:function(){this.set({leftPanels:[],rightPanels:[],infoPanels:[]},{silent:true})},update:function(b,a){this.updatePanels("leftPanels",b.leftPanels,a);this.updatePanels("rightPanels",b.rightPanels,a);this.updatePanels("infoPanels",b.infoPanels,a)},updatePanels:function(g,b,d){var i=this;var j=this.get(g);var f=[];var a=d.changed;if(a){var c=a.updated&&a.updated.panels?a.updated.panels[g]:[];var e=a.added&&a.added.panels?a.added.panels[g]:[];var k=a.deleted&&a.deleted.panels?a.deleted.panels[g]:[];if(!_.isEmpty(k)){_.each(j,function(m){var l=m.getEntity().id;if(_.contains(k,l)){i.triggerPanelRemoved({location:g,panel:m})}})}_.each(b,function(m,n){var o=m.id;if(_.contains(e,o)){var l=new JIRA.Issues.IssuePanelModel({id:m.id,entity:m});if(!d.initialize){i.triggerPanelAdded({location:g,panel:l,index:n},b)}f.push(l)}else{if(!_.contains(k,o)){var p=_.find(j,function(q){return q.id===o});if(_.contains(c,o)){p.update(m,d)}f.push(p)}}})}else{_.each(j,function(m){var l=m.getEntity().id;if(!_.any(b,function(n){return n.id===l})){i.triggerPanelRemoved({location:g,panel:m})}});_.each(b,function(m,n){var l=_.find(j,function(o){return o.id===m.id});if(l){l.update(m,d)}else{l=new JIRA.Issues.IssuePanelModel({id:m.id,entity:m});if(!d.initialize){i.triggerPanelAdded({location:g,panel:l,index:n},b)}}f.push(l)})}var h={};h[g]=f;this.set(h,{silent:true})},createPlaceholderModel:function(d,c){var b,a=this.get(d);if(!_.any(a,function(e){return e.id===c})){b=new JIRA.Issues.IssuePanelModel({id:c,entity:{id:c}});a.push(b);return b}}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/viewissue/model/IssueViewModel.js' */
Backbone.define("JIRA.Issues.IssueViewModel",JIRA.Issues.BaseModel.extend({namedEvents:["updated"],properties:["entity","id","issueEventBus","issuePagerModel","panels","pager","standalone","statusColorSupport","splitViewMode"],defaults:function(){return{splitViewMode:false}},initialize:function(){_.bindAll(this);this.set({panels:new JIRA.Issues.IssuePanelsModel()});if(this.getStatusColorSupport()){this.on("change",_.bind(function(){this.getIssueEventBus().triggerUpdateStatusColor()},this))}},isStandalone:function(){return jQuery("body").hasClass("standalone-viewissue")},update:function(b,a){this.setEntity(b.issue);this.getPanels().update(b.panels,a);this.triggerUpdated(a)},updateFromDom:function(a){this.setEntity(a)},getStatusClass:function(){return JIRA.Issues.StatusUtil.getClass(this.getEntity().status)},dismiss:function(){this.getIssueEventBus().triggerDismiss()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/viewissue/model/IssuePagerModel.js' */
Backbone.define("JIRA.Issues.IssuePagerModel",JIRA.Issues.BaseModel.extend({properties:["pager"],namedEvents:["returnToSearch"],update:function(a){this.set("pager",a)}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/pigsty/StatusUtilPiggy.js' */
AJS.namespace("JIRA.Issues.StatusUtil");JIRA.Issues.StatusUtil={getClass:function(a){return"status-"+a.name.toLowerCase().replace(/\s/g,"")}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/SessionTimedOutDialog.js' */
AJS.namespace("JIRA.Issues.SessionTimedOutDialog");JIRA.Issues.SessionTimedOutDialog={dialogHasShown:false,whiteList:["/secure/Search!Jql.jspa","/secure/SearchRendererEdit!Default.jspa","/rest/issueNav/1/issueTable","/rest/issueNav/latest","/rest/api/2/filter"],onRequestResponse:function(f,g,d){if(!this.dialogHasShown&&this.urlIsInWhiteList(d.url)){var b=JIRA.Issues.LoginUtils.loggedInUserName(),a=g.getResponseHeader("X-AUSERNAME");if(this.userHasChanged(b,a)){this.dialogHasShown=true;var c=new JIRA.FormDialog({content:AJS.$(JIRA.Templates.Issues.Util.anonymousErrorDialog({modifierKey:AJS.Navigator.modifierKey(),redirect:window.location.href.substring(window.location.href.indexOf(contextPath)+contextPath.length)}))});c.show()}}},userHasChanged:function(b,a){if(b===""&&a==="anonymous"){return false}if(b===""&&a&&a!=="anonymous"&&a!==""){return false}if(b!==""&&a==="anonymous"){return true}return false},urlIsInWhiteList:function(b){for(var c=0;c<this.whiteList.length;c++){var a=this.whiteList[c];if(b.indexOf(a)>-1){return true}}return false}};(function(a){a(document).ajaxComplete(function(c,d,b){JIRA.Issues.SessionTimedOutDialog.onRequestResponse(c,d,b)})})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/LoginUtils.js' */
JIRA.Issues.LoginUtils={isLoggedIn:function(){return !!this.loggedInUserName()},loggedInUserName:function(){return AJS.Meta.get("remote-user")},currentContextRelativePath:function(){var b=this._getWindowLocation();var c=b.protocol+"//"+b.host+(contextPath||"");var a=b.href;if(a.indexOf(c)===0){return a.substr(c.length)}return a},redirectUrlToCurrent:function(){var a=this.currentContextRelativePath();return contextPath+"/login.jsp?os_destination="+encodeURIComponent(a)},redirectUrl:function(a){return contextPath+"/login.jsp?os_destination="+encodeURIComponent(a)},_getWindowLocation:function(){return window.location}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/ConcurrentDeferred.js' */
jQuery.ConcurrentDeferred=function(c){var b=jQuery.Deferred();var d;var a=function(e){d=e;e.done(function(){if(d===e){b.resolve.apply(b,arguments)}}).fail(function(){if(d===e){b.reject.apply(b,arguments)}})};a(c);jQuery.extend(b,{update:function(e){if(!this.isPending()){throw"Cannot update non-pending ConcurrentDeferred"}var f=d;a(e);if(jQuery.isFunction(f.abort)){f.abort()}return this},isPending:function(){return this.state()==="pending"}});return b};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/RecurringPromise.js' */
jQuery.RecurringPromise=function(a){if(!(this instanceof jQuery.RecurringPromise)){return new jQuery.RecurringPromise()}this._parent=a;this._doneCallbacks=jQuery.Callbacks();this._failCallbacks=jQuery.Callbacks();this._alwaysCallbacks=jQuery.Callbacks()};jQuery.RecurringPromise.prototype={add:function(b){var a=jQuery.Deferred();a.original=b;var c=this._getPending();this._setPending(a);this._abortIfPending(c);b.done(_.bind(function(){if(this._getPending()===a){this._getPending().resolveWith(this,arguments);this._doneCallbacks.fireWith(this,arguments)}},this));b.fail(_.bind(function(){if(this._getPending()===a){this._getPending().rejectWith(this,arguments);this._failCallbacks.fireWith(this,arguments)}},this));b.always(_.bind(function(){if(this._getPending()===a){this._alwaysCallbacks.fireWith(this,arguments)}},this));return a.promise()},done:function(a){this._doneCallbacks.add(a);return this},fail:function(a){this._failCallbacks.add(a);return this},always:function(a){this._alwaysCallbacks.add(a);return this},reset:function(){this._abortIfPending(this._getPending());this._setPending(null)},sub:function(){return new jQuery.RecurringPromise(this)},_getPending:function(){return this._parent?this._parent._getPending():this._pending},_setPending:function(a){if(this._parent){this._parent._setPending(a)}else{this._pending=a}},_abortIfPending:function(a){if(a&&a.state()==="pending"){a.reject("abort");if(jQuery.isFunction(a.original.abort)){a.original.abort()}}}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/AsyncData.js' */
Backbone.define("JIRA.Issues.AsyncData",JIRA.Issues.BaseEvented.extend({namedEvents:["change"],initialize:function(a){this.data={};this.pendings={};this.accessIndex=0;if(a){this.disableCache=a.disableCache;this.maxCacheSize=a.maxCacheSize}},get:function(b,a,i){var g=jQuery.Deferred();var d=this.disableCache?{}:this.data;var f=_.bind(function(m,l){var k=this._set(d,b,_.defaults(m,{accessIndex:this.accessIndex++}),true,i);var j=_.defaults({changed:k},l,d[b]);if(i&&i.mergeIntoCurrent){j.mergeIntoCurrent=true}if(d[b]&&!d[b].error){g.resolve(d[b].value,j,i)}else{g.reject(d[b]&&d[b].value,j,i)}},this);var c=_.bind(function(j){var k=this.fetch(b,i);this.setPending(b,k,function(l){f({value:l,error:false,updated:new Date()},{initialLoad:j})},function(l){var m={error:true,updated:new Date()};if(l!==undefined){m.value=l}f(m,{initialLoad:j,error:true})})},this);var e=function(){f({},{fromCache:true})};var h=_.bind(function(){this.pendings[b].always(_.bind(f,this,{},{initialLoad:true}))},this);if(a||this.disableCache){c(false)}else{if(this.hasCached(b)){e()}else{if(this.hasPending(b)){h()}else{c(true)}}}return g.promise()},setPending:function(d,b,a,c){if(this.hasPending(d)){this.pendings[d].update(b)}else{this.pendings[d]=jQuery.ConcurrentDeferred(b)}return this.pendings[d].done(function(e){a(e)}).fail(function(e){c(e)})},getIdByValue:function(a){var b;for(b in this.data){if(this.data[b].value===a){return b}}return null},getMeta:function(a){return this.data[a]||{}},getAllCached:function(){var a={};_.each(this.data,function(b,c){a[c]=b.value});return a},hasCached:function(b){var a=this.getMeta(b);return a.value!==undefined||a.error===true},hasError:function(b){var a=this.getMeta(b);return a.error===true},hasPending:function(b){var a=this.pendings[b];return a?a.isPending():false},set:function(b,a){return this._set(this.data,b,{value:a,updated:new Date()},true)},remove:function(a){if(this.data[a]){delete this.data[a];this.triggerChange();return true}return false},setError:function(c,a){var b={error:true,updated:new Date()};if(a!==undefined){b.value=a}return this._set(this.data,c,b,true)},setMultiple:function(b){var a=new Date();var c=false;_.each(b,_.bind(function(d,e){d=_.pick(d,"value","error");d.updated=a;if(this._set(this.data,e,d,false)){c=true}},this));if(c){this.triggerChange()}return c},reset:function(a){this.data={};this.pendings={};this.accessIndex=0;if(a){this.setMultiple(a)}else{this.triggerChange()}},_set:function(e,g,f,c,b){if(this.disableCache&&e===this.data){e={}}var d=e[g]?_.clone(e[g]):{};var a=this.mergeFetchedAndCached(d,f,b?b:{},e[g]);if(c&&(!e[g]||a||e[g].error!==d.error)&&e===this.data){this.triggerChange()}if(!e[g]&&this.maxCacheSize&&_.keys(e).length===this.maxCacheSize){if(f.accessIndex){this._dropItem(e);e[g]=d}}else{e[g]=d}return a},_dropItem:function(c){var a=null;for(var b in c){if(!c[b].accessIndex){a=b;break}else{if(a===null||c[b].accessIndex<c[a].accessIndex){a=b}}}if(a!==null){delete c[a]}},fetch:function(d,b){var c=this.getMeta(d);var a=jQuery.Deferred();if(!this.hasCached(d)||c.error){a.reject(c.value)}else{a.resolve(c.value)}return a.promise()},mergeFetchedAndCached:function(b,d,a,c){_.extend(b,d);return !c||c.value!==b.value||c.error!==b.error}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/search/cache/IssueCacheManager.js' */
(function(){Backbone.define("JIRA.Issues.Cache.IssueCacheManager",JIRA.Issues.BaseEvented.extend({initialize:function(a){this.searchResults=a.searchResults;this.viewIssueData=a.viewIssueData;this.searchResults.bind("issueDeleted",this._onIssueDeleted,this);this.searchResults.bind("nextIssueSelected",this._onNextIssueSelected,this);this.searchResults.bind("prevIssueSelected",this._onPrevIssueSelected,this);this._prefetchCandidate=null},prefetchIssues:function(){if(this._prefetchCandidate&&this._prefetchCandidate.key){this._prefetchIssue(this._prefetchCandidate.key);this._prefetchCandidate=null}},scheduleIssueToBePrefetched:function(a){this._prefetchCandidate=a},_onIssueDeleted:function(a){this.viewIssueData.remove(a.key)},_onNextIssueSelected:function(a){this._prefetchCandidate=a.nextNextIssue},_onPrevIssueSelected:function(a){this._prefetchCandidate=a.prevPrevIssue},_prefetchIssue:function(a){if(!JIRA.Issues.DarkFeatures.NO_PREFETCH.enabled()){this.viewIssueData.get(a,false,{prefetch:true})}}}))})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/search/issue/IssueModule.js' */
Backbone.define("JIRA.Issues.IssueModule",JIRA.Issues.BaseEvented.extend({namedEvents:["issueRequested","loadComplete","loadError","returnToSearch","issueViewUpdated","saveSuccess","fieldSubmitted","replacedFocusedPanel"],initialize:function(a){_.bindAll(this);this.searchPageModule=a.searchPageModule;this.viewIssueController=new JIRA.Issues.ViewIssueController({saveInProgressManager:a.saveInProgressManager,viewIssueContext:a.container},{viewIssueData:a.viewIssueData});this.viewIssueController.bindIssueRequested(this.triggerIssueRequested);this.viewIssueController.bindIssueLoaded(this.triggerLoadComplete);this.viewIssueController.bindIssueError(this.triggerLoadError);this.viewIssueController.bindIssueRequested(this.triggerIssueRequested);this.viewIssueController.bindIssueViewUpdated(this.triggerIssueViewUpdated);this.viewIssueController.bindReturnToSearch(this.triggerReturnToSearch);this.viewIssueController.bindSaveSuccess(this.triggerSaveSuccess);this.viewIssueController.bindFieldSubmitted(this.triggerFieldSubmitted);this.viewIssueController.bindReplacedFocusedPanel(this.triggerReplacedFocusedPanel)},abortIfUpdatePending:function(){this.viewIssueController.loadingPromiseManager.reset()},abortPending:function(){this.viewIssueController.cancelLoad()},canDismissComment:function(){return this.viewIssueController.canDismissComment()},beforeHide:function(){this.viewIssueController.hideLightbox();this.viewIssueController.hideDropdown();this.viewIssueController.hideFocusShifterTip();this.viewIssueController.cancelLoad();this.viewIssueController.setSkipSaveIssueSuccessHandler(true);this.removeIssueMetadata()},beforeShow:function(){this.addIssueMetadata()},_getIssueEntity:function(){var a=this.viewIssueController.getViewIssueModel();return a&&a.getEntity()},getIssueId:function(){var a=this._getIssueEntity();return a&&a.id||null},getIssueKey:function(){var a=this._getIssueEntity();return a&&a.key||null},loadIssue:function(b){var a=AJS.$("#key-val"),d=AJS.Meta.get("serverRenderedViewIssue");if(d){this.viewIssueController.applyToDom({id:a.attr("rel")||b.id||-1,key:a.text()||b.key});if(!b.id||b.id===-1){this._createIssueDoesNotExistView(AJS.$(".issue-body-content"))}AJS.Meta.set("serverRenderedViewIssue",null);_.defer(_.bind(function(){this._bringViewIssueElementIntoView(b.viewIssueQuery)},this));var c={id:this.getIssueId()};JIRA.trace("jira.issue.refreshed",c);JIRA.trace("jira.psycho.issue.refreshed",c);return jQuery.Deferred().resolve().promise()}else{b=_.extend({},b,{bringToFocus:_.bind(function(){this._bringViewIssueElementIntoView(b.viewIssueQuery)},this)});return this.viewIssueController.load(b)}},renderIssueDoesNotExist:function(a){this._createIssueDoesNotExistView(a).render()},_createIssueDoesNotExistView:function(a){return new JIRA.Issues.IssueMissingErrorView({el:a,searchPageModule:this.searchPageModule})},updateIssuePager:function(a){this.viewIssueController.updatePager(a)},openFocusShifter:function(){var a=this.viewIssueController.getViewIssueModel();a.getIssueEventBus().triggerOpenFocusShifter()},refreshIssue:function(b){var a=AJS.$.Deferred();this.viewIssueController.getViewIssueModel().getIssueEventBus().triggerRefreshIssue({error:a.reject,success:a.resolve,reason:b});return a.promise()},removeIssueMetadata:function(){this.viewIssueController.removeIssueMetadata()},addIssueMetadata:function(){this.viewIssueController.addIssueMetadata()},setContainer:function(a){this.viewIssueController.changeViewIssueContext(a)},getLoading:function(){return this.viewIssueController.loading},isCurrentlyLoading:function(){return this.viewIssueController.isCurrentlyLoading()},getUpdating:function(){return this.viewIssueController.updating},updateIssueWithQuery:function(a){this.viewIssueController.updateIssueWithQuery(a)},_bringViewIssueElementIntoView:function(a){if(a){var b;if(a.focusedCommentId){b="#comment-"+a.focusedCommentId}else{if(a.attachmentSortBy||a.attachmentOrder){b="#attachmentmodule"}}if(b){AJS.$(b).scrollIntoView({marginBottom:200,marginTop:200})}}},dismiss:function(){this.viewIssueController.dismiss()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/search/issue/SimpleIssue.js' */
Backbone.define("JIRA.Issues.SimpleIssue",JIRA.Issues.BaseModel.extend({properties:["id","key"],defaults:{id:null,key:null},hasIssue:function(){return !!this.getId()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/search/issue/FullScreenIssue.js' */
Backbone.define("JIRA.Issues.FullScreenIssue",JIRA.Issues.BaseView.extend({namedEvents:["issueHidden"],initialize:function(a){_.extend(this,a);_.bindAll(this);if(this.issueContainer.hasClass("hidden")){this.issueContainer.detach();this.issueContainer.removeClass("hidden")}if(this.searchContainer.hasClass("hidden")){this.searchContainer.detach();this.searchContainer.removeClass("hidden")}},deactivate:function(){if(this.active){if(this.stalker){this.stalker.unstalk()}this.issueModule.unbindLoadComplete(this.onLoadComplete);this.issueModule.unbindLoadError(this.showError);this.issueModule.abortIfUpdatePending();this.active=false}},activate:function(){if(!this.active){this.issueModule.bindLoadComplete(this.onLoadComplete);this.issueModule.bindLoadError(this.showError);this.active=true}},onLoadComplete:function(a,b){this.stalker=AJS.$(".js-stalker",this.issueContainer).stalker();this._makeIssueVisible();if(b.isNewIssue){this._scrollToTop()}},_makeIssueVisible:function(){this.issueModule.beforeShow();this._setBodyClasses({error:false,issue:true,search:true});if(!this.isVisible()){this.issueContainer.insertBefore(this.searchContainer);this.searchContainer.detach();JIRA.trace("jira.psycho.issue.refreshed",{id:this.issueModule.getIssueId()});JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.issueContainer,JIRA.CONTENT_ADDED_REASON.pageLoad])}},updateIssue:function(c){var a=jQuery.Deferred().resolve().promise(),b=c.key==this.issueModule.getIssueKey();if(this.isVisible()){a=this.issueModule.refreshIssue(c);a.done(function(){if(!b&&c.message){JIRA.Issues.showNotification(c.message,c.key)}})}return a},showError:function(a){if(!this.isVisible()){JIRA.Messages.showErrorMsg(AJS.format("{0} can not be opened. The issue may have been deleted or you might not have permission to see the issue.",a.issueKey),{closeable:true})}else{this._setBodyClasses({error:true,issue:false,search:false})}},bindLoadComplete:function(b,a){this.issueModule.bindLoadComplete(b,a);this.issueModule.bindLoadError(b,a)},isVisible:function(){return this.issueContainer.closest("body").length>0},_scrollToTop:function(){AJS.$(window).scrollTop(0)},_setBodyClasses:function(a){AJS.$("body").toggleClass("page-type-message",a.error).toggleClass("navigator-issue-only",a.issue).toggleClass("page-type-navigator",a.search)},hide:function(){this._setBodyClasses({error:false,issue:false,search:true});if(this.isVisible()){this.searchContainer.insertBefore(this.issueContainer);this.issueContainer.detach()}this.trigger("issueHidden")},updatePager:function(a){this.issueModule.updateIssuePager(a)},show:function(a){this.activate();if(!AJS.Meta.get("serverRenderedViewIssue")){this.issueContainer.find("#issue-content").remove()}this.issueModule.setContainer(this.issueContainer);return this.issueModule.loadIssue(a).always(_.bind(function(){this.updatePager(a.pager);this.issueCacheManager.prefetchIssues()},this))}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/search/issue/ViewIssueData.js' */
Backbone.define("JIRA.Issues.ViewIssueData",JIRA.Issues.AsyncData.extend({initialize:function(a){JIRA.Issues.AsyncData.prototype.initialize.call(this,_.defaults(a||{},{disableCache:JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()||JIRA.Issues.DarkFeatures.NO_PREFETCH.enabled(),maxCacheSize:+AJS.Meta.get("viewissue-max-cache-size")}))},fetch:function(e,d){var h={issueKey:e,decorator:"none",prefetch:!!d.prefetch};if(d.mergeIntoCurrent){if(this.data&&this.data[e]&&this.data[e].value&&this.data[e].value.issue){h.lastReadTime=this.data[e].value.readTime;h.fields=[];_.each(this.data[e].value.fields,function(i){h.fields.push(i.id+":"+i.contentId)});h.issue=["summary:"+this.data[e].value.issue.summaryContentId];h.links=[];var g=function(i){_.each(i.links,function(j){h.links.push(j.id+":"+j.contentId)});_.each(i.groups,function(j){g(j)})};_.each(this.data[e].value.issue.operations.linkGroups,function(i){g(i)});h.panels=[];var a=this;var b=function(i){_.each(a.data[e].value.panels[i],function(j){h.panels.push(j.completeKey+":"+j.contentId)})};b("leftPanels");b("rightPanels");b("infoPanels")}}if("loadFields" in d){h.loadFields=d.loadFields}if(d.issueEntity){_.defaults(h,d.issueEntity.viewIssueQuery)}var f=jQuery.ajax({url:contextPath+"/secure/IssueAction!default.jspa",headers:{"X-SITEMESH-OFF":true},data:h,type:d.mergeIntoCurrent?"POST":"GET"});var c=f.pipe(function(i){return i},function(i){return _.pick(i,"status","responseText","statusText")});c.abort=function(){f.abort.apply(f,arguments)};return c},mergeFetchedAndCached:function(l,m,d){if(this._skipMerging(l,m,d)){_.extend(l,m);return null}_.each(_.pairs(m),function(s){if(s[0]!=="value"){l[s[0]]=s[1]}});var q=m.value;var k=[];var b=[];var h=[];_.each(q.removedContentIds,function(u,t){var s;if(t==="fields"){s=k}else{if(t==="panels"){s=b}else{if(t==="links"){s=h}}}if(s){_.each(u,function(v){s.push(v)})}});var g=q.fields;var e=q.issue.operations.linkGroups;var o=q.panels;var j=q.issue.summary;if(this._nothingChanged(k,b,h,g,o,e,j)){this._sendAnalyticsEvent(false,false,false,false);return null}var p={updated:{},added:{},deleted:{}};var i=l.value;var f=this._comparator;var c=false;var n=false;var a=false;var r=false;if(k.length>0||g.length>0){this._mergeFields(g,i,p,k);c=true}if(b.length>0||o.leftPanels.length>0||o.rightPanels.length>0||o.infoPanels.length>0){this._mergePanels(o,i,p,b,f);n=true}if(h.length>0||e.length>0){this._mergeLinks(e,i,p,h,f);a=true}if(j){this._mergeSummary(q,i,p);r=true}this._sendAnalyticsEvent(c,n,a,r);return p},_skipMerging:function(c,b,a){return _.isEmpty(c)||!a.mergeIntoCurrent||!c.value||!c.value.issue||b.error===true},_nothingChanged:function(e,a,g,b,d,c,f){return e.length==0&&a.length==0&&g.length==0&&b.length==0&&c.length==0&&d.leftPanels.length==0&&d.rightPanels.length==0&&d.infoPanels.length==0&&!f},_sendAnalyticsEvent:function(c,b,a,d){JIRA.Issues.Analytics.trigger("kickass.conditionalLoading",{fieldsChanged:c,panelsChanged:b,linksChanged:a,summaryChanged:d})},_mergeFields:function(c,e,d,a){d.added.fields=[];d.updated.fields=[];d.deleted.fields=[];_.each(c,function(f){var g=_.find(e.fields,function(h){return h.id==f.id});if(g){d.updated.fields.push(f.id)}else{d.added.fields.push(f.id)}});var b=c;_.each(e.fields,function(f){if(_.contains(a,f.id)){d.deleted.fields.push(f.id)}else{if(!_.contains(d.updated.fields,f.id)){b.push(f)}}});e.fields=b},_mergeSummary:function(c,b,a){a.updated.issue=["summary"];b.issue.summary=c.issue.summary;b.issue.summaryContentId=c.issue.summaryContentId},_mergePanels:function(e,d,c,a,b){c.added.panels={};c.updated.panels={};c.deleted.panels={};var f=function(g){c.added.panels[g]=[];c.updated.panels[g]=[];c.deleted.panels[g]=[];_.each(e[g],function(i){var j=_.find(d.panels[g],function(k){return k.id==i.id});if(j){c.updated.panels[g].push(i.id)}else{c.added.panels[g].push(i.id)}});var h=e[g];_.each(d.panels[g],function(i){if(_.contains(a,i.completeKey)){c.deleted.panels[g].push(i.id)}else{if(!_.contains(c.updated.panels[g],i.id)){h.push(i)}}});h.sort(b);d.panels[g]=h};f("leftPanels");f("rightPanels");f("infoPanels")},_mergeLinks:function(e,d,c,a,b){c.added.groups={};c.updated.groups={};c.deleted.groups={};var f=[];this._mergeOperationsLinks(e,d,f,c,a,b);this._mergeToolsLinks(e,d,f,c,a,b);d.issue.operations.linkGroups=f},_mergeOperationsLinks:function(j,d,c,a,k,b){a.added.groups["view.issue.opsbar"]=[];a.updated.groups["view.issue.opsbar"]=[];a.deleted.groups["view.issue.opsbar"]=[];var i=_.find(d.issue.operations.linkGroups,function(l){return"view.issue.opsbar"===l.id});var h=_.find(j,function(l){return"view.issue.opsbar"===l.id});var g={};var e={};if(h){_.each(h.groups,function(l){var m=_.find(i.groups,function(o){return l.id===o.id});if(m){a.updated.groups["view.issue.opsbar"].push(l.id)}else{a.added.groups["view.issue.opsbar"].push(l.id)}_.each(l.links,function(o){g[o.id]=o;e[o.id]=l.id});if(l.groups&&l.groups.length>0){var n=l.groups[0];_.each(n.groups,function(o){_.each(o.links,function(p){g[p.id]=p;e[p.id]=o.id})})}})}if(i){var f=[];if(h){_.each(h.groups,function(l){if(_.contains(a.added.groups["view.issue.opsbar"],l.id)){f.push(l)}})}_.each(i.groups,function(q){var p=[];var m=null;if(h){m=_.find(h.groups,function(t){return q.id===t.id});if(m){_.each(m.links,function(t){var u=_.find(q.links,function(v){return t.id===v.id});if(!u){p.push(t)}})}}var n=false;var l=function(u,t){_.each(u.links,function(v){var w=e[v.id];if(w&&w!==u.id){n=true}else{if(g[v.id]){t.push(g[v.id])}else{if(!_.contains(k,v.id)){t.push(v)}else{n=true}}}})};l(q,p);p.sort(b);q.links=p;var o=null;if(m&&m.groups&&m.groups.length>0){o=m.groups[0]}var s=null;if(q.groups&&q.groups.length>0){s=q.groups[0];var r=[];if(o){_.each(o.groups,function(t){var u=_.find(s.groups,function(v){return t.id===v.id});if(!u){r.push(t)}})}_.each(s.groups,function(v){var u=[];if(o){var t=_.find(o.groups,function(w){return w.id===v.id});if(t){_.each(t.links,function(w){var x=_.find(v.links,function(y){return w.id===y.id});if(!x){u.push(w)}})}}l(v,u);if(u.length>0){u.sort(b);v.links=u;r.push(v)}});if(r.length>0){r.sort(b);s.groups=r}else{s=null;n=true}}else{if(o){s=m.groups[0]}}q.groups=[];if(s){q.groups[0]=s}if(p.length>0||s){f.push(q);if(n&&!_.contains(a.updated.groups["view.issue.opsbar"],q.id)){a.updated.groups["view.issue.opsbar"].push(q.id)}}else{a.deleted.groups["view.issue.opsbar"].push(q.id)}});if(f.length>0){f.sort(b);i.groups=f;c.push(i)}}else{if(h){c.push(h)}}a.added.groups["view.issue.opsbar"].sort();a.deleted.groups["view.issue.opsbar"].sort();a.updated.groups["view.issue.opsbar"].sort()},_mergeToolsLinks:function(j,g,f,a,k,b){a.updated.groups["jira.issue.tools"]=false;var m=_.find(g.issue.operations.linkGroups,function(n){return"jira.issue.tools"===n.id});var l=_.find(j,function(n){return"jira.issue.tools"===n.id});var h={};if(l){a.updated.groups["jira.issue.tools"]=true;_.each(l.links,function(n){h[n.id]=n});if(l.groups&&l.groups.length>0){_.each(l.groups[0].links,function(n){h[n.id]=n})}}if(m){var c=[];if(l){_.each(l.links,function(n){var o=_.find(m.links,function(p){return n.id===p.id});if(!o){c.push(n)}})}_.each(m.links,function(n){if(h[n.id]){c.push(h[n.id])}else{if(!_.contains(k,n.id)){c.push(n)}}});c.sort(b);m.links=c;var i=null;if(l&&l.groups&&l.groups.length>0){i=l.groups[0]}if(m.groups&&m.groups.length>0){var e=m.groups[0];var d=[];if(i){_.each(i.links,function(n){var o=_.find(e.links,function(p){return n.id===p.id});if(!o){d.push(n)}})}_.each(e.links,function(n){if(h[n.id]){d.push(h[n.id])}else{if(!_.contains(k,n.id)){d.push(n)}}});m.groups=[];if(d.length>0){d.sort(b);e.links=d;m.groups[0]=e}}else{if(i){m.groups=[i]}}f.push(m)}else{if(l){f.push(l)}}},_comparator:function(b,a){if(b.weight&&a.weight){if(b.weight>a.weight){return 1}if(b.weight<a.weight){return -1}return 0}if(b.weight&&!a.weight){return 1}if(!b.weight&&a.weight){return -1}return 0}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/Resize.js' */
(function(){var a="verticalResize";var b="horizontalResize";JIRA.Issues.offVerticalResize=function(d,c){AJS.$(document).off(a,d,c)};JIRA.Issues.onVerticalResize=function(d,c){AJS.$(document).on(a,d,c)};JIRA.Issues.triggerVerticalResize=_.throttle(function(){AJS.$(document).trigger(a)},100);JIRA.Issues.triggerVerticalResize=_.throttle(function(){AJS.$(document).trigger(a)},100);jQuery(window).resize(JIRA.Issues.triggerVerticalResize);JIRA.Issues.offHorizontalResize=function(d,c){AJS.$(document).off(b,d,c)};JIRA.Issues.onHorizontalResize=function(d,c){AJS.$(document).on(b,d,c)};JIRA.Issues.triggerHorizontalResize=_.throttle(function(){AJS.$(document).trigger(b)},100)}());
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/UserParms.js' */
JIRA.Issues.UserParms={createSharedObjects:function(){return this.get().createSharedObjects},get:function(){if(!this.data){this.data=AJS.$("#user-parms").data("user-parms")||{}}return this.data}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:common', location = 'content/js/util/TipsyView.js' */
Backbone.define("JIRA.Issues.Tipsy",JIRA.Issues.BaseView.extend({events:{click:"hide"},initialize:function(a){if(_.isFunction(a.showCondition)){this.shouldShow=a.showCondition}else{if(a.showCondition){this.shouldShow=_.bind(function(){return this.$el.filter(a.showCondition).length>0},this)}else{this.shouldShow=function(){return true}}}_.defaults(a.tipsy||{},{className:"jiratipsy"});this.tipsy=this.$el.tipsy(_.extend({trigger:"manual"},a.tipsy));this.hoverIntent(a.intents)},hoverIntent:function(a){this.tipsy.hoverIntent(_.extend({interval:200,over:_.bind(this.show,this),out:_.bind(this.hide,this)},a));return this},show:function(){if(this.shouldShow()){this.$el.tipsy("show");var c=this.$el.tipsy(true);if(!c||!c.tip){return}var d=c.tip();var b=d.css("left");d.css({left:0});var a=d.width()+1;d.css({width:a,left:b})}},hide:function(){this.$el.tipsy("hide")}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-searchheader', location = 'content/templates/issuenav-searchheader.soy' */
// This file was automatically generated from issuenav-searchheader.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.IssueNavSearchHeader == 'undefined') { JIRA.Templates.IssueNavSearchHeader = {}; }


JIRA.Templates.IssueNavSearchHeader.searchHeader = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.IssueNavSearchHeader.primarySection(opt_data, output);
  if (opt_data.owner) {
    JIRA.Templates.IssueNavSearchHeader.secondarySection(opt_data, output);
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.primarySection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="header-section-primary"><h1 class="search-title" title="', soy.$$escapeHtmlAttribute(opt_data.title), '">', soy.$$escapeHtml(opt_data.title), '</h1><ul class="filter-operations">', (opt_data.primaryOps && opt_data.primaryOps.length) ? '<li class="filter-edited-item"><span>' + soy.$$escapeHtml("Edited") + '</span></li>' : '');
  if (opt_data.primaryButton) {
    output.append('<li>', (opt_data.primaryOps && opt_data.primaryOps.length) ? '<div class="aui-buttons">' : '', '<a href="', (opt_data.primaryButton.href) ? soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri(opt_data.primaryButton.href)) : '#', '" class="aui-button ', soy.$$escapeHtmlAttribute(opt_data.primaryButton.styleClass), '">', soy.$$escapeHtml(opt_data.primaryButton.label), '</a>');
    if (opt_data.primaryOps && opt_data.primaryOps.length) {
      output.append('<button class="aui-button aui-dropdown2-trigger js-edited-trigger" aria-owns="js-edited-content" aria-haspopup="true" data-container=".aui-buttons"></button></div><div id="js-edited-content" class="aui-dropdown2 aui-style-default"><ul>');
      var opList38 = opt_data.primaryOps;
      var opListLen38 = opList38.length;
      for (var opIndex38 = 0; opIndex38 < opListLen38; opIndex38++) {
        var opData38 = opList38[opIndex38];
        output.append('<li><a href="', (opData38.href) ? soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri(opData38.href)) : '#', '" ', (opData38.styleClass) ? 'class="' + soy.$$escapeHtmlAttribute(opData38.styleClass) + '"' : '', '>', soy.$$escapeHtml(opData38.label), '</a></li>');
      }
      output.append('</ul></div>');
    }
    output.append('</li>');
  }
  if (opt_data.owner) {
    var opList59 = opt_data.secondaryOps;
    var opListLen59 = opList59.length;
    for (var opIndex59 = 0; opIndex59 < opListLen59; opIndex59++) {
      var opData59 = opList59[opIndex59];
      output.append('<li><a href="', (opData59.href) ? soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri(opData59.href)) : '#', '" ', (opData59.title) ? 'title="' + soy.$$escapeHtmlAttribute(opData59.title) + '"' : '', ' class="', soy.$$escapeHtmlAttribute(opData59.styleClass), '">', (opData59.label) ? soy.$$escapeHtml(opData59.label) : '', '</a></li>');
    }
  }
  output.append('</ul></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.secondarySection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.owner) {
    output.append('<div class="header-section-secondary"><div class="search-owner">');
    JIRA.Templates.IssueNavSearchHeader.filterOwner(opt_data, output);
    output.append('</div></div>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.filterOwner = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="search-owner">', (opt_data.avatarUrl) ? '<span class="aui-avatar aui-avatar-large search-owner-avatar"><span class="aui-avatar-inner"><img src="' + soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri(opt_data.avatarUrl)) + '" /></span></span>' : '', '<span class="search-owner-name">');
  var ownerLink__soy95 = new soy.StringBuilder();
  JIRA.Templates.IssueNavSearchHeader.ownerLink(opt_data, ownerLink__soy95);
  ownerLink__soy95 = ownerLink__soy95.toString();
  output.append(AJS.format("Owned by {0}",ownerLink__soy95), '</span></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.ownerLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a href="', soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri(opt_data.ownerUrl)), '" class="user-hover" rel="', soy.$$escapeHtmlAttribute(opt_data.ownerUserName), '">', soy.$$escapeHtml(opt_data.owner), '</a>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.filterDetails = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.IssueNavSearchHeader.filterDescription(opt_data, output);
  JIRA.Templates.IssueNavSearchHeader.filterPermissions(opt_data, output);
  if (opt_data.userIsLoggedIn) {
    JIRA.Templates.IssueNavSearchHeader.filterSubscriptions(opt_data, output);
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.filterDescription = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="filter-details-section sub-section">');
  if (opt_data.owner) {
    JIRA.Templates.IssueNavSearchHeader.filterOwner(opt_data, output);
  }
  output.append((opt_data.filter.description) ? '<p class="filter-name">' + soy.$$escapeHtml(opt_data.filter.description) + ((opt_data.permissions.userHasEditPermission) ? ' <a href="' + soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri("")) + '/secure/EditFilter!default.jspa?filterId=' + soy.$$escapeUri(opt_data.filter.id) + '">(' + soy.$$escapeHtml("\u7f16\u8f91") + ')</a>' : '') + '</p>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.filterPermissions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="filter-details-section sub-section"><h4 class="section-header">', soy.$$escapeHtml("\u6743\u9650"), '</h4>');
  if (opt_data.sharePermissions && opt_data.sharePermissions.length > 0) {
    output.append('<p>', soy.$$escapeHtml("This filter is visible to:"), '</p><ul class="shared-filters">');
    var shareList155 = opt_data.sharePermissions;
    var shareListLen155 = shareList155.length;
    for (var shareIndex155 = 0; shareIndex155 < shareListLen155; shareIndex155++) {
      var shareData155 = shareList155[shareIndex155];
      JIRA.Templates.IssueNavSearchHeader.filterSharePermissionItem({type: shareData155.type, project: (shareData155.project) ? '<a href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(shareData155.project.key) + '">' + soy.$$escapeHtml(shareData155.project.name) + '</a>' : '', projectRole: (shareData155.role) ? soy.$$escapeHtml(shareData155.role.name) : '', group: (shareData155.group) ? soy.$$escapeHtml(shareData155.group.name) : ''}, output);
    }
    output.append('</ul>');
  } else {
    output.append('<p>', soy.$$escapeHtml("This filter is only visible to you."), '</p>');
  }
  output.append((opt_data.permissions.userHasEditSharingPermission) ? '<p><a class="edit-permissions" href="' + soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri("")) + '/secure/EditFilter!default.jspa?filterId=' + soy.$$escapeUri(opt_data.filter.id) + '">' + soy.$$escapeHtml("Edit permissions") + '</a></p>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.filterSubscriptions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="filter-details-section full-section"><h4>', soy.$$escapeHtml("\u8ba2\u9605"), '</h4>');
  if (opt_data.subscriptions.items.length) {
    output.append('<p>', soy.$$escapeHtml("This filter has the following subscriptions:"), '</p>');
    JIRA.Templates.IssueNavSearchHeader.filterSubscriptionList(opt_data, output);
  } else {
    output.append('<p>', soy.$$escapeHtml("This filter has no subscriptions."), '</p>');
  }
  output.append('<ul class="manage-links"><li><a href="', soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri("")), '/secure/FilterSubscription!default.jspa?filterId=', soy.$$escapeUri(opt_data.filter.id), '&returnUrl=', soy.$$escapeUri(opt_data.returnUrl), '">', soy.$$escapeHtml("New subscription"), '</a></li>', (opt_data.subscriptions.items.length) ? '<li><a href="' + soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri("")) + '/secure/ViewSubscriptions.jspa?filterId=' + soy.$$escapeUri(opt_data.filter.id) + '">' + soy.$$escapeHtml("Manage subscriptions") + '</a></li>' : '', '</ul></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.filterSubscriptionList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul>');
  var subList235 = opt_data.filter.subscriptions.items;
  var subListLen235 = subList235.length;
  for (var subIndex235 = 0; subIndex235 < subListLen235; subIndex235++) {
    var subData235 = subList235[subIndex235];
    output.append((subData235.group) ? '<li>' + soy.$$escapeHtml(subData235.group.name) + '</li>' : '<li>' + soy.$$escapeHtml(subData235.user.displayName) + '</li>');
  }
  output.append((opt_data.filter.subscriptions.additionalLength) ? '<li><a href="' + soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri("")) + '/secure/ViewSubscriptions.jspa?filterId=' + soy.$$escapeUri(opt_data.filter.id) + '">' + soy.$$escapeHtml(AJS.format("{0} more",opt_data.filter.subscriptions.additionalLength)) + '</a></li>' : '', '</ul>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.filterSharePermissionItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.type == 'global') ? '<li>' + soy.$$escapeHtml("\u6240\u6709\u4eba") + '</li>' : (opt_data.type == 'group') ? '<li>' + AJS.format("{0}\u7528\u6237\u7ec4{1}: {2}",'<strong>','</strong>',opt_data.group) + '</li>' : (opt_data.projectRole) ? '<li>' + AJS.format("{0}\u9879\u76ee{1}: {2} {3}\u89d2\u8272{4}: {5}",'<strong>','</strong>',opt_data.project,'<strong>','</strong>',opt_data.projectRole) + '</li>' : '<li>' + AJS.format("{0}\u9879\u76ee{1}: {2}",'<strong>','</strong>',opt_data.project) + '</li>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.saveFilterDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-dialog-content"><form action="', soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri(opt_data.contextPath)), '/rest/api/2/filter/" class="aui" id="save-filter-form" method="post"><div class="aui-messages"></div><div class="form-body"><h2 class="dialog-title">', soy.$$escapeHtml(opt_data.headerText), '</h2>', (opt_data.copyFromAnotherUser) ? '<p class="form-description">' + ((opt_data.filterOwnerName) ? soy.$$escapeHtml(AJS.format("This filter was created by {0}. You can save a copy of this filter but you cannot modify the original.",opt_data.filterOwnerName)) : soy.$$escapeHtml("You can save a copy of this filter but you cannot modify the original.")) + '</p>' : '', '<div class="field-group"><label for="filterName">', soy.$$escapeHtml("Filter Name"), '<span class="aui-icon icon-required"><span class="content">Required</span></span></label><input type="text" id="filterName" name="name"', (opt_data.prefilledFilterName) ? ' value="' + soy.$$escapeHtmlAttribute(opt_data.prefilledFilterName) + '"' : '', 'class="text long-field"><div class="description">', soy.$$escapeHtml("Enter a name for this Filter"), '</div>');
  var fieldList305 = opt_data.hiddenFields;
  var fieldListLen305 = fieldList305.length;
  for (var fieldIndex305 = 0; fieldIndex305 < fieldListLen305; fieldIndex305++) {
    var fieldData305 = fieldList305[fieldIndex305];
    output.append('<input type="hidden" name="', soy.$$escapeHtmlAttribute(fieldData305.name), '" value="', (fieldData305.value) ? soy.$$escapeHtmlAttribute(fieldData305.value) : '', '" />');
  }
  output.append('</div>', (opt_data.isDefaultShareScopeGlobal) ? '<div class="aui-message info shadowed"><p class="title"><span class="aui-icon icon-info"></span><strong>' + soy.$$escapeHtml("By default your filters are shared with everyone.") + '</strong></p><input type="checkbox" id="setSharingPrivate" class="checkbox"><label for="setSharingPrivate">' + soy.$$escapeHtml("My filters should be private by default.") + '</label></div>' : '', '</div><div class="buttons-container form-footer"><div class="buttons"><input accesskey="', soy.$$escapeHtmlAttribute("s"), '" title="', soy.$$escapeHtmlAttribute(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.modifierKey)), '" class="aui-button submit" type="submit" value="', soy.$$escapeHtmlAttribute("\u63d0\u4ea4"), '" /><a accesskey="', soy.$$escapeHtmlAttribute("`"), '" title="', soy.$$escapeHtmlAttribute(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.modifierKey)), '" class="aui-button aui-button-link cancel" href="javascript:">', soy.$$escapeHtml("\u53d6\u6d88"), '</a></div></div></form></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.layoutSwitcher = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-buttons"><button id="layout-switcher-button" class="aui-button drop-arrow js-default-dropdown" type="button"><span class="aui-icon aui-icon-small ', soy.$$escapeHtmlAttribute(opt_data.activeLayout.iconClass), '"></span></button><div class="aui-list hidden"><h5>', soy.$$escapeHtml("Views"), '</h5><ul class="aui-list-section aui-first aui-last">');
  var layoutList341 = opt_data.layouts;
  var layoutListLen341 = layoutList341.length;
  for (var layoutIndex341 = 0; layoutIndex341 < layoutListLen341; layoutIndex341++) {
    var layoutData341 = layoutList341[layoutIndex341];
    output.append('<li class="aui-list-item layout-switcher-item"><a href="#" class="aui-list-item-link" data-layout-key="', soy.$$escapeHtmlAttribute(layoutData341.id), '"><span class="aui-icon aui-icon-small ', (opt_data.activeLayout.id == layoutData341.id) ? 'aui-iconfont-success' : '', '"></span>', soy.$$escapeHtml(layoutData341.label), '</a>');
  }
  output.append('</ul></div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavSearchHeader.layoutSwitcherIntroDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="intro-dialog-content dialog-help-tip"><h2 class="helptip-title">', soy.$$escapeHtml("Choose how you view issues"), '</h2><div class="helptip-body">', soy.$$escapeHtml("Switch between the details and list views to suit your preference."), '</div><a class="helptip-link">', soy.$$escapeHtml("Learn more"), '</a><button class="helptip-close dismiss"><span class="assistive">', soy.$$escapeHtml("Dismiss"), '</span></button></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-searchheader', location = 'content/js/search/searchheader/SearchHeaderView.js' */
Backbone.define("JIRA.Issues.SearchHeaderView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.IssueNavSearchHeader.searchHeader,filterDetailsTemplate:JIRA.Templates.IssueNavSearchHeader.filterDetails,primarySectionTemplate:JIRA.Templates.IssueNavSearchHeader.primarySection,secondarySectionTemplate:JIRA.Templates.IssueNavSearchHeader.secondaySection,filterFavouriteButton:".fav-link",events:{"click .fav-link":"_onToggleFavourite"},initialize:function(a){_.bindAll(this);this._searchPageModule=a.searchPageModule;this._searchPageModule.on("change changeFilterProps",this.render,this);this.pageTitle=document.title},render:function(){var d=!this.$el.closest("body").length,h={},b={isDirty:this._searchPageModule.isDirty()},c=this._searchPageModule.getFilter();if(!c){h.title="Search";h.primaryButton=JIRA.Issues.FilterModel.getOpById("saveAs");this.$el.removeClass("is-filter-with-owner")}else{if(!c.getIsValid()){h.title="Search";this.$el.removeClass("is-filter-with-owner")}else{var g=c.getOperationsJson(b);var e=g.primary.reverse().pop();var f=g.primary.reverse();h.title=c.getName();this._addOwnerData(c,h);h.primaryButton=e;h.primaryOps=f;h.secondaryOps=g.secondary;this.$el.toggleClass("is-filter-with-owner",!!c.getOwner())}}var a=this.$(".filter-edited-item").length===1;this.$el.html(this.template(h));if(a){this.$(".filter-edited-item").show().css("opacity",1)}else{if(!d){this.$(".filter-edited-item").hide().fadeIn(1000)}}this._createFilterFavouriteTipsy();this.updateJqlError(false);this.updateWindowTitle();this.bindDetailsDialog();this.bindDropdown();return this},updateJqlError:function(a){var b="";if(this.isError=a){b="You cannot save a filter that is in error."}else{if(!this.queryIsSaveable()){b="You must be logged in to perform filter actions"}}this.$(".save-as-new-filter, .save-changes").attr("title",b).toggleClass("disabled",!this.queryIsSaveable())},update:function(){JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$el,JIRA.CONTENT_ADDED_REASON.returnToSearch]);this.updateWindowTitle()},updateWindowTitle:function(){if(this._searchPageModule.isFullScreenIssueVisible()){return}var a=this._searchPageModule.getFilter(),b=AJS.format("{0} - {1}","\u95EE\u9898\u5BFC\u822A\u680F",JIRA.Settings.ApplicationTitle.get());if(a&&a.getIsValid()){document.title="["+a.getName()+"] "+b}else{document.title=b}},userIsLoggedIn:function(){return JIRA.Issues.LoginUtils.isLoggedIn()},queryIsSaveable:function(){return this.userIsLoggedIn()&&!this.isError},_onToggleFavourite:function(b){b.preventDefault();var a=this.$(".fav-link").hasClass("on");this._searchPageModule.getFilter().saveFavourite(!a);if(!a){this._searchPageModule.filterModuleSaved(this._searchPageModule.getFilter())}},_onSaveAsNew:function(a){a.preventDefault();this._searchPageModule.getJqlDeferred().done(_.bind(function(b){if(this.queryIsSaveable()){new JIRA.Issues.FilterSaveDialogView({id:"save-filter-dialog",type:JIRA.Issues.FilterSaveDialogView.Types.SAVE_AS,searchPageModule:this._searchPageModule}).show()}},this))},_createFilterFavouriteTipsy:function(){new JIRA.Issues.Tipsy({el:this.filterFavouriteButton})},_onSaveChanges:function(f){f.preventDefault();if(!this.queryIsSaveable()){return}var d=this._searchPageModule.getFilter();var b=AJS.escapeHtml(d.getName());var c=d.saveFilter(this._searchPageModule.getEffectiveJql());var a=this;c.done(function(){JIRA.Messages.showSuccessMsg(AJS.format("The filter \u003cstrong>{0}\u003c\/strong> has been successfully saved.",b),JIRA.Issues.getDefaultMessageOptions());a._searchPageModule.setSessionSearch(d)});c.fail(function(){JIRA.Messages.showErrorMsg(AJS.format("The filter \u003cstrong>{0}\u003c\/strong> could not be saved.",b),JIRA.Issues.getDefaultMessageOptions())})},_onDiscardChanges:function(a){a.preventDefault();this._searchPageModule.discardFilterChanges()},_getFilterDetailsDialogCSS:function(a,d,e,c){var b=AJS.InlineDialog.opts.calculatePositions(a,d,e,c);b.arrowCss.left-=7;return b},bindDetailsDialog:function(){var b="filter-details-overlay";AJS.$("#inline-dialog-"+b).remove();var a=this.$(".show-filter-details");var c=AJS.InlineDialog(a,b,this._onShowFilterDetailsDialog,{addActiveClass:true,calculatePositions:this._getFilterDetailsDialogCSS,hideDelay:3600000,offsetX:-36,width:400});a.click(function(){if(a.hasClass("active")){setTimeout(c.hide,0)}})},bindDropdown:function(){this.$(".save-changes").on("click",this._onSaveChanges);this.$(".discard-filter-changes").on("click",this._onDiscardChanges);this.$(".save-as-new-filter").on("click",this._onSaveAsNew)},_onShowFilterDetailsDialog:function(d,f,h){var b=this._searchPageModule.getFilter(),c=_.sortBy(b.getSharePermissions(),function(i){var j=[i.type];i.group&&j.push(i.group.name);i.project&&j.push(i.project.name);i.role&&j.push(i.role.name);return j}),g=_.clone(b.getSubscriptions()),a=JIRA.Issues.LoginUtils.loggedInUserName()===b.getOwnerUserName();g.additionalLength=b.getNumberOfAdditionalSubscriptions();var e={filter:b.toJSON(),sharePermissions:c,subscriptions:g,permissions:{userHasEditSharingPermission:a&&(!!JIRA.Issues.UserParms.createSharedObjects()||c.length>0),userHasEditPermission:a},userIsLoggedIn:this.userIsLoggedIn(),returnUrl:window.location};this._addOwnerData(b,e);d.html(this.filterDetailsTemplate(e));d.bind("click",function(i){i.stopPropagation()});h()},_addOwnerData:function(a,b){if(a.getOwner()){_.extend(b,{owner:a.getOwner()||"",ownerUserName:a.getOwnerUserName()||"",avatarUrl:a.getAvatarUrl(),ownerUrl:AJS.contextPath()+"/secure/ViewProfile.jspa?name="+encodeURIComponent(a.getOwnerUserName())})}},_appendErrorContent:function(a,d){var b=a.find(".aui-messages");var f=JSON.parse(d.responseText);a.find(".error").remove();b.empty();try{if(f&&f.errors){jQuery.each(f.errors,function(g,e){a.find("#"+g).after("<div class='error'>"+AJS.escapeHTML(e)+"</div>")})}if(f&&f.errorMessages){jQuery.each(f.errorMessages,function(g,h){var e=JIRA.Issues.getDefaultMessageOptions();e.body=AJS.escapeHTML(h);e.shadowed=false;AJS.messages.error(b,e)})}else{b.append(JIRA.SmartAjax.buildDialogErrorContent(d,true))}}catch(c){b.append(JIRA.SmartAjax.buildDialogErrorContent(d,true))}}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-searchheader', location = 'content/js/search/searchheader/LayoutSwitcherView.js' */
Backbone.define("JIRA.Issues.LayoutSwitcherView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.IssueNavSearchHeader.layoutSwitcher,introDialogTemplate:JIRA.Templates.IssueNavSearchHeader.layoutSwitcherIntroDialog,initialize:function(a){_.bindAll(this);this.searchPageModule=a.searchPageModule;this.searchPageModule.on("change:currentLayout",this.render);this.introDialog=JIRA.Issues.IntroDialog.create({id:"split-view-intro",selector:".view-selector button",template:_.bind(function(){var b=jQuery(this.introDialogTemplate());b.find("a.helptip-link").attr({href:AJS.Meta.get("issue-search-help-url"),title:AJS.Meta.get("issue-search-help-title"),target:"_jirahelp"});return b},this),shouldShow:_.bind(function(){return this.$el.is(":visible")&&this.searchPageModule.search.getResults().hasIssues()},this)})},render:function(){this.$el.html(this.template({layouts:this.searchPageModule.getSortedLayouts(),activeLayout:this.searchPageModule.getActiveLayout()}));this._addLayoutSwitcherTooltip();this.$el.find(".aui-list-item-link").click(this._onLayoutSwitchClick);JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$el,JIRA.CONTENT_ADDED_REASON.layoutSwitcherReady]);return this},enableLayoutSwitcher:function(){this.$el.find("#layout-switcher-button").removeClass("disabled").removeAttr("disabled");return this},disableLayoutSwitcher:function(){this.$el.find("#layout-switcher-button").addClass("disabled").attr("disabled","");return this},_addLayoutSwitcherTooltip:function(){function a(){var b=AJS.KeyboardShortcut.getKeyboardShortcutKeys("switch.search.layouts");if(b){return AJS.format("Change view (Type \'\'{0}\'\')",AJS.KeyboardShortcut.getKeyboardShortcutKeys("switch.search.layouts"))}else{return "Change view"}}new JIRA.Issues.Tipsy({el:this.$el.find("#layout-switcher-button"),showCondition:":not(.active)",tipsy:{title:a,gravity:"ne"}})},_onLayoutSwitchClick:function(b){var a=AJS.$(b.target).closest("[data-layout-key]").data("layout-key");b.preventDefault();this.searchPageModule.changeLayout(a)}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-searchheader', location = 'content/js/search/searchheader/SearchHeaderModule.js' */
Backbone.define("JIRA.Issues.SearchHeaderModule",JIRA.Issues.BaseEvented.extend({initialize:function(a){this._searchPageModule=a.searchPageModule;this._toolPreferencesModel=a.toolPreferencesModel},registerSearch:function(a){this._search=a},createView:function(a){this.searchHeaderView=new JIRA.Issues.SearchHeaderView({el:a.searchHeaderEl,searchPageModule:this._searchPageModule});return this.searchHeaderView},createToolsView:function(a){new JIRA.Issues.IssueTableHeaderOperationsView({el:a,search:this._search,searchPageModule:this._searchPageModule,toolPreferencesModel:this._toolPreferencesModel})},handleIssueSearchAppeared:function(){this.searchHeaderView.update()},handleJqlError:function(){this.searchHeaderView&&this.searchHeaderView.updateJqlError(true)},handleJqlSuccess:function(){this.searchHeaderView&&this.searchHeaderView.updateJqlError(false)}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/templates/issuenav-filter.soy' */
// This file was automatically generated from issuenav-filter.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.IssueNavFilter == 'undefined') { JIRA.Templates.IssueNavFilter = {}; }


JIRA.Templates.IssueNavFilter.collapsedFiltersPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class="toggle-filter-panel" href="#" title="', soy.$$escapeHtmlAttribute(AJS.format("Dock the filters panel ({0})",'[')), '"></a>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavFilter.filtersPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="filters-content"><h4 class="filter-title">', soy.$$escapeHtml("Filters"), '</h4><ul class="filter-options"><li><a href="', soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri(opt_data.contextPath)), '/issues/?jql=" class="new-search aui-button" title="', soy.$$escapeHtmlAttribute("Create a new search filter"), '">', soy.$$escapeHtml("New filter"), '</a></li><li><a class="find-filters" href="', soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri(opt_data.contextPath)), '/secure/ManageFilters.jspa?filterView=search">', soy.$$escapeHtml("Find filters"), '</a></li></ul><div class="filter-panel-section">');
  JIRA.Templates.IssueNavFilter.filterList({filters: opt_data.systemFilters, fallbackMessage: 'Warning: No system filters!', name: 'system-filters'}, output);
  output.append('</div><div class="filter-panel-section"><h4 class="filter-title">', soy.$$escapeHtml("Favourite Filters"), '</h4>');
  JIRA.Templates.IssueNavFilter.filterList({filters: opt_data.favouriteFilters, fallbackMessage: opt_data.isAnonymous ? AJS.format("You must be {0}logged in{1} to view favourite filters.",'<a class="login-link" href="' + opt_data.loginUrl + '">','</a>') : "You don\x27t have any favourite filters.", name: 'favourite-filters'}, output);
  output.append('</div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavFilter.filterDropDown = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-list"><ul class="aui-list-section">', (opt_data.canEdit) ? '<li class="aui-list-item"><a href="" class="aui-list-item-link rename-filter" data-id="' + soy.$$escapeHtmlAttribute(opt_data.filter.id) + '">' + soy.$$escapeHtml("Rename") + '</a></li>' : '', '<li class="aui-list-item"><a href="" class="aui-list-item-link copy-filter" data-id="', soy.$$escapeHtmlAttribute(opt_data.filter.id), '">', soy.$$escapeHtml("\u590d\u5236"), '</a></li></ul><ul class="aui-list-section', (! opt_data.canEdit) ? ' aui-last' : '', '"><li class="aui-list-item"><a href="" class="aui-list-item-link unfavourite-filter" data-id="', soy.$$escapeHtmlAttribute(opt_data.filter.id), '">', soy.$$escapeHtml("Remove from favourites"), '</a></li></ul>', (opt_data.canEdit) ? '<ul class="aui-list-section aui-last"><li class="aui-list-item"><a href="" class="aui-list-item-link delete-filter" data-id="' + soy.$$escapeHtmlAttribute(opt_data.filter.id) + '">' + soy.$$escapeHtml("\u5220\u9664") + '</a></li></ul>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavFilter.renameFilterDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-dialog-content"><form action="', soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri("")), '/rest/api/2/filter/', soy.$$escapeHtmlAttribute(opt_data.filter.id), '" class="aui" id="rename-filter-form" method="put"><div class="aui-messages"></div><div class="form-body"><h2 class="dialog-title">', soy.$$escapeHtml("Rename Filter"), ': ', soy.$$escapeHtml(opt_data.filter.name), '</h2><div class="field-group"><label for="filterName">', soy.$$escapeHtml("Filter Name"), '<span class="aui-icon icon-required"><span class="content">Required</span></span></label><input type="text" id="filterName" name="name" value="', soy.$$escapeHtmlAttribute(opt_data.filter.name), '" class="text long-field"></div></div><div class="buttons-container form-footer"><div class="buttons"><input accesskey="', soy.$$escapeHtmlAttribute("s"), '" title="', soy.$$escapeHtmlAttribute(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.modifierKey)), '" class="aui-button submit" type="submit" value="', soy.$$escapeHtmlAttribute("\u63d0\u4ea4"), '" /><a accesskey="', soy.$$escapeHtmlAttribute("`"), '" title="', soy.$$escapeHtmlAttribute(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.modifierKey)), '" class="aui-button aui-button-link cancel" href="javascript:">', soy.$$escapeHtml("\u53d6\u6d88"), '</a></div></div></form></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavFilter.deleteFilterDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-dialog-content"><form action="', soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri("")), '/rest/api/2/filter/', soy.$$escapeHtmlAttribute(opt_data.filter.id), '" class="aui" id="delete-filter-form" method="delete"><div class="aui-messages"></div><div class="form-body"><h2 class="dialog-title">', soy.$$escapeHtml("Delete Filter"), ': ', soy.$$escapeHtml(opt_data.filter.name), '</h2>');
  if (opt_data.filter.subscriptions.items.length) {
    output.append('<p class="form-description">', soy.$$escapeHtml(AJS.format("The filter {0} has the following subscriptions. Are you sure you want to delete it?",opt_data.filter.name)), '</p>');
    JIRA.Templates.IssueNavSearchHeader.filterSubscriptionList(opt_data, output);
    output.append('<p class="form-description"><a href="', soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri("")), '/secure/ViewSubscriptions.jspa?filterId=', soy.$$escapeUri(opt_data.filter.id), '">', soy.$$escapeHtml("Manage subscriptions"), '</a></p>');
  } else {
    output.append('<p class="form-description">', soy.$$escapeHtml(AJS.format("Are you sure you want to delete the filter {0}?",opt_data.filter.name)), '</p>');
  }
  output.append('</div><div class="buttons-container form-footer"><div class="buttons"><input accesskey="', soy.$$escapeHtmlAttribute("s"), '" title="', soy.$$escapeHtmlAttribute(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.modifierKey)), '" class="aui-button submit" type="submit" value="', soy.$$escapeHtmlAttribute("\u5220\u9664"), '" /><a accesskey="', soy.$$escapeHtmlAttribute("`"), '" title="', soy.$$escapeHtmlAttribute(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.modifierKey)), '" class="aui-button aui-button-link cancel" href="javascript:">', soy.$$escapeHtml("\u53d6\u6d88"), '</a></div></div></form></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavFilter.filterList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.filters.length > 0) {
    output.append('<ul class="saved-filter filter-list ', soy.$$escapeHtmlAttribute(opt_data.name), '">');
    var filterList135 = opt_data.filters;
    var filterListLen135 = filterList135.length;
    for (var filterIndex135 = 0; filterIndex135 < filterListLen135; filterIndex135++) {
      var filterData135 = filterList135[filterIndex135];
      output.append((opt_data.name == 'favourite-filters') ? '<li><a class="filter-link" href="' + soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri("")) + '/issues/?filter=' + soy.$$escapeUri(filterData135.id) + '" data-id="' + soy.$$escapeHtmlAttribute(filterData135.id) + '" title="' + soy.$$escapeHtmlAttribute(filterData135.name) + '">' + soy.$$escapeHtml(filterData135.name) + '</a><a href="#" class="filter-actions" data-id="' + soy.$$escapeHtmlAttribute(filterData135.id) + '"><span>' + soy.$$escapeHtml("Filter Actions") + '</span></a></li>' : '<li><a class="filter-link' + ((filterData135.requiresLoginForUser) ? ' requires-login' : '') + '" href="' + soy.$$escapeHtmlAttribute(soy.$$filterNormalizeUri(filterData135.navUrl)) + '" data-id="' + soy.$$escapeHtmlAttribute(filterData135.id) + '" title="' + soy.$$escapeHtmlAttribute(filterData135.name) + '">' + soy.$$escapeHtml(filterData135.name) + '</a></li>');
    }
    output.append('</ul>');
  } else {
    output.append('<p class="filter-info">', opt_data.fallbackMessage, '</p>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavFilter.dockFeatureIntro = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="intro-dialog-content dialog-help-tip"><h2 class="helptip-title">', soy.$$escapeHtml("Did you notice?"), '</h2><div class="helptip-body">', soy.$$escapeHtml("You can dock the filter bar to always show your list of filters."), '</div><button class="helptip-close dismiss"><span class="assistive">', soy.$$escapeHtml("Dismiss"), '</span></button></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterModel.js' */
Backbone.define("JIRA.Issues.FilterModel",JIRA.Issues.BaseModel.extend({properties:["id","name","description","jql","favourite","isSystem","sharePermissions","subscriptions","ownerUserName","ownerDisplayName","avatarUrl","requiresLogin","isValid"],defaults:{isSystem:false,isValid:true},urlRoot:contextPath+"/rest/api/2/filter/",getOwner:function(){return this.getOwnerDisplayName()||this.getOwnerUserName()},isFavouriteFilter:function(){return !this.getIsSystem()&&!!this.getFavourite()},url:function(){return this.urlRoot+encodeURIComponent(this.id)+"?expand="+JIRA.Issues.FilterModel.getExpandValue()},isMyFilter:function(){return !this.getIsSystem()&&this.getOwnerUserName()===JIRA.Issues.LoginUtils.loggedInUserName()},parse:function(b,a){return JIRA.Issues.FilterModel.transformToModel(b)},getOperationsJson:function(a){var c={};var b=JIRA.Issues.FilterModel.operations;c.primary=_.filter(b.primary,_.bind(function(d){return d.validate.call(this,a)},this));c.secondary=_.filter(b.secondary,_.bind(function(d){return d.validate.call(this,a)},this));c.primary=_.map(c.primary,_.bind(function(d){return this._opAsJSON(d)},this));c.secondary=_.map(c.secondary,_.bind(function(d){return this._opAsJSON(d)},this));return c},_opAsJSON:function(b){var a={};jQuery.each(b,_.bind(function(c,d){if(c!=="validate"){a[c]=jQuery.isFunction(d)?d.call(this):d}},this));return a},getNumberOfAdditionalSubscriptions:function(){var a=this.getSubscriptions();return a.size>a.items.length?a.size-a.items.length:0},saveFavourite:function(b){var a=this;var c=this.getFavourite();this.setFavourite(b);if(this.pendingRequest){this.pendingRequest.abort()}this.pendingRequest=JIRA.SmartAjax.makeRequest({url:AJS.contextPath()+"/rest/api/1.0/filters/"+encodeURIComponent(this.getId())+"/favourite",type:b?"PUT":"DELETE"}).then(function(){delete a.pendingRequest}).done(function(d){var e=AJS.$(d).text().match(/favourite state: (\w+)/)[1]==="true";a.setFavourite(e)}).fail(function(){a.setFavourite(c)});return this.pendingRequest},saveFilter:function(b){if(this.pendingRequest){this.pendingRequest.abort()}var c=JIRA.Issues.FilterModel.transformFromModel(this.toJSON());c.jql=b;var a=this;this.pendingRequest=JIRA.SmartAjax.makeRequest({url:this.url(),type:"PUT",contentType:"application/json",data:JSON.stringify(c)}).done(function(d){a.set(JIRA.Issues.FilterModel.transformToModel(d))}).then(function(){delete a.pendingRequest;JIRA.trace("jira.filter.saved")});return this.pendingRequest},toJSONForTemplate:function(){var a=this.toJSON();_.extend(a,{requiresLoginForUser:this._requiresLoginForUser(this.getRequiresLogin()),navUrl:this._constructNavUrl(this.getId(),this.getRequiresLogin())});return a},_requiresLoginForUser:function(a){return !JIRA.Issues.LoginUtils.isLoggedIn()&&a},_constructNavUrl:function(a,b){var c="/issues/?filter="+a;if(this._requiresLoginForUser(b)){return JIRA.Issues.LoginUtils.redirectUrl(c)}else{return contextPath+c}},_getFavouriteText:function(){return this.isFavouriteFilter()?"Remove this filter from your Favourite Filters":"Add this filter to your Favourite Filters"}},{maxSubscriptions:5,getExpandValue:function(){return"subscriptions[-"+JIRA.Issues.FilterModel.maxSubscriptions+":]"},transformToModel:function(a){if(a.subscriptions&&a.subscriptions.items){a.subscriptions.items.reverse()}return{id:a.id,name:a.name,description:a.description,jql:a.jql,favourite:a.favourite,sharePermissions:a.sharePermissions||[],subscriptions:a.subscriptions,ownerUserName:a.owner&&a.owner.name,ownerDisplayName:a.owner&&a.owner.displayName,avatarUrl:a.owner&&a.owner.avatarUrls["48x48"],requiresLogin:a.requiresLogin}},transformFromModel:function(a){return{id:a.id,name:a.name,jql:a.jql,favourite:a.favourite}},operations:{primary:[{id:"save",styleClass:"save-changes",label:"\u4FDD\u5B58",validate:function(a){return a.isDirty&&this.isMyFilter()}},{id:"saveAs",styleClass:"save-as-new-filter",label:"Save as",href:AJS.contextPath()+"/secure/SaveAsFilter!default.jspa",validate:function(){return !!JIRA.Issues.LoginUtils.loggedInUserName()}},{id:"discardChanges",styleClass:"discard-filter-changes",label:"Discard changes",validate:function(a){return a.isDirty}}],secondary:[{id:"details",styleClass:"show-filter-details",title:"View information about this filter",validate:function(){return !this.getIsSystem()},label:"Details"},{id:"favourite",title:function(){return this._getFavouriteText()},label:function(){return this._getFavouriteText()},styleClass:function(){return"fav-link icon"+(this.isFavouriteFilter()?" on":" off")},href:function(){return AJS.contextPath()+"/secure/EditFilter!default.jspa?filterId="+this.id},validate:function(){return !!JIRA.Issues.LoginUtils.loggedInUserName()&&!this.getIsSystem()}}]},getOpById:function(a){return _.find(this.operations.primary.concat(this.operations.secondary),function(b){if(b.id===a){return true}})}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterCollection.js' */
Backbone.define("JIRA.Issues.FilterCollection",JIRA.Issues.BaseCollection.extend({model:JIRA.Issues.FilterModel,initialize:function(b,a){this.url=a&&a.url},toJSONForTemplate:function(){return this.invoke("toJSONForTemplate")}}));Backbone.define("JIRA.Issues.SortedFilterCollection",JIRA.Issues.FilterCollection.extend({comparator:function(b,a){return b.getName().toLowerCase().localeCompare(a.getName().toLowerCase())}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterDialogView.js' */
Backbone.define("JIRA.Issues.FilterDialogView",JIRA.Issues.BaseView.extend({initialize:function(){_.bindAll(this)},createDialog:function(a){this.filterDialog=this.filterDialog||new JIRA.FormDialog({content:this._createDialogContent,id:a,submitHandler:this._onSubmitFilterDialog})},show:function(){this.filterDialog.show()},hide:function(){this.filterDialog.hide(true);this.filterDialog.destroy()},_createDialogContent:function(a){a()},_serializeForm:function(a){return JSON.stringify({name:a.find("[name=name]").val(),jql:a.find("[name=jql]").val()})},_getFormUrl:function(a){return a.attr("action")},_getFormRequestType:function(a){return a.attr("method")},_onSubmitFilterDialog:function(d,a){d.preventDefault();var c=this.filterDialog.$form,b=JIRA.SmartAjax.makeRequest({type:this._getFormRequestType(c),url:this._getFormUrl(c),contentType:"application/json",dataType:"json",processData:false,data:this._serializeForm(c)});b.fail(this._onSubmitError);b.done(a);b.done(this._onSubmitSuccess);b.done(this.hide);b.always(function(){JIRA.trace("jira.filter.saved")});return b},_onSubmitError:function(a){this.filterDialog.getButtonsContainer().find("input").removeAttr("disabled");this.filterDialog.hideFooterLoadingIndicator();this.filterDialog.$form.removeClass("submitting");this._appendErrorContent(this.filterDialog.$popup,a);this.filterDialog.$form.find("#filterName").focus()},_onSubmitSuccess:jQuery.noop,_appendErrorContent:function(a,d){var b=a.find(".aui-messages");var f=JSON.parse(d.responseText);a.find(".error").remove();b.empty();try{if(f&&f.errors){jQuery.each(f.errors,function(g,e){a.find("#"+g).after("<div class='error'>"+AJS.escapeHTML(e)+"</div>")})}if(f&&f.errorMessages){jQuery.each(f.errorMessages,function(g,h){var e=JIRA.Issues.getDefaultMessageOptions();e.body=AJS.escapeHTML(h);e.shadowed=false;AJS.messages.error(b,e)})}else{b.append(JIRA.SmartAjax.buildDialogErrorContent(d,true))}}catch(c){b.append(JIRA.SmartAjax.buildDialogErrorContent(d,true))}}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterRenameDialogView.js' */
Backbone.define("JIRA.Issues.FilterRenameDialogView",JIRA.Issues.FilterDialogView.extend({template:JIRA.Templates.IssueNavFilter.renameFilterDialog,initialize:function(a){_.bindAll(this);this.filterId=a.filterId;this.createDialog(a.id)},_createDialogContent:function(c){var a=this;var b=this.model.getFilterById(this.filterId);b.done(function(d){c(a.template({modifierKey:AJS.Navigator.modifierKey(),filter:d.toJSON()}))})},_onSubmitSuccess:function(a){this.filterDialog.hide(true);this.filterDialog.destroy();a=this.model.setRenamedFilterName(a);JIRA.Messages.showSuccessMsg(AJS.format("The filter \u003cstrong>{0}\u003c\/strong> has been renamed.",AJS.escapeHtml(a.getName())),JIRA.Issues.getDefaultMessageOptions())}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterDeleteDialogView.js' */
Backbone.define("JIRA.Issues.FilterDeleteDialogView",JIRA.Issues.FilterDialogView.extend({template:JIRA.Templates.IssueNavFilter.deleteFilterDialog,initialize:function(a){_.bindAll(this);this.filterId=a.filterId;this.createDialog(a.id)},_createDialogContent:function(c){var a=this;var b=this.model.getFilterById(this.filterId);b.done(_.bind(function(d){this.filter=d;c(a.template({modifierKey:AJS.Navigator.modifierKey(),filter:d.toJSON()}))},this))},_onSubmitSuccess:function(){this.filterDialog.hide(true);this.filterDialog.destroy();var a=this.filter.getName();this.model.deleteFilter(this.filter);JIRA.Messages.showSuccessMsg(AJS.format("The filter \u003cstrong>{0}\u003c\/strong> has been deleted.",a),JIRA.Issues.getDefaultMessageOptions())}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterSaveDialogView.js' */
Backbone.define("JIRA.Issues.FilterSaveDialogView",JIRA.Issues.FilterDialogView.extend({template:JIRA.Templates.IssueNavSearchHeader.saveFilterDialog,initialize:function(a){_.bindAll(this);this._searchPageModule=a.searchPageModule;this.type=a.type;this.createDialog(a.id)},_createDialogContent:function(b){var a=this;JIRA.SmartAjax.makeRequest({url:AJS.contextPath()+"/rest/api/2/filter/defaultShareScope",contentType:"application/json"}).done(function(c){b(a._createSaveAsDialogHtml(c&&c.scope==="GLOBAL"))})},_onSubmitFilterDialog:function(c,b){c.preventDefault();var a=this;if(AJS.$("#setSharingPrivate").prop("checked")){JIRA.SmartAjax.makeRequest({url:AJS.contextPath()+"/rest/api/2/filter/defaultShareScope",type:"PUT",contentType:"application/json",processData:false,data:JSON.stringify({scope:"PRIVATE"})}).done(function(){a._sendFormAsFilter(b)})}else{this._sendFormAsFilter(b)}},_sendFormAsFilter:function(a){var c=this.filterDialog.$form;var b=JIRA.SmartAjax.makeRequest({type:"POST",url:c.attr("action")+"?expand="+JIRA.Issues.FilterModel.getExpandValue(),contentType:"application/json",processData:false,data:JSON.stringify({jql:c.find("[name=jql]").val(),name:c.find("[name=name]").val(),id:c.find("[name=filterId]").val(),favourite:true})});b.fail(this._onSubmitError);b.done(a);b.done(this._onSubmitSuccess);b.done(this._hideDialog);b.always(function(){JIRA.trace("jira.filter.saved")})},_getCurrentFilter:function(){if(this.model){return this.model}else{return this._searchPageModule.getFilter()}},_createSaveAsDialogHtml:function(d){var b=this._getCurrentFilter();var a;var e;var c=[];if(this.type===JIRA.Issues.FilterSaveDialogView.Types.COPY){a="Copy Filter"+" : "+this.model.getName();c.push({name:"filterId",value:this.model.getId()});e=AJS.format("\u526F\u672C {0}",this.model.getName())}else{a="Save Filter";if(b&&!b.getIsSystem()){c.push({name:"filterId",value:b.getId()})}c.push({name:"jql",value:this._searchPageModule.getEffectiveJql()})}return this.template({hiddenFields:c,headerText:a,prefilledFilterName:e,contextPath:AJS.contextPath(),modifierKey:AJS.Navigator.modifierKey(),copyFromAnotherUser:b&&b.getOwnerUserName()!==AJS.Meta.get("remote-user"),filterOwnerName:b&&b.getOwnerDisplayName(),isDefaultShareScopeGlobal:d,filter:(this.model)?this.model.toJSON():null})},_getFormUrl:function(a){return a.attr("action")+a.find("[name=id]").val()},_onSubmitSuccess:function(b){var a=new JIRA.Issues.FilterModel(JIRA.Issues.FilterModel.transformToModel(b));this._searchPageModule.filterModuleSaved(a,true);this._searchPageModule.setSessionSearch(a);this.filterDialog.hide(true);this.filterDialog.destroy()}}));JIRA.Issues.FilterSaveDialogView.Types={SAVE_AS:"saveAs",COPY:"copy"};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterPanelView.js' */
Backbone.define("JIRA.Issues.FilterPanelView",JIRA.Issues.BaseView.extend({events:{"click .filter-actions":"_showActionsDropdown","simpleClick .filter-list a.filter-link:not(.requires-login)":"_onClickFilter","simpleClick .new-search":"_onClickNewSearch","click .ui-dock":"_onDockFilterPanelClick","click .ui-undock":"_onUndockFilterPanelClick"},collapsedTemplate:JIRA.Templates.IssueNavFilter.collapsedFiltersPanel,template:JIRA.Templates.IssueNavFilter.filtersPanel,initialize:function(a){_.bindAll(this);JIRA.Issues.onVerticalResize(this._adjustFavouriteFiltersHeight);this.filterActionsDialogView=new JIRA.Issues.FilterActionsDialogView({el:this.$el,model:this.model,searchPageModule:a.searchPageModule});this.model.favouriteFiltersCollection.bind("change add remove reset",this.render);this.model.systemFiltersCollection.bind("change",this.render);this.panelReady=jQuery.Deferred();this.searchPageModule=a.searchPageModule;this.searchPageModule.bind("change:currentLayout",this._adjustFavouriteFiltersHeight);this.searchPageModule.bind("change:filter",this._renderSelectedFilter);this.dockFiltersIntro=JIRA.Issues.IntroDialog.create({selector:".ui-dock",id:"filters-dock-intro",template:JIRA.Templates.IssueNavFilter.dockFeatureIntro,shouldShow:_.bind(function(){return this.model.shouldShowDockIntro()&&this.$el.is(":visible")},this),beforeShow:_.bind(function(){this.$el.popoutSidebar("expand",false);return this.panelReady},this),initCallback:_.bind(function(){if(this.$el.popoutSidebar("isUndocked")){this.$el.popoutSidebar("unbindHoverIntent")}},this),hideCallback:_.bind(function(){if(this.$el.popoutSidebar("isUndocked")){this.$el.popoutSidebar("bindHoverIntent");this.$el.popoutSidebar("collapse")}},this)})},_adjustFavouriteFiltersHeight:function(){var f=AJS.$(".jira-feedback-link-container.subtle-style").outerHeight(true),d=f?f+10:0,c=this.$(".favourite-filters"),a=c.length&&c.offset().top,b=this.searchPageModule.getCurrentLayout() instanceof JIRA.Issues.SplitScreenLayout,e=jQuery(window).outerHeight();c.css("height",e-a-d)},_onDockFilterPanelClick:function(){AJS.$(".navigator-container").removeClass("navigator-sidebar-collapsed")},_onUndockFilterPanelClick:function(){AJS.$(".navigator-container").addClass("navigator-sidebar-collapsed")},toggleDockState:function(){this.$el.popoutSidebar("toggle")},_onClickFilter:function(b){b.preventDefault();var a=jQuery(b.target).data("id");this.searchPageModule.resetToFilter(a)},_onClickNewSearch:function(a){a.preventDefault();this.searchPageModule.resetToBlank({isNewSearch:true})},render:function(){if(!this.model.isDocked()){AJS.$(".navigator-container").addClass("navigator-sidebar-collapsed");this._renderCollapsed()}else{AJS.$(".navigator-container").removeClass("navigator-sidebar-collapsed");this._renderOpen()}var a=AJS.KeyboardShortcut.getKeyboardShortcutKeys("toggle.filter.panel");this.$el.popoutSidebar({isDocked:this.model.isDocked(),renderExpanded:this._renderOpen,renderCollapsed:this._renderCollapsed,undockText:"Undock",undockTitle:AJS.format("Undock the filter panel so it is hidden when not being focused (Type \'\'{0}\'\')",a),dockText:"Dock",dockTitle:AJS.format("Dock the filter panel so you can always see the list of filters (Type \'\'{0}\'\')",a),toggleTarget:".filter-title:first",persist:_.bind(function(b){this.model.setDocked(b)},this)});if(this.model.shouldShowDockIntro()){this.$el.popoutSidebar("collapse",false)}if(this.model.isDocked()){this.$el.popoutSidebar("renderDockState")}this._fireDockAnalytics();this.panelReady.resolve();return this.$el},_fireDockAnalytics:function(){if(localStorage.getItem("dockStatesAnalyticsEnabled")){var a=this.model.isDocked();if(localStorage.getItem("dockStateAnalytic")!==""+a){localStorage.setItem("dockStateAnalytic",a);JIRA.Issues.Analytics.trigger("kickass.filters.docked",{isDocked:this.model.isDocked()})}}},_renderCollapsed:function(){var a=jQuery(".jira-feedback-link-container.subtle-style").detach().addClass("left noborder");this.$el.addClass("collapsed").html(this.collapsedTemplate({isDocked:this.model.isDocked()}));JIRA.Issues.triggerHorizontalResize();a.appendTo("body");return this},_renderOpen:function(){var b=jQuery(".jira-feedback-link-container.subtle-style").detach().removeClass("left noborder");this.$el.removeClass("collapsed");this.model.favouriteFiltersCollection.sort({silent:true});this.$el.html(this.template({contextPath:window.contextPath,favouriteFilters:this.model.favouriteFiltersCollection.toJSONForTemplate(),isAnonymous:!JIRA.Issues.LoginUtils.isLoggedIn(),loginUrl:JIRA.Issues.LoginUtils.redirectUrlToCurrent(),systemFilters:this.model.systemFiltersCollection.toJSONForTemplate(),isDocked:this.model.isDocked()}));this._renderSelectedFilter();JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$el,JIRA.CONTENT_ADDED_REASON.filterPanelOpened]);var a=this;this.$el.find("a.filter-actions").each(function(e,c){var g=new AJS.Dropdown({alignment:AJS.LEFT,styleClass:"filter-actions-dropdown",content:function(){return a.filterActionsDialogView.getDropdownContents(AJS.$(c))},positioningController:new JIRA.Issues.WindowPositioning(),trigger:AJS.$(c)});var f=AJS.$(c).find("span"),d=AJS.$(c).closest("li");g.bind("hideLayer",function(){f.removeClass("active");d.removeClass("hover")});g.bind("showLayer",function(){f.addClass("active");d.addClass("hover");a.filterActionsDialogView.setElement(this.layerController.$layer)})});b.appendTo(this.$el);JIRA.Issues.triggerHorizontalResize();this._adjustFavouriteFiltersHeight();return this},_renderSelectedFilter:function(){var a=this.searchPageModule.getFilter();this.$el.find(".filter-list a").removeClass("active");if(a){this.$el.find(".filter-list a.filter-link").each(function(){var b=jQuery(this);if(b.data("id")==a.getId()){b.addClass("active").focus().blur();return false}return true})}},_showActionsDropdown:function(b){b.preventDefault();var a=AJS.$(b.target).parents("li").addClass("open");AJS.$(document).one("hideLayer",function(){a.removeClass("open")})}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterPanelModel.js' */
(function(){Backbone.define("JIRA.Issues.FilterPanelModel",JIRA.Issues.BaseModel.extend({initialize:function(a,b){var c=contextPath+"/rest/api/2/filter/favourite?expand="+JIRA.Issues.FilterModel.getExpandValue();_.extend(this,_.defaults(b,{storage:window.localStorage}));this.favouriteFiltersCollection=new JIRA.Issues.SortedFilterCollection([],{url:c});this.systemFiltersCollection=new JIRA.Issues.FilterCollection(b.systemFilters);this.favouriteFiltersCollection.on("change:favourite",this._removeUnfavouritedFilters,this);this.initialFavouritesFetch=this.favouriteFiltersCollection.fetch()},addFavouriteFilter:function(a){if(!this.favouriteFiltersCollection.get(a.getId())){this.favouriteFiltersCollection.add(a)}return this.favouriteFiltersCollection.get(a.getId())},addSystemFilters:function(a){this.systemFiltersCollection.add(a);this.systemFiltersCollection.trigger("change")},deleteFilter:function(b){var b=this.favouriteFiltersCollection.get(b),a=this.searchPageModule.getFilter();if(b){this.favouriteFiltersCollection.remove(b);if(a&&a.getId()===b.getId()){this.searchPageModule.resetToBlank()}}},getFilterById:function(b){var a=jQuery.Deferred();var c=this.systemFiltersCollection.get(b)||this.favouriteFiltersCollection.get(b);if(c){a.resolve(c)}else{c=new JIRA.Issues.FilterModel({id:b});c.fetch({success:_.bind(function(f,e){var d=this.favouriteFiltersCollection;if(c.getFavourite()){this.initialFavouritesFetch.done(function(){a.resolve(d.get(b)||c)});this.initialFavouritesFetch.fail(a.reject)}else{a.resolve(c)}},this),error:function(d){d.setIsValid(false);a.reject.apply(this,arguments)}})}return a.promise()},setDocked:function(a){this._getStorage().setItem("dockStatesAnalyticsEnabled",true);return this._getStorage().setItem("issues.sidebar.docked",a)},_removeUnfavouritedFilters:function(){var a=this.favouriteFiltersCollection;a.remove(a.filter(function(b){return !b.getFavourite()}))},setRenamedFilterName:function(a){var b=this.favouriteFiltersCollection.get(a.id);if(b){b.setName(a.name)}return b},_getStorage:function(){return this.storage||window.localStorage},_getWindowWidth:function(){return jQuery(window).width()},isDockedPrefGiven:function(){return this._getStorage().getItem("issues.sidebar.docked")!==null},shouldShowDockIntro:function(){return !this.isDocked()&&!this.isDockedPrefGiven()&&!AJS.Meta.getBoolean("hasDismissedFilterDockIntro")},isExpanded:function(){return this.shouldShowDockIntro()?false:this.isDocked()},isDocked:function(){var a=this._getStorage();if(a.getItem("issues.sidebar.docked")==null){return this._getWindowWidth()>1200}else{return a.getItem("issues.sidebar.docked")!=="false"}}}))}());
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterModule.js' */
Backbone.define("JIRA.Issues.FilterModule",JIRA.Issues.BaseEvented.extend({initialize:function(a){_.bindAll(this);this._searchPageModule=a.searchPageModule;this.newSearchFilter=new JIRA.Issues.FilterModel({name:"Search"});this.filterPanelModel=new JIRA.Issues.FilterPanelModel({},{searchPageModule:a.searchPageModule,systemFilters:a.systemFilters})},initSystemFilters:function(){var a=jQuery.Deferred(),b=!!this.filterPanelModel.systemFiltersCollection.size();if(b){a.resolve()}else{AJS.$.ajax({context:this,url:AJS.contextPath()+"/rest/issueNav/latest/systemFilters"}).done(function(c){var d=this._searchPageModule.addOwnerToSystemFilters(JSON.parse(c));this.filterPanelModel.addSystemFilters(d);a.resolve()}).fail(function(){a.reject()})}return a.promise()},addFavouriteFilter:function(a){return this.filterPanelModel.addFavouriteFilter(a)},getNewSearchFilter:function(){return this.newSearchFilter},getFilterById:function(a){return this.filterPanelModel.getFilterById(a)},createView:function(a){this.filterPanelView=new JIRA.Issues.FilterPanelView({el:a.$filterPanelEl,model:this.filterPanelModel,searchPageModule:this._searchPageModule});return this.filterPanelView},toggleFilterPanel:function(){this.filterPanelView.toggleDockState()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/filters/FilterActionsDialogView.js' */
Backbone.define("JIRA.Issues.FilterActionsDialogView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.IssueNavFilter.filterDropDown,events:{"click .rename-filter":"_renameFilter","click .copy-filter":"_copyFilter","click .unfavourite-filter":"_unFavouriteFilter","click .delete-filter":"_deleteFilter"},initialize:function(a){this._searchPageModule=a.searchPageModule;_.bindAll(this)},getDropdownContents:function(c){var d=this.model.getFilterById(c.data("id")),a=this,b=jQuery.Deferred();d.done(function(e){b.resolve(AJS.$(a.template({filter:e,canEdit:JIRA.Issues.LoginUtils.loggedInUserName()===e.getOwnerUserName()})))});return b},_renameFilter:function(a){a.preventDefault();var b=AJS.$(a.target).data("id");new JIRA.Issues.FilterRenameDialogView({id:"rename-filter-dialog",model:this.model,filterId:b}).show()},_copyFilter:function(a){a.preventDefault();var b=AJS.$(a.target).data("id");this._getFilter(b,_.bind(function(c){new JIRA.Issues.FilterSaveDialogView({id:"copy-filter-dialog",type:JIRA.Issues.FilterSaveDialogView.Types.COPY,searchPageModule:this._searchPageModule,model:c}).show()},this))},_unFavouriteFilter:function(a){a.preventDefault();var b=AJS.$(a.target).data("id");this._getFilter(b,function(c){c.saveFavourite(false)})},_deleteFilter:function(a){a.preventDefault();var b=AJS.$(a.target).data("id");new JIRA.Issues.FilterDeleteDialogView({id:"delete-filter-dialog",model:this.model,filterId:b}).show()},_getFilter:function(c,b){var a=this.model.getFilterById(c);a.done(b)}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-filter', location = 'content/js/search/util/WindowPositioning.js' */
JIRA.Issues.WindowPositioning=AJS.InlineLayer.StandardPositioning.extend({_calculateOverflow:function(c){var b=this.layer().css("position")==="fixed",a=c.top+this.layer().outerHeight(true),e=jQuery(window).outerHeight(),d=jQuery(window).scrollTop();if(b){return Math.max(0,a-e)}else{return Math.max(0,a-d-e)}},left:function(){var a=this._super(),b=this._calculateOverflow(a);if(b>0){a.left+=this.offsetTarget().outerWidth();a.top-=b}return a},right:function(){var a=this._super(),b=this._calculateOverflow(a);if(b>0){a.left-=this.offsetTarget().outerWidth();a.top-=b}return a}});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-table', location = 'content/templates/splitview.soy' */
// This file was automatically generated from splitview.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.SplitView == 'undefined') { JIRA.Templates.SplitView = {}; }


JIRA.Templates.SplitView.fullSplitView = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-group split-view"><div class="aui-item list-results-panel"><div class="list-panel"><div class="list-ordering"></div><div class="list-content">');
  if (opt_data.issuePanelData) {
    JIRA.Templates.SplitView.issueList(opt_data.issuePanelData, output);
  }
  output.append('</div></div><div class="end-of-stable-message"></div><div class="aui-group pagination-view count-pagination"><a href="#" class="refresh-table" title="', soy.$$escapeHtml("Refresh results"), '">', soy.$$escapeHtml("\u5237\u65b0"), '</a><div class="pagination">');
  if (opt_data.pagination) {
    JIRA.Templates.IssueNavTable.pagination(opt_data.pagination, output);
  }
  output.append('</div></div></div><div class="aui-item detail-panel navigator-issue-only"><div></div></div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.SplitView.structure = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.SplitView.fullSplitView({issuePanelData: null, pagination: null}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.SplitView.issueList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ol class="issue-list">');
  var iLimit22 = opt_data.issues.length;
  for (var i22 = 0; i22 < iLimit22; i22++) {
    var issue__soy23 = opt_data.issues[i22];
    var issueID__soy24 = opt_data.issueIDs[i22];
    var isHighlighted__soy25 = issueID__soy24 == opt_data.highlightedID;
    if (issue__soy23) {
      output.append('<li ', (isHighlighted__soy25) ? 'class="focused"' : '', ' data-id="', soy.$$escapeHtml(issueID__soy24), '" data-key="', soy.$$escapeHtml(issue__soy23.key), '" title="', soy.$$escapeHtml(issue__soy23.summary), '">');
      JIRA.Templates.SplitView.issueRow(issue__soy23, output);
      output.append('</li>');
    } else {
      JIRA.Templates.SplitView.inaccessibleIssueRow({isHighlighted: isHighlighted__soy25, issueID: issueID__soy24}, output);
    }
  }
  output.append('</ol>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.SplitView.orderBy = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.sortBy) ? '<a class="order-by ' + ((opt_data.sortBy.order == 'ASC') ? 'ascending' : 'descending') + '" data-field-id="' + soy.$$escapeHtml(opt_data.sortBy.fieldId) + '" data-direction="' + soy.$$escapeHtml(opt_data.sortBy.order) + '" href="#" title="' + soy.$$escapeHtml(AJS.format("Order by {0}",opt_data.sortBy.fieldName)) + '"><span>' + soy.$$escapeHtml(AJS.format("Order by {0}",opt_data.sortBy.fieldName)) + '</span></a>' : '<a class="order-by" title="' + soy.$$escapeHtml("Order by") + '"><span>' + soy.$$escapeHtml("Order by") + '</span></a>', '<a class="order-options" title="', soy.$$escapeHtml("Order options"), '">', soy.$$escapeHtml("Order options"), '</a>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.SplitView.orderByOptions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<select id="order-by-options" multiple="multiple" class="hidden"><optgroup data-footer-text="', soy.$$escapeHtml(opt_data.footer), '">');
  var optionList79 = opt_data.options;
  var optionListLen79 = optionList79.length;
  for (var optionIndex79 = 0; optionIndex79 < optionListLen79; optionIndex79++) {
    var optionData79 = optionList79[optionIndex79];
    output.append('<option title="', soy.$$escapeHtml(optionData79.fieldName), '" value="', soy.$$escapeHtml(optionData79.fieldId), '" data-meta="', soy.$$escapeHtml(optionData79.meta), '">', soy.$$escapeHtml(optionData79.fieldName), '</option>');
  }
  output.append('</optgroup></select>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.SplitView.issueRow = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<img height="16" width="16" alt="', soy.$$escapeHtml(opt_data.type.name), '" title="', soy.$$escapeHtml(opt_data.type.name), ' - ', soy.$$escapeHtml(opt_data.type.description), '" src="', soy.$$escapeHtml(opt_data.type.iconUrl), '" /><a class="splitview-issue-link issue-link-key" data-issue-key="', soy.$$escapeHtml(opt_data.key), '" href="', soy.$$escapeHtml(""), '/browse/', soy.$$escapeHtml(opt_data.key), '"> ', soy.$$escapeHtml(opt_data.key), ' </a><a class="splitview-issue-link issue-link-summary" data-issue-key="', soy.$$escapeHtml(opt_data.key), '" href="', soy.$$escapeHtml(""), '/browse/', soy.$$escapeHtml(opt_data.key), '"> ', soy.$$escapeHtml(opt_data.summary), ' </a><div class="aui-group"><div class="aui-item"><span>', soy.$$escapeHtml(opt_data.status), '</span></div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.SplitView.inaccessibleIssueRow = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="inaccessible-issue ', (opt_data.isHighlighted) ? 'focused' : '', '" data-id="', soy.$$escapeHtml(opt_data.issueID), '">', soy.$$escapeHtml("This issue can no longer be opened"), '</li>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.SplitView.issueDetailsNoSelection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-table', location = 'content/templates/issuenav-table.soy' */
// This file was automatically generated from issuenav-table.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.IssueNavTable == 'undefined') { JIRA.Templates.IssueNavTable = {}; }


JIRA.Templates.IssueNavTable.noResults = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="jira-adbox jira-adbox-medium no-results ', soy.$$escapeHtml(opt_data.cssClass), '"><h3>', opt_data.message, '</h3>', (opt_data.hint) ? '<p class="no-results-hint">' + opt_data.hint + '</p>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.resultsCount = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.IssueNavTable.resultsCountHelper({start: '<span class="results-count-start">' + soy.$$escapeHtml(opt_data.start) + '</span>', end: '<span class="results-count-end">' + soy.$$escapeHtml(opt_data.end) + '</span>', total: '<span class="results-count-total results-count-link">' + soy.$$escapeHtml(opt_data.total) + '</span>'}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.TopResultsCountBar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="issue-table-info-bar"><!-- page navigation here --><div class="results-count"></div><!--</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.resultsCountHelper = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="results-count aui-item"><span class="results-count-text">', AJS.format("\u663e\u793a{2}\u4e2a\u95ee\u9898\u4e2d\u7684  {0} \u5230 {1} .",opt_data.start,opt_data.end,opt_data.total), '</span><a href="#" class="refresh-table" title="', soy.$$escapeHtml("Refresh results"), '">', soy.$$escapeHtml("\u5237\u65b0"), '</a></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.listOptions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-list">');
  var groupList43 = opt_data.groups;
  var groupListLen43 = groupList43.length;
  for (var groupIndex43 = 0; groupIndex43 < groupListLen43; groupIndex43++) {
    var groupData43 = groupList43[groupIndex43];
    output.append((groupData43.label) ? '<h5>' + soy.$$escapeHtml(groupData43.label) + '</h5>' : '', '<ul ', (groupData43.id) ? 'id="' + soy.$$escapeHtml(groupData43.id) + '"' : '', ' class="aui-list-section', (groupIndex43 == 0) ? ' aui-first' : '', (groupIndex43 == groupListLen43 - 1) ? ' aui-last' : '', '">');
    var itemList63 = groupData43.items;
    var itemListLen63 = itemList63.length;
    for (var itemIndex63 = 0; itemIndex63 < itemListLen63; itemIndex63++) {
      var itemData63 = itemList63[itemIndex63];
      output.append('<li class="aui-list-item"><a class="aui-list-item-link" ', (itemData63.id) ? 'id="' + soy.$$escapeHtml(itemData63.id) + '"' : '', ' ', (itemData63.rel) ? 'rel="' + soy.$$escapeHtml(itemData63.rel) + '"' : '', ' href="', (! itemData63.relativeLink) ? soy.$$escapeHtml("") : '', soy.$$escapeHtml(itemData63.link), '" ', (itemData63.title) ? 'title="' + soy.$$escapeHtml(itemData63.title) + '"' : '', '>', soy.$$escapeHtml(itemData63.label), '</a></li>');
    }
    output.append('</ul>');
  }
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.views = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.sections.issue && opt_data.sections.issue.length > 0) {
    output.append('<div class="issue-panel aui-dropdown2-section">');
    JIRA.Templates.IssueNavTable.listOptions({groups: opt_data.sections.issue}, output);
    output.append('</div>');
  }
  if (opt_data.sections.filter && opt_data.sections.filter.length > 0) {
    output.append('<div class="filter-panel aui-dropdown2-section">');
    JIRA.Templates.IssueNavTable.listOptions({groups: opt_data.sections.filter}, output);
    output.append('</div>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.tools = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.IssueNavTable.listOptions(opt_data, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.endOfStableMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p>', soy.$$escapeHtml("Too many search results to display. Refine your search criteria and try again."), '</p>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.inaccessibleIssueRow = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<tr class="issuerow inaccessible-issue" rel="', soy.$$escapeHtml(opt_data.issueID), '"><td class="nav" colspan="', soy.$$escapeHtml(opt_data.columnCount), '">', soy.$$escapeHtml("This issue can no longer be opened"), '</td></tr>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-table', location = 'content/templates/issuenav-pagination.soy' */
// This file was automatically generated from issuenav-pagination.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.IssueNavTable == 'undefined') { JIRA.Templates.IssueNavTable = {}; }


JIRA.Templates.IssueNavTable.pagination = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="pagination aui-item" data-displayable-total="', soy.$$escapeHtml(opt_data.displayableTotal), '">');
  var MAX_PAGES_DISPLAYED__soy6 = 5;
  var lastPage__soy7 = Math.floor((opt_data.displayableTotal - 1) / opt_data.pageSize);
  var pageNumber__soy8 = Math.floor(opt_data.startIndex / opt_data.pageSize);
  var urlFragment__soy9 = new soy.StringBuilder(soy.$$escapeHtml(""), '/', opt_data.searchQuery, '&startIndex=');
  urlFragment__soy9 = urlFragment__soy9.toString();
  var prevStartIndex__soy15 = opt_data.startIndex - opt_data.pageSize;
  output.append((prevStartIndex__soy15 >= 0) ? '<a href="' + soy.$$escapeHtml(urlFragment__soy9) + soy.$$escapeHtml(prevStartIndex__soy15) + '" data-start-index="' + soy.$$escapeHtml(prevStartIndex__soy15) + '" class="icon icon-previous" title="' + soy.$$escapeHtml(AJS.format("Go to page {0} of {1}",pageNumber__soy8,lastPage__soy7 + 1)) + '"><span>&lt;&lt; ' + soy.$$escapeHtml("\u4e0a\u4e00\u9875") + '</span></a>' : '');
  JIRA.Templates.IssueNavTable.numberLinksLogicBranch({startPage: pageNumber__soy8 - Math.floor(MAX_PAGES_DISPLAYED__soy6 / 2), endPage: pageNumber__soy8 + Math.floor(MAX_PAGES_DISPLAYED__soy6 / 2), lastPage: lastPage__soy7, urlFragment: urlFragment__soy9, currentPage: pageNumber__soy8 + 1, maxPagesDisplayed: MAX_PAGES_DISPLAYED__soy6, pageSize: opt_data.pageSize, displayableTotal: opt_data.displayableTotal}, output);
  var nextStartIndex__soy37 = Math.min(opt_data.startIndex + opt_data.pageSize, opt_data.displayableTotal);
  output.append((nextStartIndex__soy37 < opt_data.displayableTotal) ? '<a href="' + soy.$$escapeHtml(urlFragment__soy9) + soy.$$escapeHtml(nextStartIndex__soy37) + '" data-start-index="' + soy.$$escapeHtml(nextStartIndex__soy37) + '" class="icon icon-next" title="' + soy.$$escapeHtml(AJS.format("Go to page {0} of {1}",pageNumber__soy8 + 2,lastPage__soy7 + 1)) + '"><span>' + soy.$$escapeHtml("\u4e0b\u4e00\u9875") + ' &gt;&gt;</span></a>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.numberLinksLogicBranch = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.lastPage < opt_data.maxPagesDisplayed) {
    JIRA.Templates.IssueNavTable.numberLinks(soy.$$augmentData(opt_data, {startPage: 0, endPage: opt_data.lastPage}), output);
  } else {
    if (opt_data.startPage < 0) {
      JIRA.Templates.IssueNavTable.numberLinks(soy.$$augmentData(opt_data, {startPage: 0, endPage: opt_data.endPage - opt_data.startPage}), output);
    } else if (opt_data.endPage > opt_data.lastPage) {
      JIRA.Templates.IssueNavTable.numberLinks(soy.$$augmentData(opt_data, {startPage: opt_data.startPage - (opt_data.endPage - opt_data.lastPage), endPage: opt_data.lastPage}), output);
    } else {
      JIRA.Templates.IssueNavTable.numberLinks(opt_data, output);
    }
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavTable.numberLinks = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var size__soy72 = opt_data.endPage - opt_data.startPage + 1;
  if (size__soy72 > 1) {
    var iLimit75 = Math.round(size__soy72);
    for (var i75 = 0; i75 < iLimit75; i75++) {
      var pageIndex__soy76 = i75 + opt_data.startPage;
      var pageNumber__soy77 = pageIndex__soy76 + 1;
      var pageStartIndex__soy78 = pageIndex__soy76 * opt_data.pageSize;
      var pageEndIndex__soy79 = Math.min(pageStartIndex__soy78 + opt_data.pageSize, opt_data.displayableTotal);
      var pageBoundaries__soy80 = new soy.StringBuilder(soy.$$escapeHtml(AJS.format("Issues {0} - {1}",pageStartIndex__soy78 + 1,pageEndIndex__soy79)));
      pageBoundaries__soy80 = pageBoundaries__soy80.toString();
      output.append(' ', (pageNumber__soy77 == opt_data.currentPage) ? '<strong title="' + soy.$$escapeHtml(pageBoundaries__soy80) + '">' + soy.$$escapeHtml(pageNumber__soy77) + '</strong>' : '<a href="' + soy.$$escapeHtml(opt_data.urlFragment) + soy.$$escapeHtml(pageStartIndex__soy78) + '" data-start-index="' + soy.$$escapeHtml(pageStartIndex__soy78) + '" title="' + soy.$$escapeHtml(pageBoundaries__soy80) + '">' + soy.$$escapeHtml(pageNumber__soy77) + '</a>');
    }
  }
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-table', location = 'content/js/components/table/IssueSearchManager.js' */
Backbone.define("JIRA.Issues.IssueSearchManager",JIRA.Issues.BaseEvented.extend({namedEvents:["beforeSearch","searchError"],initialize:function(a){_.extend(this,a);this.issueKeys=new JIRA.Issues.AsyncData()},hasInitialSearch:function(){return !!this.initialIssueTableState},search:function(c){var b,a;c=_.defaults({},c,{startIndex:0,useUserColumns:true});if(this.activeResultsReq){if(JSON.stringify(this.activeRequestData)===JSON.stringify(c)){return jQuery.Deferred().reject().promise()}else{this.activeResultsReq.abort()}}this.activeRequestData=c;this.triggerBeforeSearch();if(this.hasInitialSearch()){b=jQuery.Deferred().resolve(this.initialIssueTableState);a="jira.search.finished.initial";this.initialIssueTableState=null;this.initialIssueIds=null}else{b=this.activeResultsReq=this._doSearch(c);a="jira.search.finished.secondary"}b.always(_.bind(function(){this.activeResultsReq=null;this.activeRequestData=null;JIRA.trace(a)},this));b.done(_.bind(this._updateIssueKeysOnSearchSuccess,this));b.fail(_.bind(function(){this.issueKeys.reset();this.triggerSearchError();_.defer(JIRA.trace,"jira.search.finished")},this));return b.pipe(function(d){if(d.issueTable){delete d.issueTable.issueKeys}return d}).promise()},_doSearch:function(c){var b=/^-?\d+$/;if(c.filterId&&!b.test(c.filterId)){var a={status:400,responseText:JSON.stringify({errors:[AJS.format("\u65E0\u6548\u7684\u8FC7\u6EE4\u5668 id \'\'{0}\'\'\u3002 \u8FC7\u6EE4\u5668id\u5FC5\u987B\u4E3A\u6570\u5B57\u683C\u5F0F\u3002",c.filterId)]})};return jQuery.Deferred().reject(a).promise()}return jQuery.ajax({type:"POST",url:AJS.contextPath()+"/rest/issueNav/1/issueTable",data:_.extend(c,{layoutKey:JIRA.Issues.LayoutPreferenceManager.getPreferredLayoutKey()})})},_updateIssueKeysOnSearchSuccess:function(a){var c=a.issueTable.issueIds;var b=a.issueTable.issueKeys;if(c&&b){var d={};_.each(c,function(f,e){d[f]={value:b[e],error:false}});this.issueKeys.reset(d)}else{var d=JIRA.Issues.IssueSearchManager._extractIssueKeysFromTable(a.issueTable.table);this.issueKeys.reset(d)}},getRowsForIds:function(b,a){if(!b.length){return jQuery.Deferred().resolve({}).promise()}var c=jQuery.ajax({data:{id:b,layoutKey:JIRA.Issues.LayoutPreferenceManager.getPreferredLayoutKey(),columns:a},type:"POST",url:AJS.contextPath()+"/rest/issueNav/1/issueTable/stable"});c.fail(_.bind(function(){this.triggerSearchError()},this));return c.pipe(function(d){return{table:d.issueTable.table}}).done(_.bind(function(d){this.issueKeys.setMultiple(JIRA.Issues.IssueSearchManager._extractIssueKeysFromTable(d.table,b));_.defer(JIRA.trace,"jira.search.finished")},this)).promise()},setAsInaccessible:function(a){return this.issueKeys.setError(a)}},{_extractIssueKeysFromTable:function(a,b){var c={};AJS.$(a).find(".issuerow").each(function(f){var d=AJS.$(this);var g=b?b[f]:d.attr("rel");var e=d.data("issuekey")||null;if(g){c[g]=e?{value:e,error:false}:{error:true}}});return c}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-table', location = 'content/js/components/table/IssueTableView.js' */
(function(a){Backbone.define("JIRA.Issues.IssueTableView",JIRA.Issues.BaseView.extend({events:{"blur .hidden-link":"_onHiddenLinkBlur","click .sortable":"_onSort","click tr.issuerow":"_onClickRow"},inaccessibleIssueRowTemplate:JIRA.Templates.IssueNavTable.inaccessibleIssueRow,initialize:function(b){this.search=b.search;this.searchPromise=this._createSearchPromise({done:this._onSearchDone,fail:this._onSearchFail});this.searchResults=b.searchResults;this.addListener(this.searchResults,"issueDeleted",this.handleIssueDeleted,this);this.addListener(this.searchResults,"issueUpdated",this.handleIssueUpdated,this);this.addListener(this.searchResults,"highlightedIssueChange",this.focusHighlightedIssue,this);this.addListener(this.searchResults,"newPayload",this.renderNewSearch,this);this.addListener(this.searchResults,"startIndexChange",this.renderNewSearch,this);this.search.onSearchError(this._onSearchFail,this);this.emptyResultsView=new JIRA.Issues.EmptyResultsView({searchResults:this.searchResults,el:this.$el});this.lastRenderedState={requestId:null,startIndex:null};this.topResultsCountView=new JIRA.Issues.ResultsCountView({model:this.searchResults,search:this.search});this.paginationView=new JIRA.Issues.ResultsCountView({el:this.$(".count-pagination"),model:this.searchResults,search:this.search});this.paginationView.setEndOfStableSearchMessage(this.$(".end-of-stable-message"))},deactivate:function(){this.search.offSearchError(this._onSearchFail,this);this.searchPromise.reset();this.paginationView.deactivate();JIRA.Issues.BaseView.prototype.deactivate.apply(this,arguments)},getIssueRowById:function(c,b){b=b?jQuery(b):this.$el;return b.find("#issuerow"+c)},handleIssueDeleted:function(b){this.getIssueRowById(b.id).hide();this._showPending();this.render({force:true})},handleIssueInaccessible:function(b){this.getIssueRowById(b).replaceWith(this.inaccessibleIssueRowTemplate({columnCount:this.$el.find("thead > tr > th").length,issueID:b}))},handleIssueUpdated:function(d,b){var c=this.getIssueRowById(d,b.table);this.getIssueRowById(d).replaceWith(c);JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[c,JIRA.CONTENT_ADDED_REASON.issueTableRowRefreshed]);this.focusIssue(d);JIRA.trace("jira.search.finished")},show:function(){this.focusHighlightedIssue()},_onSort:function(b){b.preventDefault();this.search.doSort({fieldId:a(b.currentTarget).data("id")})},selectNext:function(){var b=this.getSelectedRow().next();if(b.length===1&&b.hasClass("issuerow")){this.selectInModel(b)}else{this.searchResults.nextPage().done(_.bind(function(){this.selectInModel(this.$(".issuerow:first"));jQuery(window).scrollTop(0)},this))}},selectPrev:function(){var b=this.getSelectedRow().prev();if(b.length===1&&b.hasClass("issuerow")){this.selectInModel(b)}else{this.searchResults.previousPage().done(_.bind(function(){this.selectInModel(this.$(".issuerow:last"))},this))}},getSelectedRow:function(){return this.$(".issuerow").eq(this.searchResults.getSelectedIssueIndex())},selectIssueById:function(c){var b=this.$(".issuerow[rel='"+c+"']");if(b.length){this.selectInModel(b)}else{this.searchResults.clearSelectedIssue()}},focusHighlightedIssue:function(){var b=this.searchResults.getHighlightedIssue();b&&this.focusIssue(b.getId(),true)},focusIssue:function(e,d){var c=this.$(".issuerow.focused"),b;if(e!=null){c.removeClass("focused");b=this.$(".issuerow[rel='"+e+"']");b.addClass("focused");this._postFocusRenderActions(b,d)}},_postFocusRenderActions:function(b,c){if(b.is(":visible")){_.defer(function(){b.scrollIntoView({marginBottom:50});if(!c){b.find(".hidden-link").removeAttr("tabIndex").focus()}})}},render:function(b){b=_.defaults({},b,{force:false});if(this._updateLastRenderedState()||b.force){return this.searchPromise.add(this.searchResults.getResultsForPage())}else{return jQuery.Deferred().resolve().promise()}},renderNewSearch:function(){if(this._updateLastRenderedState()){this.showSearchInProgress();this.searchPromise.add(this.searchResults.getResultsForPage())}},_postRenderActions:function(){var b=this.$el;_.defer(_.bind(function(){this._triggerTableUpdatedEvent()},this))},_triggerTableUpdatedEvent:function(){AJS.$(document).trigger("resultsWidthChanged");JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$el,JIRA.CONTENT_ADDED_REASON.issueTableRefreshed])},_prepareTable:function(b){b.find("#issuetable").wrap('<div class="issue-table-container"/>');b.children().addClass("navigator-results");b.find(".sortable").each(function(){this.onclick=null});this._decorateTableWithIssueIDs(b);this._decorateTableHeaderWithSortOptions(b);this._fixTableForIE(b);return b},_handleRowSelection:function(){if(this.searchResults.initialSelectedIssueId){this.selectIssueById(this.searchResults.initialSelectedIssueId);this.searchResults.initialSelectedIssueId=null}},_decorateTableWithIssueIDs:function(c){var b=this.searchResults.getPageIssueIds();c.find(".issuerow").attr("rel",function(d){return b[d]})},_decorateTableHeaderWithSortOptions:function(d){var h=this.searchResults.getSortBy();if(h){var c=h.fieldId;var b=h.order;var g=d.find(".rowHeader .sortable").filter('[data-id="'+c+'"]');if(g.size()&&!g.hasClass("descending")&&!g.hasClass("ascending")){var e=this.$(".rowHeader .sortable");e.filter(".descending").removeClass("descending active").addClass("colHeaderLink");e.filter(".ascending").removeClass("ascending active").addClass("colHeaderLink");var f=b=="DESC"?"descending":"ascending";g.removeClass("colHeaderLink").addClass("active "+f)}}},_fixTableForIE:function(b){if(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)===9){b.find("table, tbody, thead, tr").contents().filter(function(){return this.nodeType===3}).remove()}},showSearchInProgress:function(){this._showPending()},_handleError:function(){this._hidePending()},_handleAndRenderError:function(b){this._handleError();JIRA.Messages.showMessageAtTarget(b,{closeable:true,target:this.$el.empty(),type:JIRA.Templates.Issues.Util.errorMessage})},_onClickRow:function(c){var b=a(c.target).closest("tr.issuerow");if(b.length){this.searchResults.highlightIssueById(b.attr("rel"),{preventFocus:true})}},_onHiddenLinkBlur:function(b){a(b.target).attr("tabIndex",-1)},_createSearchPromise:function(b){var c=jQuery.RecurringPromise();b=b||{};b.done&&c.done(_.bind(b.done,this));b.fail&&c.fail(_.bind(b.fail,this));return c},_onSearchDone:function(c){var c=a(c),b=a("<div/>").addClass("list-view").append(JIRA.Templates.IssueNavTable.TopResultsCountBar()).append(c);this._hidePending();this.topResultsCountView.setElement(b.find(".issue-table-info-bar"));if(!this.searchResults.hasIssues()){this.emptyResultsView.render()}else{this.topResultsCountView.render();if(c.length>0){this.$el.empty().append(this._prepareTable(b))}this.paginationView.setElement(this.$(".count-pagination"));this.paginationView.setEndOfStableSearchMessage(this.$(".end-of-stable-message"));this.paginationView.render();if(!this.searchResults.hasHighlightedIssue()){this.searchResults.highlightFirstInPage()}this.focusHighlightedIssue()}this._postRenderActions();JIRA.trace("jira.search.stable.update")},_onSearchFail:function(){this.$el.removeClass("pending");this.emptyResultsView.render()},_updateLastRenderedState:function(){var c,b=this.lastRenderedState;c=this.lastRenderedState={resultsId:this.searchResults.getResultsId(),startIndex:this.searchResults.getStartIndex()};return !_.isEqual(b,c)},_hidePending:function(){this.$el.removeClass("pending empty-results")},_showPending:function(){this.$el.addClass("pending")}}))})(jQuery);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-table', location = 'content/js/components/table/ToolPreferencesModel.js' */
Backbone.define("JIRA.Issues.ToolPreferencesModel",JIRA.Issues.BaseModel.extend({properties:["useUserColumns"],defaults:{useUserColumns:false}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-table', location = 'content/js/components/table/IssueTableOperationsView.js' */
JIRA.Issues.IssueTableOperationsView=JIRA.Issues.BaseView.extend({events:{"click .refresh-table":"onRefreshTable"},initialize:function(a){_.bindAll(this);_.extend(this,a);this.addListener(this.search,"searchError",this._onSearchError,this);this.addListener(this.search.getResults(),"newPayload",this._onSearchSuccess,this)},onRefreshTable:function(a){a.preventDefault();JIRA.Issues.Analytics.trigger("kickass.issueTableRefresh");this.search.refresh()},_onSearchError:function(){this.$el.find("li:not(:has(.refresh-table))").hide()},_onSearchSuccess:function(){var a=this.search.getResults().getTotal()>0;this.$el.find("li:not(:has(.refresh-table))").toggle(a)}});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-table', location = 'content/js/components/table/HeaderOperationsView.js' */
JIRA.Issues.IssueTableHeaderOperationsView=JIRA.Issues.BaseView.extend({initialize:function(a){_.bindAll(this);_.extend(this,a);this.initTools();this.initViews();this.initShare();this._results=this.search.getResults();this._results.onNewPayload(this._onSearchSuccess)},initViews:function(){var a=this.searchPageModule;a.on("change",this._updateFilterPageResources);this._updateFilterPageResources();new JIRA.Issues.Tipsy({el:AJS.$(".header-views",this.$el),showCondition:":not(.active)"});var b=this._spinnerTimeoutKeeper(".header-views");AJS.Dropdown.create({styleClass:"header-views-menu aui-style-default",trigger:AJS.$(".header-views",this.$el),ajaxOptions:function(){var d={jql:a.getEffectiveJql()},c=a.getFilter();if(c&&!c.getIsSystem()){d.filterId=c.getId();if(a.isDirty()){d.jql=a.getJql();d.modified=true}}b.start();return{url:contextPath+"/rest/issueNav/1/issueNav/operations/views",type:"POST",data:d,dataType:"json",cache:false,formatSuccess:function(e){b.end();return AJS.$(JIRA.Templates.IssueNavTable.views({sections:e,contextPath:contextPath}))}}}})},initTools:function(){var a=this,b=this.searchPageModule;AJS.$("body").delegate("#use-cols","click",function(d){d.preventDefault();a.toolPreferencesModel.setUseUserColumns(true)});AJS.$("body").delegate("#use-filter-cols","click",function(d){d.preventDefault();a.toolPreferencesModel.setUseUserColumns(false)});new JIRA.Issues.Tipsy({el:AJS.$(".header-tools",this.$el),showCondition:":not(.active)",tipsy:{gravity:"ne"}});var c=this._spinnerTimeoutKeeper(".header-tools");AJS.Dropdown.create({styleClass:"header-tools-menu",trigger:AJS.$(".header-tools",a.$el),ajaxOptions:function(){var e,d=b.getFilter();e={jql:b.getEffectiveJql(),searchResultsTotal:a._results.getDisplayableTotal(),searchResultsPages:a._results.getNumberOfPages(),useColumns:!a.toolPreferencesModel.getUseUserColumns(),skipColumns:b.getActiveLayout().id==="split-view"};if(d&&!d.getIsSystem()){e.filterId=d.getId();if(b.isDirty()){e.jql=b.getJql()}}c.start();return{url:contextPath+"/rest/issueNav/1/issueNav/operations/tools",type:"POST",data:e,dataType:"json",cache:false,formatSuccess:function(f){c.end();if(f&&f.length==0){return AJS.$('<div class="menu-empty-content"></span>'+"No Available Option(s)"+"<div>")}else{return AJS.$(JIRA.Templates.IssueNavTable.tools({groups:f,contextPath:contextPath}))}}}}})},initShare:function(){new JIRA.Issues.Tipsy({el:AJS.$(".issuenav-share",this.$el),showCondition:":not(.active)"})},_onSearchSuccess:function(){AJS.$(".header-tools").toggle(this.search.getResults().getDisplayableTotal()>0)},_updateFilterPageResources:function(){var d=this.$el.find(".operations-view-data > fieldset"),b=this.searchPageModule;d.empty();if(b.getFilter()&&!b.isDirty()){AJS.$('<input type="hidden" id="filterId" />').val(b.getFilter().getId()).appendTo(d);AJS.$('<input type="hidden" id="jql" />').val("").appendTo(d)}else{AJS.$('<input type="hidden" id="filterId" />').val("");AJS.$('<input type="hidden" id="jql" />').val(b.getJql()).appendTo(d)}var c=b.getFilter(),a=c&&c.getId();if(a&&!c.getIsSystem()&&!b.isDirty()){AJS.Meta.set("filter-id",a);AJS.Meta.set("filter-jql",undefined)}else{AJS.Meta.set("filter-id",undefined);AJS.Meta.set("filter-jql",b.getEffectiveJql())}},_spinnerTimeoutKeeper:function(a){var b=undefined;return{start:function(){if(b){b=clearTimeout(b)}b=setTimeout(function(){b=undefined;AJS.$(a).addClass("spinner")},1000)},end:function(){b=clearTimeout(b);AJS.$(a).removeClass("spinner")}}}});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-jql', location = 'content/templates/issuenav-query-jql.soy' */
// This file was automatically generated from issuenav-query-jql.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.IssueNavQueryJql == 'undefined') { JIRA.Templates.IssueNavQueryJql = {}; }


JIRA.Templates.IssueNavQueryJql.jqlQueryView = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="advanced-search-container"><div class="aui-group"><div class="aui-item atlassian-autocomplete">', (AJS.params.autocompleteEnabled) ? '<label for="advanced-search"><span id="jqlerrormsg" class="icon jqlgood"><span>' + soy.$$escapeHtml("parse") + '</span></span> <span class="jql-label">' + soy.$$escapeHtml("\u67e5\u8be2:") + ' <span id="jqlcolrowcount">' + soy.$$escapeHtml("\u884c") + ':<span id="jqlrownum">0</span>' + soy.$$escapeHtml("\u5b57\u7b26") + ':<span id="jqlcolumnnum">0</span></span></span></label>' : '', '<textarea id="advanced-search" class="search-entry advanced-search ajs-dirty-warning-exempt', (! AJS.params.autocompleteEnabled) ? ' jql-autocomplete-disabled' : '', '" name="jql"></textarea></div><div class="aui-item search-button-container"><button class="aui-item aui-button aui-button-subtle search-button" type="submit" title="', soy.$$escapeHtml("Search for issues"), '"><span class="aui-icon aui-icon-small aui-iconfont-search">', soy.$$escapeHtml("Search"), '</span></button><span class="switcher"></span></div></div><a class="syntax-help" href="', soy.$$escapeHtml(opt_data.helpUrl), '" title="', soy.$$escapeHtml("\u8bed\u6cd5"), '" target="_jirahelp" tabindex="-1"><span class="aui-icon aui-icon-small aui-iconfont-help">', soy.$$escapeHtml("\u8bed\u6cd5"), '</span></a></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-jql', location = 'content/js/search/query/jql/JqlQueryModule.js' */
Backbone.define("JIRA.Issues.JqlQueryModule",JIRA.Issues.BaseEvented.extend({namedEvents:["searchRequested"],initialize:function(a){this._searchPageModule=a.searchPageModule;this.view=new JIRA.Issues.JqlQueryView({searchPageModule:a.searchPageModule})},search:function(){var a=this.view.readJql();this.triggerSearchRequested(a)},queryChanged:function(){this.view.setQuery(this._searchPageModule.getEffectiveJql())},createView:function(){return this.view}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-jql', location = 'content/js/search/query/jql/JqlQueryView.js' */
Backbone.define("JIRA.Issues.JqlQueryView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.IssueNavQueryJql.jqlQueryView,events:{expandedOnInput:"_handleExpandOnInput"},initialize:function(a){_.bindAll(this);this.searchPageModule=a.searchPageModule;AJS.$(document).bind("issueNavWidthChanged",this._resizeHeight);if(JIRA.Issues.JQLAutoCompleteView){this.JQLAutoCompleteView=new JIRA.Issues.JQLAutoCompleteView()}},render:function(b){this.$el.html(this.template({helpUrl:AJS.Meta.get("advanced-search-help-url"),helpTitle:AJS.Meta.get("advanced-search-help-title")}));this.$el.addClass("loading");if(this.JQLAutoCompleteView){this.JQLAutoCompleteView.setElement(this.$el.find(".advanced-search"));this.JQLAutoCompleteView.getJqlAutoCompleteData()}var a=this.searchPageModule.getJqlDeferred();a.done(this.setQuery);if(b){a.done(b)}this.$el.find(".search-button").tipsy({trigger:"hover",delayIn:300});return this},readJql:function(){var a=this._getInputField();var b=a.val()||"";var c=AJS.$.trim(b);if(b!==c){a.val(c)}this._resizeHeight();return c},_handleExpandOnInput:function(){JIRA.Issues.triggerVerticalResize()},_resizeHeight:function(){var a=this._getInputField();if(a.val()){a.height(0).expandOnInput()}else{a.expandOnInput().height(0).trigger("refreshInputHeight")}},setQuery:function(a){this.$el.removeClass("loading");this._getInputField().val(a);this._getInputField().trigger("updateParseIndicator");this._resizeHeight()},focus:function(){this._getInputField().focus()},_getInputField:function(){return this.$el?this.$el.find("textarea"):AJS.$()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/templates/issuenav-query-basic.soy' */
// This file was automatically generated from issuenav-query-basic.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.IssueNavQueryBasic == 'undefined') { JIRA.Templates.IssueNavQueryBasic = {}; }


JIRA.Templates.IssueNavQueryBasic.basicQueryView = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="search-criteria"><ul class="criteria-list"><li class="text-query hidden"><div class="text-query-container"><input class="search-entry text ajs-dirty-warning-exempt" id="searcher-query" type="text" name="text" placeholder="', soy.$$escapeHtmlAttribute("Contains text"), '" /></div></li><li class="criteria-actions"></li><li><button class="aui-button aui-button-subtle search-button" type="submit" title="', soy.$$escapeHtmlAttribute("Search for issues"), '"><span class="aui-icon aui-icon-small aui-iconfont-search">', soy.$$escapeHtml("Search"), '</span></button></li><li class="switcher"></li></ul></div><div class="search-criteria-extended"><ul class="criteria-list"></ul></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavQueryBasic.criteriaButton = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<button type="button" data-id="', soy.$$escapeHtmlAttribute(opt_data.id), '" class="criteria-selector aui-button aui-button-subtle drop-arrow" /><a href="#" class="remove-filter" title="', soy.$$escapeHtmlAttribute("Remove criterion"), '" tabindex="-1"><span class="aui-icon aui-icon-small aui-iconfont-remove"></span></a>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavQueryBasic.criteriaButtonContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="criteria-wrap">', (opt_data.extended || ! opt_data.viewHtml) ? '<span class="fieldLabel">' + soy.$$escapeHtml(opt_data.name) + ':</span> ' : '', (opt_data.viewHtml) ? opt_data.viewHtml : soy.$$escapeHtml("All"), '</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavQueryBasic.lozengeDropdownContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form id="issue-filter" action="#" class="searchfilter aui top-label aui-popup-content"><div class="form-body"></div>', (opt_data.displayBackButton) ? '<a href="#" class="back">' + soy.$$escapeHtml("Back") + '</a>' : '', (opt_data.displayUpdateCancel) ? '<div class="buttons-container form-footer"><div class="buttons"><input type="submit" name="filter" class="aui-button filter" value="' + soy.$$escapeHtmlAttribute("Update") + '" /><a href="#" class="aui-button aui-button-link cancel-update">' + soy.$$escapeHtml("Close") + '</a></div></div>' : '', '</form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavQueryBasic.lozengeDropdownCannotEdit = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="searcher-no-edit-content">');
  JIRA.Templates.Issues.Util.auiMessage({typeClass: 'info', messages: [AJS.format("To search by {0} please switch to advanced.",opt_data.fieldName)]}, output);
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavQueryBasic.clauseButtonView = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<button type="button" class="add-criteria aui-button aui-button-subtle drop-arrow" title="', soy.$$escapeHtmlAttribute("Add more fields to search with"), '">', soy.$$escapeHtml("More"), '</button>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavQueryBasic.searcherDropdownContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="searcher-groups available"><ul>');
  var groupList59 = opt_data.searcherGroups;
  var groupListLen59 = groupList59.length;
  for (var groupIndex59 = 0; groupIndex59 < groupListLen59; groupIndex59++) {
    var groupData59 = groupList59[groupIndex59];
    output.append('<li class="twixi-block ', (groupIndex59 == 0) ? 'expanded' : 'collapsed', '" data-id="', soy.$$escapeHtmlAttribute(groupData59.id), '"><div class="twixi-trigger">', soy.$$escapeHtml(groupData59.name), '</div><ul class="twixi-content">');
    var searcherList71 = groupData59.searchers;
    var searcherListLen71 = searcherList71.length;
    for (var searcherIndex71 = 0; searcherIndex71 < searcherListLen71; searcherIndex71++) {
      var searcherData71 = searcherList71[searcherIndex71];
      output.append('<li><a href="#" data-id="', soy.$$escapeHtmlAttribute(searcherData71.id), '" class="searcher-option" >', soy.$$escapeHtml(searcherData71.name), '</a></li>');
    }
    output.append('</ul></li>');
  }
  output.append('</ul><div class="buttons-container"><div class="buttons"><a href="#" class="aui-button aui-button-link">', soy.$$escapeHtml("Close"), '</a></div></div></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/TextQueryBuilder.js' */
AJS.namespace("JIRA.Issues.TextQueryBuilder");JIRA.Issues.TextQueryBuilder={BACKSLASH_PATTERN:/\\/g,MULTIPLE_WHITESPACE_PATTERN:/\s+/g,QUOTE_PATTERN:/\"/g,DOUBLE_BACKSLASH:"\\\\",buildJql:function(a){if(!a){return""}a=""+a;a=AJS.$.trim(a);a=a.replace(this.BACKSLASH_PATTERN,this.DOUBLE_BACKSLASH);a=a.replace(this.MULTIPLE_WHITESPACE_PATTERN," ");a=a.replace(this.QUOTE_PATTERN,'\\"');return this.createQueryClause(a)},createQueryClause:function(a){return'text ~ "'+a+'"'}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/BasicQueryModule.js' */
Backbone.define("JIRA.Issues.BasicQueryModule",JIRA.Issues.BaseEvented.extend({namedEvents:["jqlTooComplex","searchRequested"],initialize:function(a){this._searchPageModule=a.searchPageModule;this.searcherCollection=new JIRA.Issues.SearcherCollection([],{fixedLozenges:a.primaryClauses,searchPageModule:a.searchPageModule,initData:a.initialSearcherCollectionState});this.view=new JIRA.Issues.BasicQueryView({searcherCollection:this.searcherCollection});this.searcherCollection.bindSearchRequested(_.bind(function(b){JIRA.Issues.Analytics.trigger("kickass.basicModeCriteriaCountWhenSearching",{count:this.searcherCollection.getAllSelectedCriteriaCount()});var c=this._attachOrderByClause(b);this.triggerSearchRequested(c)},this));this.searcherCollection.bindJqlTooComplex(_.bind(function(b){this.triggerJqlTooComplex(b)},this))},hasErrors:function(){var a=this.searcherCollection.any(function(b){return b.hasErrorInEditHtml()});return a},clear:function(){this.searcherCollection.clear()},queryChanged:function(){this.searcherCollection.restoreFromQuery(this._searchPageModule)},queryReset:function(){this.searcherCollection.setInteractive(false);return this.searcherCollection.restoreFromQuery(this._searchPageModule,true).always(_.bind(function(){this.searcherCollection.setInteractive(true)},this))},searchersReady:function(){return this.searcherCollection.searchersReady()},createView:function(){return this.view},getSelectedCriteria:function(){return this.searcherCollection.getAllSelectedCriteria()},_attachOrderByClause:function(a){var b=/\bORDER\s+BY\b.*$/i;var c=b.exec(this._searchPageModule.getEffectiveJql());if(c&&b.exec(a)===null){a=a?a+" "+c[0]:c[0]}return a}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/CriteriaView.js' */
Backbone.define("JIRA.Issues.CriteriaView",JIRA.Issues.BaseView.extend({tagName:"li",template:JIRA.Templates.IssueNavQueryBasic.criteriaButton,contentTemplate:JIRA.Templates.IssueNavQueryBasic.criteriaButtonContent,events:{"click .criteria-selector":"_onClickCriteriaSelector","click .remove-filter":"_onClickRemoveCriteria","mousedown .remove-filter":"_preventFocusWhileDisabled",keydown:"_onKeydown"},initialize:function(a){this.extended=a.extended;this.searcherCollection=a.searcherCollection;this.searcherCollection.bindCollectionChanged(this.update,this);this.searcherCollection.bindInteractiveChanged(this._handleInteractiveChanged,this);this.searcherCollection.bind("change:isSelected",this._onCriteriaSelectionChanged,this);JIRA.Issues.SearcherDialog.instance.onHide(_.bind(this._addTooltip,this));JIRA.Issues.SearcherDialog.instance.onShow(_.bind(this._onCriteriaDialogShow,this))},render:function(){this.$el.html(this.template({id:this.model.getId()}));this.$el.attr("data-id",this.model.getId());if(this.extended){this.$el.addClass("extended-searcher")}this.update();this.prepareForDisplay()},prepareForDisplay:function(){this._addTooltip();this.delegateEvents()},update:function(){var g=this.searcherCollection.length===0;var f=this._getSearcher();var b=this._isValidSearcher();var e=!g&&!f;var a=g||!b;var d=this.$("button");var c=this.$(".remove-filter");this.$el.toggleClass("hidden",e);d.attr("aria-disabled",a?"true":null).html(this.contentTemplate({name:f&&f.getName()||this.model.getName(),viewHtml:f&&f.getViewHtml(),extended:this.extended}));this.$el.toggleClass("invalid-searcher",!b).toggleClass("partial-invalid-searcher",(b&&d.find(".invalid_sel").length!==0));c.toggle(!b||!!this.extended);return this},destroy:function(){this.tipsy.hide();this.$el.remove()},_getSearcher:function(){return this.searcherCollection.get(this.model.getId())},_isValidSearcher:function(){var a=this._getSearcher();return !a||!(a.getValidSearcher()===false)},_containsInvalidValue:function(a){return(AJS.$(a.getViewHtml()).find(".invalid_sel").length>0)},_showDialog:function(){if(this.searcherCollection.isInteractive()&&this._getSearcher()&&this._isValidSearcher()){JIRA.Issues.SearcherDialog.instance.show(this._getSearcher())}},_removeCriteria:function(b){var a=this.extended||!this._isValidSearcher();if(this.searcherCollection.isInteractive()&&a){this.searcherCollection.triggerBeforeCriteriaRemoved(this.model.getId(),b);_.defer(_.bind(function(){this.searcherCollection.clearClause(this.model.getId())},this))}},_getTooltipText:function(){var b=this.searcherCollection.get(this.model.getId());var a;if(!this._isValidSearcher()){a="This criteria is not valid for the project and\/or issue type"}else{if(this._containsInvalidValue(b)){a="This criteria contains invalid value(s)"}else{a=b.getTooltipText()}}return b&&a||""},_addTooltip:function(){this.tipsy=new JIRA.Issues.Tipsy({el:this.$el,showCondition:this.searcherCollection.isInteractive,tipsy:{title:_.bind(this._getTooltipText,this)}})},_handleInteractiveChanged:function(a){this.$("button, .remove-filter").attr("aria-disabled",(a)?null:"true")},_onClickCriteriaSelector:function(a){if(this.searcherCollection.isInteractive()&&this._getSearcher()&&this._isValidSearcher()){JIRA.Issues.SearcherDialog.instance.toggle(this._getSearcher())}a.preventDefault()},_onClickRemoveCriteria:function(a){this._removeCriteria();a.preventDefault()},_onKeydown:function(a){switch(a.which){case AJS.$.ui.keyCode.DOWN:this._showDialog();break;case AJS.$.ui.keyCode.ESCAPE:this.$("button:focus").blur();break;case AJS.$.ui.keyCode.BACKSPACE:this._removeCriteria(-1);break;case AJS.$.ui.keyCode.DELETE:this._removeCriteria(1);break;default:return}a.preventDefault()},_onCriteriaDialogShow:function(){var a=JIRA.Issues.SearcherDialog.instance.getCurrentSearcher();if(a==this._getSearcher()){this.$el.removeData("tipsy")}},_preventFocusWhileDisabled:function(a){if(jQuery(a.target).closest("[aria-disabled=true]").length>0){a.preventDefault()}}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/SearcherModel.js' */
Backbone.define("JIRA.Issues.SearcherModel",JIRA.Issues.BaseModel.extend({properties:["id","name","isShown","viewHtml","editHtml","groupId","groupName","initParams","isSelected","jql","position","serializedParams","validSearcher","key","lastViewed"],namedEvents:["readyForDisplay"],initialize:function(){this._onEditHtmlUpdated();this.bind("change:editHtml",this._onEditHtmlUpdated,this)},parse:function(a){if(a.viewHtml){a.viewHtml=this._cleanViewHtml(a.viewHtml)}return a},_cleanViewHtml:function(b){var a=AJS.$("<div/>").appendCatchExceptions(b);a.find(".fieldLabel").remove();a.find("a").replaceWith(function(){return AJS.$(this).html()});a.find(".searcherValue").slice(0,-1).each(function(){AJS.$(this).after("-")});a.find("*").removeAttr("title");return a.html()},createOrUpdateClauseWithQueryString:function(){return this.collection.createOrUpdateClauseWithQueryString(this.id)},getQueryString:function(){var a={};if(this.collection.QUERY_ID===this.getId()){if(this.getViewHtml()){a[this.collection.QUERY_PARAM]=this.getDisplayText();return AJS.$.param(a)}return null}if((!this.getValidSearcher()||/^\s*$/.test(this.getEditHtml()))&&this.getJql()){a={};a[this.collection.JQL_INVALID_QUERY_PREFIX+this.getId()]=this.getJql();return AJS.$.param(a)}return this.getSerializedParams()},getDisplayText:function(){var a=this.getViewHtml();var c="";if(a){var b=AJS.$("<div>").appendCatchExceptions(a);c=AJS.$.trim(b.text()).replace(/[\n\r\s]+/g," ")}return c},hasClause:function(){if(this.collection.QUERY_ID===this.getId()){return !!this.getViewHtml()}else{if(!this.getValidSearcher()){return !!this.getJql()}else{return !!this.getQueryString()}}},clearSearchState:function(){this.set({viewHtml:null,editHtml:null,jql:null,validSearcher:null,isSelected:false})},_now:Date.now||function(){return new Date().getTime()},select:function(){this.set({isSelected:true,position:this.collection.getNextPosition(),validSearcher:true,lastViewed:this._now()})},retrieveEditHtml:function(){var a=this.collection.createJql();if(this.getEditHtml()){return jQuery.Deferred().resolve(this.getEditHtml())}return JIRA.SmartAjax.makeRequest({type:"POST",url:contextPath+"/secure/SearchRendererEdit!Default.jspa",success:_.bind(this.setEditHtml,this),dataType:"html",error:JIRA.Issues.displayFailSearchMessage,data:{fieldId:this.getId(),decorator:"none",jqlContext:a}})},hasErrorInEditHtml:function(){var a=jQuery("<div>").htmlCatchExceptions(this.getEditHtml());if(!a){return false}else{return a.find(".error, .has-errors").length>0}},clearEditHtml:function(){this.setEditHtml(null)},_onEditHtmlUpdated:function(){this.setSerializedParams(jQuery("<form/>").appendCatchExceptions(this.getEditHtml()).serialize())},getTooltipText:function(){if(this.getValidSearcher!==false){var a=this.getDisplayText()||"All";return this.getName()+": "+a}else{return "This criteria is not valid for the project and\/or issue type"}},searchersReady:function(){return this.collection.searchersReady()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/SearcherCollection.js' */
Backbone.define("JIRA.Issues.SearcherCollection",JIRA.Issues.BaseCollection.extend({model:JIRA.Issues.SearcherModel,namedEvents:["searchRequested","collectionChanged","jqlTooComplex","textFieldChanged","requestUpdateFromView","interactiveChanged","beforeCriteriaRemoved"],QUERY_PARAM:"text",QUERY_ID:"text",JQL_INVALID_QUERY_PREFIX:"__jql_",initialize:function(b,a){_.bindAll(this);if(b&&b.length){this._searcherCache=b}this.fixedLozenges=a&&a.fixedLozenges?a.fixedLozenges:[];this.searchPageModule=a&&a.searchPageModule;this.initData=a&&a.initData;this._interactive=true},_createItemDescriptors:function(a){return _.map(a,function(b){return new AJS.ItemDescriptor({meta:{isShown:b.isShown},label:b.name,title:b.isShown?b.name:b.name+" "+"is not applicable for the current project and\/or issue type.",selected:b.isSelected||b.jql,value:b.id})})},getAddMenuGroupDescriptors:function(){this._updateSearcherCache();var d=this.fixedLozengeIds().concat(this.QUERY_ID);var a=_.filter(this._searcherCache,function(e){var g=_.contains(d,e.id);var f=!!e.groupName;return !g&&f});if(a.length){var b=new AJS.GroupDescriptor({label:"All Criteria",items:this._createItemDescriptors(_.sortBy(a,function(e){return e.name.toLowerCase()}))});var c=new AJS.GroupDescriptor({label:"Recent Criteria",items:this._createItemDescriptors(_.first(_.sortBy(_.filter(a,function(e){return e.lastViewed}),function(e){return -e.lastViewed}),AJS.Meta.getNumber("max-recent-searchers")))});return[c,b]}else{return[]}},getSearcher:function(b){var a=this.get(b);if(!a){this.add(this._searcherCache[b]);a=this.get(b)}return a},setJql:function(b,a){this._addOrSet(b,{jql:a})},createJql:function(){var a=this.pluck("jql");return _.filter(a,_.isNotBlank).join(" AND ")||""},isDirty:function(){return this.any(function(a){return a.getJql()!==undefined&&a.getJql()!==""})},clearSearchState:function(){this.each(function(a){a.clearSearchState()});this._querySearchersAndValues("")},clearClause:function(c){var b=this.get(c);var a=b&&b.hasClause();if(b){b.clearSearchState()}this.triggerCollectionChanged();this.triggerRequestUpdateFromView();if(a){this.triggerSearchRequested(this.createJql())}},getTextQuery:function(){var a=this.get(this.QUERY_ID);return a?a.getViewHtml():""},setInteractive:function(a){if(a!==this._interactive){this._interactive=a;this.triggerInteractiveChanged(a)}},isInteractive:function(){return this._interactive},handleBasicViewSubmit:function(){this.triggerRequestUpdateFromView();this.triggerSearchRequested(this.createJql())},updateTextQuery:function(a){if(a){var b=AJS.escapeHtml(a);this._addOrSet(this.QUERY_ID,{viewHtml:b,editHtml:b,jql:JIRA.Issues.TextQueryBuilder.buildJql(a)})}else{this.remove(this.QUERY_ID)}this.triggerTextFieldChanged()},getQueryString:function(){var a=[];this.each(function(c){var b=c.getQueryString();if(b){a.push(b)}});return a.join("&")},_addOrSet:function(e,d,b){var a=this.get(e);if(a){if(b&&b.parse&&a.parse){d=a.parse(d);delete b.parse}if(d.jql){d.isSelected=true}a.set(d,b)}else{var c=_.clone(d);c.id=e;c.isSelected=!!d.jql;this.add(c,b);a=this.get(e)}return a},restoreFromQuery:function(e,d){var b={jql:this.searchPageModule.getEffectiveJql(),decorator:"none"};var c=e.getFilter();if(c&&c.getIsValid()){b.filter=e.getFilter().getId()}if(this.initData){if(!this.initData.errorMessages){this._onQuerySearchersAndValues(this.initData);this.initData=null;return jQuery.Deferred().resolve()}else{this._handleSearcherError(e,this.initData);this.initData=null;return jQuery.Deferred().reject()}}else{var a=AJS.$.ajax({url:contextPath+"/secure/Search!Jql.jspa",headers:{"X-SITEMESH-OFF":true},data:b,type:"POST"});a.success(_.bind(function(f){if(d){this.clearExpectingUpdate(d)}this._onQuerySearchersAndValues(f)},this));a.error(_.bind(function(h){if(d){this.clearExpectingUpdate()}try{var f=JSON.parse(h.responseText);if(f){this._handleSearcherError(e,f)}}catch(g){console.log("search response error - not JSON?")}},this));a.always(function(){JIRA.trace("jira.search.searchers.updated")});return a}},clearExpectingUpdate:function(){this.reset();this.updateTextQuery("")},_handleSearcherError:function(b,a){if(_.include(a.errorMessages,"jqlTooComplex")||_.include(a.errorMessages,"jqlInvalid")){window.setTimeout(_.bind(function(){this.triggerJqlTooComplex(b.getJql())},this),0)}},searcherAffectsContext:function(a){return"project"===a||"issuetype"===a},createOrUpdateClauseWithQueryString:function(b){this.triggerRequestUpdateFromView();var a;if(this.searcherAffectsContext(b)){a=this._querySearchersAndValues(this.getQueryString())}else{a=this._querySearchersByValue(b)}a.done(_.bind(function(){if(!this.containsInvalidSearchers()){this.triggerSearchRequested(this.createJql())}},this));return a},containsInvalidSearchers:function(){return this.any(function(a){return a.hasErrorInEditHtml()})},_querySearchersByValue:function(d){var a=this.get(d);var c=AJS.$.param({decorator:"none",jqlContext:this.searchPageModule.getEffectiveJql()});if(a){var b=a.getQueryString();if(b){c=c+"&"+b}}if(this._activeSearcherReq){this._activeSearcherReq.abort()}return this._activeSearcherReq=JIRA.SmartAjax.makeRequest({type:"POST",data:c,processData:false,url:contextPath+"/secure/SearchRendererValue!Default.jspa",success:_.bind(function(f){var e=this.get(d);if(e){if(f[d]){f[d].groupName=e.getGroupName();f[d].groupId=e.getGroupId()}else{f[d]=_.extend(e.toJSON(),{editHtml:null,jql:null,viewHtml:null})}}this._setSearchersFromData(f,true)},this),dataType:"json",error:function(e){JIRA.Issues.displayFailSearchMessage(e)}}).always(_.bind(function(){this._activeSearcherReq=null},this))},_parseSearcherGroups:function(b){var a={};_.each(b.groups,function(c){_.each(c.searchers,function(d){d.groupId=c.type;d.groupName=c.title;a[d.id]=d})});return a},_querySearchersAndValues:function(c){var b="decorator=none";if(this._activeSearcherReq){if(this._activeSearcherQuery===c){return jQuery.Deferred().reject()}this._activeSearcherReq.abort()}this._activeSearcherQuery=c;var a=this.searchPageModule&&this.searchPageModule.getFilter();if(a){b+="&filter="+a.getId()}if(c){b+="&"+c}this._activeSearcherReq=AJS.$.ajax({url:contextPath+"/secure/Search!Default.jspa",headers:{"X-SITEMESH-OFF":true},type:"POST",data:b,processData:false});this._activeSearcherReq.done(_.bind(function(d){this._onQuerySearchersAndValues(d)},this));this._activeSearcherReq.fail(_.bind(function(d){JIRA.Issues.displayFailSearchMessage(d)},this));this._activeSearcherReq.always(_.bind(function(){this._activeSearcherReq=null},this));return this._activeSearcherReq},clear:function(){this.reset([],{silent:true});this.updateTextQuery("");this.triggerCollectionChanged()},searchersReady:function(){if(this._activeSearcherReq){return this._activeSearcherReq}else{return jQuery.Deferred().resolve()}},_onQuerySearchersAndValues:function(c){var d=this,a=this._parseSearcherGroups(c.searchers);_.each(c.values,_.bind(function(f,g){var e=a[g];if(!e){a[g]=f}else{_.extend(e,f)}},this));var b=[];this.each(function(f){var e=f.id;if(!_.any(a,function(g){return g.id===e})){if(f.getIsSelected()){f.setValidSearcher(false)}else{b.push(f)}}});if(b.length){this.remove(b)}this._setSearchersFromData(a)},_updateSearcherCache:function(){if(this._searcherCache){this.each(_.bind(function(a){this._searcherCache[a.id]=a.toJSON();this._searcherCache[a.id].id=a.id},this))}},_setSearchersFromData:function(a,b){_.each(a,_.bind(function(c,d){this._addOrSet(d,{groupId:c.groupId,groupName:c.groupName,isShown:c.isShown,name:c.name,viewHtml:c.viewHtml,jql:c.jql,editHtml:c.editHtml,validSearcher:c.validSearcher,key:c.key,lastViewed:c.lastViewed},{parse:true})},this));if(b){this._updateSearcherCache()}else{this._searcherCache=a}this.triggerCollectionChanged();JIRA.trace("jira.search.searchers.updated")},getVariableClauses:function(){var a=[];this.each(_.bind(function(b){if(!this.isFixed(b)&&b.hasClause()){a.push(b)}},this));return a},getSelectedCriteria:function(){var a=this;var b=function(c){return !a.isFixed(c)&&(c.hasClause()||c.getIsSelected())};return this.chain().filter(b).sortBy(function(c){return c.getPosition()}).value()},getAllSelectedCriteriaCount:function(){return this.getAllSelectedCriteria().length},getAllSelectedCriteria:function(){var a=[];this.each(_.bind(function(b){if(b.hasClause()||b.getIsSelected()){a.push(b)}},this));return a},isFixed:function(a){return _.contains(this.fixedLozengeIds(),a.getId())||a.getId()===this.QUERY_ID},fixedLozengeIds:function(){return _.pluck(this.fixedLozenges,"id")},getNextPosition:function(){return this.reduce(function(b,c){var a=Math.max(b,c.getPosition());return isNaN(a)?b:a},-1)+1}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/CriteriaModel.js' */
Backbone.define("JIRA.Issues.CriteriaModel",JIRA.Issues.BaseModel.extend({properties:["id","name"]}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/CardView.js' */
AJS.namespace("JIRA.Issues.CardView");JIRA.Issues.CardView=JIRA.Issues.BaseView.extend({namedEvents:["viewChanged"],initialize:function(a){_.bindAll(this);this.views=a.views;if(a.activeView){this.activeView=a.activeView}else{var b=_.keys(this.views);if(b.length>0){this.activeView=b[0]}}},render:function(){this._renderActiveView()},changeToView:function(a){if(a===this.activeView){return}this.activeView=a;if(this.$el){this._renderActiveView(a)}this.triggerViewChanged(a)},_renderActiveView:function(){var a=this.views[this.activeView];a.setElement(this.$el);a.render()}});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/BasicQueryView.js' */
Backbone.define("JIRA.Issues.BasicQueryView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.IssueNavQueryBasic.basicQueryView,initialize:function(a){this.searcherCollection=a.searcherCollection;this.textFieldView=new JIRA.Issues.TextFieldView({collection:this.searcherCollection});this.primaryCriteriaContainerView=new JIRA.Issues.PrimaryCriteriaContainerView({collection:this.searcherCollection});this.extendedCriteriaContainerView=new JIRA.Issues.ExtendedCriteriaContainerView({collection:this.searcherCollection});this.clauseButtonView=new JIRA.Issues.ClauseButtonView({searcherCollection:this.searcherCollection});this.searcherCollection.bindInteractiveChanged(this._handleInteractiveChanged,this);this.searcherCollection.bindBeforeCriteriaRemoved(this._handleBeforeCriteriaRemoved,this)},_handleInteractiveChanged:function(a){this.$el.toggleClass("loading",!a)},_handleBeforeCriteriaRemoved:function(b,a){if(a){this._shiftFocus(b,a)}},render:function(){this.$el.html(this.template());this.primaryCriteriaContainerView.setElement(this.$el.find(".search-criteria .criteria-list"));this.textFieldView.setElement(this.$el.find("input.search-entry"));this.clauseButtonView.setElement(this.$el.find(".criteria-actions"));this.extendedCriteriaContainerView.setElement(this.$el.find(".search-criteria-extended .criteria-list"));this.primaryCriteriaContainerView.render();this.$el.find(".text-query").removeClass("hidden");this.textFieldView.render();this.clauseButtonView.render();this.extendedCriteriaContainerView.render();this._handleInteractiveChanged(this.searcherCollection.isInteractive());JIRA.Issues.triggerVerticalResize();this.$el.find(".search-button").tipsy({trigger:"hover",delayIn:300});return this},search:function(){this.searcherCollection.handleBasicViewSubmit()},_shiftFocus:function(b,f){var e=this.primaryCriteriaContainerView.getFocusableForCriteria(b);if(!e.length){e=this.extendedCriteriaContainerView.getFocusableForCriteria(b)}var d=this.primaryCriteriaContainerView.getFocusables().add(this.extendedCriteriaContainerView.getFocusables());var c=d.index(e);var a;if(c===0){a=1}else{if(c===d.length-1){a=d.length-2}else{a=c+f}}d.eq(a).focus()},focus:function(){this.primaryCriteriaContainerView.getFocusables().first().focus()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/TextFieldView.js' */
AJS.namespace("JIRA.Issues.TextFieldView");JIRA.Issues.TextFieldView=JIRA.Issues.BaseView.extend({initialize:function(){_.bindAll(this);this.collection.on("remove change add",_.bind(function(a){if(a.getId()===this.collection.QUERY_ID){this.render()}},this));this.collection.bindTextFieldChanged(this.render);this.collection.bindRequestUpdateFromView(this._updateSearcherCollectionTextField);this.collection.bindInteractiveChanged(this._handleInteractiveChanged)},render:function(){var a=this.collection.get(this.collection.QUERY_ID);if(a){var c=a.getEditHtml();var b=AJS.$("<div></div>").html(c||"").text();this.setQuery(b)}else{this.setQuery("")}},setQuery:function(a){this.$el.val(a)},_updateSearcherCollectionTextField:function(){if(this.$el.is("input")){var a=AJS.$.trim(this.$el.val());this.collection.updateTextQuery(a)}},_handleInteractiveChanged:function(a){this.$el.prop("disabled",!a)}});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/PrimaryCriteriaContainerView.js' */
Backbone.define("JIRA.Issues.PrimaryCriteriaContainerView",JIRA.Issues.BaseView.extend({initialize:function(){this._criteriaViews=_.map(this.collection.fixedLozenges,function(a){return new JIRA.Issues.CriteriaView({model:new JIRA.Issues.CriteriaModel(a),searcherCollection:this.collection})},this)},render:function(){_.each(this._criteriaViews,function(a){a.render()});this.$el.prepend(_.pluck(this._criteriaViews,"el"))},getCriteriaViews:function(){return this._criteriaViews},getFocusables:function(){return this.$(".criteria-selector, #searcher-query, .add-criteria, .search-button")},getFocusableForCriteria:function(a){return this.$('.criteria-selector[data-id="'+a+'"]')}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/ExtendedCriteriaContainerView.js' */
Backbone.define("JIRA.Issues.ExtendedCriteriaContainerView",JIRA.Issues.BaseView.extend({initialize:function(a){this.collection.on("change:isSelected",this._onCriteriaSelectionChanged,this);this.collection.on("add",this._onCriteriaSelectionChanged,this);this.collection.on("remove",this._removeViewForSearcher,this);this.collection.on("reset",this._onReset,this);this._criteriaViews=_.map(this.collection.getSelectedCriteria(),_.bind(function(b){if(b.getPosition()==null){b.setPosition(this.collection.getNextPosition())}return this._buildCriteriaViewForSearcher(b)},this))},render:function(){_.each(this._criteriaViews,_.bind(function(a){a.render();this.$el.append(a.$el)},this))},getFocusables:function(){return this.$(".criteria-selector")},getFocusableForCriteria:function(a){return this.$('.criteria-selector[data-id="'+a+'"]')},_buildCriteriaViewForSearcher:function(a){return new JIRA.Issues.CriteriaView({model:new JIRA.Issues.CriteriaModel({id:a.get("id"),name:a.get("name")}),searcherCollection:this.collection,extended:true})},_onCriteriaSelectionChanged:function(a){if(a.getIsSelected()&&!this.collection.isFixed(a)){this._addViewForSearcher(a)}else{this._removeViewForSearcher(a)}},_addViewForSearcher:function(b){var a=this._buildCriteriaViewForSearcher(b);a.render();this.$el.append(a.$el);this._criteriaViews.push(a);JIRA.Issues.triggerVerticalResize()},_removeViewForSearcher:function(a){this._criteriaViews=_.reject(this._criteriaViews,function(b){if(b.model.getId()===a.getId()){b.destroy();return true}return false});JIRA.Issues.triggerVerticalResize()},_onReset:function(){_.each(this._criteriaViews,function(a){a.destroy()});this._criteriaViews=[]}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/SearcherGroupListDialogView.js' */
(function(){var a;Backbone.define("JIRA.Issues.SearcherGroupListDialogView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.IssueNavQueryBasic.searcherDropdownContent,namedEvents:["searcherSelected","hideRequested"],events:{keydown:"_keyPressed"},initialize:function(b){this.searcherCollection=b.searcherCollection;this.$el.scrollLock(".aui-list-scroll")},render:function(){var f=this.searcherCollection.getAddMenuGroupDescriptors(),e=f.length&&f[0].properties.items.length>JIRA.Issues.SearcherGroupListDialogView.CRITERIA_DISPLAY_LIMIT;var c=jQuery(AJS.Templates.queryableSelect({descriptors:f,id:"criteria"}));this.$el.empty().append(c);var d={element:c,suggestionsHandler:JIRA.Issues.SearcherGroupListDialogView.SuggestHandler,hideFooterButtons:true};var h="...excluding \u003cspan class=hidden-no>\u003c\/span> hidden",g="These criteria are hidden because they are not applicable to the current project and\/or issue type";if(e){d.maxInlineResultsDisplayed=JIRA.Issues.SearcherGroupListDialogView.CRITERIA_DISPLAY_LIMIT;h="...excluding \u003cspan class=hidden-no>\u003c\/span> hidden. Please enter a keyword to refine.";g="These criteria are hidden because there are either too many to display or they are not applicable to the current project and\/or issue type"}var b=new AJS.CheckboxMultiSelect(d);a=jQuery("<div class='more-criteria-footer' />").html(h).tipsy({title:function(){return g},className:"tipsy-front"});this.$el.append(a);this.$el.unbind("selected").bind("selected",_.bind(this._searcherSelected,this));this.$el.unbind("unselect").bind("unselect",_.bind(this._searcherUnselected,this));return this.$el},_searcherUnselected:function(c,b){this.searcherCollection.clearClause(b.properties.value)},_searcherSelected:function(d,c){var b=this.searcherCollection.getSearcher(c.properties.value);b.select();JIRA.Issues.SearcherDialog.instance.hide();JIRA.Issues.SearcherDialog.instance.show(b)},_keyPressed:function(f){if(f.keyCode===AJS.$.ui.keyCode.TAB){var b=AJS.$(":tabbable",this.$el);var c=(b.length===0);var e=(f.shiftKey&&(document.activeElement===b.first()[0]));var d=(!f.shiftKey&&(document.activeElement===b.last()[0]));if(c||e||d){this.triggerHideRequested(AJS.HIDE_REASON.tabbedOut);f.preventDefault()}}}},{CRITERIA_DISPLAY_LIMIT:100}));JIRA.Issues.SearcherGroupListDialogView.SuggestHandler=AJS.CheckboxMultiSelectSuggestHandler.extend({formatSuggestions:function(b,c){var e=0,d=AJS.SuggestHelper.removeDuplicates(this.model.getDisplayableSelectedDescriptors());b.splice(0,0,new AJS.GroupDescriptor({actionBarHtml:d.length>1?this.createClearAll():null,items:d,styleClass:"selected-group"}));_.each(b,function(g){if(c.length===0){var f=_.filter(g.items(),function(i,h){var j=i.meta();return j&&j.isShown&&h<JIRA.Issues.SearcherGroupListDialogView.CRITERIA_DISPLAY_LIMIT});e+=g.items().length-f.length;g.items(f)}else{_.each(g.items(),function(h){var i=h.meta();h.disabled(!(i&&i.isShown))})}});_.defer(function(){if(a){if(e){a.show().find(".hidden-no").text(e)}else{a.hide()}}});return b}})})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/SearcherEditDialogView.js' */
Backbone.define("JIRA.Issues.SearcherEditDialogView",JIRA.Issues.BaseView.extend({namedEvents:["backRequested","hideRequested"],autoUpdate:[".js-default-checkboxmultiselect",".js-user-checkboxmultiselect",".js-usergroup-checkboxmultiselect",".js-group-checkboxmultiselect",".js-label-checkboxmultiselect"],events:function(){var a={"click .cancel-update":"_onCancelClicked",click:"_stopPropagation",submit:"_onSubmit",keydown:"_keyPressed"};if(AJS.Meta.getBoolean("hasCriteriaAutoUpdate")){a["selected "+this.autoUpdate.join(",")]="applyChanges";a["unselect "+this.autoUpdate.join(",")]="applyChanges"}return a},template:JIRA.Templates.IssueNavQueryBasic.lozengeDropdownContent,initialize:function(){this._formData="";this.$el.scrollLock(".aui-list-scroll")},renderDeferred:function(){var a=jQuery.Deferred();this.model.retrieveEditHtml().done(_.bind(function(b){a.resolve(this.render(b))},this));return a.promise()},hasAutoUpdate:function(a){return AJS.Meta.getBoolean("hasCriteriaAutoUpdate")&&jQuery(a).find(this.autoUpdate.join(",")).length!==0},render:function(b){var a=!(/^\s*$/.test(b));var c;if(a){c=AJS.$(this.template({displayBackButton:this.displayBackButton,displayUpdateCancel:!this.hasAutoUpdate(b)&&!jQuery(b).hasClass("searchfilter-not-found")}))}else{c=AJS.$(JIRA.Templates.IssueNavQueryBasic.lozengeDropdownCannotEdit({fieldName:this.model.getName()}))}this.$el.html(c);this.$el.find(".form-body").appendCatchExceptions(b);this.$el.find("form").addClass(this.model.id+"-criteria");this.$el.find("label:first").remove();JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$el,JIRA.CONTENT_ADDED_REASON.criteriaPanelRefreshed]);this._formData=this.$el.find("form").serialize();this.model.setInitParams(this._formData);return this.$el},_stopPropagation:function(a){a.stopPropagation()},_preventDefault:function(a){a.preventDefault()},applyFilter:function(){var b=this.$el.find("form").serialize();var a=(b!==this._formData);this._formData=b;this.model.setSerializedParams(this._formData);return a},applyChanges:function(){if(this.applyFilter()){this.model.createOrUpdateClauseWithQueryString()}},_onCancelClicked:function(a){a.preventDefault();this.triggerHideRequested(AJS.HIDE_REASON.cancelClicked)},_onSubmit:function(a){a.preventDefault();this.triggerHideRequested(AJS.HIDE_REASON.submit)},_keyPressed:function(e){if(e.keyCode===AJS.$.ui.keyCode.TAB){var a=AJS.$(":tabbable",this.$el);var b=(a.length===0);var d=(e.shiftKey&&(document.activeElement===a.first()[0]));var c=(!e.shiftKey&&(document.activeElement===a.last()[0]));if(b||d||c){this.triggerHideRequested(AJS.HIDE_REASON.tabbedOut);e.preventDefault()}}}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/ClauseListDialogView.js' */
AJS.namespace("JIRA.Issues.ClauseListDialogView");JIRA.Issues.ClauseListDialogView=JIRA.Issues.BaseView.extend({events:{"click .clauses .searcherValue":"_clauseSelected","click .remove-filter":"_removeFilterRequested"},template:JIRA.Templates.IssueNavQueryBasic.enabledClauses,namedEvents:["clauseSelected","hideRequested"],initialize:function(a){_.bindAll(this);this.searcherCollection=a.searcherCollection;this.searcherCollection.bindCollectionChanged(this._renderAndCheckForClose)},render:function(){this.$el.html(this.template({clauses:this._getClauses()}))},_renderAndCheckForClose:function(){this.render();if(!this._getClauses().length){this.triggerHideRequested()}},_clauseSelected:function(b){b.preventDefault();var a=AJS.$(b.target),c=a.parents("li").first().data("id");this.triggerClauseSelected(c)},_removeFilterRequested:function(b){b.preventDefault();var a=this;_.defer(function(){var c=AJS.$(b.target),e=c.parents("li").first();var d=e.data("id");a.searcherCollection.clearClause(d);e.remove();a.triggerHideRequested()})},_getClauses:function(){var b=this.searcherCollection.getVariableClauses();var a=_.map(b,function(c){return c.toJSON()});_.each(a,this._formatForTemplate);return a},_formatForTemplate:function(a){if(a.validSearcher){a.invalidMessage=""}else{a.invalidMessage="This criteria is not valid for the project and\/or issue type"}}});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query-basic', location = 'content/js/search/query/basic/ClauseButtonView.js' */
Backbone.define("JIRA.Issues.ClauseButtonView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.IssueNavQueryBasic.clauseButtonView,addCriteriaButton:".add-criteria",events:{"click .add-criteria":"_showDialog","keydown .add-criteria":"_onKeydown"},initialize:function(c){_.bindAll(this);var a=this;this.searcherCollection=c.searcherCollection;this.searcherCollection.bindCollectionChanged(this._showOrHideClauseButtons);this.searcherCollection.bindInteractiveChanged(this._handleInteractiveChanged);var d=this.dialog=new AJS.InlineLayer({width:"auto",alignment:AJS.LEFT,offsetTarget:function(){return a.$el.find(a.addCriteriaButton)},content:function(){return b.render()}});d.bind(AJS.InlineLayer.EVENTS.hide,function(h,f,g){if(g===AJS.HIDE_REASON.escPressed||g===AJS.HIDE_REASON.toggle||g==AJS.HIDE_REASON.tabbedOut){a.$(a.addCriteriaButton).focus()}});var b=new JIRA.Issues.SearcherGroupListDialogView({searcherCollection:this.searcherCollection,dialog:d});b.bindHideRequested(function(e){d.hide(e)});d.bind(AJS.InlineLayer.EVENTS.show,function(f,e){jQuery("#criteria-input").focus();e.find(".aui-list-scroll").scrollTop(0)})},render:function(){this.$el.html(this.template());this._showOrHideClauseButtons();this._addToolTip();return this.$el},_addToolTip:function(){new JIRA.Issues.Tipsy({el:this.$el.find(this.addCriteriaButton),showCondition:":not(.active)"})},_showOrHideClauseButtons:function(){var a=this.$(this.addCriteriaButton);if(this.searcherCollection.getAddMenuGroupDescriptors().length>0){a.show()}else{a.hide()}},_showDialog:function(a){if(this.searcherCollection.isInteractive()){this.dialog.toggle()}a.preventDefault()},_handleInteractiveChanged:function(a){this.$(this.addCriteriaButton).attr("aria-disabled",(a)?null:"true")},_onKeydown:function(a){switch(a.which){case AJS.$.ui.keyCode.DOWN:this._showDialog(a);break;case AJS.$.ui.keyCode.ESCAPE:jQuery(a.target).blur();break;case AJS.$.ui.keyCode.BACKSPACE:break;default:return}a.preventDefault()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query', location = 'content/templates/issuenav-query.soy' */
// This file was automatically generated from issuenav-query.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.IssueNavQuery == 'undefined') { JIRA.Templates.IssueNavQuery = {}; }


JIRA.Templates.IssueNavQuery.searchSwitcher = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var itemList3 = opt_data.items;
  var itemListLen3 = itemList3.length;
  for (var itemIndex3 = 0; itemIndex3 < itemListLen3; itemIndex3++) {
    var itemData3 = itemList3[itemIndex3];
    JIRA.Templates.IssueNavQuery.searchSwitcherItem({id: itemData3.id, isActive: itemData3.id == opt_data.selectedId}, output);
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavQuery.searchSwitcherItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a href="#" class="switcher-item', soy.$$escapeHtml(opt_data.isActive ? ' active' : ''), ' " data-id=\'', soy.$$escapeHtml(opt_data.id), '\' title="', (opt_data.id == 'basic') ? soy.$$escapeHtml("Switch to advanced search using JQL") : soy.$$escapeHtml("Switch to basic search"), '">', (opt_data.id == 'basic') ? soy.$$escapeHtml("Advanced") : soy.$$escapeHtml("Basic"), '</a>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNavQuery.queryView = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-group"><div class="aui-item search-wrap"><div class="search-container"></div><div class="save-filter-controls"></div></div><div class="aui-item view-selector" id="layout-switcher-toggle"></div></div><div class="notifications"></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query', location = 'content/js/search/query/SearchShifter.js' */
JIRA.Issues.SearchShifter=function(d){var b,c,a,e;b=function(){var f=d.searcherCollection.chain().filter(a).map(e).value();return function(){return jQuery.Deferred().resolve(f).promise()}};c=function(h){var f=JIRA.Issues.SearcherDialog.instance.getCurrentSearcher(),g=d.searcherCollection.get(h);if(!g.getIsSelected()){g.select()}if(!f||f.getId()!==g.getId()){JIRA.Issues.SearcherDialog.instance.toggle(g)}};a=function(f){return f.getIsShown()};e=function(f){return{label:f.getName(),value:f.getId()}};return function(){if(!d.isBasicMode()||d.isFullScreenIssue()){return null}return{getSuggestions:b(),name:"Search Criteria",onSelection:c,weight:150}}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query', location = 'content/js/search/query/QueryModule.js' */
Backbone.define("JIRA.Issues.QueryModule",JIRA.Issues.BaseEvented.extend({initialize:function(a){this._searchPageModule=a.searchPageModule;this._queryStateModel=new JIRA.Issues.QueryStateModel({preferredSearchMode:a.preferredSearchMode},{searchPageModule:a.searchPageModule});JIRA.Issues.SearcherDialog.initialize(this._queryStateModel);this._basicQueryModule=new JIRA.Issues.BasicQueryModule({searchPageModule:a.searchPageModule,primaryClauses:a.primaryClauses,initialSearcherCollectionState:a.initialSearcherCollectionState});this._jqlQueryModule=new JIRA.Issues.JqlQueryModule({searchPageModule:a.searchPageModule});this._basicQueryModule.bindJqlTooComplex(_.bind(function(){if(this.getSearchMode()!==this._queryStateModel.ADVANCED_SEARCH){JIRA.Issues.Analytics.trigger("kickass.queryTooComplexSwitchToAdvanced")}this.setSearchMode(this._queryStateModel.ADVANCED_SEARCH);if(this._queryView){this._queryView.switcherViewModel.disableSwitching()}},this));this._basicQueryModule.bindSearchRequested(_.bind(function(b){this._searchPageModule.queryModuleSearchRequested(b);this.clearSearchErrors()},this));this._jqlQueryModule.bindSearchRequested(_.bind(function(b){this._searchPageModule.queryModuleSearchRequested(b);this._basicQueryModule.queryChanged();this.clearSearchErrors()},this));this._errors={};this._errors[this._queryStateModel.BASIC_SEARCH]=[];this._errors[this._queryStateModel.ADVANCED_SEARCH]=[];this._queryStateModel.on("change:searchMode",this.showSearchErrors,this);JIRA.Shifter.register(JIRA.Issues.SearchShifter({isBasicMode:_.bind(this._isBasicMode,this),isFullScreenIssue:function(){return a.searchPageModule.isFullScreenIssueVisible()},searcherCollection:this._basicQueryModule.searcherCollection}))},_isBasicMode:function(){return this.getSearchMode()===this._queryStateModel.BASIC_SEARCH},resetToQuery:function(a){this.clearSearchErrors();this._basicQueryModule.queryReset().always(_.bind(function(){this._jqlQueryModule.queryChanged();this._queryStateModel.switchToPreferredSearchMode();var b=this._searchPageModule.getFilter();this._queryView.setVisible(!b||b.getIsValid());if(a&&a.focusQuery===true){this._queryView.getView().focus()}},this))},queryChanged:function(){this.clearSearchErrors();this._basicQueryModule.queryChanged();this._jqlQueryModule.queryChanged()},onSearchSuccess:function(a){if(this._queryView){this._queryView.showWarnings(a);this._queryView.enableLayoutSwitcher()}},searchersReady:function(){return this._basicQueryModule.searchersReady()},onSearchError:function(b){this._errors.renderFunction="showErrors";var c=(b.errorMessages)?b.errorMessages.concat():[];var a=[];_.each(b.errors,function(e,d){if(d==="jql"){a.push(e)}else{c.push(e)}});if(this.getSearchMode()===this._queryStateModel.BASIC_SEARCH&&!this._basicQueryModule.hasErrors()&&a.length>0){this.setSearchMode(this._queryStateModel.ADVANCED_SEARCH)}this._errors[this._queryStateModel.BASIC_SEARCH]=c;this._errors[this._queryStateModel.ADVANCED_SEARCH]=a.concat(c);this._queryView.disableLayoutSwitcher();this.showSearchErrors()},showSearchErrors:function(){if(this._queryView){this._queryView.clearNotifications();var a=this._errors.renderFunction||"showErrors";this._queryView[a](this._errors[this.getSearchMode()])}},clearSearchErrors:function(){if(this._queryView){this._queryView.clearNotifications();this._queryView.switcherViewModel.enableSwitching()}this._errors[this._queryStateModel.BASIC_SEARCH].length=0;this._errors[this._queryStateModel.ADVANCED_SEARCH].length=0},getSearchMode:function(){return this._queryStateModel.getSearchMode()},getActiveBasicModeSearchers:function(){return this._basicQueryModule.getSelectedCriteria()},setSearchMode:function(a){if(this.getSearchMode()!==a){this._queryStateModel.switchToSearchMode(a);return true}return false},createAndRenderView:function(a){this._queryView=new JIRA.Issues.QueryView({el:a,queryStateModel:this._queryStateModel,basicQueryModule:this._basicQueryModule,jqlQueryModule:this._jqlQueryModule,searchPageModule:this._searchPageModule});this._queryView.render()},isQueryValid:function(){return(this._errors&&this._errors[this._queryStateModel.BASIC_SEARCH].length===0&&this._errors[this._queryStateModel.ADVANCED_SEARCH].length===0)}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query', location = 'content/js/search/query/QueryStateModel.js' */
Backbone.define("JIRA.Issues.QueryStateModel",JIRA.Issues.BaseModel.extend({BASIC_SEARCH:"basic",ADVANCED_SEARCH:"advanced",properties:["searchMode","preferredSearchMode"],defaults:{searchMode:"basic",preferredSearchMode:"basic"},initialize:function(a,b){this.searchPageModule=b&&b.searchPageModule;this.bind("change:preferredSearchMode",_.bind(function(){JIRA.Issues.Analytics.trigger("kickass.switchto"+this.getPreferredSearchMode())},this))},switchToSearchMode:function(a){this.setSearchMode(a)},switchPreferredSearchMode:function(a){this.switchToSearchMode(a);this.setPreferredSearchMode(a);this._savePreferredSearchMode()},switchToPreferredSearchMode:function(){this.switchToSearchMode(this.getPreferredSearchMode())},_savePreferredSearchMode:function(){jQuery.ajax({url:AJS.contextPath()+"/rest/issueNav/latest/userSearchMode",type:"POST",data:{searchMode:this.getPreferredSearchMode()},error:_.bind(function(a){JIRA.Issues.displayFailSearchMessage(a)},this),success:function(){JIRA.trace("jira.search.mode.changed")}})}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query', location = 'content/js/search/query/SwitcherModel.js' */
Backbone.define("JIRA.Issues.SwitcherModel",JIRA.Issues.BaseModel.extend({properties:["id","name","view","text"]}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query', location = 'content/js/search/query/SwitcherCollection.js' */
Backbone.define("JIRA.Issues.SwitcherCollection",JIRA.Issues.BaseCollection.extend({model:JIRA.Issues.SwitcherModel}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query', location = 'content/js/search/query/QuerySwitcherViewModel.js' */
Backbone.define("JIRA.Issues.QuerySwitcherViewModel",JIRA.Issues.BaseModel.extend({mixins:[JIRA.Issues.Mixin.SingleSelect],properties:["disabled"],namedEvents:["selectionChanged"],initialize:function(a,b){this.queryStateModel=b.queryStateModel;this.queryStateModel.bind("change:searchMode",_.bind(function(){this.triggerSelectionChanged.apply(this,arguments)},this))},getSelected:function(){var a=this.queryStateModel.getSearchMode();return a?this.getCollection().get(a):null},setSelected:function(a){this.queryStateModel.switchPreferredSearchMode(a?a.id:null)},enableSwitching:function(){this.setDisabled(false)},disableSwitching:function(){this.setDisabled(true)}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query', location = 'content/js/search/query/QueryView.js' */
Backbone.define("JIRA.Issues.QueryView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.IssueNavQuery.queryView,events:{submit:"search"},initialize:function(a){_.bindAll(this);this.queryStateModel=a.queryStateModel;var b=new JIRA.Issues.SwitcherCollection([{id:this.queryStateModel.BASIC_SEARCH,name:"Basic",view:a.basicQueryModule.createView()},{id:this.queryStateModel.ADVANCED_SEARCH,name:"Advanced",view:a.jqlQueryModule.createView()}]);this.jqlQueryModule=a.jqlQueryModule;this.switcherViewModel=new JIRA.Issues.QuerySwitcherViewModel({collection:b},{queryStateModel:this.queryStateModel});this.switcherView=new JIRA.Issues.SwitcherView({template:JIRA.Templates.IssueNavQuery.searchSwitcher,model:this.switcherViewModel,containerClass:".search-container"});if(!JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()){this.layoutSwitcherView=new JIRA.Issues.LayoutSwitcherView({searchPageModule:a.searchPageModule})}},render:function(){this.$el.html(this.template);this.switcherView.setElement(this.$el).render();if(this.layoutSwitcherView){this.layoutSwitcherView.setElement(this.$("#layout-switcher-toggle")).render()}return this},enableLayoutSwitcher:function(){if(this.layoutSwitcherView){this.layoutSwitcherView.enableLayoutSwitcher()}},disableLayoutSwitcher:function(){if(this.layoutSwitcherView){this.layoutSwitcherView.disableLayoutSwitcher()}},clearNotifications:function(){this.$(".notifications").empty()},search:function(a){a.preventDefault();if(this.queryStateModel.ADVANCED_SEARCH===this.switcherViewModel.getSelected().getId()){this.jqlQueryModule.search()}else{this.getView().search()}},getView:function(){return this.switcherViewModel.getSelected().getView()},showErrors:function(a){this.$(".notifications").append(JIRA.Templates.Issues.Util.errorMessage({messages:a}))},showWarnings:function(a){this.$(".notifications").append(JIRA.Templates.Issues.Util.warningMessage({messages:a}))},setVisible:function(a){this.$(".search-container").toggle(a);this.switcherView.setVisible(a)}}));jQuery(function(){if(jQuery.browser.msie&&jQuery.browser.version<=8){JIRA.bind(AJS.InlineLayer.EVENTS.hide,function(){jQuery(".text-query-container").parent().append(jQuery(".text-query-container").detach())})}});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-query', location = 'content/js/search/query/SwitcherView.js' */
Backbone.define("JIRA.Issues.SwitcherView",JIRA.Issues.BaseView.extend({tagName:"div",events:{"click .switcher-item":"_onSwitcherClick"},initialize:function(a){_.bindAll(this);this.containerClass=a.containerClass;this.model=a.model;this.template=a.template;this.model.bindSelectionChanged(this._onSelect);this.switchEl=AJS.$();this.model.on("change:disabled",this._setSwitching)},render:function(){this._onSelect();this._render()},_render:function(){var a=this.model.getSelected();this.switchEl=this.$el.find(".switcher");this.switchEl.html(this.template({items:this.model.getCollection().toJSON(),selectedId:a&&a.id}));new JIRA.Issues.Tipsy({el:this.$el.find(".switcher-item.active")})},getSwitcherTrigger:function(){return this.switchEl.find(".switcher-item.active")},_onSelect:function(){var a=this.$el.find(this.containerClass).empty(),b=this.model.getSelected();if(b){b.getView().setElement(a).render().$el.attr("data-mode",b.id)}this._render();JIRA.Issues.triggerVerticalResize()},_onSwitcherClick:function(b){b.preventDefault();if(!this.model.getDisabled()){this.model.next();var a=this.model.getSelected().getView();a.focus&&a.focus()}},_setSwitching:function(){if(this.model.getDisabled()){this.disableSwitching()}else{this.enableSwitching()}},disableSwitching:function(){this.switchEl.addClass("disabled");this.getSwitcherTrigger().attr("title","\u7B80\u5355\u6A21\u5F0F\u65E0\u6CD5\u89E3\u6790\u590D\u6742\u7684\u67E5\u8BE2\u6761\u4EF6\u3002")},enableSwitching:function(){this.switchEl.removeClass("disabled");this.$el.find(".switcher-item").removeAttr("title")},setVisible:function(a){this.switchEl.toggleClass("hidden",!a)}}));
/* module-key = 'jira.webresources:searchers', location = '/includes/jira/searchers/datePicker.soy' */
// This file was automatically generated from datePicker.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.DateSearcher == 'undefined') { JIRA.Templates.DateSearcher = {}; }


JIRA.Templates.DateSearcher.dateMeasurement = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<select class="js-measurement"><option value="m">', soy.$$escapeHtml("\u5206"), '</option><option value="h">', soy.$$escapeHtml("\u5c0f\u65f6"), '</option><option value="d">', soy.$$escapeHtml("\u5929"), '</option><option value="w">', soy.$$escapeHtml("\u5468"), '</option></select>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.renderWithinTheLast = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(AJS.format("Within the last {0} {1}",opt_data.inputField,opt_data.dateMeasurementField));
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.withinTheLast = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<input type="radio" class="js-dp-type-toggle" id="withinTheLastRadio"/>');
  var param19 = new soy.StringBuilder();
  JIRA.Templates.DateSearcher.dateMeasurement(null, param19);
  JIRA.Templates.DateSearcher.renderWithinTheLast({inputField: '<input class="js-val" type="text" maxlength="15" />', dateMeasurementField: param19.toString()}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.nowOverdue = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<label><input type="radio" class="js-dp-type-toggle" />', soy.$$escapeHtml("\u5df2\u7ecf\u903e\u671f\u7684"), '</label>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.renderMoreThan = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(AJS.format("More than {0} {1} ago",opt_data.inputField,opt_data.dateMeasurementField));
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.moreThan = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<input type="radio" tabIndex="-1" class="js-dp-type-toggle" id="moreThanRadio"/>');
  var param33 = new soy.StringBuilder();
  JIRA.Templates.DateSearcher.dateMeasurement(null, param33);
  JIRA.Templates.DateSearcher.renderMoreThan({inputField: '<input class="js-val" type="text" maxlength="15" />', dateMeasurementField: param33.toString()}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.renderDueMoreThan = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(AJS.format("More than {0} {1} overdue",opt_data.inputField,opt_data.dateMeasurementField));
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.dueMoreThan = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<input type="radio" tabIndex="-1" class="js-dp-type-toggle" id="moreThanRadio"/>');
  var param43 = new soy.StringBuilder();
  JIRA.Templates.DateSearcher.dateMeasurement(null, param43);
  JIRA.Templates.DateSearcher.renderDueMoreThan({inputField: '<input class="js-val" type="text" maxlength="15" />', dateMeasurementField: param43.toString()}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.renderDueInNext = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(AJS.format("Due in next {0} {1} {2} overdue",opt_data.inputField,opt_data.dateMeasurementField,opt_data.clauseField));
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.dueInNext = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<input type="radio" tabIndex="-1" class="js-dp-type-toggle" id="dueInNextRadio"/>');
  var param53 = new soy.StringBuilder();
  JIRA.Templates.DateSearcher.dateMeasurement(null, param53);
  JIRA.Templates.DateSearcher.renderDueInNext({inputField: '<input class="js-val" maxlength="15" type="text" />', dateMeasurementField: param53.toString(), clauseField: '<select class="js-clause"><option value="orIs">' + soy.$$escapeHtml("or is") + '</option><option value="andNot">' + soy.$$escapeHtml("\u548c\u4e0d\u662f") + '</option></select>'}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.renderDateBetween = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(AJS.format("Between {0} and {1}",opt_data.startField,opt_data.endField));
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.dateBetween = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<input type="radio" tabIndex="-1" class="js-dp-type-toggle" id="dateBetweenRadio"/>');
  JIRA.Templates.DateSearcher.renderDateBetween({startField: '<input class="js-start-date" maxlength="15" placeholder="11-Jan-2012" type="text" /><span class="js-start-date-trigger aui-icon icon-date">' + soy.$$escapeHtml("\u9009\u62e9\u65e5\u671f") + '</span>', endField: '<input class="js-end-date" maxlength="12" placeholder="30-Jan-2012" type="text" /><span class="js-end-date-trigger aui-icon icon-date">' + soy.$$escapeHtml("\u9009\u62e9\u65e5\u671f") + '</span>'}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.renderInRange = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(AJS.format("In range {0} to {1}",opt_data.startInput,opt_data.endInput));
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.DateSearcher.inRange = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<input type="radio" tabIndex="-1" maxlength="15" class="js-dp-type-toggle" id="inRangeRadio"/>');
  JIRA.Templates.DateSearcher.renderInRange({startInput: '<input class="js-start-range" placeholder="-3w 4d 12h" type="text" />', endInput: '<input class="js-end-range" maxlength="15" placeholder="3w 4d 12h" type="text" />'}, output);
  return opt_sb ? '' : output.toString();
};

/* module-key = 'jira.webresources:searchers', location = '/includes/jira/searchers/DateSearcher.js' */
(function($){var _excludeList=["js-dp-type-toggle","js-val","js-measurement","js-clause","js-start-date","js-end-date","js-start-range","js-end-range"];var _labelfyContent=function(content,radioKey){var $content=jQuery("<div></div>").html(content).contents();var transformed=[];$content.each(function(index,element){var $element=jQuery(element);var value=jQuery("<div/>").html(element).html();if(!_.contains(_excludeList,$element.attr("class"))){value=value.replace(/^\s+|\s+$/g,"&nbsp;");transformed.push("<label for='"+radioKey+"'>"+value+"</label>")}else{transformed.push(value)}});return transformed.join("")};var _generateSearcherAndBindHandler=function(data){var radioKey=data.radioKey+"Radio";var outputContent=data.$el.html(_labelfyContent(data.rawTemplate,radioKey));outputContent.find(":not(.js-dp-type-toggle):not(select):input").mousedown(function(){var $label=outputContent.find("label");if($label.length>0){$label[0].click()}});return outputContent};var NowOverdue=Backbone.View.extend({className:"field-group",attributes:{"data-date-type":"nowOverdue"},template:JIRA.Templates.DateSearcher.nowOverdue,getValues:function(){return{to:0}},updateFromValues:function(values){if(!values.from&&values.to==="0"){return true}},render:function(){return this.$el.html(this.template())}});var WithinTheLast=Backbone.View.extend({className:"field-group",attributes:{"data-date-type":"withinTheLast"},template:JIRA.Templates.DateSearcher.withinTheLast,getValues:function(){var val=this.$(".js-val").val();if(val){return{from:"-"+val+this.$el.find(".js-measurement").val()}}},updateFromValues:function(values){if(!values.to&&values.from&&values.from.charAt(0)=="-"){var vals=this.model.parseRelativeStr(values.from);this.$(".js-val").val(vals.val.slice(1));if(vals.measurement){this.$(".js-measurement").val(vals.measurement)}return true}},render:function(verb){return _generateSearcherAndBindHandler({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}});var MoreThan=Backbone.View.extend({className:"field-group",attributes:{"data-date-type":"moreThan"},template:JIRA.Templates.DateSearcher.moreThan,getValues:function(){var val=this.$(".js-val").val();if(val){return{to:"-"+val+this.$el.find(".js-measurement").val()}}},updateFromValues:function(values){if(!values.from&&values.to&&values.to.charAt(0)=="-"){var vals=this.model.parseRelativeStr(values.to);this.$(".js-val").val(vals.val.slice(1));if(vals.measurement){this.$(".js-measurement").val(vals.measurement)}return true}},render:function(verb){return _generateSearcherAndBindHandler({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}});var DueMoreThan=MoreThan.extend({className:"field-group",template:JIRA.Templates.DateSearcher.dueMoreThan});var DueInNext=Backbone.View.extend({className:"field-group",attributes:{"data-date-type":"dueInNext"},template:JIRA.Templates.DateSearcher.dueInNext,getValues:function(){var val=this.$el.find(".js-val").val();if(val){return{from:this.$el.find(".js-clause").val()==="andNot"?"0":null,to:val+this.$(".js-measurement").val()}}},updateFromValues:function(values){if((!values.from||values.from==="0")&&values.to){var vals=this.model.parseRelativeStr(values.to);var clause=values.from==="0"?"andNot":"orIs";this.$(".js-val").val(vals.val);this.$(".js-clause").val(clause);if(vals.measurement){this.$(".js-measurement").val(vals.measurement)}return true}},render:function(){return _generateSearcherAndBindHandler({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}});var DatesBetween=Backbone.View.extend({className:"field-group",attributes:{"data-date-type":"dateBetween"},template:JIRA.Templates.DateSearcher.dateBetween,getValues:function(){return{startDate:this.$el.find(".js-start-date").val(),endDate:this.$el.find(".js-end-date").val()}},updateFromValues:function(values){if(values.startDate||values.endDate){this.$el.find(".js-start-date").val(values.startDate);this.$el.find(".js-end-date").val(values.endDate);return true}},bindCalendar:function(inputClass,triggerClass){var trigger=this.$el.find("."+triggerClass)[0];var input=this.$el.find("."+inputClass)[0];var calendarParams=_.extend({},this.model.calendarConfig,{inputField:input,button:trigger});Calendar.setup(calendarParams)},render:function(){_generateSearcherAndBindHandler({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]});this.bindCalendar("js-end-date","js-end-date-trigger");this.bindCalendar("js-start-date","js-start-date-trigger");return this.$el}});var InRange=Backbone.View.extend({className:"field-group",attributes:{"data-date-type":"inRange"},template:JIRA.Templates.DateSearcher.inRange,getValues:function(){return{from:this.$el.find(".js-start-range").val(),to:this.$el.find(".js-end-range").val()}},updateFromValues:function(values){if(values.from||values.to){this.$el.find(".js-start-range").val(values.from);this.$el.find(".js-end-range").val(values.to);return true}},render:function(){return _generateSearcherAndBindHandler({$el:this.$el,rawTemplate:this.template(),radioKey:this.attributes["data-date-type"]})}});var DateSeacherModel=Backbone.Model.extend({initialize:function(options){this.from$El=options.$el.find(".js-date-picker-from").hide();this.to$El=options.$el.find(".js-date-picker-to").hide();this.startDate$El=options.$el.find(".js-date-picker-start-date").hide();this.endDate$El=options.$el.find(".js-date-picker-end-date").hide();this.calendarConfig=this.errors=JIRA.parseOptionsFromFieldset(options.$el.find("fieldset.js-date-picker-errors"));this.calendarConfig=JIRA.parseOptionsFromFieldset(options.$el.find("fieldset.datepicker-params"))},parseRelativeStr:function(str){var measurement=str.slice(str.length-1);var val=str.slice(0,str.length-1);return{val:val,measurement:measurement}},update:function(updateParams){this.clear();if(updateParams){if(typeof updateParams.from!=="undefined"){this.from$El.val(updateParams.from)}if(typeof updateParams.to!=="undefined"){this.to$El.val(updateParams.to)}if(typeof updateParams.startDate!=="undefined"){this.startDate$El.val(updateParams.startDate)}if(typeof updateParams.endDate!=="undefined"){this.endDate$El.val(updateParams.endDate)}}},toJSON:function(){return{from:this.from$El.val(),to:this.to$El.val(),startDate:this.startDate$El.val(),endDate:this.endDate$El.val(),errors:this.errors}},clear:function(){this.from$El.val("");this.to$El.val("");this.startDate$El.val("");this.endDate$El.val("")}});JIRA.DateSearcher=Backbone.View.extend({initialize:function(options){var instance=this;this.verb=options.verb;this.model=new DateSeacherModel({$el:this.$el});this.setElement($("<div />").addClass("js-picker-ui").appendTo(this.$el));this.views=[];var useInputEvent=!jQuery.browser.msie||parseInt(jQuery.browser.version,10)<10;_.each(options.dateTypes,function(dateType){var view=new dateType({model:instance.model});instance.views.push(view);if(useInputEvent){view.$el.delegate(":text","input",function(){instance.update(view)})}else{view.$el.delegate(":text","keydown",function(){var $this=jQuery(this);var currentVal=$this.val();$this.one("keyup",function(){if($this.val()!==currentVal){instance.update(view)}})});view.$el.delegate(":text","change",function(){instance.update(view)})}view.$el.delegate(":radio,select,input","change",function(){instance.update(view)}).delegate(".icon-date","click",function(){instance.update(view)})})},update:function(selectedView,error){this.model.update(selectedView.getValues());_.each(this.views,function(view){if(view===selectedView){view.$(":radio").prop("checked",true)}else{view.$(":radio").prop("checked",false)}})},render:function(){var instance=this;var values=this.model.toJSON();_.each(this.views,function(view){instance.$el.append(view.render(instance.verb))});$.each(this.views,function(i,view){if(this.updateFromValues(values)){instance.update(this);if(values.errors){$.each(values.errors,function(i,error){$("<div />").addClass("error").text(error).appendTo(view.$el);return false})}return false}});window.setTimeout(function(){instance.$el.find(":radio:checked").focus()},30)}});JIRA.DateSearcher.createDueDateSearcher=function(el){return new JIRA.DateSearcher({el:el,dateTypes:[NowOverdue,DueMoreThan,DueInNext,DatesBetween,InRange]}).render()};JIRA.DateSearcher.createResolvedDateSearcher=function(el){return new JIRA.DateSearcher({el:el,dateTypes:[WithinTheLast,MoreThan,DatesBetween,InRange]}).render()};JIRA.DateSearcher.createCreatedDateSearcher=function(el){return new JIRA.DateSearcher({el:el,dateTypes:[WithinTheLast,MoreThan,DatesBetween,InRange]}).render()};JIRA.DateSearcher.createUpdatedDateSearcher=function(el){return new JIRA.DateSearcher({el:el,dateTypes:[WithinTheLast,MoreThan,DatesBetween,InRange]}).render()};JIRA.DateSearcher.createCustomDateSearcher=function(el){return new JIRA.DateSearcher({el:el,dateTypes:[WithinTheLast,MoreThan,DatesBetween,InRange]}).render()}})(AJS.$);
/* module-key = 'jira.webresources:searchers', location = '/includes/jira/searchers/initDateSearchers.js' */
jQuery(function(){function initDueDateSearcher($ctx){$ctx.find(".js-duedate-searcher").each(function(){JIRA.DateSearcher.createDueDateSearcher(this)})}function initResolvedDateSearcher($ctx){$ctx.find(".js-resolutiondate-searcher").each(function(){JIRA.DateSearcher.createResolvedDateSearcher(this)})}function initCreatedDateSearcher($ctx){$ctx.find(".js-created-searcher").each(function(){JIRA.DateSearcher.createCreatedDateSearcher(this)})}function initUpdatedDateSearcher($ctx){$ctx.find(".js-updated-searcher").each(function(){JIRA.DateSearcher.createUpdatedDateSearcher(this)})}function initCustomFieldDateSearcher($ctx){$ctx.find(".js-customdate-searcher").each(function(){JIRA.DateSearcher.createCustomDateSearcher(this)})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason===JIRA.CONTENT_ADDED_REASON.criteriaPanelRefreshed){initDueDateSearcher(context);initResolvedDateSearcher(context);initCreatedDateSearcher(context);initUpdatedDateSearcher(context);initCustomFieldDateSearcher(context)}})});
/* module-key = 'jira.webresources:searchers', location = '/includes/jira/searchers/initSparklers.js' */
jQuery(function(){function initSparklers($ctx){$ctx.find(".js-default-checkboxmultiselect").each(function(){var $select=AJS.$(this);if(!$select.data("checkboxmultiselect")){$select.data("checkboxmultiselect",new AJS.CheckboxMultiSelect({element:this}))}else{$select.data("checkboxmultiselect").render()}})}function initLabelSparkler($ctx){$ctx.find(".js-label-checkboxmultiselect").each(function(){var cms=new AJS.CheckboxMultiSelect({element:this,ajaxOptions:{url:contextPath+"/rest/api/1.0/labels/suggest",query:true,minQueryLength:0,formatResponse:function(response){var selectedValues=cms.model.getSelectedValues();return[new AJS.GroupDescriptor({items:_.map(_.sortBy(_.reject(response.suggestions,function(suggestion){return _.contains(selectedValues,suggestion.label)}),"label"),function(suggestion){return new AJS.ItemDescriptor({highlighted:true,html:suggestion.html,label:suggestion.label,value:suggestion.label,title:suggestion.label})})})]}}})})}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,$context,reason){if(reason===JIRA.CONTENT_ADDED_REASON.criteriaPanelRefreshed){initSparklers($context);initLabelSparkler($context)}})});
/* module-key = 'jira.webresources:searchers', location = '/includes/jira/searchers/initUserSparkler.js' */
JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,$ctx){function _formatUserGroupResponse(response){var users=_formatUserResponse(response.users,true);var groups=_formatGroupResponse(response.groups,true);var items=[].concat(users).concat(groups);return[new AJS.GroupDescriptor({items:items})]}function _formatUserResponse(response,prefix){return _.map(response.users,function(item){return new AJS.ItemDescriptor({highlighted:true,html:item.html,icon:item.avatarUrl,label:item.displayName,value:(prefix?"user:":"")+item.name})})}function _formatGroupResponse(response,prefix){return _.map(response.groups,function(item){return new AJS.ItemDescriptor({highlighted:true,html:item.html,icon:AJS.contextPath()+"/images/icons/icon_groups_16.png",label:item.name,value:(prefix?"group:":"")+item.name})})}jQuery(".js-usergroup-checkboxmultiselect",$ctx).each(function(){new AJS.CheckboxMultiSelect({element:this,maxInlineResultsDisplayed:10,content:"mixed",ajaxOptions:{url:AJS.contextPath()+"/rest/api/latest/groupuserpicker",data:{showAvatar:true},query:true,formatResponse:_formatUserGroupResponse}})});jQuery(".js-user-checkboxmultiselect",$ctx).each(function(){new AJS.CheckboxMultiSelect({element:this,maxInlineResultsDisplayed:5,content:"mixed",ajaxOptions:{url:AJS.contextPath()+"/rest/api/latest/user/picker",data:{showAvatar:true},query:true,formatResponse:function(items){return _formatUserResponse(items,false)}}})});jQuery(".js-group-checkboxmultiselect",$ctx).each(function(){new AJS.CheckboxMultiSelect({element:this,maxInlineResultsDisplayed:5,content:"mixed",ajaxOptions:{url:AJS.contextPath()+"/rest/api/latest/groups/picker",data:{showAvatar:true},query:true,formatResponse:function(items){return _formatGroupResponse(items,false)}}})})});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/search/enhanceIssueLinks.js' */
JIRA.Issues.enhanceLinks={withPushState:function(a){a=_.defaults(a,{selector:".push-state"});AJS.$(document).delegate(a.selector,"simpleClick",function(d){if(this.href){d.preventDefault();var b=parseUri(this.href);var c=b.path;if(b.query){c+="?"+b.query}c=c.replace(Backbone.history.options.root,"");if(Backbone.history.fragment==c||Backbone.history.fragment==decodeURIComponent(c)){Backbone.history.loadUrl(c)}else{a.router.navigate(c,{trigger:true})}}})},toIssueNav:function(a){var c="a.filter-link[data-filter-id], a.filter-link[data-jql]",b="#issues_new_search_link_lnk";if(JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()){return}AJS.$(document).on("simpleClick",c,function(h){h.preventDefault();var g=AJS.$(h.target).closest("a"),f=g.data("filter-id"),d=g.data("jql");a.searchPageModule.reset({filter:f,jql:d})});AJS.$(document).on("simpleClick",b,function(d){d.preventDefault();a.searchPageModule.resetToBlank()})},isIssueTableDropdown:function(a){if(AJS.InlineLayer.current){var b=jQuery(AJS.InlineLayer.current.offsetTarget());if(b.closest(".list-view table#issuetable").size()){return true}}},toIssue:function(b){if(JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()){return}AJS.$(document).on("simpleClick",["#attachment-sorting-options a","#attachment-sorting-order-options a","#subtasks-show-all","#subtasks-show-open"].join(","),function(g){if(this.href){g.preventDefault();g.stopPropagation();var f=parseUri(this.href);if(f.queryKey){b.issueModule.updateIssueWithQuery(f.queryKey);AJS.$(this).parents("ul").find("a.aui-checked").removeClass("aui-checked");AJS.$(this).addClass("aui-checked")}}});var d="a.issue-link[data-issue-key]",c=".parentIssue",a=".list-view table#issuetable a.issue-link[data-issue-key]";AJS.$(document).on("simpleClick",d,function(k){k.preventDefault();k.stopPropagation();var i=b.searchPageModule.searchResults;var f=AJS.$(k.target).closest("a").data("issue-key");var g=i._getIssueIdForKey(f);var l=parseInt(g,10);var j=AJS.$(k.target).is(a);var m=AJS.$(k.target).is(c);var h=JIRA.Issues.enhanceLinks.isIssueTableDropdown(a);if((j&&!m)||h){JIRA.Issues.Analytics._loadIssueReason="click-issue-link";JIRA.Issues.Analytics.trigger("kickass.openIssueFromTable",{issueId:g,absolutePosition:i.getPositionOfIssueInSearchResults(l)+1,relativePosition:i.getPositionOfIssueInPage(l)+1});b.searchPageModule.update({selectedIssueKey:f})}else{b.searchPageModule.reset({selectedIssueKey:f})}})},transformToAjax:function(a){if(JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()){return}AJS.$(document).on("simpleClick",[".subtask-reorder a"].join(","),function(b){if(this.href){b.preventDefault();b.stopPropagation();AJS.$.ajax({type:"GET",data:{disableRedirect:true},url:this.href}).done(function(){a.issueModule.refreshIssue(JIRA.Issues.Actions.UPDATE)}).fail(function(c){JIRA.Messages.showErrorMsg(JIRA.SmartAjax.buildSimpleErrorContent(c),{closeable:true})})}})}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/components/table/ResultsCountView.js' */
(function(a){Backbone.define("JIRA.Issues.ResultsCountView",JIRA.Issues.BaseView.extend({events:{"simpleClick .pagination a[data-start-index]":"_onPaginationClick","click .refresh-table":"_onRefreshTable"},initialize:function(b){this.model.bindIssueDeleted(this.render,this);this.search=b.search},setEndOfStableSearchMessage:function(b){this.$endOfStableSearchMessage=b},render:function(){AJS.$.fn.tipsy.revalidate();this._renderResultsCount();this._renderPaginationLinks();this._renderEndOfStableMessage();this.$("[title]").each(function(b,c){new JIRA.Issues.Tipsy({el:AJS.$(c),showCondition:":not(.active)",tipsy:{gravity:AJS.$.fn.tipsy.autoBounds(60,["s"])}})})},_onRefreshTable:function(b){b.preventDefault();JIRA.Issues.Analytics.trigger("kickass.issueTableRefresh");this.search.refresh()},_onPaginationClick:function(b){b.preventDefault();var c=AJS.$(b.target).closest("a").data("start-index");this.model.goToPage(c)},_renderResultsCount:function(){var b=this.$(".results-count");var c=this.model.getTotal();if(c===0){b.empty()}else{b.replaceWith(JIRA.Templates.IssueNavTable.resultsCount({start:JIRA.NumberFormatter.format(this.model.getStartIndex()+1),end:JIRA.NumberFormatter.format(this.model.getPositionOfLastIssueInPage()),total:JIRA.NumberFormatter.format(c)}))}},_renderPaginationLinks:function(){var d=this.$(".pagination");var b=this.model.getDisplayableTotal();if(b===0){d.empty();return}var c=JIRA.Issues.URLSerializer.getURLFromState({selectedIssueKey:null,jql:this.search.getJql(),filter:this.search.getFilterId()});d.replaceWith(JIRA.Templates.IssueNavTable.pagination({startIndex:this.model.getStartIndex(),pageSize:this.model.getPageSize(),searchQuery:c,displayableTotal:b}))},_renderEndOfStableMessage:function(){if(!this.$endOfStableSearchMessage){return}var c=!!(this.model.getTotal()-this.model.getDisplayableTotal()),b=this.model.getPageNumber()===this.model.getNumberOfPages();if(c&&b){this.$endOfStableSearchMessage.addClass("visible");this.$endOfStableSearchMessage.html(JIRA.Templates.IssueNavTable.endOfStableMessage())}else{this.$endOfStableSearchMessage.empty();this.$endOfStableSearchMessage.removeClass("visible")}},_getPagingUri:function(b){return AJS.contextPath()+"/"+JIRA.Issues.URLSerializer.getURLFromState({selectedIssueKey:null,startIndex:b,jql:this.search.getJql(),filter:this.search.getFilterId()})}}))})(jQuery);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/splitview/SplitScreenDetailView.js' */
Backbone.define("JIRA.Issues.SplitScreenDetailView",JIRA.Issues.BaseView.extend({events:{"focus #addcomment textarea":"scrollToBottom"},issueDetailsNoSelectionTemplate:JIRA.Templates.SplitView.issueDetailsNoSelection,initialize:function(a){_.bindAll(this);this.issueCacheManager=a.issueCacheManager;this.issueModule=a.issueModule;this.search=a.search;this.searchResults=a.search.getResults();this.issueModule.bindFieldSubmitted(this.focus);this.issueModule.bindReplacedFocusedPanel(this.focus)},adjustHeight:function(){_.defer(_.bind(function(){var b=this.getIssueContainer(),a=b.length&&b.offset().top,c=jQuery(window).height();if(b.length){b.css("height",c-a)}},this))},getIssueContainer:function(){return this.$el.find(".issue-container")},scrollToTop:function(){var a=this.getIssueContainer();if(a.size()){a.scrollTop(0)}},scrollToBottom:function(){var a=this.getIssueContainer();if(a.size()){a.scrollTop(a.prop("scrollHeight"))}},activate:function(){if(this.isActive){return this}var a=this;this.$el.focusin(function(){a.focused=true});this.$el.focusout(function(){a.focused=false});this.addListener(this.searchResults,"selectedIssueChange",this.render,this);this.addListener(this.searchResults,"issueUpdated",this.onIssueUpdated,this);this.addListener(this.searchResults,"issueDoesNotExist",this._onIssueDoesNotExist,this);JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,this.fixMentionsDropdownInMentionableFields);JIRA.Issues.onVerticalResize(this.adjustHeight);this.issueModule.bindLoadComplete(this.adjustHeight,this);this.isActive=true;return this},deactivate:function(){this.issueModule.abortPending();JIRA.Issues.offVerticalResize(this.adjustHeight);this.issueModule.unbindLoadComplete(this.adjustHeight);JIRA.unbind(JIRA.Events.NEW_CONTENT_ADDED,this.fixMentionsDropdownInMentionableFields);JIRA.Issues.BaseView.prototype.deactivate.apply(this,arguments);this.isActive=false},fixMentionsDropdownInMentionableFields:function(b,a,c){if(c===JIRA.CONTENT_ADDED_REASON.panelRefreshed||c===JIRA.CONTENT_ADDED_REASON.inlineEditStarted){a.find(".mentionable:not([data-follow-scroll])").attr("follow-scroll",".split-view .issue-container");a.find(".mentionable:not([data-push-scroll])").attr("push-scroll",".issue-body-content")}},onIssueUpdated:function(c,a,b){if(b.action!==JIRA.Issues.Actions.INLINE_EDIT&&b.action!==JIRA.Issues.Actions.ROW_UPDATE){return this.issueModule.refreshIssue(b)}else{return jQuery.Deferred().resolve()}},render:function(b,a){a=a||{};if(this.searchResults.hasIssues()&&!this.search.isStandAloneIssue()&&a.reason!=="issueLoaded"){if(this.searchResults.hasSelectedIssue()){this.issueModule.abortPending();JIRA.Issues.Utils.debounce(this,"_renderIssue",this.searchResults.getSelectedIssue())}else{this._renderNoIssue()}}this.adjustHeight();return this},_renderIssue:function(a){this.issueModule.loadIssue({id:a.getId(),key:a.getKey(),splitViewMode:true}).always(_.bind(function(){this.issueModule.updateIssuePager(_.extend({},this.searchResults.getPager(),{isSplitView:true}));if(this.searchResults.isFirstIssueSelected()&&this.searchResults.getDisplayableTotal()>1){this.issueCacheManager.scheduleIssueToBePrefetched(this.searchResults.getNextIssueForSelectedIssue())}this.issueCacheManager.prefetchIssues();this.$el.addClass("active");this.scrollToTop()},this))},focus:function(){if(!this.hasFocus()){this.getIssueContainer().focus()}},blur:function(){this.getIssueContainer().blur()},_onIssueDoesNotExist:function(){this._renderNoIssue();this.issueModule.renderIssueDoesNotExist(this.$el)},_renderNoIssue:function(){this.$el.html(this.issueDetailsNoSelectionTemplate())},hasFocus:function(){return this.focused===true}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/splitview/SplitScreenOrderByView.js' */
Backbone.define("JIRA.Issues.SplitScreenOrderByView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.SplitView.orderBy,events:{"simpleClick a.order-by":"_onClickOrderBy","simpleClick a.order-options":"_toggleShowDropDown"},initialize:function(a){this.search=a.search;this.searchResults=a.search.getResults()},render:function(){this.$el.html(this.template({sortBy:this.searchResults.getSortBy()}));return this},deactivate:function(){this.orderByDropDown&&this.orderByDropDown.deactivate();JIRA.Issues.BaseView.prototype.deactivate.apply(this,arguments)},_onClickOrderBy:function(b){b.preventDefault();var a=AJS.$(b.currentTarget).data("field-id");if(a){this.search.doSort({fieldId:a})}},_toggleShowDropDown:function(a){a.preventDefault();if(!this.orderByDropDown){this.orderByDropDown=new JIRA.Issues.OrderByDropDownView({search:this.search,offsetTarget:this.$("a.order-by"),onHideCallback:_.bind(function(){this.orderByDropDown=null},this)})}this.orderByDropDown.toggle()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/splitview/OrderByDropDownView.js' */
Backbone.define("JIRA.Issues.OrderByDropDownView",JIRA.Issues.BaseView.extend({initialize:function(a){_.bindAll(this,"_onDropdownHidden","_onDropdownShown");this.search=a.search;this.offsetTarget=a.offsetTarget;this._onHideCallback=a.onHideCallback;this._pending=null;this._inlineLayer=null},deactivate:function(){this._inlineLayer&&this._inlineLayer.hide();JIRA.Issues.BaseView.prototype.deactivate.apply(this,arguments)},toggle:function(){if(!this._inlineLayer){this._pending=AJS.$.ajax(this._ajaxDefaults());this._inlineLayer=this._createInlineLayer(this._pending);this._inlineLayer.bind(AJS.InlineLayer.EVENTS.show,this._onDropdownShown);this._inlineLayer.bind(AJS.InlineLayer.EVENTS.hide,this._onDropdownHidden);this._inlineLayer.show()}else{this._inlineLayer.hide()}},_createInlineLayer:function(a){var b=_.bind(function(d){this._deferredAddTipsyToFooter(d);return this._renderInitialContent(d)},this);var c=new AJS.InlineLayer({offsetTarget:this.offsetTarget,content:function(){return a.pipe(b)},width:218});if(this._onHideCallback){c.bind(AJS.InlineLayer.EVENTS.hide,this._onHideCallback)}return c},_initSingleSelect:function(b){var c=b.find("select");c.bind("selected",_.bind(this._onFieldSelected,this));new AJS.CheckboxMultiSelect({element:c,itemAttrDisplayed:"label",suggestionsHandler:AJS.SelectSuggestHandler,ajaxOptions:this._ajaxDefaults({data:_.bind(function(d){return JSON.stringify(this._ajaxOptionsData(d))},this),query:true,minQueryLength:0,formatResponse:_.bind(function(d){this._removeTipsy();var f=new AJS.GroupDescriptor();_.each(d.fields,function(g){f.addItem(new AJS.ItemDescriptor({title:g.fieldName,value:g.fieldId,label:g.fieldName,meta:{sortJql:g.sortJql}}))});var e=this._getFooterText(d);if(e){f.footerText(e);this._deferredAddTipsyToFooter(d)}return[f]},this)})});var a=b.find("#order-by-options-input");a.focus()},_ajaxDefaults:function(b){var a={url:AJS.contextPath()+"/rest/issueNav/1/orderByOptions",type:"POST",contentType:"application/json",data:JSON.stringify(this._ajaxOptionsData())};return _.extend(a,b)},_ajaxOptionsData:function(c){var a=this.search.getEffectiveJql();var b=this.search.getFilterId();var d=this.search.getResults().getSortBy();return{query:c,jql:a?a:undefined,filter:b?b:undefined,sortBy:d?d.fieldId:undefined}},_renderInitialContent:function(a){var b=_.map(a.fields,function(c){return _.extend({},c,{meta:JSON.stringify({sortJql:c.sortJql})})});return AJS.$("<div></div>").addClass("order-dropdown").html(JIRA.Templates.SplitView.orderByOptions({options:b,footer:this._getFooterText(a)}))},_onDropdownShown:function(b,a,c){this._initSingleSelect(a)},_onDropdownHidden:function(b,a,c){this._removeTipsy();AJS.$("div.order-dropdown").remove();this._inlineLayer=null},_onFieldSelected:function(b,a){_.defer(_.bind(function(){AJS.InlineLayer.current.hide();var c=a.meta();this.search.doSort({jql:c.sortJql})},this))},_getFooterText:function(a){if(typeof a.matchesCount==="number"&&typeof a.maxResults==="number"){var b=a.matchesCount-a.maxResults;if(b>0){return AJS.format("{0} more fields...",b)}}return""},_deferredAddTipsyToFooter:function(d){var b=d.matchesCount;var e=Math.min(d.matchesCount,d.maxResults);var c=AJS.format("Showing {0} of {1} matching fields. Find more fields by typing in the search box.",e,b);var a=this;_.defer(function(){a._tipsyTrigger=a._inlineLayer.$layer.find(".aui-list-section-footer").tipsy({title:function(){return c},className:"tipsy-front"})})},_removeTipsy:function(){if(this._tipsyTrigger){this._tipsyTrigger.tipsy("hide");this._tipsyTrigger=null}}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/splitview/SplitScreenListView.js' */
Backbone.define("JIRA.Issues.SplitScreenListView",JIRA.Issues.BaseView.extend({inaccessibleIssueRowTemplate:JIRA.Templates.SplitView.inaccessibleIssueRow,template:JIRA.Templates.SplitView.issueList,events:{"simpleClick .issue-list li":"_onClickIssue"},initialize:function(a){_.bindAll(this);this.search=a.search;this.searchContainer=a.searchContainer;this.searchPromise=this._createSearchPromise({done:this._onSearchDone,fail:this._onSearchFail});this.searchResults=a.search.getResults();this.serverRendered=!!a.serverRendered&&this._issuesRendered(a);this.paginationView=new JIRA.Issues.ResultsCountView({model:this.searchResults,search:this.search});JIRA.Issues.onVerticalResize(this._adjustHeight);this.addListener(this.searchResults,"highlightedIssueChange",this._onHighlightedIssueChange,this);this.addListener(this.searchResults,"issueUpdated",this._onIssueUpdated,this);this.addListener(this.searchResults,"startIndexChange",this.render,this)},_issuesRendered:function(a){return !!a.searchContainer.find(".issue-list").length},_adjustHeight:function(){var b=jQuery(".end-of-stable-message").outerHeight(),a=this.$el.offset().top+this.searchContainer.find(".list-panel").scrollTop(),d=jQuery(".pagination-view:last").outerHeight(),c=jQuery(window).height();this.$el.css("height",c-a-b-d)},scrollToFocused:function(){var b=this.searchContainer.find(".list-panel");var a=this.$el.find(".focused");if(b.size()&&a.size()){b.scrollTop(a.position().top)}},deactivate:function(){this.searchPromise.reset();JIRA.Issues.offVerticalResize(this._adjustHeight);this.paginationView.deactivate();JIRA.Issues.BaseView.prototype.deactivate.apply(this,arguments)},_onClickIssue:function(c){var b=AJS.$(c.target).closest("[data-id]").data("id"),a=this.searchResults.getSelectedIssue().getId()==b;c.preventDefault();if(!a){this.searchResults.selectIssueById(b,{replace:true});JIRA.Issues.Analytics.trigger("kickass.openIssueFromTable",{issueId:b,absolutePosition:this.searchResults.getPositionOfIssueInSearchResults(b)+1,relativePosition:this.searchResults.getPositionOfIssueInPage(b)+1})}},_createSearchPromise:function(a){var b=jQuery.RecurringPromise();a=a||{};a.done&&b.done(_.bind(a.done,this));a.fail&&b.fail(_.bind(a.fail,this));return b},getIssueById:function(a){return this.$el.find("[data-id="+a+"]")},_highlightIssue:function(a){this.$el.find(".focused").removeClass("focused");a&&this.getIssueById(a.getId()).addClass("focused").scrollIntoView()},markIssueInaccessible:function(a){this.getIssueById(a).replaceWith(this.inaccessibleIssueRowTemplate({isHighlighted:this.searchResults.getHighlightedIssue().getId()===a,issueID:a}))},_onHighlightedIssueChange:function(){this._highlightIssue(this.searchResults.getHighlightedIssue())},_onIssueUpdated:function(b,a){if(a.table[0]===null){this.markIssueInaccessible(b)}else{this.getIssueById(b).html(JIRA.Templates.SplitView.issueRow(a.table[0]))}},_onSearchDone:function(a){if(a instanceof Array){if(this.searchResults.hasIssues()){if(!a.serverRendered){this.$el.html(this.template({highlightedID:this.searchResults.getHighlightedIssue().getId(),issueIDs:this.searchResults.getPageIssueIds(),issues:a}))}this.paginationView.render()}_.defer(_.bind(function(){this._adjustHeight();this.scrollToFocused()},this))}},_onSearchFail:function(){var a=this.searchContainer.find(".navigator-content");a.html(JIRA.Templates.Issues.Util.errorMessage({msg:"Error occurred communicating with the server. Please reload the page and try again."}))},render:function(){var a=this.serverRendered;this.serverRendered=false;if(this.searchResults.hasIssues()){if(!this.searchResults.hasHighlightedIssue()&&!this.searchResults.hasSelectedIssue()){this.searchResults.highlightFirstInPage();return}return this.searchPromise.add(this.searchResults.getResultsForPage().then(function(b){return _.extend(b,{serverRendered:a})}))}else{return jQuery.Deferred().resolve()}}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/splitview/SplitScreenLayout.js' */
(function(a){Backbone.define("JIRA.Issues.SplitScreenLayout",JIRA.Issues.BaseView.extend({initialize:function(b,c){_.bindAll(this);c=_.extend(c,{serverRendered:this._consumeServerRenderedSplitView(c)});this.search=c.search;this.fullScreenIssue=c.fullScreenIssue;this.issueModule=c.issueModule;this.navigatorContent=c.searchContainer.find(".navigator-content");this.searchResults=c.search.getResults();this.emptyResultsView=new JIRA.Issues.EmptyResultsView({searchResults:this.searchResults,el:this.navigatorContent});this.detailsView=new JIRA.Issues.SplitScreenDetailView(c);this.listView=new JIRA.Issues.SplitScreenListView(c);this.orderByView=new JIRA.Issues.SplitScreenOrderByView(c);JIRA.Issues.onVerticalResize(this._adjustNoResultsMessageHeight);JIRA.Issues.onHorizontalResize(this._updateSidebarPosition);JIRA.Issues.onVerticalResize(this._updateSidebarPosition);this.addListener(c.search,"beforeSearch",this._showPending,this);this.addListener(this.searchResults,"issueDeleted",this._onIssueDeleted,this);this.addListener(this.searchResults,"newPayload",this._hidePending,this);this.addListener(this.searchResults,"newPayload",this.render,this);this.addListener(this.searchResults,"startIndexChange",this._onStartIndexChange,this);this.addListener(this.searchResults,"highlightedIssueChange",this._onHighlightedIssueChange,this);this.addListener(this.searchResults,"selectedIssueChange",this._onSelectedIssueChange,this);this.search.onSearchError(this._onSearchFail,this);this.issueModule.bindLoadError(this._onIssueLoadError,this);this.listView.searchPromise.done(_.bind(function(){this._makeVisible()},this));this.fullScreenIssue.hide();JIRA.Issues.overrideScrollIntoViewForSplit();this.setElement(this.navigatorContent);if(c.serverRendered){this._activateSubviews()}},_adjustNoResultsMessageHeight:function(){var d=this.searchResults.hasIssues(),c=this.navigatorContent.offset().top,b=AJS.$(window).outerHeight(true);if(d){this.navigatorContent.css("height","")}else{this.navigatorContent.css("height",b-c)}},_consumeServerRenderedSplitView:function(c){var d=!!AJS.Meta.get("consumed-server-rendered-split-view"),b=!!c.searchContainer.find(".split-view").length;AJS.Meta.set("consumed-server-rendered-split-view",true);return !d&&b},deactivate:function(){JIRA.Issues.offVerticalResize(this._adjustNoResultsMessageHeight);JIRA.Issues.offHorizontalResize(this._updateSidebarPosition);JIRA.Issues.restoreScrollIntoViewForNormal();jQuery("body").removeClass("page-type-split");this.issueModule.unbindLoadError(this._onIssueLoadError,this);this.navigatorContent.addClass("pending").css("height","");this.search.offSearchError(this._onSearchFail,this);this.detailsView.deactivate();this.listView.deactivate();jQuery(window).unbind("resize",this.applyResponsiveDesign);JIRA.Issues.BaseView.prototype.deactivate.apply(this,arguments);if(!this.searchResults.hasIssue(this.searchResults.getSelectedIssue().getId())){this.searchResults.selectFirstInPage()}},_handleInitialIssueSelection:function(){if(!this.searchResults.hasSelectedIssue()){if(this.searchResults.hasHighlightedIssue()){this.searchResults.selectIssueById(this.searchResults.getHighlightedIssue().getId(),{replace:true})}else{this.searchResults.selectFirstInPage({replace:true})}}},_hidePending:function(){this.navigatorContent.removeClass("pending")},_isInitialRender:function(){return !this.navigatorContent.find(".split-view").length},_makeVisible:function(){this.navigatorContent.removeClass("pending");if(this._isInitialRender()){this.navigatorContent.html(this.$el)}this.$el.find(".list-results-panel").sidebar({id:"splitview",minWidth:function(b){return 250},maxWidth:_.bind(function(){return this.$el.width()-500},this),resize:this.applyResponsiveDesign});jQuery(window).resize(this.applyResponsiveDesign);JIRA.trigger(JIRA.Events.LAYOUT_RENDERED);this.applyResponsiveDesign()},_updateSidebarPosition:function(){var b=this.$el.find(".list-results-panel");b.sidebar("updatePosition")},applyResponsiveDesign:function(){this.$el.toggleClass("skinny",this.detailsView.$el.width()<900);this.$el.toggleClass("very-skinny",this.detailsView.$el.width()<600)},nextIssue:function(){this.searchResults.selectNextIssue({replace:true})},_onHighlightedIssueChange:function(c,b){b=_.defaults({},b,{replace:true});var d=this.searchResults.getHighlightedIssue().getId();this.searchResults.selectIssueById(d,b)},_onIssueDeleted:function(b){this.listView.getIssueById(b.id).hide();this._showPending();if(this.searchResults.hasIssues()){this.listView.render()}else{this._renderEmptyResults()}},_onIssueLoadError:function(b){if(b.response.status===404){this.listView.markIssueInaccessible(b.issueId)}},_onSearchFail:function(){this._renderEmptyResults();this._hidePending()},_onSelectedIssueChange:function(){this._setIssueModuleContainer()},_onStartIndexChange:function(){if(this.searchResults.hasIssues()){this._showPending()}},prevIssue:function(){this.searchResults.selectPrevIssue({replace:true})},render:function(){var c=this.searchResults.hasIssues(),b=this._isInitialRender();jQuery("body").addClass("page-type-split");if(c){this._handleInitialIssueSelection();this.navigatorContent.removeClass("empty-results");if(b){this.$el.html(JIRA.Templates.SplitView.structure())}this._activateSubviews();this.detailsView.render();this.listView.render()}else{this._hidePending();this._renderEmptyResults()}this._adjustNoResultsMessageHeight();this.orderByView.render();return this},_renderEmptyResults:function(){this.emptyResultsView.render()},_setIssueModuleContainer:function(){this.issueModule.setContainer(this.$(".split-view .detail-panel > div"))},_showPending:function(){this.navigatorContent.addClass("pending")},_activateSubviews:function(){this.detailsView.setElement(this.$(".detail-panel")).activate();this.orderByView.setElement(this.$(".list-ordering"));this.listView.setElement(this.$(".list-content"));this.listView.paginationView.setElement(this.$(".pagination-view"));this.listView.paginationView.setEndOfStableSearchMessage(this.$(".end-of-stable-message"));this._setIssueModuleContainer()},handleLeft:function(){this.detailsView.blur()},handleRight:function(){this.detailsView.focus()},isIssueViewActive:function(){return this.detailsView.hasFocus()}}))})(jQuery);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/util/IntroDialog.js' */
JIRA.Issues.IntroDialog={dialogs:{},_undismissedDialogs:{},create:function(a){function d(){delete JIRA.Issues.IntroDialog._undismissedDialogs[a.id];b.hide();jQuery.ajax({url:a.url,type:"POST",data:{tipKey:a.id}})}if(!a.id){console.error("JIRA.Issues.createIntroDialog: you must specify an id")}if(!a.template){console.error("JIRA.Issues.createIntroDialog: you must specify a template")}this.options=a=_.defaults(a,{addActiveClass:false,noBind:true,url:AJS.contextPath()+"/rest/issueNav/1/suppressedTips",offsetX:-40,hideDelay:50000,displayShadow:!jQuery.browser.msie||parseInt(jQuery.browser.version,10)>8,shouldShow:function(){return true},beforeShow:function(){}});var b=new AJS.InlineDialog(a.selector,a.id,function(g,f,e){g.empty().append(a.template());g.find(".dismiss").click(function(h){d();h.preventDefault()});g.click(function(h){h.stopPropagation()});e()},a);var c=this.dialogs[a.id]={dismissForever:d,hide:b.hide,show:function(g){var f=jQuery.Deferred();var e=function(){var h=a.beforeShow();if(h&&h.done){h.done(function(){b.show();f.resolve()})}else{b.show();f.resolve()}};if(g){e()}else{if(a.shouldShow()&&JIRA.Issues.LoginUtils.isLoggedIn()){jQuery.ajax({url:a.url,data:{tipKey:a.id}}).done(function(h){if(h==="false"){e()}else{delete JIRA.Issues.IntroDialog._undismissedDialogs[a.id];f.reject()}})}else{f.reject()}}return f.promise()}};this._undismissedDialogs[a.id]=c;return c},showOneOf:function(a){if(a.length){var b=JIRA.Issues.IntroDialog._undismissedDialogs[a[0]];if(b){b.show().fail(function(){JIRA.Issues.IntroDialog.showOneOf(a.slice(1))})}else{JIRA.Issues.IntroDialog.showOneOf(a.slice(1))}}}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/search/FullScreenLayout.js' */
Backbone.define("JIRA.Issues.FullScreenLayout",JIRA.Issues.BaseView.extend({initialize:function(a,b){_.bindAll(this);_.extend(this,b);this.$searchContainer=b.searchContainer;this.$navigatorContent=this.$searchContainer.find(".navigator-content");this.searchResults=this.search.getResults();this.issueTableView=new JIRA.Issues.IssueTableView({el:this.$navigatorContent,search:this.search,searchResults:this.searchResults});this.addListener(this.search,"beforeSearch",this._onBeforeSearch,this);this.addListener(this.searchResults,"newPayload",this.render,this);this.addListener(this.searchResults,"selectedIssueChange",this.handleIssueSelectionChanged,this);this.addListener(this.searchResults,"issueUpdated",this.handleIssueUpdated,this);this.issueModule.bindLoadError(this.handleIssueLoadError,this)},handleIssueUpdated:function(c,a,b){if(b.action!=="inlineEdit"&&b.action!=="rowUpdate"){return this.fullScreenIssue.updateIssue(b)}},deactivate:function(){this.issueModule.unbindLoadError(this.handleIssueLoadError,this);this.$navigatorContent.addClass("pending");this.fullScreenIssue.deactivate();this.issueTableView.deactivate();JIRA.Issues.BaseView.prototype.deactivate.apply(this,arguments)},handleIssueSelectionChanged:function(a,b){if(a.hasIssue()){this.handleSelectedIssue(a,b)}else{this.handleIssueUnselected()}},render:function(){if(!this.searchResults.hasSelectedIssue()){this.fullScreenIssue.hide();this.issueTableView.render().done(_.bind(function(){this.$navigatorContent.removeClass("pending");JIRA.trigger(JIRA.Events.LAYOUT_RENDERED,["list-view"])},this))}return this},handleIssueLoadError:function(a){if(a.response.status===404){this.issueTableView.handleIssueInaccessible(a.issueId)}if(!this.fullScreenIssue.isVisible()){this.searchResults.selectIssueByKey(null)}this.fullScreenIssue.showError(a)},handleIssueUnselected:function(){if(this.fullScreenIssue.isVisible()){this.fullScreenIssue.hide();JIRA.trace("jira.returned.to.search");JIRA.trace("jira.psycho.returned.to.search");JIRA.Issues.Analytics.trigger("kickass.returntosearch")}this.$navigatorContent.removeClass("pending");this.issueTableView.show()},_loadIssue:function(a){this.fullScreenIssue.show({id:a.getId(),key:a.getKey(),pager:this.searchResults.getPager()})},handleSelectedIssue:function(a,b){b=b||{};if(b.reason!=="issueLoaded"){this.issueModule.abortPending();JIRA.Issues.Utils.debounce(this,"_loadIssue",a)}this.fullScreenIssue.updatePager(this.searchResults.getPager())},_onBeforeSearch:function(){this.$navigatorContent.addClass("pending")},nextIssue:function(){this.searchResults.highlightNextIssue();if(this.searchResults.hasSelectedIssue()){this.searchResults.selectNextIssue()}},prevIssue:function(){this.searchResults.highlightPrevIssue();if(this.searchResults.hasSelectedIssue()){this.searchResults.selectPrevIssue()}},returnToSearch:function(){this.searchResults.unselectIssue()},searchIsVisible:function(){return this.searchContainer.closest("body").length>0},handleLeft:function(){},handleRight:function(){},isIssueViewActive:function(){return this.fullScreenIssue.isVisible()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/search/SearchResults.js' */
(function(a){Backbone.define("JIRA.Issues.SearchResults",JIRA.Issues.BaseModel.extend({defaults:{issueIds:[],selectedIssue:new JIRA.Issues.SimpleIssue(),highlightedIssue:new JIRA.Issues.SimpleIssue(),total:0},properties:["columnSortJql","highlightedIssue","issueIds","issueIdsForPage","jiraHasIssues","pageSize","resultsId","selectedIssue","startIndex","sortBy","columns","table","total","initialPayload"],namedEvents:["prevIssueSelected","nextIssueSelected","issueUpdated","issueDeleted","issueDoesNotExist"],initialize:function(b,c){JIRA.Issues.ModelUtils.makeTransactional(this,"resetFromSearch","selectNextIssue","selectPrevIssue");this.issueUpdateCallbacks=[];this._issueSearchManager=c.issueSearchManager;this._initialHighlightedIssueId=c.initialHighlightedIssueId;this._initialSelectedIssue=c.initialSelectedIssue},getStartIndexForPage:function(b){return b*this.getPageSize()},hasIssue:function(b){return _.indexOf(this.getIssueIds(),b)!==-1},getPager:function(){if(this.hasIssue(this.getSelectedIssue().getId())){var e=this.getIssueIds();var f=this.getSelectedIssue().getId();var c=_.indexOf(e,f);var g=this.getTotal();var h=e.length;var d={position:JIRA.NumberFormatter.format(c+1),resultCount:JIRA.NumberFormatter.format(g),stableSearchLimit:h};if(c>0){var i=this._getPrevIssueId(f);if(i){d.previousIssue={id:i,key:this._getIssueKeyForId(i)}}}if(c<g-1&&c<h-1){var b=this._getNextIssueId(f);if(b){d.nextIssue={id:b,key:this._getIssueKeyForId(b)}}}return d}},getNumberOfPages:function(){return this._getPageNumberForStartIndex(this.getDisplayableTotal()-1)},removeIssue:function(e){e=parseInt(e,10);var d=this.getIssueIds()[0]===e,c=this.getHighlightedIssue().getId()===e,b=_.last(this.getIssueIds())===e;if(c){if(!b){this.highlightNextIssue({replace:true})}else{if(!d){this.highlightPrevIssue({replace:true})}}}this.setIssueIds(_.without(this.getIssueIds(),e));this.setTotal(this.getTotal()-1);this.triggerIssueDeleted({id:e,key:this._getIssueKeyForId(e)})},isFirstIssueHighlighted:function(){if(!this.hasHighlightedIssue()){return false}return this.getHighlightedIssue().getId()===this.getIssueIds()[0]},updateIssueById:function(c,b){return this.updateIssue(_.extend({id:c},b))},updateIssue:function(f,b){var d=f.action===JIRA.Issues.Actions.DELETE,e=f.id,c=[];b=_.defaults({},b,{showMessage:true});if(d){this.removeIssue(e);b.showMessage&&this._notifyOfIssueUpdate(f);return jQuery.Deferred().resolve().promise()}else{return this.getResultForId(e).done(_.bind(function(g){_.each(this.issueUpdateCallbacks,function(i){var h=i.handler.call(i.ctx||window,e,g,f);if(h&&h.promise){c.push(h)}});a.when(c).done(_.bind(function(){b.showMessage&&this._notifyOfIssueUpdate(f)},this))},this))}},_notifyOfIssueUpdate:function(b){b.message&&JIRA.Issues.showNotification(b.message,b.key);JIRA.trace("jira.search.stable.update")},getResultForId:function(b){return this._issueSearchManager.getRowsForIds([b],this.getColumns())},isHighlightedIssueAccessible:function(){if(!this.hasHighlightedIssue()){return null}return !this._issueSearchManager.issueKeys.hasError(this.getHighlightedIssue().getId())},getDisplayableTotal:function(){return this.getIssueIds().length},selectIssueByKey:function(c,b){if(!c){this.unselectIssue();return}var d=this._getIssueIdForKey(c);if(!d){this._unhighlightIssue();this.getSelectedIssue().set({id:-1,key:c});this.triggerIssueDoesNotExist()}else{this._selectExistingIssueById(d,b)}},_unhighlightIssue:function(){this.getHighlightedIssue().set({id:null,key:null})},selectFirstInPage:function(b){this.selectIssueById(this.getIssueIds()[this.getStartIndex()],b)},getPrevPageStartIndex:function(){var b=(this.getStartIndex()||0)-this.getPageSize();return(b<0)?null:b},getNextPageStartIndex:function(){var b=this.getPositionOfLastIssueInPage();return(b>=this.getDisplayableTotal())?null:b},getPositionOfLastIssueInPage:function(){var c=this.getStartIndex();var b=this._pageSize();return Math.min(c+b,this.getDisplayableTotal())},highlightFirstInPage:function(){this.highlightIssueById(this.getIssueIds()[this.getStartIndex()])},selectIssueById:function(c,b){if(!c){this.unselectIssue()}else{this._selectExistingIssueById(c,b)}},_selectExistingIssueById:function(c,b){if(c!==this.getSelectedIssue().getId()){c=c?parseInt(c,10):null;this.getSelectedIssue().set({id:c,key:c?this._getIssueKeyForId(c):null},b);if(JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()){this._postSelectionToServer(c)}this.highlightIssueById(c)}},_postSelectionToServer:function(d){var b=_.indexOf(this.getIssueIds(),d),c=this.getIssueIds[b+1];AJS.$.get(contextPath+"/secure/SetSelectedIssue.jspa",{atl_token:atl_token(),selectedIssueId:d,selectedIssueIndex:b,nextIssueId:c},function(){JIRA.trace("jira.search.set.selected.issue.complete")})},highlightIssueById:function(c,b){b=_.defaults({},b,{replace:false});if(c&&c!==this.getHighlightedIssue().getId()){c=c?parseInt(c,10):null;this.getHighlightedIssue().set({id:c,key:c?this._getIssueKeyForId(c):null},b);if(c){this.setStartIndex(this._getStartIndexForIssueId(c))}if(JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()){this._postSelectionToServer(c)}}},getState:function(){return{selectedIssueKey:this.getSelectedIssue().getKey(),startIndex:this.getStartIndex()}},resetFromSearch:function(b){b.resultsId=_.uniqueId();this.getSelectedIssue().set({id:null,key:null});this.set("sortBy",null);this.set(_.pick(b,this.properties));if(typeof b.selectedIssueKey==="string"){this.selectIssueByKey(b.selectedIssueKey)}else{if(this.isIssueOnPage(this._initialHighlightedIssueId)){this.highlightIssueById(this._initialHighlightedIssueId)}else{if(this.hasIssues()){this.highlightFirstInPage()}else{this.getHighlightedIssue().set({id:null,key:null})}}}this._initialHighlightedIssueId=null},hasIssues:function(){return !!this.getIssueIds().length},isIssueOnPage:function(b){return _.indexOf(this.getPageIssueIds(),b)!==-1},isFirstIssueSelected:function(){if(this.hasIssue(this.getSelectedIssue().getId())){var c=this.getIssueIds();var d=this.getSelectedIssue().getId();var b=_.indexOf(c,d);return b==0}return false},getResultsForPage:function(){if(this.getTable()){var b=this.getTable();this.setTable(null);_.defer(function(){JIRA.trace("jira.search.finished")});return a.Deferred().resolve(b).promise()}return this.getResultsForIds(this.getPageIssueIds())},getResultsForIds:function(c){var b=a.Deferred();this._issueSearchManager.getRowsForIds(c,this.getColumns()).done(function(d){b.resolve(d.table)}).fail(b.fail).always(function(){_.defer(function(){JIRA.trace("jira.search.finished")})});return b},applyState:function(b){this.set(_.pick(b,this.properties))},unselectIssue:function(b){var c=this.getSelectedIssue();if(c.getId()){c.set({id:null,key:null},b)}},hasSelectedIssue:function(){return !!this.getSelectedIssue().getId()},hasHighlightedIssue:function(){return !!this.getHighlightedIssue().getId()},getPageIssueIds:function(){var d=this.getStartIndex();var c=this._pageSize();var b=this.getIssueIds();return b?b.slice(d,Math.min(d+c,b.length)):[]},getPageIssues:function(){return _.map(this.getPageIssueIds(),function(b){return{id:b,key:this._getIssueKeyForId(b)}},this)},getPageNumber:function(){return Math.floor(this.getStartIndex()/this._pageSize())},getPositionOfIssueInPage:function(b){return this.getPositionOfIssueInSearchResults(b)%this._pageSize()},getPositionOfIssueInSearchResults:function(b){return _.indexOf(this.getIssueIds(),b)},selectNextIssue:function(b){if(!this.hasSelectedIssue()){return a.Deferred().reject().promise()}var c=this._getNextIssueId(this.getSelectedIssue().getId());this._triggerNextIssueSelectedEvent(c);return this._selectIssue(c,b)},selectPrevIssue:function(b){if(!this.hasSelectedIssue()){return a.Deferred().reject().promise()}var c=this._getPrevIssueId(this.getSelectedIssue().getId());this._triggerPrevIssueSelectedEvent(c);return this._selectIssue(c,b)},_selectIssue:function(c,b){this.selectIssueById(c,b);return a.Deferred().resolve(c).promise()},highlightNextIssue:function(b){if(!this.hasHighlightedIssue()){return a.Deferred().reject().promise()}var c=this._getNextIssueId(this.getHighlightedIssue().getId());this.highlightIssueById(c,b);return a.Deferred().resolve(c).promise()},highlightPrevIssue:function(b){if(!this.hasHighlightedIssue()){return a.Deferred().reject().promise()}var c=this._getPrevIssueId(this.getHighlightedIssue().getId());this.highlightIssueById(c,b);return a.Deferred().resolve(c).promise()},goToPage:function(d,c){c=_.defaults({},c,{replace:false});if(d===null||d===this.getStartIndex()){return a.Deferred().resolve().promise()}var b=this.getIssueIds()[d];this.highlightIssueById(b,c);return a.Deferred().resolve(b).promise()},onHighlightedIssueChange:function(c,b){this.getHighlightedIssue().on("change",c,b)},offHighlightedIssueChange:function(c,b){this.getHighlightedIssue().off("change",c,b)},onSelectedIssueChange:function(c,b){this.getSelectedIssue().on("change",c,b)},offSelectedIssueChange:function(c,b){this.getSelectedIssue().off("change",c,b)},onStartIndexChange:function(c,b){this.on("change:startIndex",c,b)},onNewIssueIds:function(c,b){this.on("change:issueIds",c,b)},offNewIssueIds:function(c,b){this.off("change:issueIds",c,b)},offStartIndexChange:function(c,b){this.off("change:startIndex",c,b)},onNewPayload:function(c,b){this.on("change:resultsId",c,b)},offNewPayload:function(c,b){this.off("change:resultsId",c,b)},onIssueUpdated:function(c,b){this.issueUpdateCallbacks.push({handler:c,ctx:b})},offIssueUpdated:function(c){var b=[];this.issueUpdateCallbacks=_.each(this.issueUpdateCallbacks,function(d){if(d.handler!==c){b.push(d)}});this.issueUpdateCallbacks=b},_getNextIssueId:function(c){var b=this.getIssueIds();return b[Math.min(_.indexOf(b,c)+1,this.getDisplayableTotal()-1)]},getNextIssueForId:function(c){var b=this._getNextIssueId(c);return{id:b,key:this._getIssueKeyForId(b)}},getNextIssueForSelectedIssue:function(){return this.getNextIssueForId(this.getSelectedIssue().getId())},_getPrevIssueId:function(c){var b=this.getIssueIds();return b[Math.max(0,_.indexOf(this.getIssueIds(),c)-1)]},_getStartIndexForIssueId:function(d){var c=_.indexOf(this.getIssueIds(),d),b=this._pageSize();return Math.max(0,Math.floor(c/b)*b)},_getIssueIdForKey:function(b){if(this._initialSelectedIssue&&b===this._initialSelectedIssue.key){return this._initialSelectedIssue.id}return this._getIssueKeysToIds()[b]},_getIssueKeyForId:function(b){if(this._initialSelectedIssue&&b===this._initialSelectedIssue.id){return this._initialSelectedIssue.key}return this._getIssueIdsToKeys()[b]},_getIssueIdsToKeys:function(){return this._issueSearchManager.issueKeys.getAllCached()},_getIssueKeysToIds:function(){var b={};var c=this._issueSearchManager.issueKeys.getAllCached();_.each(c,function(e,d){b[e]=d});return b},_getPageNumberForStartIndex:function(b){return Math.floor(b/this._pageSize())},_pageSize:function(){return this.getPageSize()},_triggerPrevIssueSelectedEvent:function(c){if(c!==this.getSelectedIssue().getId()){var b=this._getPrevIssueId(c);this.trigger("prevIssueSelected",{prevIssue:{id:c,key:this._getIssueKeyForId(c)},prevPrevIssue:{id:b,key:this._getIssueKeyForId(b)}})}},_triggerNextIssueSelectedEvent:function(b){if(b!==this.getSelectedIssue().getId()){var c=this._getNextIssueId(b);this.trigger("nextIssueSelected",{nextIssue:{id:b,key:this._getIssueKeyForId(b)},nextNextIssue:{id:c,key:this._getIssueKeyForId(c)}})}}}))})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/search/SearchModule.js' */
Backbone.define("JIRA.Issues.SearchModule",JIRA.Issues.BaseEvented.extend({initialize:function(a){this._issueSearchManager=a.issueSearchManager;this._searchPageModule=a.searchPageModule;this._toolPreferencesModel=a.toolPreferencesModel;this._searchResults=new JIRA.Issues.SearchResults(null,{issueSearchManager:this._issueSearchManager,initialHighlightedIssueId:a.initialHighlightedIssueId,initialSelectedIssue:a.initialSelectedIssue})},doSort:function(c){if(!(c.fieldId||c.jql)){throw"one of sortOptions.fieldId or sortOptions.jql must be provided"}var a=c.jql;if(c.fieldId){var b=this.getResults().getColumnSortJql();a=b?b[c.fieldId]:null}if(a){this._searchPageModule.update({jql:a,startIndex:null,selectedIssueKey:null},true)}},getFilterId:function(){var a=this._searchPageModule.getFilter();return a&&a.getId()},getJql:function(){return this._searchPageModule.getJql()},getEffectiveJql:function(){return this._searchPageModule.getEffectiveJql()},getResults:function(){return this._searchResults},isStandAloneIssue:function(a){a=a||this._searchPageModule.getState();return !!a.selectedIssueKey&&!_.isString(a.jql)&&!a.filter},onBeforeSearch:function(b,a){this._issueSearchManager.bindBeforeSearch(b,a)},offBeforeSearch:function(b,a){this._issueSearchManager.unbindBeforeSearch(b,a)},onSearchError:function(b,a){this._issueSearchManager.bindSearchError(b,a)},offSearchError:function(b,a){this._issueSearchManager.unbindSearchError(b,a)},refresh:function(){return this._searchPageModule.refreshSearch()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/search/IssueAPI.js' */
JIRA.Issues.IssueAPI=(function(){var a;var b={getIssueId:function(){return JIRA.Issues.Api.getSelectedIssueId()},getIssueKey:function(){return JIRA.Issues.Api.getSelectedIssueKey()}};return{override:function(c){c=_.defaults({},c,{target:JIRA.Issue});a=c.searchPageModule;_.extend(c.target,b)}}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/search/IssuesApi.js' */
JIRA.Issues.Api=(function(){var a,b;return{initialize:function(c){a=c.searchPageModule;b=c.saveInProgressManager},focusSearch:function(){AJS.$(".criteria-selector:first, #advanced-search").focus().select()},getSelectedIssue:function(){return a.getEffectiveIssue()},getSelectedIssueId:function(){return a.getEffectiveIssueId()},getSelectedIssueKey:function(){return a.getEffectiveIssueKey()},hasSavesInProgress:function(){return b.hasSavesInProgress()},isCurrentlyLoadingIssue:function(){return a.isCurrentlyLoadingIssue()},isSelectedIssueAccessible:function(){return a.isHighlightedIssueAccessible()},issueIsVisible:function(){return a.isIssueVisible()},nextIssue:function(){a.nextIssue()},openFocusShifter:function(){if(a.isIssueVisible()){a.openFocusShifter()}},prevIssue:function(){a.prevIssue()},returnToSearch:function(c){a.returnToSearch({ignoreDirtiness:c})},showInlineIssueLoadError:function(c){a.showInlineIssueLoadError(c)},switchLayouts:function(){var c=-1,d=a.getCurrentLayout(),f=a.getSortedLayouts(),e;_.find(f,function(h,g){if(d instanceof h.view){c=g;return true}});e=f[(c+1)%f.length];a.changeLayout(e.id)},isQueryValid:function(){return a.queryModule.isQueryValid()},isFullScreenIssueVisible:function(){return a.isFullScreenIssueVisible()},viewSelectedIssue:function(){if(!JIRA.Issues.Api.isSelectedIssueAccessible()){return}var c=JIRA.Issues.Api.getSelectedIssueKey(),d=JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled();if(d){try{window.location=AJS.contextPath()+"/browse/"+c}catch(e){}}else{if(!a.isIssueVisible()){JIRA.Issues.Analytics._loadIssueReason="issues-api-view-selected";a.update({selectedIssueKey:c})}}},toggleFilterPanel:function(){a.toggleFilterPanel()},waitForSavesToComplete:function(){var c=jQuery.Deferred();window.setTimeout(function(){if(!JIRA.Issues.Api.hasSavesInProgress()){c.resolve()}else{JIRA.bind(JIRA.Events.INLINE_EDIT_SAVE_COMPLETE,function(d){if(!JIRA.Issues.Api.hasSavesInProgress()){c.resolve()}})}},10)},updateIssue:function(c,d){d=d||"thanks_issue_updated";return a.updateIssue({key:c.key,id:c.id,action:JIRA.Issues.Actions.UPDATE,message:d,meta:{}})}}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/search/LayoutPreferenceManager.js' */
JIRA.Issues.LayoutPreferenceManager={PREFERRED_LAYOUT_KEY:"jira.issues.preferred.layout.key",getPreferredLayoutKey:function(){return AJS.Meta.get(this.PREFERRED_LAYOUT_KEY)},setPreferredLayoutKey:function(a){AJS.Meta.set(this.PREFERRED_LAYOUT_KEY,a);AJS.$.ajax({data:{layoutKey:a},type:"POST",url:AJS.contextPath()+"/rest/issueNav/latest/preferredSearchLayout"})}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/search/SearchPageModule.js' */
Backbone.define("JIRA.Issues.SearchPageModule",JIRA.Issues.BaseModel.extend({namedEvents:["changeFilterProps"],properties:["currentLayout","layouts","filter","jql","searchId"],defaults:function(){return{filter:null,jql:null}},initialize:function(a,b){_.bindAll(this);_.extend(this,b);this.setLayouts({});this.registerLayout("list-view",{label:"List View",iconClass:"icon-view-list",view:JIRA.Issues.FullScreenLayout});this.registerLayout("split-view",{label:"Detail View",iconClass:"icon-view-split",view:JIRA.Issues.SplitScreenLayout});this._onFilterChanged();this.on("change:filter",this._onFilterChanged)},getInactiveLayouts:function(){var a=[];_.each(this.getLayouts(),function(c,b){if(b!==JIRA.Issues.LayoutPreferenceManager.getPreferredLayoutKey()){a.push(c)}},this);return a},getActiveLayout:function(){return this.getLayouts()[JIRA.Issues.LayoutPreferenceManager.getPreferredLayoutKey()]},changeLayout:function(c,b){var d=this.getLayout(c),e,a=this.getCurrentLayout();JIRA.Issues.changingLayout=true;jQuery("body, html").scrollTop(0);b=_.defaults({},b,{render:true});if(d){if(a instanceof d.view){return}if(a&&a.deactivate){a.deactivate();this.searchResults.unselectIssue({replace:true})}JIRA.Issues.LayoutPreferenceManager.setPreferredLayoutKey(c);e=new d.view({},{fullScreenIssue:this.fullScreenIssue,issueContainer:this.issueContainer,issueModule:this.issueModule,issueCacheManager:this.issueCacheManager,search:this.search,searchContainer:this.searchContainer,searchHeaderModule:this.searchHeaderModule});b.render&&e.render();this.setCurrentLayout(e);this.standalone=false}},createLayout:function(){if(!this.getCurrentLayout()){this.changeLayout(JIRA.Issues.LayoutPreferenceManager.getPreferredLayoutKey(),{render:false});this.fullScreenIssue.deactivate()}},_onFilterChanged:function(){var a=this.previous("filter");if(a){a.off("change",this.triggerChangeFilterProps,this)}var b=this.getFilter();if(b){b.on("change",this.triggerChangeFilterProps,this)}},getLayout:function(a){return this.getLayouts()[a]||null},getSortedLayouts:function(){return _.sortBy(this.getLayouts(),"label")},registerLayout:function(a,b){b.id=a;this.getLayouts()[a]=b},getJqlDeferred:function(){var b=jQuery.Deferred();var a=this;_.defer(function(){a.queryModule.searchersReady().always(function(){_.defer(function(){b.resolve(a.getEffectiveJql())})})});return b.promise()},registerToolPreferencesModel:function(a){this.toolPreferencesModel=a;this.toolPreferencesModel.on("change",this.refreshSearch)},registerIssueSearchManager:function(a){this.issueSearchManager=a},registerIssueCacheManager:function(a){this.issueCacheManager=a},registerQueryModule:function(a){this.queryModule=a},registerFilterModule:function(a){this.filterModule=a},registerSearch:function(a){this.search=a;this.searchResults=this.search.getResults();this.searchResults.onStartIndexChange(this._handleSearchResultsChange);this.searchResults.onSelectedIssueChange(this._handleSearchResultsChange)},_handleSearchResultsChange:function(b,a){a=a||{};a.replace?this.issueNavRouter.replaceState(this.getState()):this.issueNavRouter.pushState(this.getState())},registerSearchHeaderModule:function(a){this.searchHeaderModule=a},registerFullScreenIssue:function(a){this.fullScreenIssue=a;this.fullScreenIssue.bindIssueHidden(function(){this.issueModule.dismiss();this.searchHeaderModule.handleIssueSearchAppeared()},this)},registerIssueModule:function(a){this.issueModule=a;this.issueModule.bindReturnToSearch(this.returnToSearch);this.searchResults.onSelectedIssueChange(_.bind(function(b){if(!b.hasIssue()){this.issueModule.removeIssueMetadata()}},this));this.issueModule.bindLoadComplete(function(b,c){if(!this.standalone&&!c.reason){this.searchResults.selectIssueById(b.getId(),{reason:"issueLoaded"})}},this);this.issueModule.getLoading().done(_.bind(function(b){if(!this.standalone){this.searchResults.updateIssueById(b.issue.id,{action:"rowUpdate"})}},this));this.issueModule.getUpdating().done(_.bind(function(c){if(c.taskKey==="issue"){var b=c.data[0]&&c.data[0].issue.key;if(b){var d=this._getUpdateState({selectedIssueKey:b});if(this._validateNavigate(d)){this.issueNavRouter.replaceState(d)}}}},this));this.issueModule.bindSaveSuccess(function(b){this.searchResults.updateIssueById(b,{action:"inlineEdit"})},this)},registerViewContainers:function(a){this.issueContainer=a.issueContainer;this.searchContainer=a.searchContainer},registerIssueNavRouter:function(a){this.issueNavRouter=a},prevIssue:function(){if(this._overlayIsVisible()){return false}if(this.issueModule.canDismissComment()&&!this.standalone){JIRA.Issues.Analytics._loadIssueReason="issues-api-next-prev";this.getCurrentLayout().prevIssue();return true}return false},nextIssue:function(){if(this._overlayIsVisible()){return false}if(this.issueModule.canDismissComment()&&!this.standalone){JIRA.Issues.Analytics._loadIssueReason="issues-api-next-prev";this.getCurrentLayout().nextIssue();return true}return false},isCurrentlyLoadingIssue:function(){return this.issueModule.isCurrentlyLoading()},_overlayIsVisible:function(){return AJS.$(".aui-blanket:visible").length>0},getEffectiveIssueId:function(a){return this.getEffectiveIssue().getId()},updateIssue:function(c){var b=c.action===JIRA.Issues.Actions.DELETE,a=this.fullScreenIssue.isVisible();if(b){return this._deleteIssue(c)}else{if(a){return this.fullScreenIssue.updateIssue(c).done(_.bind(function(){!this.standalone&&this.searchResults.updateIssue(c,{showMessage:false})},this))}else{return this.searchResults.updateIssue(c)}}},_deleteIssue:function(c){var a=this.fullScreenIssue.isVisible(),b=c.key==this.issueModule.getIssueKey();if(!a){return this.searchResults.updateIssue(c)}else{if(!b){return this.fullScreenIssue.updateIssue(c)}else{if(this.standalone){this.resetToBlank();JIRA.Issues.showNotification(c.message,c.key);return jQuery.Deferred().resolve().promise()}else{this.returnToSearch();return this.searchResults.updateIssue(c)}}}},getEffectiveIssueKey:function(){return this.getEffectiveIssue().getKey()},getEffectiveIssue:function(){var b=this.searchResults.hasHighlightedIssue(),c=this.searchResults.hasSelectedIssue(),a;a=new JIRA.Issues.SimpleIssue({id:this.issueModule.getIssueId(),key:this.issueModule.getIssueKey()});if(this.standalone){return a}else{if(c){return this.searchResults.getSelectedIssue()}else{if(b){return this.searchResults.getHighlightedIssue()}else{return a}}}},isHighlightedIssueAccessible:function(){return this.search.getResults().isHighlightedIssueAccessible()},returnToSearch:function(){if(this.standalone){this.resetToBlank();JIRA.trace("jira.returned.to.search")}else{if(this.fullScreenIssue.isVisible()){this.searchResults.unselectIssue();this.issueModule.beforeHide()}else{JIRA.trace("jira.returned.to.search")}}jQuery.event.trigger("updateOffsets.popout")},toggleFilterPanel:function(){return this.filterModule.toggleFilterPanel()},issueTableSortRequested:function(a,b){this.update({jql:a,startIndex:b})},issueTableSearchError:function(a){if(a.status!==0){this.searchHeaderModule.handleJqlError();var c;try{c=JSON.parse(a.responseText)}catch(b){c={errorMessages:["Error occurred communicating with the server. Please reload the page and try again."]}}this.queryModule.onSearchError(c)}},issueTableSearchSuccess:function(a){this.update({startIndex:a.startIndex});this.searchHeaderModule.handleJqlSuccess();this.queryModule.onSearchSuccess(a.warnings)},issueTableStableUpdate:function(a){this.update({startIndex:a})},confirmNavigation:function(a){a=_.defaults({},a,{confirm:function(c){return window.confirm(c)},ignoreDirtiness:false});var b=JIRA.DirtyForm.getDirtyWarning()||JIRA.Issue.getDirtyCommentWarning();return !!a.ignoreDirtiness||b===undefined||a.confirm(b)},isFullScreenIssueVisible:function(){return this.fullScreenIssue&&this.fullScreenIssue.isVisible()},isIssueVisible:function(){var a=JIRA.Issues.LayoutPreferenceManager.getPreferredLayoutKey();if(this.isFullScreenIssueVisible()){return true}else{if(a==="list-view"){return this.fullScreenIssue.isVisible()}else{if(a==="split-view"){return this.search.getResults().hasIssues()}}}return false},queryModuleSearchRequested:function(a){this.update({jql:a,startIndex:0,selectedIssueKey:null,searchId:_.uniqueId()})},filterModuleSaved:function(b,a){if(a){this.reset({filter:b.getId()})}if(b.getFavourite()){this.filterModule.addFavouriteFilter(b)}},discardFilterChanges:function(){this.update({jql:null,selectedIssueKey:null},true)},getState:function(){var a=this.getFilter();var b={filter:a&&a.getId(),filterJql:a&&a.getJql(),jql:this.getJql()};if(this.standalone){b.selectedIssueKey=this.issueModule.getIssueKey()}else{_.extend(b,this.search.getResults().getState())}return b},_doSearch:function(a){a=a||{};var b={};var d;var c=this.getFilter();b.startIndex=a.startIndex;if(c){b.filterId=c.getId();if(!c.getIsSystem()){b.useUserColumns=this.toolPreferencesModel.getUseUserColumns()}}b.jql=this.getEffectiveJql();d=this.issueSearchManager.search(b);d.done(_.bind(function(e){if(this.fullScreenIssue.isVisible()&&!AJS.Meta.get("serverRenderedViewIssue")){this.issueModule.beforeHide()}this.searchResults.resetFromSearch(_.extend(a,e.issueTable));this.queryModule.onSearchSuccess(e.warnings);jQuery.event.trigger("updateOffsets.popout")},this)).fail(_.bind(function(e){if(e.status==400&&a.selectedIssueKey){this.reset({selectedIssueKey:a.selectedIssueKey},{replace:true})}else{this.searchResults.resetFromSearch(_.extend(_.pick(a,"selectedIssueKey"),this.searchResults.defaults));this.issueTableSearchError(e)}},this));return d},_applyState:function(c,f,b){b=b||{};var e=_.extend(this.toJSON(),this.search.getResults().toJSON());var a=_.pick(c,this.properties);this.set(a);var d=_.extend(this.toJSON(),c);if(f){this.queryModule.resetToQuery({focusQuery:b.isNewSearch})}if(this.shouldPerformNewSearch(e,d)){this._doSearch(d)}else{if("selectedIssueKey" in c){this.searchResults.selectIssueByKey(c.selectedIssueKey)}if("startIndex" in c&&!c.selectedIssueKey){this.searchResults.goToPage(c.startIndex)}}if(!this._shownIntroDialog){JIRA.Issues.IntroDialog.showOneOf(["split-view-intro","filters-dock-intro"]);this._shownIntroDialog=true}},shouldPerformNewSearch:function(f,e){var g=f.filter&&f.filter.getId();var a=e.filter&&e.filter.getId();var c=g!==a;var d=e.jql!==f.jql;var b=e.searchId!==f.searchId;return c||d||b},refreshSearch:function(){return this._doSearch(_.extend({},this.getState(),{selectedIssueKey:undefined}))},_navigateToState:function(b,c,a){a=a||{};if(!this.issueModule.canDismissComment()){this.queryModule.queryChanged();AJS.InlineLayer.current&&AJS.InlineLayer.current.hide();return}if(this._validateNavigate(b)){a.replace?this.issueNavRouter.replaceState(b):this.issueNavRouter.pushState(b)}if(this.search.isStandAloneIssue(b)){this.resetToStandaloneIssue(b)}else{return this.applyState(b,c,a)}},_validateNavigate:function(b){var a=JIRA.Issues.URLSerializer.getURLFromState;return a(b)!==a(this.getState())},_getUpdateState:function(a){return _.extend({},this.getState(),a)},update:function(b,c,a){this._navigateToState(this._getUpdateState(b),c,a)},reset:function(c,b){var a=_.extend({},this.defaults(),c);a.searchId=_.uniqueId();this._navigateToState(a,true,b)},_deactivateCurrentLayout:function(){var a=this.getCurrentLayout();if(a){a.deactivate&&a.deactivate();this.setCurrentLayout(null)}},resetToStandaloneIssue:function(a){this._deactivateCurrentLayout();this.set(this.defaults());this.standalone=true;this.fullScreenIssue.show({key:a.selectedIssueKey,viewIssueQuery:a.viewIssueQuery})},applyState:function(d,f,c){var b,a=d.filter&&!(d.filter instanceof JIRA.Issues.FilterModel),e=this.initSystemFilters();this.issueModule.abortPending();this.createLayout();if(a){b=jQuery.Deferred();e.always(_.bind(function(){this.filterModule.getFilterById(d.filter).always(function(g){d.filter=g;b.resolve()})},this))}jQuery.when(b,e).always(_.bind(function(){this._applyState(d,f,c)},this))},updateFromRouter:function(a){if(this.search.isStandAloneIssue(a)){this.resetToStandaloneIssue(a)}else{this.applyState(a,!this._isSearchStateEqual(a))}},hasSelectedIssue:function(){return this.search.getResults().getSelectedIssue().getKey()},resetToFilter:function(a){this.reset({filter:a,searchId:_.uniqueId()})},resetToBlank:function(a){this.reset({jql:""},a)},isDirty:function(){var a=this.getFilter();return !!a&&a.getJql()!==this.getEffectiveJql()},getSearchMode:function(){return this.queryModule.getSearchMode()},getActiveBasicModeSearchers:function(){return this.queryModule.getActiveBasicModeSearchers()},setSessionSearch:function(a){AJS.$.ajax({data:{filterId:a.getId()},type:"PUT",url:AJS.contextPath()+"/rest/issueNav/1/issueTable/sessionSearch/"})},openFocusShifter:function(){this.issueModule.openFocusShifter()},setAsInaccessible:function(a){this.issueTableModule.setAsInaccessible(a)},showInlineIssueLoadError:function(b){var a=JIRA.Templates.ViewIssue.Body.errorsLoading({});JIRA.Messages.showErrorMsg(a,{closeable:true})},getEffectiveJql:function(){var b=this.getFilter(),a=this.getJql();if(_.isString(a)){return a}else{if(b){return b.getJql()||""}else{return""}}},initSystemFilters:function(){return this.filterModule.initSystemFilters()},addOwnerToSystemFilters:function(c){var d=AJS.Meta.get("remote-user");if(!d){return c}var b=AJS.Meta.get("remote-user-fullname");var a=AJS.Meta.get("remote-user-avatar-url");return _.map(c,function(e){e.ownerUserName=d;e.ownerDisplayName=b;e.avatarUrl=a;return e})},handleLeft:function(){if(this._allowLeftRightNavigation()){this.getCurrentLayout()&&this.getCurrentLayout().handleLeft()}},handleRight:function(){if(this._allowLeftRightNavigation()){this.getCurrentLayout()&&this.getCurrentLayout().handleRight()}},handleUp:function(){if(!this._allowUpDownNavigation()){return false}if(this.searchResults.isFirstIssueHighlighted()){return false}return this.prevIssue()},handleDown:function(){if(!this._allowUpDownNavigation()){return false}return this.nextIssue()},_allowLeftRightNavigation:function(){return !AJS.keyboardShortcutsDisabled},_allowUpDownNavigation:function(){if(AJS.keyboardShortcutsDisabled){return false}if(AJS.InlineLayer.current||AJS.Dropdown.current||JIRA.Dialog.current||AJS.$(".aui-dropdown2:visible").length>0){return false}return !this.getCurrentLayout().isIssueViewActive()},_isSearchStateEqual:function(a){var b=["filter","jql","startIndex"];return _.isEqual(_.pick(a,b),_.pick(this.getState(),b))},removeOpenTipsies:function(){AJS.$.fn.tipsy.revalidate()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/search/EmptyResultsView.js' */
Backbone.define("JIRA.Issues.EmptyResultsView",JIRA.Issues.BaseView.extend({initialize:function(a){this.searchResults=a.searchResults},render:function(){var d;var e;var b;var a;var c=JIRA.Issues.UserParms.get().createIssue;if(!JIRA.Issues.LoginUtils.isLoggedIn()){d="No issues were found to match your search";e="Try \u003ca>logging in\u003c\/a> to see more results";b="not-logged-in-message";a="login"}else{if(this.searchResults.getJiraHasIssues()===false){d="No issues have been created (yet)";e=c?"Be the first to \u003ca>create an issue\u003c\/a>":null;b="empty-results-message";a="create"}else{d="No issues were found to match your search";e=c?"Try modifying your search criteria or \u003ca>creating a new issue\u003c\/a>":"Try modifying your search criteria";b="no-results-message";a="create"}}this.$el.addClass("empty-results");this.$el.html(JIRA.Templates.IssueNavTable.noResults({message:d,hint:e,cssClass:b}));var f=this.$(".no-results-hint a");switch(a){case"create":f.addClass("create-issue").attr("href",AJS.contextPath()+"/secure/CreateIssue!default.jspa");break;case"login":f.attr("href",JIRA.Issues.LoginUtils.redirectUrlToCurrent()).addClass("login-link");break}_.defer(jQuery.event.trigger,"updateOffsets.popout");_.defer(JIRA.trace,"jira.search.finished")}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav-common', location = 'content/js/util/URLSerializer.js' */
(function(){var b="browse/",d="issues/";var c=function(e){return e};var a=function(e){if(typeof e==="string"){return parseInt(e,10)}return e};JIRA.Issues.URLSerializer={getURLFromState:function(g){g=g||{};var f=[];var e;if(g.selectedIssueKey){e=b+g.selectedIssueKey}else{e=d}if(g.filter!=null){f.push("filter="+g.filter)}if(g.jql!=null&&(g.filterJql==null||g.jql!==g.filterJql)){f.push("jql="+encodeURIComponent(g.jql))}if(g.startIndex&&!g.selectedIssueKey){f.push("startIndex="+g.startIndex)}return e+(f.length?"?"+f.join("&"):"")},getStateFromURL:function(e){var g={},i=e.split("?")[0],j,h;h={filter:null,jql:null,selectedIssueKey:null,startIndex:0};if(e.indexOf(b)==0){h.selectedIssueKey=i.split("/")[1]}if(e.indexOf("?")!==-1){j=e.substr(e.indexOf("?"));g=JIRA.Issues.QueryStringParser.parse(j);var f=_.pick(g,"focusedCommentId","attachmentSortBy","attachmentOrder");if(!_.isEmpty(f)){h.viewIssueQuery=f}}return _.inject(this.PARAMETER_TRANSFORM,function(n,k,l){var m=g[l];if(m!==undefined){n[l]=k(m)}return n},_.extend(h))},PARAMETER_TRANSFORM:{filter:c,jql:c,startIndex:a}}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/util/Overrides.js' */
JIRA.Messages.showMsgOnReload=function(b,a){JIRA.one(JIRA.Events.ISSUE_REFRESHED,function(){a.type=JIRA.Messages.Types[a.type];JIRA.Messages.showMsg(b,a)})};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/templates/viewissue-header-content.soy' */
// This file was automatically generated from viewissue-header-content.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.ViewIssue == 'undefined') { JIRA.Templates.ViewIssue = {}; }
if (typeof JIRA.Templates.ViewIssue.Header == 'undefined') { JIRA.Templates.ViewIssue.Header = {}; }


JIRA.Templates.ViewIssue.Header.pager = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul class="ajax ops page-navigation ', (opt_data.invalidSearchContext) ? ' pager-invalid-search-context ' : '', '"><li class="previous">', (opt_data.previousIssue) ? '<a data-id="' + soy.$$escapeHtml(opt_data.previousIssue.id) + '" data-key="' + soy.$$escapeHtml(opt_data.previousIssue.key) + '" href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.previousIssue.key) + '" id="previous-issue" rel="' + soy.$$escapeHtml(opt_data.previousIssue.key) + '" title="' + soy.$$escapeHtml("\u4e0a\u4e00\u95ee\u9898") + ' \'' + soy.$$escapeHtml(opt_data.previousIssue.key) + '\'"><span class="icon icon-page-prev"><span>' + soy.$$escapeHtml("\u4e0a\u4e00\u95ee\u9898") + ' \'' + soy.$$escapeHtml(opt_data.previousIssue.key) + '\'</span></span></a>' : (! opt_data.invalidSearchContext) ? '<span class="icon icon-page-prev-deactivated" title="' + soy.$$escapeHtml("\u8fd9\u5df2\u7ecf\u662f\u7b2c\u4e00\u4e2a\u95ee\u9898") + '"></span>' : '', '</li><li class="showing">', (opt_data.invalidSearchContext) ? '<span class="aui-icon icon-warning" title="' + soy.$$escapeHtml(opt_data.invalidSearchContext) + '"></span>' : (opt_data.position && opt_data.resultCount) ? soy.$$escapeHtml(AJS.format("\u7b2c{0}\u4e2a\u95ee\u9898,\u5171{1}",opt_data.position,opt_data.resultCount)) : '', '</li><li class="next">', (opt_data.nextIssue) ? '<a data-id="' + soy.$$escapeHtml(opt_data.nextIssue.id) + '" data-key="' + soy.$$escapeHtml(opt_data.nextIssue.key) + '" href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.nextIssue.key) + '" id="next-issue" rel="' + soy.$$escapeHtml(opt_data.nextIssue.key) + '" title="' + soy.$$escapeHtml("\u4e0b\u4e2a\u95ee\u9898") + ' \'' + soy.$$escapeHtml(opt_data.nextIssue.key) + '\'"><span class="icon icon-page-next"><span>' + soy.$$escapeHtml("\u4e0b\u4e2a\u95ee\u9898") + ' \'' + soy.$$escapeHtml(opt_data.nextIssue.key) + '\'</span></span></a>' : (! opt_data.invalidSearchContext) ? '<span class="icon icon-page-next-deactivated" title="' + soy.$$escapeHtml("\u8fd9\u5df2\u7ecf\u662f\u6700\u540e\u4e00\u4e2a\u95ee\u9898") + '"></span>' : '', '</li>', (opt_data.returnToSearch) ? '<li class="return"><a id="return-to-search" href="' + soy.$$escapeHtml("") + '/issues/" title="' + soy.$$escapeHtml("Return to search") + '">' + soy.$$escapeHtml("Return to search") + '</a></li>' : '', '</ul>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Header.linkGroup = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.group.header && opt_data.group.header.label) {
    if (opt_data.group.links.length > 0 || opt_data.group.groups.length > 0) {
      JIRA.Templates.ViewIssue.Header.dropdownLink(opt_data.group, output);
    }
  } else {
    output.append('<ul ', (opt_data.group.id) ? 'id="opsbar-' + soy.$$escapeHtml(opt_data.group.id) + '" ' : '', 'class="toolbar-group pluggable-ops">');
    var linkList93 = opt_data.group.links;
    var linkListLen93 = linkList93.length;
    for (var linkIndex93 = 0; linkIndex93 < linkListLen93; linkIndex93++) {
      var linkData93 = linkList93[linkIndex93];
      JIRA.Templates.ViewIssue.Header.toolbarItem({link: linkData93}, output);
    }
    var subGroupList97 = opt_data.group.groups;
    var subGroupListLen97 = subGroupList97.length;
    for (var subGroupIndex97 = 0; subGroupIndex97 < subGroupListLen97; subGroupIndex97++) {
      var subGroupData97 = subGroupList97[subGroupIndex97];
      JIRA.Templates.ViewIssue.Header.linkGroup({group: subGroupData97}, output);
    }
    output.append('</ul>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Header.dropdownLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="toolbar-item toolbar-dropdown"><div><a href="#" ', (opt_data.header.id) ? ' id="' + soy.$$escapeHtml(opt_data.header.id) + '"' : '');
  JIRA.Templates.ViewIssue.Header.titleAttr({title: opt_data.header.title, label: opt_data.header.label}, output);
  output.append('data-hide-on-scroll=".split-view .issue-container" data-contain-to-window="true" class="toolbar-trigger ', (opt_data.links.length > 0 || opt_data.groups.length > 0) ? ' js-default-dropdown' : '', (opt_data.header.styleClass) ? ' ' + soy.$$escapeHtml(opt_data.header.styleClass) : '', '" >', (opt_data.header.iconClass) ? '<span class="icon ' + soy.$$escapeHtml(opt_data.header.iconClass) + '"></span> ' : '', '<span class="dropdown-text">', soy.$$truncate(soy.$$escapeHtml(opt_data.header.label), 25, true), '</span><span class="icon drop-menu"></span></a><div class="aui-list hidden">');
  if (opt_data.links.length > 0) {
    output.append('<ul class="aui-list-section aui-first', (opt_data.groups.length == 0) ? ' aui-last' : '', '">');
    var linkList137 = opt_data.links;
    var linkListLen137 = linkList137.length;
    for (var linkIndex137 = 0; linkIndex137 < linkListLen137; linkIndex137++) {
      var linkData137 = linkList137[linkIndex137];
      JIRA.Templates.ViewIssue.Header.dropdownItem(linkData137, output);
    }
    output.append('</ul>');
  }
  var groupList141 = opt_data.groups;
  var groupListLen141 = groupList141.length;
  for (var groupIndex141 = 0; groupIndex141 < groupListLen141; groupIndex141++) {
    var groupData141 = groupList141[groupIndex141];
    output.append('<ul class="aui-list-section', (opt_data.links.length == 0 && groupIndex141 == 0) ? ' aui-first' : '', (groupIndex141 == groupListLen141 - 1) ? ' aui-last' : '', '">');
    var linkList150 = groupData141.links;
    var linkListLen150 = linkList150.length;
    for (var linkIndex150 = 0; linkIndex150 < linkListLen150; linkIndex150++) {
      var linkData150 = linkList150[linkIndex150];
      JIRA.Templates.ViewIssue.Header.dropdownItem(linkData150, output);
    }
    output.append('</ul>');
  }
  output.append('</div></div></li>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Header.dropdownItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="aui-list-item"><a  href="', (opt_data.href) ? soy.$$escapeHtml(opt_data.href) : '#', '" class="aui-list-item-link', (opt_data.styleClass) ? ' ' + soy.$$escapeHtml(opt_data.styleClass) : '', '"');
  JIRA.Templates.ViewIssue.Header.titleAttr(opt_data, output);
  output.append((opt_data.id) ? 'id="' + soy.$$escapeHtml(opt_data.id) + '"' : '', '><span class="trigger-label">', soy.$$truncate(soy.$$escapeHtml(opt_data.label), 25, true), '</span></a></li>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Header.toolbarItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="toolbar-item"><a id="', soy.$$escapeHtml(opt_data.link.id), '"');
  JIRA.Templates.ViewIssue.Header.titleAttr({title: opt_data.link.title, label: opt_data.link.label}, output);
  output.append('class="toolbar-trigger', (opt_data.link.styleClass) ? ' ' + soy.$$escapeHtml(opt_data.link.styleClass) : '', '" href="', (opt_data.link.href) ? soy.$$escapeHtml(opt_data.link.href) : '#', '">', (opt_data.link.iconClass) ? '<span class="icon ' + soy.$$escapeHtml(opt_data.link.iconClass) + '"></span> <span class="trigger-label">' + soy.$$truncate(soy.$$escapeHtml(opt_data.link.label), 25, true) + '</span>' : '<span class="trigger-label">' + soy.$$truncate(soy.$$escapeHtml(opt_data.link.label), 25, true) + '</span>', '</a></li>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Header.titleAttr = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.title) ? 'title="' + soy.$$escapeHtml(opt_data.title) + '"' : (opt_data.label && opt_data.label.length && opt_data.label.length > 25) ? 'title="' + soy.$$escapeHtml(opt_data.label) + '"' : '');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Header.opsbar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="ops-cont"><div class="ops-menus aui-toolbar">');
  var linkGroupList226 = opt_data.issue.operations.linkGroups;
  var linkGroupListLen226 = linkGroupList226.length;
  for (var linkGroupIndex226 = 0; linkGroupIndex226 < linkGroupListLen226; linkGroupIndex226++) {
    var linkGroupData226 = linkGroupList226[linkGroupIndex226];
    if (linkGroupData226.id && linkGroupData226.id == 'view.issue.opsbar') {
      output.append('<div class="toolbar-split toolbar-split-left">');
      var subGroupList230 = linkGroupData226.groups;
      var subGroupListLen230 = subGroupList230.length;
      for (var subGroupIndex230 = 0; subGroupIndex230 < subGroupListLen230; subGroupIndex230++) {
        var subGroupData230 = subGroupList230[subGroupIndex230];
        JIRA.Templates.ViewIssue.Header.linkGroup({group: subGroupData230, parentGroup: linkGroupData226}, output);
      }
      output.append('</div>');
    } else if (linkGroupData226.id && linkGroupData226.id == 'jira.issue.tools') {
      output.append('<div class="toolbar-split toolbar-split-right">');
      JIRA.Templates.ViewIssue.Header.linkGroup({group: linkGroupData226}, output);
      output.append('</div>');
    }
  }
  output.append('</div></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/templates/viewissue-header.soy' */
// This file was automatically generated from viewissue-header.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.ViewIssue == 'undefined') { JIRA.Templates.ViewIssue = {}; }
if (typeof JIRA.Templates.ViewIssue.Header == 'undefined') { JIRA.Templates.ViewIssue.Header = {}; }


JIRA.Templates.ViewIssue.Header.legacyIssueHeader = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="issue-header-content"><div id="issue-header-pager">');
  if (opt_data.pager) {
    JIRA.Templates.ViewIssue.Header.pager(opt_data.pager, output);
  }
  output.append('</div><div id="heading-avatar"><img id="project-avatar" alt="" class="project-avatar-48" height="48" src="', soy.$$escapeHtml(opt_data.issue.project.avatarUrls['48x48']), '" width="48"></div><ul class="breadcrumbs"><li><a id="project-name-val" href="', soy.$$escapeHtml(""), '/browse/', soy.$$escapeHtml(opt_data.issue.project.key), '">', soy.$$escapeHtml(opt_data.issue.project.name), '</a> </li>', (opt_data.issue.parent && opt_data.issue.parent.id) ? '<li><a class="issue-link" data-issue-key="' + soy.$$escapeHtml(opt_data.issue.parent.key) + '" href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.issue.parent.key) + '" id="parent_issue_summary" title="' + soy.$$escapeHtml(opt_data.issue.parent.summary) + '">' + soy.$$escapeHtml(opt_data.issue.parent.key) + ' ' + soy.$$escapeHtml(opt_data.issue.parent.summary) + '</a> </li>' : '', '<li><a class="issue-link" data-issue-key="', soy.$$escapeHtml(opt_data.issue.key), '" href="', soy.$$escapeHtml(""), '/browse/', soy.$$escapeHtml(opt_data.issue.key), '" id="key-val" rel="', soy.$$escapeHtml(opt_data.issue.id), '">', soy.$$escapeHtml(opt_data.issue.key), '</a></li></ul><h1 id="summary-val">', soy.$$escapeHtml(opt_data.issue.summary), '</h1><div class="command-bar">');
  if (opt_data.serverRenderedViewIssue) {
    JIRA.Templates.ViewIssue.Header.opsbar(opt_data, output);
  }
  output.append('</div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Header.issueHeader = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="issue-header-content">');
  var param51 = new soy.StringBuilder();
  var param52 = new soy.StringBuilder();
  JIRA.Templates.Headers.projectAvatar({id: soy.$$escapeHtml(opt_data.issue.project.id), projectKey: soy.$$escapeHtml(opt_data.issue.project.key), projectName: soy.$$escapeHtml(opt_data.issue.project.name), avatarUrl: soy.$$escapeHtml(opt_data.issue.project.avatarUrls['48x48']), avatarAlt: soy.$$escapeHtml(opt_data.issue.project.name), isSystemAvatar: opt_data.issue.project.systemAvatar, hasProjectShortcut: opt_data.hasProjectShortcut}, param52);
  aui.page.pageHeaderImage({content: param52.toString()}, param51);
  aui.page.pageHeaderMain({content: '<ol class="aui-nav aui-nav-breadcrumbs"><li><a id="project-name-val" href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.issue.project.key) + '">' + soy.$$escapeHtml(opt_data.issue.project.name) + '</a></li>' + ((opt_data.issue.parent && opt_data.issue.parent.id) ? '<li><a class="issue-link" data-issue-key="' + soy.$$escapeHtml(opt_data.issue.parent.key) + '" href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.issue.parent.key) + '" id="parent_issue_summary" title="' + soy.$$escapeHtml(opt_data.issue.parent.summary) + '">' + soy.$$escapeHtml(opt_data.issue.parent.key) + ' ' + soy.$$escapeHtml(opt_data.issue.parent.summary) + '</a></li>' : '') + '<li><a class="issue-link" data-issue-key="' + soy.$$escapeHtml(opt_data.issue.key) + '" href="' + soy.$$escapeHtml("") + '/browse/' + soy.$$escapeHtml(opt_data.issue.key) + '" id="key-val" rel="' + soy.$$escapeHtml(opt_data.issue.id) + '">' + soy.$$escapeHtml(opt_data.issue.key) + '</a></li></ol><h1 id="summary-val">' + soy.$$escapeHtml(opt_data.issue.summary) + '</h1>'}, param51);
  var param104 = new soy.StringBuilder('<div id="issue-header-pager">');
  if (opt_data.pager) {
    JIRA.Templates.ViewIssue.Header.pager(opt_data.pager, param104);
  }
  param104.append('</div>');
  aui.page.pageHeaderActions({content: param104.toString()}, param51);
  aui.page.pageHeader({content: param51.toString()}, output);
  output.append('<div class="command-bar">');
  if (opt_data.serverRenderedViewIssue) {
    JIRA.Templates.ViewIssue.Header.opsbar(opt_data, output);
  }
  output.append('</div></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/templates/viewissue-body.soy' */
// This file was automatically generated from viewissue-body.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.ViewIssue == 'undefined') { JIRA.Templates.ViewIssue = {}; }
if (typeof JIRA.Templates.ViewIssue.Body == 'undefined') { JIRA.Templates.ViewIssue.Body = {}; }


JIRA.Templates.ViewIssue.Body.issueBody = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-group issue-body"><div class="aui-item issue-main-column"></div><div id="viewissuesidebar" class="aui-item issue-side-column"></div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Body.issueBodyWithPanels = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-group issue-body"><div class="aui-item issue-main-column">');
  if (opt_data.serverRenderedViewIssue) {
    var panelList10 = opt_data.panels.leftPanels;
    var panelListLen10 = panelList10.length;
    for (var panelIndex10 = 0; panelIndex10 < panelListLen10; panelIndex10++) {
      var panelData10 = panelList10[panelIndex10];
      JIRA.Templates.ViewIssue.Body.issuePanel(panelData10, output);
    }
  }
  output.append('</div><div id="viewissuesidebar" class="aui-item issue-side-column">');
  if (opt_data.serverRenderedViewIssue) {
    var panelList16 = opt_data.panels.rightPanels;
    var panelListLen16 = panelList16.length;
    for (var panelIndex16 = 0; panelIndex16 < panelListLen16; panelIndex16++) {
      var panelData16 = panelList16[panelIndex16];
      JIRA.Templates.ViewIssue.Body.issuePanel(panelData16, output);
    }
  }
  output.append('</div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Body.issuePanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.renderHeader) {
    output.append('<div id=', soy.$$escapeHtml(opt_data.id), ' class="module toggle-wrap"><div id="', soy.$$escapeHtml(opt_data.id), '_heading" class="mod-header"><ul class="ops">');
    var linkList28 = opt_data.headerLinks.links;
    var linkListLen28 = linkList28.length;
    for (var linkIndex28 = 0; linkIndex28 < linkListLen28; linkIndex28++) {
      var linkData28 = linkList28[linkIndex28];
      output.append('<li>');
      JIRA.Templates.Issues.Util.simpleLink({link: linkData28}, output);
      output.append('</li>');
    }
    if (opt_data.headerLinks.groups.length > 0) {
      output.append('<li class="drop"><div class="aui-dd-parent"><a href="#" class="icon drop-menu js-default-dropdown" title="', soy.$$escapeHtml("\u9009\u9879"), '"><span>', soy.$$escapeHtml("\u9009\u9879"), '</span></a><div class="aui-dropdown-content aui-list">');
      var groupList41 = opt_data.headerLinks.groups;
      var groupListLen41 = groupList41.length;
      for (var groupIndex41 = 0; groupIndex41 < groupListLen41; groupIndex41++) {
        var groupData41 = groupList41[groupIndex41];
        output.append((groupData41.header && groupData41.header.label) ? '<h5>' + soy.$$escapeHtml(groupData41.header.label) + '</h5>' : '', '<ul ', (groupData41.header && groupData41.header.id) ? 'id="' + soy.$$escapeHtml(groupData41.header.id) + '"' : '', 'class="aui-list-section', (groupData41.header && groupData41.header.styleClass) ? ' ' + soy.$$escapeHtml(groupData41.header.styleClass) : '', (groupIndex41 == 0) ? ' aui-first' : '', (groupIndex41 == groupListLen41 - 1) ? ' aui-last' : '', '">');
        var linkList65 = groupData41.links;
        var linkListLen65 = linkList65.length;
        for (var linkIndex65 = 0; linkIndex65 < linkListLen65; linkIndex65++) {
          var linkData65 = linkList65[linkIndex65];
          output.append('<li class="aui-list-item">');
          JIRA.Templates.Issues.Util.simpleLink({link: linkData65, additionalStyleClass: 'aui-list-item-link'}, output);
          output.append('</li>');
        }
        output.append('</ul>');
      }
      output.append('</div></div></li>');
    }
    output.append('</ul>');
    if (opt_data.subpanelHtmls.length > 0) {
      output.append('<div class="mod-header-panels">');
      var subPanelList79 = opt_data.subpanelHtmls;
      var subPanelListLen79 = subPanelList79.length;
      for (var subPanelIndex79 = 0; subPanelIndex79 < subPanelListLen79; subPanelIndex79++) {
        var subPanelData79 = subPanelList79[subPanelIndex79];
        output.append('<div class="mod-header-panel">', subPanelData79, '</div>');
      }
      output.append('</div>');
    }
    output.append('<h2 class="toggle-title">', soy.$$escapeHtml(opt_data.label), '</h2></div><div class="mod-content">', opt_data.html, '</div></div>');
  } else {
    output.append(opt_data.html);
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Body.viewIssueNoPermissionError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.ViewIssue.Body.viewIssueError({title: "Permission Violation", body: "It seems that you have tried to perform an operation which you are not permitted to perform.", error: 'warning', returnToSearch: false, pager: opt_data.pager}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Body.viewIssueDoesNotExistError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.ViewIssue.Body.viewIssueError({title: "Issue Does Not Exist", body: "The issue you are trying to view does not exist.", error: 'error', returnToSearch: ! opt_data.hideReturnToSearch, pager: opt_data.pager}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Body.viewIssueGenericError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.ViewIssue.Body.viewIssueError({title: "Unexpected Error", body: "There was an unexpected error while loading the issue.", error: 'error', returnToSearch: false, pager: opt_data.pager}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Body.viewIssueError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="issue-content" class="form-body"><header class="issue-header"><div class="issue-header-content"><header class="aui-page-header"><div class="aui-page-header-inner"><div class="aui-page-header-main"><h1>', soy.$$escapeHtml(opt_data.title), '</h1></div><div class="aui-page-header-actions"><div id="issue-header-pager">');
  if (opt_data.pager) {
    JIRA.Templates.ViewIssue.Header.pager(opt_data.pager, output);
  }
  output.append('</div></div></div></header></div></header><div class="issue-body-content"><div class="aui-message ', soy.$$escapeHtml(opt_data.error), '"><span class="aui-icon icon-', soy.$$escapeHtml(opt_data.error), '"></span><p>', soy.$$escapeHtml(opt_data.body), '</p><p>', soy.$$escapeHtml("If you think this message is wrong, please contact your"), '<a href="', soy.$$escapeHtml(""), '/secure/ContactAdministrators!default.jspa"> ', soy.$$escapeHtml("JIRA administrators"), '</a>.</p>', (opt_data.returnToSearch) ? '<p><a id="return-to-search" class="push-state" href="' + soy.$$escapeHtml("") + '/issues/" title="' + soy.$$escapeHtml("Return to search") + '">' + soy.$$escapeHtml("Return to search") + '</a></p>' : '', '</div></div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Body.errorsLoading = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.isTimeout) ? soy.$$escapeHtml("\u65e0\u6cd5\u8fde\u63a5JIRA\u670d\u52a1\u5668\u3002 \u53ef\u80fd\u662f\u7531\u4e8e\u670d\u52a1\u5668\u6545\u969c\u6216\u77ed\u6682\u4e2d\u65ad\u3002") : soy.$$escapeHtml("There were errors loading the issue."));
  if (opt_data.errorMessages) {
    output.append('<ul>');
    var msgList155 = opt_data.errorMessages;
    var msgListLen155 = msgList155.length;
    for (var msgIndex155 = 0; msgIndex155 < msgListLen155; msgIndex155++) {
      var msgData155 = msgList155[msgIndex155];
      output.append('<li>', soy.$$escapeHtml(msgData155), '</li>');
    }
    output.append('</ul>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Body.focusShifter = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message closeable" id="focus-shifter"><label><span>', soy.$$escapeHtml("viewissue.focusshifter"), '</span><div id="focus-shifter-content"></div></label><span class="aui-icon icon-close"></span></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Body.focusShifterTip = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-message closeable" id="focus-shifter-tip"><strong>', soy.$$escapeHtml("Hint:"), '</strong> ', AJS.format("Press {0} to jump to fields for editing",'<kbd>,</kbd>'), '<br/><a href="', soy.$$escapeHtml(""), '/secure/ViewKeyboardShortcuts!default.jspa">', soy.$$escapeHtml("Show other keyboard shortcuts"), '</a><span class="aui-icon icon-close"/></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/templates/viewissue-fields.soy' */
// This file was automatically generated from viewissue-fields.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.ViewIssue == 'undefined') { JIRA.Templates.ViewIssue = {}; }
if (typeof JIRA.Templates.ViewIssue.Fields == 'undefined') { JIRA.Templates.ViewIssue.Fields = {}; }


JIRA.Templates.ViewIssue.Fields.saveErrorMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var issueLink__soy3 = new soy.StringBuilder();
  if (opt_data.isAccessible) {
    JIRA.Templates.Issues.Util.issueAnchor(opt_data, issueLink__soy3);
  } else {
    issueLink__soy3.append(soy.$$escapeHtml(opt_data.issueKey));
  }
  issueLink__soy3 = issueLink__soy3.toString();
  output.append(AJS.format("Saving of \x3cstrong\x3e{0}\x3c/strong\x3e failed!",issueLink__soy3), '<ul>');
  var messageList12 = opt_data.errors;
  var messageListLen12 = messageList12.length;
  for (var messageIndex12 = 0; messageIndex12 < messageListLen12; messageIndex12++) {
    var messageData12 = messageList12[messageIndex12];
    output.append('<li>', soy.$$escapeHtml(messageData12), '</li>');
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Fields.field = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form id="', soy.$$escapeHtml(opt_data.issue.id), '-form" class="ajs-dirty-warning-exempt aui" action= "#"><div class="inline-edit-fields">', opt_data.issue.editHtml, '</div><span class="overlay-icon throbber" /><div class="save-options"><button type="submit" class="aui-button submit" accessKey="', soy.$$escapeHtml("s"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.accessKey)), '"><span class="icon icon-save">', soy.$$escapeHtml("\u4fdd\u5b58"), '</span></button><button type="cancel" class="aui-button cancel" accessKey="', soy.$$escapeHtml("`"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.accessKey)), '"><span class="icon icon-cancel">', soy.$$escapeHtml("\u53d6\u6d88"), '</span></button></div></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Fields.modalField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-dialog-content"><h2 class="dialog-title">', soy.$$escapeHtml(AJS.format("Edit {0}",opt_data.field.label)), '</h2><form action="" class="aui" method="post"><div class="form-body">', opt_data.field.editHtml, '</div><div class="buttons-container form-footer"><div class="buttons"><input class="button" type="submit" value="', soy.$$escapeHtml("\u63d0\u4ea4"), '"/><a class="cancel" href="#">', soy.$$escapeHtml("\u53d6\u6d88"), '</a></div></div></form></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Fields.modalFieldGeneralErrors = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="error">');
  if (opt_data.messages.length == 1) {
    output.append(soy.$$escapeHtml(opt_data.messages[0]));
  } else {
    output.append('<ul>');
    var messageList55 = opt_data.messages;
    var messageListLen55 = messageList55.length;
    for (var messageIndex55 = 0; messageIndex55 < messageListLen55; messageIndex55++) {
      var messageData55 = messageList55[messageIndex55];
      output.append('<li>', soy.$$escapeHtml(messageData55), '</li>');
    }
    output.append('</ul>');
  }
  output.append('</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ViewIssue.Fields.resumableSaveErrorMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.ViewIssue.Fields.saveErrorMessage(opt_data, output);
  output.append('<p><a href="#" id="fix" class="fix" data-key="', soy.$$escapeHtml(opt_data.issueKey), '">', (opt_data.isCurrentIssue) ? soy.$$escapeHtml("Fix errors") : soy.$$escapeHtml("Return to Issue"), '</a></p>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/templates/util.soy' */
// This file was automatically generated from util.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.Issues == 'undefined') { JIRA.Templates.Issues = {}; }
if (typeof JIRA.Templates.Issues.Util == 'undefined') { JIRA.Templates.Issues.Util = {}; }


JIRA.Templates.Issues.Util.throbber = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="icon throbber" />');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issues.Util.simpleLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a', (opt_data.link.id) ? ' id="' + soy.$$escapeHtml(opt_data.link.id) + '"' : '', 'href="', (opt_data.link.href) ? soy.$$escapeHtml(opt_data.link.href) : '#', '"', (opt_data.link.styleClass || opt_data.additionalStyleClass) ? 'class="' + soy.$$escapeHtml(opt_data.link.styleClass) + ((opt_data.additionalStyleClass) ? ' ' + soy.$$escapeHtml(opt_data.additionalStyleClass) : '') + '"' : '', (opt_data.link.title) ? 'title="' + soy.$$escapeHtml(opt_data.link.title) + '"' : '', '><span>', soy.$$escapeHtml(opt_data.link.label), '</span></a>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issues.Util.issueNotFound = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append(AJS.format("The issue {0} does not exist in the search.",opt_data.issueAnchor));
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issues.Util.issueAnchor = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class="issue-key" href="', soy.$$escapeHtml(""), '/browse/', soy.$$escapeHtml(opt_data.issueKey), '"> ', soy.$$escapeHtml(opt_data.issueKey), ' </a>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issues.Util.buildMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.messages.length == 1) {
    output.append(soy.$$escapeHtml(opt_data.messages[0]));
  } else {
    output.append('<ul>');
    var messageList52 = opt_data.messages;
    var messageListLen52 = messageList52.length;
    for (var messageIndex52 = 0; messageIndex52 < messageListLen52; messageIndex52++) {
      var messageData52 = messageList52[messageIndex52];
      output.append('<li>', soy.$$escapeHtml(messageData52), '</li>');
    }
    output.append('</ul>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issues.Util.auiMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.messages.length > 0) {
    output.append('<div class="aui-message ', soy.$$escapeHtml(opt_data.typeClass), '"><span class="aui-icon icon-', soy.$$escapeHtml(opt_data.typeClass), '"></span>');
    JIRA.Templates.Issues.Util.buildMessage(opt_data, output);
    output.append('</div>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issues.Util.errorMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.Issues.Util.auiMessage({typeClass: 'error', messages: opt_data.messages ? opt_data.messages : [opt_data.msg]}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issues.Util.warningMessage = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.Issues.Util.auiMessage({typeClass: 'warning', messages: opt_data.messages ? opt_data.messages : [opt_data.msg]}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issues.Util.anonymousErrorDialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-dialog-content"><div class="form-body"><h2 class="dialog-title">', soy.$$escapeHtml("\u8fdb\u7a0b\u8d85\u65f6"), '</h2>');
  JIRA.Templates.Issues.Util.auiMessage({typeClass: 'warning', messages: ["It looks like your session has timed out, or you have been logged out of JIRA. You will need to log back in to continue."]}, output);
  output.append('</div><div class="buttons-container form-footer"><div class="buttons"><a accesskey="', soy.$$escapeHtml("s"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.modifierKey)), '" class="aui-button submit" href="', soy.$$escapeHtml(""), '/login.jsp?os_destination=', soy.$$escapeHtml(opt_data.redirect), '">', soy.$$escapeHtml("\u91cd\u65b0\u767b\u5f55"), '</a><a accesskey="', soy.$$escapeHtml("`"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.modifierKey)), '" class="aui-button aui-button-link cancel">', soy.$$escapeHtml("Ignore"), '</a></div></div></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/pigsty/SerializeToObject.js' */
jQuery.fn.serializeObject=function(){var b={};var a=this.find(":input").serializeArray();jQuery.each(a,function(){if(b[this.name]){if(!b[this.name].push){b[this.name]=[b[this.name]]}b[this.name].push(this.value||"")}else{b[this.name]=this.value||""}});return b};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/editissue/model/EditIssueController.js' */
Backbone.define("JIRA.Issues.EditIssueController",JIRA.Issues.BaseModel.extend({properties:["issueId","issueKey","issueViewContext","fields","issueEventBus"],namedEvents:["save"],initialize:function(){_.bindAll(this);this.set({fields:new JIRA.Issues.IssueFieldCollection()},{silent:true});this.getFields().bind("add",this.createFieldView).bind("updated",this.handleFieldUpdate).bind("save",this.save);this.getIssueEventBus().bindSavingStarted(this._handleSavingStarted);this.getIssueEventBus().bindSaveSuccess(this._handleSaveSuccess);this.getIssueEventBus().bindSaveError(this._handleSaveError);this.getIssueEventBus().bindSave(this.save);this.getIssueEventBus().bindSave(this.cancelUneditedFields)},_saveById:function(b){var a=this.getFields().get(b);if(a){a.blurEdit()}},_handleSaveError:function(d,c,b){var a=this;if(b){this.applyErrors(b)}else{_.each(c,function(f){var e=a.getFields().get(f);if(e){e.handleSaveError()}})}},_handleSavingStarted:function(a){this.getFields().each(function(b){if(_.include(a,b.id)){b.handleSaveStarted()}})},handleFieldUpdate:function(b){var a=jQuery(JIRA.Issues.IssueFieldUtil.getFieldSelector(b.id));if(!a.hasClass("editable-field")){this.createFieldView(b)}},applyErrors:function(d,c){var a=d.errorCollection;if(a&&a.errors){this.getFields().each(function(e){if(a.errors[e.id]){var f=_.find(d.fields,function(g){return g.id==e.id});if(f){e.setValidationError(f.editHtml,a.errors[e.id],c);c=false}}})}if(a.errorMessages&&a.errorMessages.length){var b=JIRA.Templates.ViewIssue.Fields.saveErrorMessage({errors:a.errorMessages,issueKey:this.getIssueKey()});JIRA.Messages.showErrorMsg(b,{closeable:true})}},reset:function(){this.getFields().reset()},cancelEdit:function(){this.getFields().each(function(a){a.cancelEdit()})},_handleSaveSuccess:function(c,a,d){var b=this.getFields().filter(function(e){return _.indexOf(d,e.id)>=0});_.each(b,function(e){e.handleSaveSuccess()})},getDirtyEditsInProgress:function(){return _.pluck(this.getFields().filter(function(a){return a.getEditing()&&a.isDirty()}),"id")},getEditsInProgress:function(){return _.pluck(this.getFields().filter(function(a){return a.getEditing()}),"id")},save:function(b,a){var e={},d=[];var c=[b];if(!b){c=this.getFields().filter(function(f){return !f.getSaving()&&f.getEditing()&&f.isDirty()})}else{if(!b.getEditing()||b.getSaving()){return}}_.each(c,function(f){d.push(f.getId());_.extend(e,f.getCurrentParams())});if(d.length>0){this.triggerSave(this.getIssueId(),this.getIssueKey(),d,e,a)}},cancelUneditedFields:function(){this.getFields().each(function(a){if(a.getEditing()&&!a.isDirty()&&!a.hasValidationError()){a.cancelEdit()}})},update:function(b,a){this.getFields().update(b,a)},createFieldView:function(b){var a=jQuery(JIRA.Issues.IssueFieldUtil.getFieldSelector(b.id),this.getIssueViewContext());if(a.length===1){new JIRA.Issues.IssueFieldView({model:b,el:a,issueEventBus:this.getIssueEventBus()})}}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/editissue/model/SaveInProgressManager.js' */
Backbone.define("JIRA.Issues.SaveInProgressManager",JIRA.Issues.BaseModel.extend({properties:["savesInProgress"],namedEvents:["beforeSaving","savingStarted","saveSuccess","saveError"],initialize:function(){this.setSavesInProgress([])},saveIssue:function(g,b,d,c,h){this.triggerBeforeSaving();var i=this,a,e;e=_.extend(c,{issueId:g,atl_token:atl_token(),singleFieldEdit:true,fieldsToForcePresent:d});var f=_.extend({type:"POST",url:contextPath+"/secure/IssueAction.jspa?decorator=none",headers:{"X-SITEMESH-OFF":true},error:function(j){i._handleSaveError(g,b,d,j)},success:function(n,l,m,j){var k=j.data;if(typeof k=="string"){i._handleHtmlResponse(g,b,d,k)}else{i.triggerSaveSuccess(g,b,d,k)}},complete:function(){i.removeSaveInProgress(a);JIRA.trigger(JIRA.Events.INLINE_EDIT_SAVE_COMPLETE)},data:e},h);a=JIRA.SmartAjax.makeRequest(f);this.addSaveInProgress(a);this.triggerSavingStarted(g,d,c)},hasSavesInProgress:function(){return this.getSavesInProgress().length>0},removeSaveInProgress:function(a){this.setSavesInProgress(_.without(this.getSavesInProgress(),a))},addSaveInProgress:function(a){var b=this.getSavesInProgress();b.push(a);this.setSavesInProgress(b)},_handleHtmlResponse:function(h,b,c,e){var a=this;var g=AJS.$(AJS.extractBodyFromResponse(e));var f=g.find("#atl_token").val();if(f){AJS.$("#atlassian-token").attr("content",f)}var d=new JIRA.FormDialog({offsetTarget:"body",content:g});this.triggerSaveError(h,b,c);d._handleServerSuccess=function(i){d.hide();var j=a._parseResponse(i);if(j){a.triggerSaveSuccess(h,b,c,j)}};d._handleServerError=function(j){d.hide();var i=a._parseResponse(j.responseText);if(i){a.triggerSaveError(h,b,c,i)}};d.show()},_handleSaveError:function(e,a,b,d){var c=this._parseResponse(d.responseText);if(c){this.triggerSaveError(e,a,b,c)}},_parseResponse:function(a){try{return JSON.parse(a)}catch(b){this._showFatalErrorMessage();return null}},_showFatalErrorMessage:function(){var a="<p>"+"\u901A\u8BAF\u4E2D\u65AD"+"</p><p>"+"\u5173\u95ED\u8FD9\u4E2A\u5BF9\u8BDD\u6846\u5E76\u91CD\u65B0\u5237\u65B0\u6D4F\u89C8\u5668"+"</p>";JIRA.Messages.showErrorMsg(a,{closeable:true})}}));JIRA.Events.INLINE_EDIT_SAVE_COMPLETE="inlineEditSaveComplete";
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/editissue/model/IssueFieldModel.js' */
Backbone.define("JIRA.Issues.IssueFieldModel",JIRA.Issues.BaseModel.extend({namedEvents:["editingStarted","focusRequested","editingCancelled","save","saveError","savingStarted","saveComplete","saveSuccess","updateRequired","validationError","modelDestroyed"],properties:["id","initParams","params","editHtml","viewHtml","required","fieldType","editing","saving","error","label","contentId"],initialize:function(){if(this.collection){var a=this;this.collection.on("reset",function(){a.triggerModelDestroyed()})}this.on("change:viewHtml",function(){var b=this.previous("viewHtml");if(b){jQuery.cleanData(b)}});this.bindModelDestroyed(function(){var b=this.getViewHtml();if(b){jQuery.cleanData(b)}})},blurEdit:function(){if(this.getEditing()){if(this.isDirty()||this.hasValidationError()){this.save()}else{this.cancelEdit()}}},setValidationError:function(c,b,a){this.setSaving(false);this.setError(b);this.edit({ignoreBlur:true});this.triggerSaveError();this.triggerValidationError(c,a)},handleSaveError:function(){this.setSaving(false);this.triggerSaveError()},cancelEdit:function(b){if(!this.cancelLocked){var a=new AJS.$.Event(JIRA.Events.BEFORE_INLINE_EDIT_CANCEL);JIRA.trigger(a,[this.getId(),this.getFieldType(),b]);if(!a.isDefaultPrevented()){this.cancelLocked=true;if(this.getEditing()||this.getSaving()){this.setEditing(false);this.setSaving(false);this.unset("params");this.unset("initParams");this.triggerEditingCancelled();this.unset("viewHtml")}delete this.cancelLocked}}},edit:function(a){if(!this.getEditing()){this.setEditing(true);this.triggerEditingStarted(this,a)}else{if(!a||!a.ignoreBlur){this.triggerFocusRequested(this,a)}}},getCurrentParams:function(){this.triggerUpdateRequired();var c={};if(this.getParams()){c=this.getParams()}else{if(this.getInitParams()){c=this.getInitParams()}else{var b=AJS.$("<div />").html(this.getEditHtml());this.setInitParams(b.serializeObject());c=this.getInitParams()}}var a={};_.each(c,function(e,d){a[d]=e});return a},isEditable:function(){if(this.getEditHtml()){return AJS.$(this.getEditHtml()).find("textarea, :text,:radio,:checkbox, select").length!==0}return false},hasValidationError:function(){return !!this.getError()},switchElToEdit:function(a){if(!this.getViewHtml()){this.setViewHtml(a.contents())}a.contents().detach();a.html(JIRA.Templates.ViewIssue.Fields.field({issue:this.toJSON(),accessKey:JIRA.Issues.IssueFieldUtil.getAccessKeyModifier()}));if(!this.getInitParams()){this.setInitParams(a.serializeObject())}this.setEditing(true)},update:function(a){if(this.getEditing()){this.setParams(a.serializeObject())}},handleSaveSuccess:function(){this.setSaving(false);this.setEditing(false);this.unset("viewHtml");this.unset("initParams");this.setError(null);this.triggerSaveSuccess()},handleSaveStarted:function(){this.setSaving(true);this.triggerSavingStarted()},save:function(){if(!this.getSaving()){this.triggerUpdateRequired();this.triggerSave(this)}},isDirty:function(){this.triggerUpdateRequired();return this._isDirty(this.getCurrentParams())},_isDirty:function(a){return JSON.stringify(a)!==JSON.stringify(this.getInitParams())},matchesFieldSelector:function(){return JIRA.Issues.IssueFieldUtil.matchesFieldSelector(this.id)}},{IS_EDITABLE:function(a){return a.isEditable()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/editissue/model/IssueFieldCollection.js' */
Backbone.define("JIRA.Issues.IssueFieldCollection",JIRA.Issues.BaseCollection.extend({model:JIRA.Issues.IssueFieldModel,initialize:function(){_.bindAll(this);this.bind("editingStarted",this._handleEditingStarted)},_handleEditingStarted:function(b,a){a=a||{};if(a.ignoreBlur){return}this.each(function(c){if(b!==c&&c.getEditing()){c.blurEdit()}})},update:function(e,c){var a=this;if(c&&c.changed){var b=c.changed;var f=b.updated?b.updated.fields:[];var d=b.added?b.added.fields:[];_.each(e,function(h){if(_.contains(f,h.id)){var g=a.get(h.id);if(g){if(g.hasValidationError()){delete h.editHtml}g.set(h,{silent:true});a.trigger("updated",g)}else{a.add(h)}}else{if(_.contains(d,h.id)){a.add(h)}}})}else{_.each(e,function(h){var g=a.get(h.id);if(g){if(g.hasValidationError()){delete h.editHtml}g.set(h,{silent:true});a.trigger("updated",g)}else{a.add(h)}})}},cancelEdit:function(){this.each(function(a){a.cancelEdit()})},isDirty:function(){return this.any(function(a){return a.isDirty()})},getDirtyFields:function(){return this.filter(function(a){return a.isDirty()})}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/editissue/util/InlineEditUtils.js' */
JIRA.Events.INLINE_EDIT_STARTED="inlineEditStarted";JIRA.Events.BEFORE_INLINE_EDIT_CANCEL="inlineEditCancelled";JIRA.Events.INLINE_EDIT_BLURRED="inlineEditBlurred";JIRA.Events.INLINE_EDIT_FOCUSED="inlineEditFocused";JIRA.Events.INLINE_EDIT_REQUESTED="inlineEditRequested";JIRA.Events.PANEL_REFRESHED="panelRefreshed";JIRA.Events.LOCK_PANEL_REFRESHING="lockPanelRefreshing";JIRA.Events.UNLOCK_PANEL_REFRESHING="unlockPanelRefreshing";JIRA.Events.REFRESH_ISSUE_PAGE="refreshIssuePage";JIRA.Issues.CANCEL_REASON={escPressed:"escPressed"};AJS.$(function(){AJS.namespace("JIRA.Issues.InlineEdit");JIRA.Issues.InlineEdit.BLUR_FOCUS_TIMEOUT=50;var a=JIRA.Issues.InlineEdit.BlurTriggers={Default:function(e,i){i=i.nextAll(".save-options").andSelf();var h=":input, a[href], [tabindex]";var g;var f=b(i);var d={focus:function(){if(!f){f=true;JIRA.trigger(JIRA.Events.INLINE_EDIT_FOCUSED,[e])}},blur:function(){if(g){clearTimeout(g)}g=setTimeout(c,JIRA.Issues.InlineEdit.BLUR_FOCUS_TIMEOUT)}};i.attr("tabindex",1).bind(d).delegate(h,d);function c(){if(!b(i)){f=false;JIRA.trigger(JIRA.Events.INLINE_EDIT_BLURRED,[e])}}}};function b(d){var c=document.activeElement;return d.find(c).length>0||d.filter(c).length>0}JIRA.Issues.InlineEdit.BlurTriggerMapping={system:{summary:a.Default,priority:a.Default,issuetype:a.Default,components:a.Default,versions:a.Default,fixVersions:a.Default,assignee:a.Default,reporter:a.Default,environment:a.Default,description:a.Default,labels:a.Default,duedate:a.Default},custom:{"com.atlassian.jira.plugin.system.customfieldtypes:cascadingselect":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:datepicker":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:datetime":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:float":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:grouppicker":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:labels":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:multigrouppicker":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:multiselect":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:multiuserpicker":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:multiversion":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:project":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:select":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:textarea":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:textfield":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:url":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:userpicker":a.Default,"com.atlassian.jira.plugin.system.customfieldtypes:version":a.Default}};JIRA.bind(JIRA.Events.INLINE_EDIT_STARTED,function(h,d,c,i){var g;if(c){g=JIRA.Issues.InlineEdit.BlurTriggerMapping.custom[c];if(!g){var f=c.replace(/.+:(.+)/,"$1");g=JIRA.Issues.InlineEdit.BlurTriggerMapping.custom[f]}}else{g=JIRA.Issues.InlineEdit.BlurTriggerMapping.system[d]}if(g){g(d,i)}})});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/view/UnhandledSaveErrorView.js' */
Backbone.define("JIRA.Issues.UnhandledSaveErrorView",JIRA.Issues.BaseView.extend({events:{"click .fix,.issue-key":"_onFix","click .ignore":"_onIgnore"},initialize:function(a){this.viewIssueLoader=a.viewIssueLoader;this.isCurrentIssue=a.isCurrentIssue;this.issueId=a.issueEntity.id;this.issueEntity=a.issueEntity;this.attemptedSavedIds=a.attemptedSavedIds;this.response=a.response},render:function(){if(!this.response||!this.response.errorCollection){return}var a=this.response.errorCollection;var d=a.errorMessages.concat(_.values(a.errors));var c=this._getTemplate();var b;b=JIRA.Templates.ViewIssue.Fields[c]({errors:d,issueKey:this.issueEntity.key,isAccessible:this._isAccessible(),isCurrentIssue:this.isCurrentIssue});this.setElement(JIRA.Messages.showErrorMsg(b,{closeable:true,timeout:0}))},_onIgnore:function(a){this.hide();a.preventDefault()},hide:function(){this.$el.remove()},_onFix:function(a){this.fix();a.preventDefault()},fix:function(){this.hide();return this.viewIssueLoader.replaySaveError(this.issueEntity,this.attemptedSavedIds,this.response)},isVisible:function(){return this.$el.closest("body").length===1},getId:function(){return this.issueId},_isAccessible:function(){return !!(this.response.fields&&this.response.fields.length)},_getTemplate:function(){var a=_.any(this.response.fields,function(b){return b.id===this.attemptedSavedIds[0]&&b.editHtml},this);return a?"resumableSaveErrorMessage":"saveErrorMessage"}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/util/ViewIssueController.js' */
Backbone.define("JIRA.Issues.ViewIssueController",JIRA.Issues.BaseModel.extend({namedEvents:["issueDataUpdated","issueError","issueLoaded","issueLoading","issueRequested","returnToSearch","unhandledSaveError","issueViewUpdated","saveSuccess","fieldSubmitted","replacedFocusedPanel"],defaults:{selectedIssue:new JIRA.Issues.SimpleIssue()},properties:["saveInProgressManager","viewIssueModel","selectedEditIssueController","selectedIssue","viewIssueContext"],initialize:function(e,d){var b=this,a=!JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()&&!JIRA.Issues.DarkFeatures.NO_PREFETCH.enabled();_.bindAll(this);this.viewIssueData=(d&&d.viewIssueData)?d.viewIssueData:new JIRA.Issues.ViewIssueData();this.issuePagerModel=new JIRA.Issues.IssuePagerModel();this.issuePagerModel.bindReturnToSearch(function(){if(this.canDismissComment()){this._destroySelectedViewIssue();this.triggerReturnToSearch()}},this);this.loadingPromiseManager=jQuery.RecurringPromise();this.loading=this.loadingPromiseManager.sub();this.loading.done(_.bind(this._onLoadFromViewIssueData,this));this.loading.fail(_.bind(this._handleFailure,this));if(a){this.loading.always(_.bind(this._refresh,this))}this.updating=this.loadingPromiseManager.sub();this.updating.done(_.bind(this._onUpdated,this));this.updating.fail(_.bind(this._onUpdatedFailure,this));var c=window.onbeforeunload;window.onbeforeunload=function(){return c.apply(this,arguments)||b._handleUnload.apply(this,arguments)};this.on("destroy",function(){window.onbeforeunload=c});JIRA.bind(JIRA.Events.REFRESH_ISSUE_PAGE,function(g,h,f){if(b.isCurrentIssue(h)){b.getViewIssueModel().getIssueEventBus().triggerRefreshIssue(f)}});JIRA.Issues.FocusShifter.init(this);this.getSaveInProgressManager().bindSaveSuccess(function(j,g,k,i){if(b.isCurrentIssue(j)){if(!b.shouldSkipSaveIssueSuccessHandler()){b._handleSelectedIssueSaveSuccess(j,g,k,i)}else{var h=b.getSelectedEditIssueController(),f=b.getViewIssueModel();b._handleLoadComplete({editIssueController:h,issueViewModel:f,issueId:j,fieldsSaved:k,fieldsInProgress:h.getEditsInProgress(),initialize:false})}}b.triggerSaveSuccess(j)});this.getSaveInProgressManager().bindSaveError(function(j,f,h,g){if(g){b._parseLoadResponseData(g)}if(b._shouldShowDeferredError(j,h)){var i=b.isCurrentIssue(j);b.unhandledSaveError=new JIRA.Issues.UnhandledSaveErrorView({issueEntity:{id:j,key:f},attemptedSavedIds:h,response:g,viewIssueLoader:b,isCurrentIssue:i});b.unhandledSaveError.render();if(i){b.getSelectedEditIssueController().cancelEdit()}}else{b._handleSelectedIssueSaveError(j,h,g)}b._checkRefreshIssueRowData(j)});this.getSaveInProgressManager().bindBeforeSaving(function(){var g=b.getViewIssueModel();if(g){var f=g.getEntity();b.triggerIssueViewUpdated(f.id,f.key)}});this.getSaveInProgressManager().bindSavingStarted(function(g,f){b._recordTimeStampForAnalytic();if(b.isCurrentIssue(g)){b.getViewIssueModel().getIssueEventBus().triggerSavingStarted(f)}})},isCurrentIssue:function(a){return parseInt(this.getSelectedIssue().getId(),10)===parseInt(a,10)},_shouldShowDeferredError:function(f,e){var c=AJS.$(".aui-blanket:visible").length>0;if(!this.isCurrentIssue(f)){return true}if(e.length>1){return c}var b=JIRA.Issues.IssueFieldUtil.matchesFieldSelector(e[0]);var a=AJS.$("#modal-field-view").data("field-id");var d=e[0]===a;return !d&&(!b||c)},replaySaveError:function(b,d,c){var g=this.getViewIssueModel()&&b.id===this.getViewIssueModel().id;if(g){var a=this.getSelectedEditIssueController().getFields();if(d.length===1){var f=a.get(d[0]);if(!f.matchesFieldSelector()){new JIRA.Issues.ModalIssueFieldView({issueEventBus:this.getViewIssueModel().getIssueEventBus(),model:f}).show()}}this._handleSelectedIssueSaveError(b.id,d,c);var e=a.filter(function(h){return h.getEditing()});if(e.length===1){e[0].triggerFocusRequested()}return JIRA.Issues.Utils.resolvedPromise()}return this.load(b,c)},_destroySelectedViewIssue:function(){var b=this.getViewIssueModel();var a=this.getSelectedEditIssueController();this.getSelectedIssue().clear();if(a){a.reset()}if(this.getViewIssueModel()){this.setViewIssueModel(undefined);b.dismiss()}},_getFieldsData:function(d,a){var c=jQuery.ajax({url:contextPath+"/secure/EditAction!default.jspa?decorator=none",headers:{"X-SITEMESH-OFF":true},data:{issueId:d}});var b=c.pipe(function(e){var f=JIRA.Issues.IssueFieldUtil.transformFieldHtml(e);return{issueId:d,issueKey:a,fields:f.fields}},function(j){var g={};var h=true;if(j.status===400||j.status===401){h=false;if(j.status===400){try{var f=JSON.parse(j.responseText)||{};g=f.errorCollection}catch(i){}}else{g=null}}return{issueId:d,fields:null,errorCollection:g,isTimeout:"timeout"===j.statusText,fatalError:h}});b.abort=function(){c.abort.apply(c,arguments)};return b},_checkRefreshIssueRowData:function(b){if(this._refreshRowDataAfterUpdate){var a=this;return jQuery.ajax({url:contextPath+"/rest/api/latest/issue/"+b+"?expand=operations",success:function(c){a.triggerIssueDataUpdated(b,c)}})}},refreshRowDataAfterUpdate:function(){this._refreshRowDataAfterUpdate=true;return this},_parsePanelData:function(a){return{leftPanels:a.leftPanels,rightPanels:a.rightPanels,infoPanels:a.infoPanels}},showLoadingIndicator:function(){this.hideLoadingIndicator();this.loadingWait=window.setTimeout(function(){JIRA.Loading.showLoadingIndicator()},200)},hideLoadingIndicator:function(){clearInterval(this.loadingWait);if(this.loadingWait){JIRA.Loading.hideLoadingIndicator();delete this.loadingWait}},_update:function(a){this.startIssueLoad={date:new Date()};this._addViewIssueDataGetToUpdating(a.issueEntity.key,a);this._triggerIssueViewUpdatedEvent(a.issueEntity.id,a.issueEntity.key)},_showError:function(b,a){var d=b.errorMessages||{};var c=JIRA.Templates.ViewIssue.Body.errorsLoading({errorMessages:d,isTimeout:a});JIRA.Messages.showErrorMsg(c,{closeable:true,timeout:0})},_handleLoadSuccess:function(b,c){this._parseLoadResponseData(c);this._checkRefreshIssueRowData(b.issueId);if(c){var a=b.editable=c.fields&&c.fields.length;if(a){b.issueViewModel.update(c,b);b.editIssueController.update(c.fields,b);b.fieldsInProgress=b.editIssueController.getEditsInProgress();if(b.lastEditData&&b.lastEditData.errorCollection){b.editIssueController.applyErrors(b.lastEditData,true)}if(b.initialize!==false){this._showFocusShifterTip()}}else{b.editIssueController.reset();b.issueViewModel.update(c,b)}}this._handleLoadComplete(b);this.triggerIssueLoaded(b.issueViewModel,b);if(b.success){b.success()}if(b.complete){b.complete()}},conditionallyRenderAccessError:function(a,d){var e;var c;var b;if(d.status===403){e="Permission Violation";c=JIRA.Templates.ViewIssue.Body.viewIssueNoPermissionError({pager:a})}else{if(d.status===404){e="Issue Does Not Exist";b=new JIRA.Issues.IssueMissingErrorView({el:this.getViewIssueContext(),searchPageModule:this.searchPageModule,pager:a})}else{if(d.status!==401){e="Unexpected Error";c=JIRA.Templates.ViewIssue.Body.viewIssueGenericError({pager:a})}}}if(e){document.title=e+" - "+AJS.Meta.get("app-title");if(c){this.getViewIssueContext().html(c)}else{if(b){b.render()}}new JIRA.Issues.IssuePagerView({model:this.issuePagerModel,el:this.getViewIssueContext().find("#issue-header-pager")});return true}return false},conditionallyRedirectToLogin:function(b,c){if(c.status===401){var a=AJS.contextPath()+"/login.jsp?os_destination="+encodeURIComponent("/browse/"+b);window.location.replace(a);return true}return false},_handleLoadError:function(a,b){if(b&&(!b.fields||!b.fields.length)){a.editIssueController.reset();a.issueViewModel.update(b,a)}this._handleLoadComplete(a);if(a.error){a.error()}if(a.complete){a.complete()}},_handleLoadComplete:function(b){if(this.startIssueLoad){JIRA.Issues.Analytics.trigger("kickass.issueLoadDuration",{issueId:b.issueId,duration:new Date()-this.startIssueLoad.date,loadReason:JIRA.Issues.Analytics._loadIssueReason,fromCache:this.startIssueLoad.fromCache});this.startIssueLoad=null;delete JIRA.Issues.Analytics._loadIssueReason}this.hideLoadingIndicator();this.hideDropdown();if(b.issueViewModel){b.issueViewModel.getIssueEventBus().triggerIssueRefreshed(b.issueId)}var a={id:b.issueId};JIRA.trace("jira.issue.refreshed",a);if(this._checkChangedData(b)){JIRA.trace("jira.psycho.issue.refreshed.cached",a)}JIRA.trigger(JIRA.Events.ISSUE_REFRESHED,[b.issueId]);this._logAnalyticAfterUpdate()},_checkChangedData:function(b){if(!b.mergeIntoCurrent){return false}var a=b.changed;if(!a){return false}return this._checkChangedDataCategory(a.added)||this._checkChangedDataCategory(a.updated)||this._checkChangedDataCategory(a.deleted)},_checkChangedDataCategory:function(a){if(a){if(!_.isEmpty(a.fields)){return true}if(!_.isEmpty(a.issue)){return true}if(a.panels&&(!_.isEmpty(a.panels.leftPanels)||!_.isEmpty(a.panels.rightPanels)||!_.isEmpty(a.panels.infoPanels))){return true}if(a.groups&&(!_.isEmpty(a.groups["view.issue.opsbar"])||a.groups["jira.issue.tools"])){return true}}return false},_parseLoadResponseData:function(a){a=JIRA.Issues.IssueFieldUtil.transformFieldHtml(a);if(a.panels){a.panels=this._parsePanelData(a.panels)}},dismiss:function(){this.deactivateViewIssueScrolling();this._destroySelectedViewIssue()},deactivateViewIssueScrolling:function(){if(this.getViewIssueModel()){this.trigger("issueDismissed",this.getViewIssueModel())}},_recordTimeStampForAnalytic:function(){if(!this._saveStarted){this._saveStarted=[]}this._saveStarted.push((new Date()).getTime())},_logAnalyticAfterUpdate:function(){if(this._saveStarted&&this._saveStarted.length){var a=this._saveStarted.shift();JIRA.Issues.Analytics.trigger("kickass.issueTotalSaveDuration",{duration:(new Date()).getTime()-a})}},_handleSelectedIssueSaveError:function(h,d,e){var c=this.getSelectedEditIssueController(),b=this.getViewIssueModel().getIssueEventBus(),a=this.getViewIssueModel(),g,f;if(e){g=_.keys(e.errorCollection.errors);f=_.without(d,g)}b.triggerSaveError(h,d,e);this._handleLoadError({editIssueController:c,issueViewModel:a,issueId:h,fieldsSaved:f,initialize:false},e)},_handleSelectedIssueSaveSuccess:function(f,c,g,e){var d=this.getSelectedEditIssueController(),b=this.getViewIssueModel().getIssueEventBus(),a=this.getViewIssueModel();b.triggerSaveSuccess.apply(b,arguments);this.viewIssueData.set(c,e);this._handleLoadSuccess({editIssueController:d,issueViewModel:a,issueId:f,fieldsSaved:g,fieldsInProgress:d.getEditsInProgress(),initialize:false},e)},shouldSkipSaveIssueSuccessHandler:function(){return this._shouldSkipSaveIssueSuccessHandler},setSkipSaveIssueSuccessHandler:function(a){this._shouldSkipSaveIssueSuccessHandler=a},_handleUnload:function(){var a=this.getSelectedEditIssueController();if(a){if(a.getDirtyEditsInProgress().length>0){return "You are still editing this page. Are you sure you want to leave?"}}},_initIssueObjects:function(c){var d=new JIRA.Issues.IssueEventBus({issueId:c.id});d.bindOpenFocusShifter(this._openFocusShifter);d.bindRefreshIssue(_.bind(function(e){e=e||{};this._update({editIssueController:b,issueViewModel:a,viewIssueQuery:c.viewIssueQuery,issueEntity:c,reason:e.reason,success:e.success,error:e.error,complete:e.complete,initialize:false})},this));d.bindFieldSubmitted(this.triggerFieldSubmitted);d.bindReplacedFocusedPanel(this.triggerReplacedFocusedPanel);var a=new JIRA.Issues.IssueViewModel({id:c.id,issuePagerModel:this.issuePagerModel,issueEventBus:d,splitViewMode:c.splitViewMode});this.setViewIssueModel(a);var b=new JIRA.Issues.EditIssueController({issueId:c.id,issueKey:c.key,issueViewContext:jQuery(this.getViewIssueContext()),issueEventBus:d});b.bindSave(_.bind(this._onSaveComplete,this));this.setSelectedEditIssueController(b);this.issueView=new JIRA.Issues.IssueView({model:a,el:this.getViewIssueContext()});return{issueEventBus:d,issueViewModel:a,editIssueController:b}},_onSaveComplete:function(e,a,c,d,b){this.setSkipSaveIssueSuccessHandler(false);this.getSaveInProgressManager().saveIssue(e,a,c,d,b)},applyToDom:function(c){var b;c.id=+c.id;b=this._initIssueObjects(c);var a=this;var e={id:c.id};var d=function(g){var h=g.fields&&g.fields.length;if(h){b.editIssueController.update(g.fields);a._showFocusShifterTip()}JIRA.trace("jira.issue.fields.loaded",e)};var f;if(AJS.Meta.get("server-view-issue-is-editable")||JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()){f=this._getFieldsData(c.id,c.key);AJS.Meta.set("server-view-issue-is-editable",null)}else{f=jQuery.Deferred().reject({fields:[]}).promise()}f.done(d).fail(function(g){if(!g.fatalError){d(g)}else{JIRA.trace("jira.issue.fields.loaded",e)}});this.getSelectedIssue().set({key:c.key,id:c.id});b.issueViewModel.updateFromDom(c);b.issueEventBus.triggerUpdateFromDom(this.getViewIssueContext());this.triggerIssueLoaded(b.issueViewModel,{isNewIssue:true})},updatePager:function(a){this.issuePagerModel.update(a)},_createPager:function(){},canDismissComment:function(){var b;var a=JIRA.Issue.CommentForm;if(!a.getForm().data("dismissed")){b=a.handleBrowseAway();if(b){if(!confirm(b)){a.focus();return false}else{a.getForm().data("dismissed",true)}}}return true},isCurrentlyLoading:function(){return this._currentlyLoading},load:function(a,b){if(!this.canDismissComment()||!a.key){return jQuery.Deferred().reject()}if(this._shouldReplaySaveError(a.id)){return this.unhandledSaveError.fix()}this._currentlyLoading=true;var c=jQuery.Deferred().always(_.bind(function(){this._currentlyLoading=false},this));this.getSelectedIssue().set({key:a.key,id:a.id});this.showLoadingIndicator();this.issuePagerModel.clear();this.startIssueLoad={date:new Date()};this.loading.add(this.viewIssueData.get(a.key,false,{issueEntity:a,lastEditData:b,loadCompletely:c,loadFields:false}));return c},_shouldReplaySaveError:function(a){return this.unhandledSaveError&&this.unhandledSaveError.isVisible()&&this.unhandledSaveError.getId()===a},cancelLoad:function(){this.loading.reset();this.updating.reset();this.hideLoadingIndicator()},isNewIssue:function(b){var a=this.getViewIssueModel()&&this.getViewIssueModel().getEntity();return !a||a.id!==b},_onLoadFromViewIssueData:function(c,i,j){var g=j.issueEntity;g.id=c.issue.id;var h=this.isNewIssue(g.id);var d=!i.mergeIntoCurrent&&j.initialize!==false;if(this.startIssueLoad){this.startIssueLoad.fromCache=i.fromCache}var e={id:g.id};if(i.fromCache){JIRA.trace("jira.issue.loadFromCache",e);JIRA.trace("jira.issue.fields.loaded",e)}else{JIRA.trace("jira.issue.loadFromServer",e)}if(g.key!==c.issue.key){g.key=c.issue.key}if(d){this._destroySelectedViewIssue()}this.getSelectedIssue().set({key:g.key,id:g.id});if(!c.pager){c.pager=g.pager}var a;var b;if(d){var f=this._initIssueObjects(g);a=f.editIssueController;b=f.issueViewModel}else{a=this.getSelectedEditIssueController();b=this.getViewIssueModel()}this._handleLoadSuccess({editIssueController:a,issueViewModel:b,issueId:g.id,issueKey:g.key,lastEditData:j.lastEditData,initialize:d,isNewIssue:h,splitViewMode:g.splitViewMode,changed:i.changed,mergeIntoCurrent:i.mergeIntoCurrent,success:j.success,error:j.error,complete:j.complete},c);if(g.bringToFocus){g.bringToFocus()}this.addIssueMetadata();if(j.loadCompletely){j.loadCompletely.resolve()}this._triggerRefreshToggleBlocks(g.id)},_handleFailure:function(d,e,b){var a=b.issueEntity,c;c={issueId:a.id,issueKey:a.key,pager:a.pager,response:d};if(!this.conditionallyRedirectToLogin(a.key,d)){if(!a.preventErrorRendering){this.conditionallyRenderAccessError(a.pager,d)}this._handleLoadError(c);this.triggerIssueError(c)}this.removeIssueMetadata();if(b.loadCompletely){b.loadCompletely.reject()}},_refresh:function(c,d,b){var a=b.issueEntity;if(d.fromCache){JIRA.Issues.Analytics._loadIssueReason="issues-cache-refresh";this.startIssueLoad={date:new Date()};b.mergeIntoCurrent=!d.error;delete b.loadFields;this._addViewIssueDataGetToUpdating(a.key,b)}else{if(d.initialLoad&&!d.error&&c.issue.isEditable){this.updating.add(this._updatingTask(this._getFieldsDataTask(a.id,a.key),"fields",b.lastEditData))}}},_addViewIssueDataGetToUpdating:function(a,b){this.updating.add(this._updatingTask(this.viewIssueData.get(a,true,b),"issue"))},_getFieldsDataTask:function(c,a){var b=jQuery.Deferred();this.viewIssueData.setPending(c,this._getFieldsData(c,a),function(d){b.resolve(d)},function(d){if(d.fatalError){b.reject(d)}else{b.resolve(d)}});return b.promise()},_updatingTask:function(a,c,b){return a.pipe(function(){return{taskKey:c,data:arguments,lastEditData:b}},function(){return{taskKey:c,data:arguments,lastEditData:b}})},_onUpdated:function(a){if(a.taskKey==="issue"){this._onLoadFromViewIssueData.apply(this,a.data)}else{if(a.taskKey==="fields"){this._onFieldsLoaded(a.data[0],a.lastEditData)}}},_onFieldsLoaded:function(a,d){if(a.errorCollection||a.isTimeout){this._showError(a.errorCollection,a.isTimeout)}var c=this.viewIssueData.getMeta(a.issueKey);if(c&&c.value){c.value.fields=a.fields||{}}var b=a.fields&&a.fields.length;if(b){this.getSelectedEditIssueController().update(a.fields);if(d&&d.errorCollection){this.getSelectedEditIssueController().applyErrors(d,true)}this._showFocusShifterTip()}this._traceFieldsLoaded(a.issueId)},_traceFieldsLoaded:function(b){var a={id:b};JIRA.trace("jira.issue.fields.loaded",a)},_onUpdatedFailure:function(a){if(a.taskKey==="issue"){this._handleFailure.apply(this,a.data)}else{if(a.taskKey==="fields"){this._handleLoadFieldsFailure.apply(this,a.data)}}},_handleLoadFieldsFailure:function(a){if(a.errorCollection||a.isTimeout){this._showError(a.errorCollection,a.isTimeout)}this._traceFieldsLoaded(a.issueId)},_openFocusShifter:function(){JIRA.Issues.FocusShifter.show()},_showFocusShifterTip:function(){var a=this.getSelectedEditIssueController().getFields().models;var b=JIRA.Issues.FocusShifter.hasSuggestions(a)&&JIRA.Issues.FocusShifterTip&&JIRA.Issues.FocusShifterTip._shouldShow();if(b){new JIRA.Issues.FocusShifterTip()}},hideFocusShifterTip:function(){if(JIRA.Issues.FocusShifterTip){JIRA.Issues.FocusShifterTip.hide()}},hideLightbox:function(){AJS.$.fancybox.close()},hideDropdown:function(){if(AJS.InlineDialog.current&&_.contains(JIRA.Issues.IntroDialog.dialogs,AJS.InlineDialog.current)){AJS.InlineDialog.current.hide()}if(AJS.InlineLayer.current){var a=AJS.InlineLayer.current.options.offsetTarget();if(a instanceof jQuery){if(!a.is(":visible")){AJS.InlineLayer.current.hide()}}}},_triggerIssueViewUpdatedEvent:function(b,a){this.trigger("issueViewUpdated",{issueId:b,issueKey:a})},_triggerRefreshToggleBlocks:function(a){if(JIRA.Events.REFRESH_TOGGLE_BLOCKS){JIRA.trigger(JIRA.Events.REFRESH_TOGGLE_BLOCKS,[a])}},changeViewIssueContext:function(b){var a=this.getSelectedEditIssueController(),c=this.issueView;if(a){a.setIssueViewContext(b)}if(c){c.setElement(b)}this.setViewIssueContext(b)},removeIssueMetadata:function(c){var b=c||this.getViewIssueModel();var a=(b&&b.getEntity())||{};if(a.metadata){_.each(a.metadata,function(e,d){AJS.Meta.set(d,null)})}else{if(AJS.Meta.get("issue-key")){AJS.Meta.set("issue-key",null)}}},addIssueMetadata:function(c){var b=c||this.getViewIssueModel();var a=(b&&b.getEntity())||{};_.each(a.metadata,function(e,d){AJS.Meta.set(d,e)})},updateIssueWithQuery:function(c){var a=this.getViewIssueModel();if(!a){return}var b=a.getEntity();if(!b.key||!b.id){return}b.viewIssueQuery=c||{};this._addViewIssueDataGetToUpdating(b.key,{mergeIntoCurrent:true,issueEntity:b})}}));JIRA.Events.ISSUE_REFRESHED="issueRefreshed";
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/util/FocusShifter.js' */
AJS.namespace("JIRA.Issues.FocusShifter");JIRA.Issues.FocusShifter.init=function(a){return JIRA.Shifter.register(function(){var b;if(JIRA.Issues.Api.issueIsVisible&&!JIRA.Issues.Api.issueIsVisible()){b=[]}else{var c=a.getSelectedEditIssueController().getFields().models;b=JIRA.Issues.FocusShifter.getSuggestions(c)}return{id:"edit-fields",name:"Edit Fields",context:JIRA.Issue.getIssueKey(),weight:100,getSuggestions:function(){return jQuery.Deferred().resolve(b)},onSelection:function(f){var d=a.getSelectedEditIssueController();var e=a.getViewIssueModel().getIssueEventBus();var g=d.getFields().get(f);JIRA.Issues.FocusShifter.performEdit(g,e)}}})};JIRA.Issues.FocusShifter.show=function(){JIRA.Shifter.show()};JIRA.Issues.FocusShifter.hasSuggestions=function(a){return JIRA.Issues.FocusShifter.getSuggestions(a).length>0};JIRA.Issues.FocusShifter.getSuggestions=function(a){return _.chain(a).filter(JIRA.Issues.IssueFieldModel.IS_EDITABLE).reject(function(b){return b.id==="comment"}).map(function(b){return{label:b.getLabel(),value:b.id}}).value()};JIRA.Issues.FocusShifter.performEdit=function(c,b){if(c){var a=function(){if(c.matchesFieldSelector()){c.edit()}else{new JIRA.Issues.ModalIssueFieldView({issueEventBus:b,model:c}).show()}};if(!c.getSaving()){a()}else{JIRA.one(JIRA.Events.ISSUE_REFRESHED,function(){a()})}}};JIRA.Issues.FocusShifter.suppressTip=function(){if(JIRA.Issues.FocusShifterTip){JIRA.Issues.FocusShifterTip._dismiss();AJS.$.ajax({data:"tipKey=focusShifter",type:"POST",url:contextPath+"/rest/issueNav/1/suppressedTips"})}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/editissue/view/IssueFieldView.js' */
Backbone.define("JIRA.Issues.IssueFieldView",JIRA.Issues.BaseView.extend({events:{"click .cancel":"onClickCancel",keyup:"onKeyCancel","click .submit":"onSubmit",click:"onEdit",mousedown:"saveSelectedText","submit form":"onSubmit",'keydown select[multiple="multiple"]':"_enterToSubmitMultiSelect","keypress select":"_enterToSubmitSelect","beforeBlurInput *":"_preventBlurByEsc"},initialize:function(b){this.model.bind("validationError",this.handleValidationError,this);this.model.bind("editingStarted",this.switchToEdit,this);this.model.bind("focusRequested",this.focus,this);this.model.bind("editingCancelled",this.switchToRead,this);this.model.bind("saveError",this.handleSaveError,this);this.model.bind("updateRequired",this.updateModel,this);this.model.bind("savingStarted",this.handleSavingStarted,this);this.model.bind("modelDestroyed",this.destroy,this);this.decorate();this.issueEventBus=b.issueEventBus;this.issueEventBus.bind("panelRendered",this.handlePanelRendered,this);this.model.setFieldType(this.$el.data("fieldtypecompletekey"));this._editDelay=0;var a=this;JIRA.bind(JIRA.Events.INLINE_EDIT_BLURRED,function(d,c){if(c===a.model.getId()){a._onPossibleBlur()}});JIRA.bind(JIRA.Events.INLINE_EDIT_REQUESTED,function(d,c){if(c!==a.model.getId()&&a._editDelay!==0){clearTimeout(a._editDelay);a._editDelay=0}})},destroy:function(){this.issueEventBus.off("panelRendered",this.handlePanelRendered)},decorate:function(){if(this.model.isEditable()&&!this.model.getEditing()){this.$el.addClass("editable-field inactive");this.$el.append('<span class="overlay-icon icon icon-edit-sml" />');this._addToolTip()}},getEditElements:function(){return this.$el.find(".inline-edit-fields")},_addToolTip:function(){this.$el.attr("title","Click to edit");jQuery("a:not([title])",this.$el).attr("title","Follow link")},_removeToolTip:function(){this.$el.removeAttr("title")},_stealAccessKeys:function(){jQuery("[accessKey='"+"s"+"']").attr("accessKey","_s");jQuery("[accessKey='"+"`"+"']").attr("accessKey","_x")},_returnAccessKeys:function(){jQuery("[accessKey=_s]").attr("accessKey","s");jQuery("[accessKey=_x]").attr("accessKey","`")},_handleEditingStarted:function(a){var b=this.$el.find(".field-tools");JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$el,JIRA.CONTENT_ADDED_REASON.inlineEditStarted]);JIRA.trigger(JIRA.Events.INLINE_EDIT_STARTED,[this.model.getId(),this.model.getFieldType(),this.getEditElements(),this.$el]);this.$el.find(".textarea").css("height",Math.max(this._originalHeight,60)).expandOnInput(jQuery(window).height()-jQuery("#stalker").height()-100);if(a){this.$el.find(":input:visible:first").focus()}if(!this.$el.find(".error").size()){this.$el.find("select.aui-ss-select").each(function(){var c=jQuery(this);if(c.data("static-suggestions")){c.trigger("showSuggestions")}})}this.$el.find(".save-options").attr("tabindex",1).prepend(b)},handleValidationError:function(b,a){this.$el.html(JIRA.Templates.ViewIssue.Fields.field({issue:{id:this.model.id,editHtml:b},accessKey:JIRA.Issues.IssueFieldUtil.getAccessKeyModifier()}));this.$el.find(".error").addClass("inline-edit-error").attr("data-field",this.model.id);this._handleEditingStarted(a)},handlePanelRendered:function(a,b){var c=jQuery(JIRA.Issues.IssueFieldUtil.getFieldSelector(this.model.id),b);if(c.length===1){this.$el=c;this.el=this.$el[0];this.decorate();this.delegateEvents()}},handleSaveError:function(){this.$el.find(":input").removeAttr("disabled").trigger("enable");this.$el.removeClass("saving saving-"+this.model.id)},handleSavingStarted:function(){this.$el.find(":input").attr("disabled","disabled").trigger("disable");this.$el.addClass("saving saving-"+this.model.id)},updateModel:function(){this.model.update(this.$el)},reveal:function(){var a=40;this.$el.scrollIntoView({direction:"y",marginBottom:a,marginTop:AJS.$("#stalker").outerHeight(true)+a});this.$el.trigger("reveal")},focus:function(){this.reveal();this.$el.find(":input").removeAttr("disabled");if(jQuery(".aui-blanket").length===0){var a=this.$el.find(":input:visible:first");a.focus();if(!this.$el.hasClass("field-ignore-highlight")){a.select()}}},switchToEdit:function(){var a={fieldId:this.model.getId()};JIRA.Issues.Analytics.trigger("kickass.editField",a);this._stealAccessKeys();this._removeToolTip();this.$el.removeClass("inactive saving").addClass("active");this._originalHeight=this.$el.height();this.model.switchElToEdit(this.$el);this._handleEditingStarted();this.focus()},switchToRead:function(){this._addToolTip();this.$el.addClass("inactive").removeClass("active");this.$el.html(this.model.getViewHtml());this.$el.closest("form").unbind("submit",this.onSubmit);this._returnAccessKeys()},onKeyCancel:function(a){if(a.keyCode===27){this.model.cancelEdit(JIRA.Issues.CANCEL_REASON.escPressed);a.preventDefault()}},onClickCancel:function(a){this.model.cancelEdit();a.preventDefault()},onSubmit:function(b){var a=new jQuery.Event("before-submit");this.$el.find("form").trigger(a);if(!a.isDefaultPrevented()){this.$el.find(":focus").blur();this.issueEventBus.triggerFieldSubmitted();this.model.save();this._returnAccessKeys()}b.preventDefault()},onEdit:function(f){var e=AJS.$(f.target).is(".overlay-icon.icon-edit-sml");var c=AJS.$(f.target).closest("a, .uneditable").length===0&&this.$el.hasClass("inactive");var d=this._getCurrentlySelectedText()===""&&!this._previouslySelectedText;var b=c&&(e||d);if(this._editDelay!==0){clearTimeout(this._editDelay);this._editDelay=0}else{if(b){JIRA.trigger(JIRA.Events.INLINE_EDIT_REQUESTED,[this.model.getId()]);var a=this;if(e){jQuery(document).one("click",function(g){if(!g.isDefaultPrevented()){a.model.edit()}})}else{this._editDelay=setTimeout(function(){if(!f.isDefaultPrevented()&&a.$el.hasClass("inactive")&&a._getCurrentlySelectedText()===""){a.model.edit()}a._editDelay=0},250)}}}},_onPossibleBlur:function(){if(this.model.getSaving()){return}if(jQuery(".aui-blanket").length>0){return}this.model.blurEdit()},_preventBlurByEsc:function(a){a.preventDefault()},_getCurrentlySelectedText:function(){if(jQuery(document.activeElement).is(":input")){return""}if(document.selection&&document.selection.createRange){return document.selection.createRange().text||""}if(window.getSelection){return window.getSelection().toString()}return""},_enterToSubmitSelect:function(a){if(!a.isDefaultPrevented()){if(a.which===13){a.preventDefault();jQuery(a.target).closest("form").submit()}}},_enterToSubmitMultiSelect:function(a){if(!a.isDefaultPrevented()){if(a.which===13){jQuery(a.target).blur()}}},saveSelectedText:function(){this._previouslySelectedText=this._getCurrentlySelectedText()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/editissue/view/ModalIssueFieldView.js' */
Backbone.define("JIRA.Issues.ModalIssueFieldView",JIRA.Issues.BaseView.extend({errorsTemplate:JIRA.Templates.ViewIssue.Fields.modalFieldGeneralErrors,template:JIRA.Templates.ViewIssue.Fields.modalField,initialize:function(a){_.bindAll(this);JIRA.bind("Dialog.hide",this._onHide);this.issueEventBus=a.issueEventBus;this.issueEventBus.bindSaveError(this._showGeneralError);this.model.bindSaveSuccess(this._remove);this.model.bindUpdateRequired(this._updateModel);this.model.bindValidationError(this._showValidationError)},_enable:function(){var b=this._getDialog();b.hideFooterLoadingIndicator();var a=b.$popup;a.find(":input").removeAttr("disabled").trigger("enable");a.find(":input:first").focus().select();a.find(":submit").removeAttr("disabled")},_getDialog:function(){if(!this._dialog){this._dialog=new JIRA.FormDialog({id:"modal-field-view",submitHandler:this._onSubmit,content:_.bind(function(a){a(this.template({field:this.model.toJSON()}))},this)});this._dialog.get$popup().data("field-id",this.model.getId())}return this._dialog},_onHide:function(a,b){if(b===this._getDialog().get$popup()){this._remove()}},_onSubmit:function(c,b){c.preventDefault();this.model.save();b();var a=this._getDialog();a.showFooterLoadingIndicator();a.$popup.find(":input").attr("disabled","disabled").trigger("disable")},_remove:function(b){var a=this._getDialog();if(a.get$popup().is(":visible")){a.hide()}a.destroy();this.model.cancelEdit();JIRA.unbind("Dialog.hide",this._onHide);this.issueEventBus.unbindSaveError(this._showGeneralError);this.model.unbindSaveSuccess(this._remove);this.model.unbindUpdateRequired(this._updateModel);this.model.unbindValidationError(this._showValidationError)},show:function(){this.model.edit();this._getDialog().show()},_showGeneralError:function(f,b,a){this._enable();var d=this._getDialog().$popup;d.find(":submit").attr("disabled","disabled");var g=a&&a.errorCollection;if(g){var c=!_.isEmpty(g.errors),e=!_.isEmpty(g.errorMessages);if(!c&&e){d.find(".form-body").append(this.errorsTemplate({messages:g.errorMessages}))}}},_showValidationError:function(a){this._enable();this._getDialog().$popup.find(".form-body").html(a)},_updateModel:function(){this.model.update(this._getDialog().$popup)}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/pigsty/IssueFieldUtil.js' */
JIRA.Issues.IssueFieldUtil={getFieldSelector:function(a){if(a==="issuetype"){return"#type-val"}else{if(a==="fixVersions"){return"#fixfor-val"}else{if(a==="summary"){return"#summary-val"}else{if(a==="labels"){return"#wrap-labels .value"}else{if(a==="duedate"){return"#due-date"}else{return"#"+a+"-val"}}}}}},matchesFieldSelector:function(a){return jQuery(JIRA.Issues.IssueFieldUtil.getFieldSelector(a)).length===1},transformFieldHtml:function(a){a.fields=_.map(a.fields,function(c){var b=AJS.$("<div />").htmlCatchExceptions(c.editHtml);b.find("legend,label").eq(0).remove();return{id:c.id,label:c.label,editHtml:b.html(),required:c.required,contentId:c.contentId}});return a},getAccessKeyModifier:function(){var b=AJS.$("#home_link_drop").attr("title"),a=/\(([\w\+]+)\+\w\)/i;if(a.test(b)){return a.exec(b)[1]}else{return"Alt"}}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/view/IssuePanelView.js' */
(function(a){Backbone.define("JIRA.Issues.IssuePanelView",JIRA.Issues.BaseView.extend({tagName:"div",template:JIRA.Templates.ViewIssue.Body.issuePanel,initialize:function(b){_.bindAll(this);this.issueEventBus=b.issueEventBus;this.model.bindUpdated(this.applyDomUpdate)},applyDomUpdate:function(d){var c=this.model.applyUpdates(this._renderPanel(),this.$el,d.fieldsSaved,d.fieldsInProgress);if(c){if(c.type==="replace"){var e=document.activeElement;var b=this.$el.find(e).length>0;this.$el.replaceWith(c.$el);if(b){this.issueEventBus.triggerReplacedFocusedPanel()}this.setElement(c.$el)}JIRA.trigger(JIRA.Events.PANEL_REFRESHED,[this.model.id,this.$el,c.$existing]);this.issueEventBus.triggerPanelRendered(this.model.id,this.$el);_.each(c.updates,function(f){JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[f,JIRA.CONTENT_ADDED_REASON.panelRefreshed])})}},render:function(){return this.$el=this._renderPanel()},_renderPanel:function(){var c;var b=this.model.getEntity();c=a(this.template(b));if(b.styleClass){c.addClass(b.styleClass)}return c}}))})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/view/IssueBodyView.js' */
(function(a){Backbone.define("JIRA.Issues.IssueBodyView",JIRA.Issues.BaseView.extend({tagName:"div",className:"issue-body-content",panelLocations:{leftPanels:".issue-main-column",rightPanels:".issue-side-column",infoPanels:".issue-body"},template:JIRA.Templates.ViewIssue.Body.issueBody,initialize:function(){_.bindAll(this);this.model.getPanels().bindPanelRemoved(this.removePanel);this.model.getPanels().bindPanelAdded(this.addPanel);this.model.getIssueEventBus().bindUpdateFromDom(this.updateFromDom)},updateFromDom:function(d){var b=this;this.setElement(d.find(".issue-body-content"));function c(h,f){var g=f.id;if(g==="addcomment"){g="addcommentmodule"}var e=b.model.getPanels().createPlaceholderModel(h,g);if(e){new JIRA.Issues.IssuePanelView({el:f,model:e,issueEventBus:b.model.getIssueEventBus()})}}this.$el.find(this.panelLocations.leftPanels+" .module").each(function(){c("leftPanels",this)});this.$el.find(this.panelLocations.rightPanels+" .module").each(function(){c("rightPanels",this)});this.$el.find(this.panelLocations.infoPanels+". module").each(function(){c("infoPanels",this)})},render:function(){var c=this.model.getPanels();var b=a(this.template());this.$el.html(b);this._renderPanels(c.getLeftPanels(),"leftPanels");this._renderPanels(c.getRightPanels(),"rightPanels");this._renderPanels(c.getInfoPanels(),"infoPanels");return this.$el},removePanel:function(c){var b=this._convertLocation(c.location);this.$(b).find("#"+c.panel.getPanelId()).remove()},addPanel:function(d,f){var e=new JIRA.Issues.IssuePanelView({model:d.panel,issueEventBus:this.model.getIssueEventBus()});var j=this.$(this._convertLocation(d.location));var h=e.render();var c=false;var b=d.index;while(b>0){b--;var g=j.find("#"+f[b].id);if(g.length>0){h.insertAfter(g);c=true;break}}if(!c){h.appendTo(j)}JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[h,JIRA.CONTENT_ADDED_REASON.panelRefreshed])},_convertLocation:function(b){return this.panelLocations[b]},_renderPanels:function(d,c){var b=this;_.each(d,function(e,f){b.addPanel({location:c,panel:e,index:f},d)})}}))})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/view/IssueHeaderView.js' */
Backbone.define("JIRA.Issues.IssueHeaderView",JIRA.Issues.BaseView.extend({className:"issue-header js-stalker",id:"stalker",tagName:"header",template:null,initialize:function(){_.bindAll(this);this.template=this._issueHeaderTemplate();this.model.bindUpdated(this._modelUpdated);this.model.getIssueEventBus().bindUpdateFromDom(this.updateFromDom)},_issueHeaderTemplate:function(){if(AJS.DarkFeatures.isEnabled("com.atlassian.jira.config.PDL")){return JIRA.Templates.ViewIssue.Header.issueHeader}return JIRA.Templates.ViewIssue.Header.legacyIssueHeader},_modelUpdated:function(a){if(a.initialize){this.updateWindowTitle()}else{var b=_.include(a.fieldsInProgress,"summary");if(b){this.renderOpsBar()}else{this.render(a);this.updateWindowTitle()}this.model.getIssueEventBus().triggerPanelRendered("header",this.$el)}},updateFromDom:function(a){this.setElement(a.find("header.issue-header"));this._processCommentButton()},updateWindowTitle:function(){var b=this.$el.find("#key-val").first().text();var a=this.$el.find("#summary-val").first().text();var c=AJS.Meta.get("app-title");if(!c||!a||!b){console.warn("JIRA.Issues.IssueHeaderView: Parsing of title failed")}else{document.title="["+b+"] "+a+" - "+c}},renderOpsBar:function(){this.opsbarView=new JIRA.Issues.IssueOpsbarView({el:this.$el.find(".command-bar"),model:this.model});this.opsbarView.render();JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$el,JIRA.CONTENT_ADDED_REASON.panelRefreshed])},render:function(a){var e=this.$el.find("#issue-comment-add").detach(),a=a||{};if(a.changed){if(a.changed.updated.issue&&_.contains(a.changed.updated.issue,"summary")){this.$el.find("#summary-val").text(this.model.getEntity().summary)}if(!this.opsbarView){this.renderOpsBar()}this.opsbarView.update(a);JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$el,JIRA.CONTENT_ADDED_REASON.panelRefreshed])}else{if(!a.mergeIntoCurrent){var c=this.$el.find("#issue-header-pager").detach();var d=this.template({issue:this.model.getEntity(),hasProjectShortcut:JIRA.Issues.DarkFeatures.PROJECT_SHORTCUTS.enabled()});this.$el.attr("class",this.className).empty().append(d);this.opsbarView=new JIRA.Issues.IssueOpsbarView({el:this.$el.find(".command-bar"),model:this.model});this.opsbarView.render();if(c.length){this.$el.find("#issue-header-pager").replaceWith(c)}var b=this._processCommentButton();if(e.length===1){this.$el.addClass("action").find(".ops-cont").append(e);b.addClass("active")}JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[this.$el,JIRA.CONTENT_ADDED_REASON.panelRefreshed])}}return this.$el},_onAssigneeUpdate:function(){this.model.getIssueEventBus().triggerRefreshIssue()},_processCommentButton:function(){return this.$el.find("#comment-issue").addClass("inline-comment")}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/view/IssueOpsbarView.js' */
(function(a){Backbone.define("JIRA.Issues.IssueOpsbarView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.ViewIssue.Header.opsbar,render:function(){var b=AJS.$(this.template({issue:this.model.getEntity()}));if(this.model.getSplitViewMode()){b.find("#ops-login-lnk").hide()}this.$el.empty().append(b);this._addTipsy();return this.$el},_addTipsy:function(){new JIRA.Issues.Tipsy({el:AJS.$(".viewissue-share",this.$el),showCondition:":not(.active)"});new JIRA.Issues.Tipsy({el:AJS.$("#viewissue-export",this.$el),showCondition:":not(.active)",tipsy:{gravity:"ne"}})},update:function(j){if(j&&j.changed&&(j.changed.added.groups)){var g=this.model.getEntity().operations.linkGroups;var e=null;var d=null;_.each(g,function(n){if("view.issue.opsbar"==n.id){e=n}else{if("jira.issue.tools"==n.id){d=n}}});var c=j.changed.added.groups["view.issue.opsbar"];var i=j.changed.updated.groups["view.issue.opsbar"];var m=j.changed.deleted.groups["view.issue.opsbar"];if(c.length>0||i.length>0||m.length>0){var k=this.$el.find(".toolbar-split-left");if(i.length>0||m.length>0){var h=k.find(".toolbar-group");h.each(function(o,p){p=AJS.$(p);var q=p.attr("id").substr("opsbar-".length);if(_.contains(m,q)){p.remove()}else{if(_.contains(i,q)){var n=_.find(e.groups,function(r){return q===r.id});p.replaceWith(JIRA.Templates.ViewIssue.Header.linkGroup({group:n,parentGroup:e}))}}})}if(c.length>0){var l=this;var b=_.clone(c);_.each(c,function(r){for(var q=0;q<e.groups.length;q++){var p=e.groups[q];if(p.id===r){var u=JIRA.Templates.ViewIssue.Header.linkGroup({group:p,parentGroup:e});if(q===e.groups.length-1){k.append(u)}else{var s=false;for(var o=q+1;o<e.groups.length;o++){var n=e.groups[o];if(!_.contains(b,n.id)){var t=l.$el.find("#opsbar-"+n.id);t.before(u);s=true;break}}if(!s){k.append(u)}}b.splice(0,1);break}}})}}if(j.changed.updated.groups["jira.issue.tools"]){var f=this.$el.find(".toolbar-split-right");f.html(JIRA.Templates.ViewIssue.Header.linkGroup({group:d}))}}}}))})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/view/IssueView.js' */
(function(a){Backbone.define("JIRA.Issues.IssueView",JIRA.Issues.BaseView.extend({mixins:[JIRA.Issues.Mixin.PageTitleView,JIRA.Issues.Mixin.LoadingClass],ISSUE_ACTION_SELECTOR:"a[class*='issueaction-'], .toggle-title",initialize:function(){var b=this;_.bindAll(this);a(document).delegate(this.ISSUE_ACTION_SELECTOR,"click",this._handleActionClicked);this.model.getIssueEventBus().bindUpdateStatusColor(this.updateStatusClass);this.model.getIssueEventBus().bindDismiss(this.destroy);this.model.getIssueEventBus().bindUpdateFromDom(this.updateFromDom);this.model.getIssueEventBus().bindRefreshIssue(this.addLoadingClass);this.model.getIssueEventBus().bindIssueRefreshed(this.removeLoadingClass);this.model.bindUpdated(this._handleUpdated);this.body=new JIRA.Issues.IssueBodyView({model:this.model});this.pager=new JIRA.Issues.IssuePagerView({model:this.model.getIssuePagerModel()});this.header=new JIRA.Issues.IssueHeaderView({model:this.model})},_handleUpdated:function(b){var c=b.reason;if(b.initialize){this.render()}else{if(c&&c.action===JIRA.Issues.Actions.EDIT_COMMENT){this.focusComment(c.meta.commentId)}}},_handleActionClicked:function(){this.model.getIssueEventBus().trigger("save")},focusComment:function(b){this.$("#activitymodule .focused").removeClass("focused");this.$("#comment-"+b).addClass("focused");this.$(".js-stalker").trigger("refresh")},renderPager:function(){this.pager.setElement(this.$("#issue-header-pager")).render()},updateFromDom:function(b){this.setElement(b);this.renderPager();this.$form=this.$el},destroy:function(){this.undelegateEvents();this.pager.destroy();a(document).undelegate(this.ISSUE_ACTION_SELECTOR,"click",this._handleActionClicked)},render:function(){AJS.log("IssueView: Render started for issue ["+this.model.getEntity().key+"]");this.$el.empty();this.$form=a("<div />").attr({id:"issue-content"}).addClass("issue-edit-form").appendTo(this.$el);this.updateStatusClass();this.$el.attr("tabindex","-1");this.$form.prepend(this.header.render());this.$form.append(this.body.render());var c={id:this.model.getId()};if(this.isVisible()){JIRA.trace("jira.psycho.issue.refreshed",c)}var b=this.$form;JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[b,JIRA.CONTENT_ADDED_REASON.pageLoad]);this.renderPager();return this.$el},updateStatusClass:function(){this.$el.attr("class","issue-container "+this.model.getStatusClass())},isVisible:function(){return this.$el.closest("body").length>0}}))})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/view/IssuePagerView.js' */
(function(a){Backbone.define("JIRA.Issues.IssuePagerView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.ViewIssue.Header.pager,events:{"simpleClick .ajax #next-issue":"_onPagerClick","simpleClick .ajax #previous-issue":"_onPagerClick","simpleClick .ajax #return-to-search":"_onReturnToSearchClick"},namedEvents:["issueRequested","returnToSearch"],initialize:function(){this.model.bind("change:pager",this.render,this)},destroy:function(){this.model.unbind("change:pager",this.render)},render:function(){var b=this.model.getPager();if(b){var c=this.template(_.extend({},b,{returnToSearch:!b.isSplitView}));this.$el.html(c)}if(AJS.activeShortcuts){AJS.activeShortcuts.j&&AJS.activeShortcuts.j._addShortcutTitle(this.$el.find("#next-issue"));AJS.activeShortcuts.k&&AJS.activeShortcuts.k._addShortcutTitle(this.$el.find("#previous-issue"));AJS.activeShortcuts.u&&AJS.activeShortcuts.u._addShortcutTitle(this.$el.find("#return-to-search"))}},_onPagerClick:function(c){if(!JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()){JIRA.Issues.Analytics._loadIssueReason="click-pager";c.preventDefault();var b=AJS.$(c.target).closest("a");if(b.is("#next-issue")){JIRA.Issues.Api.nextIssue()}else{JIRA.Issues.Api.prevIssue()}}},_onReturnToSearchClick:function(b){if(!JIRA.Issues.DarkFeatures.KILL_SWITCH.enabled()){b.preventDefault();this.model.triggerReturnToSearch();jQuery("body").focus()}}}))})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:viewissue', location = 'content/js/viewissue/view/IssueMissingErrorView.js' */
(function(){Backbone.define("JIRA.Issues.IssueMissingErrorView",JIRA.Issues.BaseView.extend({template:JIRA.Templates.ViewIssue.Body.viewIssueDoesNotExistError,events:{"simpleClick #return-to-search":"_onReturnToSearchClick"},render:function(){var b=(JIRA.Issues.LayoutPreferenceManager.getPreferredLayoutKey()==="split-view");var a=this.template({pager:this.options.pager,hideReturnToSearch:b});this.$el.html(a)},_onReturnToSearchClick:function(a){a.preventDefault();this.options.searchPageModule.returnToSearch()}}))})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav', location = 'content/templates/issuenav.soy' */
// This file was automatically generated from issuenav.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.IssueNav == 'undefined') { JIRA.Templates.IssueNav = {}; }


JIRA.Templates.IssueNav.issueTable = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<thead><tr></tr></thead><tbody></tbody>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.columnHeader_issuetype = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<th class="issue-type issue-icon-result persist-result"><div>', soy.$$escapeHtml("\u7c7b\u578b"), '</div></th>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.column_issuetype = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="issue-type issue-icon-result persist-result"><img src="', soy.$$escapeHtml(opt_data.issue.fields.issuetype.iconUrl), '" alt="', soy.$$escapeHtml(opt_data.issue.fields.issuetype.name), '" title="', soy.$$escapeHtml(opt_data.issue.fields.issuetype.description), '" align="absmiddle" border="0" height="16" width="16"></td>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.columnHeader_keysummary = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<th class="issue-key persist-result"><div>', soy.$$escapeHtml("Key"), '</div></th><th class="issue-summary issue-text-result persist-result"><div>', soy.$$escapeHtml("\u4e3b\u9898"), '</div></th>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.column_keysummary = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="issue-key-summary issue-text-result persist-result" colspan="2"><div><a href="', soy.$$escapeHtml(opt_data.contextPath), '/browse/', soy.$$escapeHtml(opt_data.issue.key), '" class="issue"><span class="secondary-text">', soy.$$escapeHtml(opt_data.issue.key), '</span>', soy.$$escapeHtml(opt_data.issue.fields.summary), '</a></div></td>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.columnHeader_status = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<th class="issue-status"><div>', soy.$$escapeHtml("\u72b6\u6001"), '</div></th>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.column_status = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="issue-status"><div class="status-lozenge">', soy.$$escapeHtml(opt_data.issue.fields.status.name), '</div></td>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.columnHeader_assignee = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<th class="issue-user"><div>', soy.$$escapeHtml("\u7ecf\u529e\u4eba"), '</div></th>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.column_assignee = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="issue-user">', (opt_data.issue.fields.assignee) ? '<img src="' + soy.$$escapeHtml(opt_data.issue.fields.assignee.avatarUrls['16x16']) + '" alt="' + soy.$$escapeHtml(opt_data.issue.fields.assignee.name) + '" height="16" width="16" /><a class="user-hover" rel="' + soy.$$escapeHtml(opt_data.issue.fields.assignee.name) + '" href="#">' + soy.$$escapeHtml(opt_data.issue.fields.assignee.displayName) + '</a>' : soy.$$escapeHtml("\u672a\u5206\u914d"), '</td>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.columnHeader_updated = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<th class="issue-datetime"><div>', soy.$$escapeHtml("\u66f4\u65b0\u65e5\u671f"), '</div></th>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.column_updated = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="issue-datetime"><time datetime="', soy.$$escapeHtml(opt_data.issue.fields.updated), '">', soy.$$escapeHtml(opt_data.TMP_FORMATTED_DATE), '</time></td>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.columnHeader_resolution = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<th class="issue-resolution"><div>', soy.$$escapeHtml("\u89e3\u51b3\u7ed3\u679c"), '</div></th>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.column_resolution = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<td class="issue-resolution">', (opt_data.issue.fields.resolution) ? soy.$$escapeHtml(opt_data.issue.fields.resolution.name) : soy.$$escapeHtml("\u672a\u89e3\u51b3"), '</td>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.IssueNav.issueResultsError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<tr class="error"><td colspan="', soy.$$escapeHtml(opt_data.columnCount), '">', soy.$$escapeHtml(opt_data.errorText), '</td></tr>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav', location = 'content/js/search/SplitModel.js' */
AJS.namespace("JIRA.Issues.SplitModel");JIRA.Issues.SplitModel=JIRA.Issues.BaseModel.extend({DETAILED_MODE:"detailed",properties:["displayMode","realDisplayMode"],namedEvents:["switchedToDetailMode","selectedInDetailedMode","detailedModeDismissed","backToSearch"],initialize:function(c,b){_.bindAll();this.issueSelectionModel=b.issueSelectionModel;var a=this;this.issueSelectionModel.bindIssueSelected(function(e,d){if(a.getRealDisplayMode()===a.DETAILED_MODE){a.triggerSelectedInDetailedMode(e,d.data)}});this.bind("change:realDisplayMode",function(){if(this.previous("realDisplayMode")===this.DETAILED_MODE){this.triggerDetailedModeDismissed()}})},backToSearch:function(){this.set({displayMode:undefined,realDisplayMode:undefined});this.triggerBackToSearch();JIRA.Issues.Analytics.trigger("kickass.returntosearch")},okToSwitchToDetailMode:function(){if(this.getDisplayMode()===this.DETAILED_MODE){this.switchToDetailedView()}},switchToDetailedView:function(b,a){var c;if(b!=null){c=this.issueSelectionModel.getIssueCollection().get(b);this.issueSelectionModel.selectIssue(c,{mode:this.DETAILED_MODE,data:a})}else{c=this.issueSelectionModel.getRealSelectedIssue()}if(c){if(c==this.issueSelectionModel.getRealSelectedIssue()){if(this.getRealDisplayMode()!==this.DETAILED_MODE){this.setDisplayMode(this.DETAILED_MODE);this.setRealDisplayMode(this.DETAILED_MODE);this.triggerSwitchedToDetailMode(c);this.triggerSelectedInDetailedMode(c,a)}}}}});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav', location = 'content/js/search/Notifications.js' */
JIRA.Issues.showNotification=function(){var a={thanks_issue_updated:"{0} \u5DF2\u7ECF\u88AB\u66F4\u65B0\u3002",thanks_issue_transitioned:"{0} \u5DF2\u7ECF\u88AB\u66F4\u65B0\u3002",thanks_issue_assigned:"{0} \u5DF2\u7ECF\u88AB\u5206\u914D\u3002",thanks_issue_commented:"{0} \u5728\u4F60\u7684\u5907\u6CE8\u57FA\u7840\u4E0A\u5DF2\u7ECF\u88AB\u66F4\u65B0\u3002",thanks_issue_worklogged:"{0}\u5DF2\u7ECF\u88AB\u6DFB\u52A0\u5DE5\u4F5C\u65E5\u5FD7\u3002",thanks_issue_voted:"\u4F60\u6295\u7968\u7684 {0} \u5DF2\u7ECF\u88AB\u66F4\u65B0\u3002",thanks_issue_watched:"\u4F60\u5173\u6CE8\u7684 {0}\u7684\u72B6\u6001\u5DF2\u7ECF\u88AB\u66F4\u65B0\u3002",thanks_issue_moved:"{0} \u5DF2\u7ECF\u88AB\u79FB\u52A8\u3002",thanks_issue_linked:"{0} \u7684\u94FE\u63A5\u5DF2\u7ECF\u88AB\u66F4\u65B0\u3002",thanks_issue_cloned:"{0} \u5DF2\u7ECF\u88AB\u590D\u5236\u3002",thanks_issue_labelled:"{0} \u7684\u6807\u7B7E\u5DF2\u7ECF\u88AB\u66F4\u65B0\u3002",thanks_issue_deleted:"{0} \u5DF2\u7ECF\u88AB\u66F4\u65B0\u3002",thanks_issue_attached:"\u8FD9\u4E9B\u6587\u4EF6\u5DF2\u7ECF\u88AB\u4E0A\u4F20\u5230 {0}\u3002"};return function(c,b){var d;if(!c){c="thanks_issue_updated"}d=a[c];if(d&&b){d=AJS.format(d,b)}JIRA.Messages.showSuccessMsg(d||c,{closeable:true})}}();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav', location = 'content/js/search/IssueNavView.js' */
Backbone.define("JIRA.Issues.IssueNavView",JIRA.Issues.BaseView.extend({threshold:100,mixins:[JIRA.Issues.Mixin.PageTitleView],initialize:function(){_.bindAll(this);this.model.issueSelectionModel.bindIssueSelected(this.checkMode);this.model.splitModel.bind("change:realDisplayMode",this.checkMode);this.model.splitModel.bindSwitchedToDetailMode(this.checkMode);this.model.splitModel.bindBackToSearch(this.checkMode);this.model.splitModel.bindBackToSearch(this._restoreTitle);this.end=AJS.$(document).scrollHeight;AJS.$(document).bind("scroll",this.onWindowScroll)},checkMode:function(){var a=this.model.issueSelectionModel.get("selectedIssue");if(a){if(this.model.splitModel.getRealDisplayMode()===this.model.splitModel.DETAILED_MODE){this.viewIssueMode()}else{this.searchMode()}}},viewIssueMode:function(){this.$el.addClass("navigator-collapsed");this.$el.find(".issue-container").empty();AJS.$(document).unbind("scroll",this.onWindowScroll);this.$el.find(".navigator-content").unbind("scroll",this.onDomScroll).bind("scroll",this.onDomScroll)},searchMode:function(){this.$el.removeClass("navigator-collapsed");this.$el.find(".navigator-group");this.$el.find(".issue-container").empty();AJS.$(document).unbind("scroll",this.onDomScroll).bind("scroll",this.onDomScroll)},onDomScroll:function(g){var b=AJS.$(g.target),f=b.scrollTop(),a=b.height(),c=b.attr("scrollHeight"),h=c-f-a;if(h<this.threshold){this.model.appendMoreResults()}},onWindowScroll:function(f){var c=window.scrollY,b=window.innerHeight,a=this.$el.position().top+this.$el.height(),g=a-c-b;if(g<this.threshold){this.model.appendMoreResults()}},_restoreTitle:function(){this.restorePreviousPageTitle()}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav', location = 'content/js/search/IssueNavRouter.js' */
Backbone.define("JIRA.Issues.IssueNavRouter",JIRA.Issues.BaseRouter.extend({initialize:function(a){_.extend(this,a);_.bindAll(this)},routes:{"":"_restoreSessionSearch","issues/":"_restoreSessionSearch","*fragment":"_route"},navigate:function(){this.searchPageModule.removeOpenTipsies();this.trigger("navigate");JIRA.Issues.BaseRouter.prototype.navigate.apply(this,arguments)},pushState:function(a){this._setStatePermalink(a);this.navigate(JIRA.Issues.URLSerializer.getURLFromState(a),{trigger:false})},replaceState:function(a){this._setStatePermalink(a);this.navigate(JIRA.Issues.URLSerializer.getURLFromState(a),{trigger:false,replace:true})},_validateNav:function(a){return a!==Backbone.history.getFragment()},_restoreSessionSearch:function(){var b=this.initialSessionSearchState,a=JIRA.Issues.URLSerializer.getURLFromState(b||this.searchPageModule.getState());this.navigate(a,{replace:true,trigger:true})},_route:function(a){if(JIRA.Issues.ignorePopState){return}var b=JIRA.Issues.URLSerializer.getStateFromURL(a);if(!this._navigateToLoginIfNeeded(b)){this._navigateUsingState(b)}},_navigateToLoginIfNeeded:function(c,d){if(!JIRA.Issues.IssueNavRouter.usePushState(d)&&c.selectedIssueKey&&!JIRA.Issues.LoginUtils.isLoggedIn()){var a=this;var b={};if(c.filter!=null){b.filterId=c.filter}jQuery.ajax({url:AJS.contextPath()+"/rest/issueNav/1/issueNav/anonymousAccess/"+c.selectedIssueKey,headers:{"X-SITEMESH-OFF":true},data:b,success:function(){a._navigateUsingState(c)},error:function(e){if(e.status===401){a._redirectToLogin(c)}else{a._navigateUsingState(c)}}});return true}return false},_navigateUsingState:function(a){this._setStatePermalink(a);this.navigate(JIRA.Issues.URLSerializer.getURLFromState(a),{replace:true,trigger:false});this.searchPageModule.updateFromRouter(a)},_redirectToLogin:function(b){var a=AJS.contextPath()+"/login.jsp?permissionViolation=true&os_destination="+encodeURIComponent(JIRA.Issues.URLSerializer.getURLFromState(b));window.location.replace(a)},_getQueryMap:function(b){var a={};var c=b.indexOf("?");if(c!==-1){var d=b&&b.substring(c+1)||"";a=JIRA.Issues.QueryStringParser.parse(d)}return a},_updateUrl:function(){var a=this.searchPageModule.getState();this._setStatePermalink(a);this.navigate(JIRA.Issues.URLSerializer.getURLFromState(a))},navigateBySearchPageModule:function(b,c){var a=c?_.pick(c,"replace"):{};this.navigate(this._getViewIssueFragmentWithSearchContext(b,c),a)},_getViewIssueFragmentWithSearchContext:function(a,b){if(a.standalone){return"browse/"+b.key}else{return JIRA.Issues.URLSerializer.getURLFromState(_.extend(a.getState(),{startIndex:undefined}))}},_setStatePermalink:function(d){var b=_.pick(d,"selectedIssueKey");var c=AJS.Meta.get("jira-base-url");if(!_.isEmpty(b)){AJS.Meta.set("viewissue-permlink",c+"/"+JIRA.Issues.URLSerializer.getURLFromState(b))}var a=_.omit(d,"selectedIssueKey");if(!_.isEmpty(a)){AJS.Meta.set("issuenav-permlink",c+"/"+JIRA.Issues.URLSerializer.getURLFromState(a))}}},{getBackboneRoot:function(a){return AJS.contextPath()+(this.usePushState(a)?"/":"/i")},usePushState:function(c){var a=(c=c||window.history)&&c.pushState,b=AJS.DarkFeatures.isEnabled("ka.I_ROOT");return a&&!b}}));
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav', location = 'content/js/search/util/HandlePushStateInIE.js' */
JIRA.Issues.hashTheUrl=function(b){var d=parseUri(b);var a={changed:false,uri:d};if(d.anchor===""&&d.query!==""){var c=d.protocol+"://"+d.authority+d.path;a.uri=c+"#?"+d.query;a.changed=true}return a};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav', location = 'content/js/search/util/DialogCleanup.js' */
JIRA.Issues.dialogCleaner=function(a){a.on("navigate",function(){if(JIRA.Dialog.current){JIRA.Dialog.current.hide()}})};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:issuenav', location = 'content/js/search/IssueNavCreator.js' */
JIRA.Issues.IssueNavCreator=function(){};JIRA.Issues.IssueNavCreator.prototype={create:function(s,c){JIRA.Events.LAYOUT_RENDERED="layoutRendered";JIRA.Issues.IssueNavCreated=new Date();var p=this.searchPageModule=new JIRA.Issues.SearchPageModule();p.registerViewContainers({issueContainer:jQuery(".issue-container"),searchContainer:jQuery(".navigator-container")});var f=new JIRA.Issues.ToolPreferencesModel();var q=this.searchHeaderModule=new JIRA.Issues.SearchHeaderModule({searchPageModule:p,toolPreferencesModel:f});var a=q.createView({searchHeaderEl:s.find("#search-header-view")});var o=new JIRA.Issues.FilterModule({searchPageModule:p,systemFilters:p.addOwnerToSystemFilters(c.systemFilters)});o.createView({$filterPanelEl:s.find(".navigator-sidebar")});var d=new JIRA.Issues.QueryModule({primaryClauses:this.primaryClauses(),preferredSearchMode:AJS.Meta.get("user.search.mode"),searchPageModule:p,initialSearcherCollectionState:c.initialSearcherCollectionState});d.createAndRenderView(s.find("form.navigator-search"));var i=this.saveInProgressManager=new JIRA.Issues.SaveInProgressManager();var b=new JIRA.Issues.ViewIssueData();var g=new JIRA.Issues.IssueModule({container:jQuery("#issue-content"),searchPageModule:p,saveInProgressManager:i,viewIssueData:b});var h=new JIRA.Issues.IssueSearchManager({initialIssueTableState:c.initialIssueTableState,initialIssueIds:c.initialIssueIds});var r=new JIRA.Issues.SearchModule({searchPageModule:p,queryModule:d,issueSearchManager:h,initialHighlightedIssueId:c.initialHighlightedIssueId,initialSelectedIssue:c.initialSelectedIssue});var e=new JIRA.Issues.Cache.IssueCacheManager({searchResults:r.getResults(),viewIssueData:b});var m=s.find(".saved-search-selector");var l=new JIRA.Issues.FullScreenIssue({issueModule:g,issueContainer:p.issueContainer,searchContainer:p.searchContainer,issueCacheManager:e});p.registerSearch(r);p.registerSearchHeaderModule(q);p.registerFilterModule(o);p.registerQueryModule(d);p.registerIssueModule(g);p.registerToolPreferencesModel(f);p.registerFullScreenIssue(l);p.registerIssueSearchManager(h);p.registerIssueCacheManager(e);a.render();q.registerSearch(r);q.createToolsView(m);var n=this.issueNavRouter=new JIRA.Issues.IssueNavRouter({searchPageModule:p,initialSessionSearchState:c.initialSessionSearchState});p.registerIssueNavRouter(n);JIRA.Issues.enhanceLinks.toIssueNav({searchPageModule:p});JIRA.Issues.enhanceLinks.withPushState({router:n});JIRA.Issues.enhanceLinks.toIssue({searchPageModule:p,issueModule:g});JIRA.Issues.enhanceLinks.transformToAjax({issueModule:g});JIRA.Issues.dialogCleaner(n);JIRA.Issues.overrideIssueDialogs({getIssueId:p.getEffectiveIssueId,isNavigator:true,updateIssue:function(t){var u=JIRA.Issues.Utils.getUpdateCommandForDialog(t);return p.updateIssue(u)}});var j=AJS.$("#quicksearch-message");if(j.length){var k=JIRA.Messages.showWarningMsg(j.find("p").html(),{closeable:true});AJS.$("a",k).click(function(){k.remove()})}jQuery(document).keydown(function(v){var x=jQuery("div.aui-blanket").length>0,t=(v.which===AJS.$.ui.keyCode.ENTER||v.which===AJS.$.ui.keyCode.LEFT||v.which===AJS.$.ui.keyCode.UP||v.which===AJS.$.ui.keyCode.RIGHT||v.which===AJS.$.ui.keyCode.DOWN);if(!x&&t){var u=AJS.$(v.target),w=u.is(":not(:input)");if(u==undefined||w){if(v.which===AJS.$.ui.keyCode.ENTER){if(u==undefined||u.is(":not(a)")){JIRA.Issues.Api.viewSelectedIssue()}}else{if(v.which===AJS.$.ui.keyCode.LEFT){p.handleLeft()}else{if(v.which===AJS.$.ui.keyCode.RIGHT){p.handleRight()}else{if(v.which===AJS.$.ui.keyCode.UP){if(p.handleUp()){v.preventDefault()}}else{if(v.which===AJS.$.ui.keyCode.DOWN){if(p.handleDown()){v.preventDefault()}}}}}}}}});this._autoUpdateLoginLinks(r.getResults());return this},primaryClauses:function(){return[{id:"project",name:"Project"},{id:"issuetype",name:"Type"},{id:"status",name:"Status"},{id:"assignee",name:"Assignee"}]},_autoUpdateLoginLinks:function(a){this.searchResults=a;this.searchPageModule.on("change",this._changeLoginUrl,this);a.on("change",this._changeLoginUrl,this);a.getSelectedIssue().on("change",this._changeLoginUrl,this)},_changeLoginUrl:function(){var a=JIRA.Issues.LoginUtils.redirectUrlToCurrent();jQuery(".login-link").attr("href",a);if(!JIRA.Issues.LoginUtils.isLoggedIn()){jQuery("#header-details-user > a.lnk").attr("href",a)}}};
/* module-key = 'com.atlassian.jira.gadgets:searchrequestview-charts', location = 'script/chartpopup/popupuserprefstore.js' */
/**
 * @fileoverview Implements the gadgets.UserPrefStore interface storing data in a javascript store.
 */
jQuery.namespace("jira.plugin.chartingstore", true);

jira.plugin.chartingstore = function() {
    var userPrefMap = {};
    return {
        get: function (gadgetId) {
            var userPrefs = userPrefMap[gadgetId];
            if(!userPrefs) {
                return {};
            }
            return userPrefs;
        },
        set: function (gadgetId, name, value) {
            var prefs = this.get(gadgetId);
            prefs[name] = value;
            userPrefMap[gadgetId] = prefs;
        },
        clear: function() {
            userPrefMap = {};
        }
    };
}();

gadgets.IfrGadgetService.prototype.setUserPref = function(editToken, name, value) {
    var gadgetId = this.f;
    if(gadgetId) {
        gadgetId = gadgetId.substr("gadget-".length);
    }
    jira.plugin.chartingstore.set(gadgetId, name, value);
};

/* module-key = 'com.atlassian.jira.gadgets:searchrequestview-charts', location = 'script/chartpopup/chartdialog.js' */
/**
 * @module jira.plugin.charting
 * @author Scott Harwood
 * @since 4.0
 * @requires jQuery > v1.6, jQuery.aop
 */

 /*JSLINT options*/
 /*jslint white: true, browser: true, onevar: true, plusplus: true, regexp: true, eqeqeq: true */
 /*global window, document, jQuery, dhtmlHistory, jira*/

jQuery.namespace("jira.plugin.charting");

// singleton
jira.plugin.charting = function () {
    var dialog, /* {Object} jquery object */
    DIALOG_ID = "charts-dialog",
    CHARTS_CATEGORY = "Charts",
    CHART_HEIGHT = 522,
    saveFormLoaded = false,
    idToUriMap = {},
    dialogThrobber = AJS.$('<span class="icon throbber"></span>'),

    getPostData = function(formData) {
        var postData = {};
        jQuery.each(formData, function(i, field) {
            postData[field.name] = field.value;
        });
        var filterId = getFilterId();
        if(filterId) {
            postData.filterId = filterId;
        } else {
            postData.jql = getFilterJql() || "";
        }
        var chartPanelId = dialog.getPage(0).curtab;
        postData.gadgetUri = idToUriMap[chartPanelId];
        var userPrefs = jira.plugin.chartingstore.get(chartPanelId);
        if(userPrefs) {
            var prefsMap = {};
            for (var key in userPrefs) {
                prefsMap[key] = userPrefs[key];
            }
            postData.userPrefs = prefsMap;
        }

        return postData;
    },

    loadSaveToDashboardForm = function() {
        if(!saveFormLoaded) {
            var saveFormUrl = contextPath + "/rest/gadget/1.0/chart/add";
            var filterId = getFilterId();
            if(filterId) {
                saveFormUrl = saveFormUrl + "?filterId=" + encodeURIComponent(filterId);
            } else {
                saveFormUrl = saveFormUrl + "?jql=" + encodeURIComponent(getFilterJql());
            }

            var saveFormPanel = jQuery("#saveToDashboardPanel");
            saveFormPanel.empty();
            jQuery.ajax({
                url: saveFormUrl,
                success: function(data) {
                    saveFormPanel.html(data);
                    saveFormLoaded = true;
                    var chartForm = saveFormPanel.find("form#savetodashboardform");
                    var saveButton = saveFormPanel.find("#save-btn1");
                    chartForm.submit(function(e) {
                        e.preventDefault();
                        chartForm.find(".error").remove();
                        chartForm.find(".form-errors p").remove();
                        chartForm.find(".form-errors").hide();
                        saveButton.attr("disabled", "true");

                        var postData = getPostData(chartForm.serializeArray());
                        jQuery.ajax({
                            url: chartForm.attr("action"),
                            contentType:'application/json',
                            dataType: "text",
                            data: JSON.stringify(postData),
                            type:'POST',
                            success: function (data) {
                                chartForm.trigger("fakesubmit");
                                saveButton.removeAttr("disabled", "false");
                                window.location = data;
                            },
                            error: function(XMLHttpRequest, textStatus, errorThrown) {
                                saveButton.removeAttr("disabled", "false");
                                if(XMLHttpRequest.status === 400) {
                                    var errorCollection = eval("(" + XMLHttpRequest.responseText + ")");
                                    if(errorCollection.generic.length > 0) {
                                        jQuery(errorCollection.generic).each(function(i, item) {
                                        chartForm.find(".form-errors").append("<p>" + item + "</p>");
                                        });
                                        chartForm.find(".form-errors").show();
                                    }
                                    if(errorCollection.fields.length > 0) {
                                        jQuery(errorCollection.fields).each(function(i, item) {
                                            chartForm.find("#" + item.field).after("<div class=\"error\">" + item.error + "</div>");
                                        });
                                    }
                                }
                            }
                        });

                    });
                    saveFormPanel.find("#cancel-btn1").click(function(e) {
                        dialog.prevPage();
                        saveButton.removeAttr("disabled", "false");
                        chartForm.find(".form-errors").hide();
                        chartForm.find(".error").remove();
                        e.preventDefault();
                    });
                }
            });
        }
    },

    /**
     * Appends loading indicator (throbber) to all ajax requests. Indicator, controlled via css, appears in the top
     * right corner of the dialog.
     *
     * @method addThrobber
     * @private
     */
    addThrobber = function () {
        dialog.popup.element.find(".dialog-button-panel").prepend(dialogThrobber);
        jQuery().ajaxSend(function(a,xhr) {
            if (dialog.popup.element.is(":visible")) {
                jQuery(xhr).throbber({target: dialogThrobber});
            }
        });
    },

    /**
     * Handles failed ajax requests. Will subsitute the page body with the 500 error that occured.
     *
     * @method addErrorHandler
     * @private
     */
    addErrorHandler = function () {
        jQuery().ajaxError(function(e,XMLHttpRequest,ajaxOptions){
            if (XMLHttpRequest.status == 500) {
                dialog.hide();
                jQuery("body").html(XMLHttpRequest.responseText);
            }
        });
    },

    /**
     * ESC hides the dialog
     */
    keypressListener = function(e) {       
        if (e.keyCode === 27) {
            dialog.hide();
        }
    },

    /**
     * Creates dialog box. Adds global functionality including error handling and ajax throbber indicator.
     *
     * @method createDialog
     * @private
     * @param {String, Number} width - width of dialog box
     * @param {String, Number} height - height of dialog box
     */
    createDialog = function (width, height, data) {
        dialog = new AJS.Dialog(width, height, DIALOG_ID);
        dialog.addHeader("\u5C0F\u5DE5\u5177");
        resetPanels(data);
        dialog.addButton("\u4FDD\u5B58\u5230\u9762\u677F",
                function(dialog) {
                    loadSaveToDashboardForm();
                    dialog.nextPage();
                },
                "save-to-dashboard");
        dialog.addCancel("\u53D6\u6D88", function(dialog) {
            dialog.hide();
        });
        dialog.addPage();
        dialog.page[1].addPanel("saveToDashBoard", "<div id=\"saveToDashboardPanel\"</div>");
        dialog.page[1].addHeader("\u4FDD\u5B58\u5230\u9762\u677F");
        addThrobber();
        addErrorHandler();
        AJS.$(document).keydown(keypressListener);
    },

    /**
     * Resets the dialog to the original state when it pops up.
     *
     * @method resetDialog
     * @param {Number} initialPanel - the panel index to go to after resetting the dialog
     * @private
     */
    resetDialog = function(initialPanel) {
        if(dialog) {
            saveFormLoaded = false;
            jQuery("form[name=chartpopup]").show();
            jQuery("input[name=filterName]").val("");
            dialog.gotoPage(0);
            for(var i = 0; dialog.getPanel(i); i++) {
                var panel = dialog.getPanel(i);
                panel.loaded = false;
            }
            dialog.gotoPanel(initialPanel);
        }
    },

    /**
     * Given a directory JSON object this method figures out all the chart gadgets to display in the popup.
     *
     * @method createDialog
     * @private
     * @param {json} data -
     */
    loadChartGadgets = function(data) {
        // Fill items on the right
        var chartGadgets = [], filterResultsGadget, uri = parseUri(window.location);
        var baseUrl = uri.protocol + "://" + uri.authority;
        jQuery(data.gadgets).each(function(i, gadget) {
            //JRADEV-4419: Only add gadgets that are hosted locally to the dialog!
            if(gadget.gadgetSpecUri.indexOf("http") !== 0 || gadget.gadgetSpecUri.indexOf(baseUrl) === 0) {
                jQuery([gadget.categories]).each(function(i, catKey) {
                    var g = {title:gadget.title, specUri:gadget.gadgetSpecUri};
                    // we want to stick the Filter Results gadget at the front of the list of gadgets, so keep a reference to it
                    if (g.specUri.indexOf("filter-results") > -1) {
                        filterResultsGadget = g;
                    }
                    if(catKey.constructor==Array) { // if there are multiple categories for this gadget, loop through all of them
                        for(var j=0; j<catKey.length; ++j) {
                            // don't add the Filter Results gadget to the array - we'll do it later
                            if(catKey[j] === CHARTS_CATEGORY && filterResultsGadget != g) {
                                chartGadgets.push(g);
                            }
                        }
                    }
                    else {
                        // don't add the Filter Results gadget to the array - we'll do it later
                        if(catKey === CHARTS_CATEGORY && filterResultsGadget != g) {
                            chartGadgets.push(g);
                        }
                    }
                });
            }
        });

        chartGadgets.sort(function(one, two) { return (one.title > two.title ? 1 : -1); });
        // add the Filter Results gadget to the start
        if (filterResultsGadget) {
            chartGadgets.unshift(filterResultsGadget);
        }
        return chartGadgets;
    },

    /**
     * Renders the contents of a particular panel for a particular chart.
     *
     * @method renderPanelContents
     * @private
     * @param {Object} panel - the panel to render
     * @param {Object} data - json object with the directory contents
     */
    renderPanelContents = function(panel, data) {
        panel.body.html(data);
        panel.loaded = true;
    },

    /**
     * Sets up all the panels when the dialog loads
     *
     * @method resetPanels
     * @private
     * @param {Object} data - json object of the directory contents
     */
    resetPanels = function(data) {
        var chartGadgets = loadChartGadgets(data);
        dialog.gotoPage(0);
        jQuery(chartGadgets).each(function(i, gadget) {
            dialog.page[0].addPanel(gadget.title, "<div class=\"loadingPanel\">&nbsp;</div>");
            var panel = dialog.getPanel(i);
            if(panel) {
                panel.loaded = false;
                idToUriMap[i] = gadget.specUri;
                panel.body.show = function (panel, show) {
                    return function() {
                        if(!panel.loaded) {
                            var rendererUrl = contextPath + "/rest/gadget/1.0/chart/render?id=" + i + "&gadgetUri=" + encodeURIComponent(gadget.specUri);
                            var filterId = getFilterId();
                            if(filterId) {
                                rendererUrl = rendererUrl + "&filterId=" + encodeURIComponent(filterId);
                            } else {
                                rendererUrl = rendererUrl + "&jql=" + encodeURIComponent(getFilterJql());
                            }

                            jQuery.ajax({
                                url: rendererUrl,
                                success: function(data) {
                                    renderPanelContents(panel, data);
                                }
                            });
                        }
                        show.call(panel.body);
                    };
                }(panel, panel.body.show);
            }
        });
    },

    /**
     * Creates a new dialog (if necessary and displays it)
     *
     * @method launchDialog
     * @private
     * @param {String} url - the url to get the direcotry JSON object from
     * @param {String, Number} width - width of dialog box
     * @param {String, Number} height - height of dialog box
     * @param {String, Number} initialPanel - the first panel to load
     */
    launchDialog = function (url, width, height, initialPanel) {
        if(dialog) {
            //this ensures that all the panels will get loaded from the server again.
            resetDialog(initialPanel);
            dialog.show();
        } else {
            jQuery(jQuery.ajax({
                url: url,
                dataType: 'json',
                success: function (data) {
                    if (!dialog) {
                        createDialog(width, height, data);
                    }
                    dialog.show();
                    dialog.gotoPage(0);
                    dialog.gotoPanel(initialPanel);
                }
            })).throbber({target: jQuery("#throbber-space")});
        }
    },

    getFilterId = function()
    {
        var filterId = AJS.Meta.get('filter-id');

        if (filterId && filterId >= 0) {
            return filterId;
        }

        return null;
    },

    getFilterJql = function()
    {
        return AJS.Meta.get('filter-jql');
    };

    return function () {
        // if they clicked on Charts we default to the first chart i.e. Panel 1
        jQuery("body").delegate("#charts", "click", function(e) {
            AJS.populateParameters();
            launchDialog(contextPath + "/rest/config/1.0/directory.json", 800, CHART_HEIGHT, 1);
            e.preventDefault();
        });
        // if they clicked on On Dashboard we default to the Filter Results gadget i.e. Panel 0
        jQuery("body").delegate("#onDashboard", "click", function(e) {
            AJS.populateParameters();
            launchDialog(contextPath + "/rest/config/1.0/directory.json", 800, CHART_HEIGHT, 0);
            e.preventDefault();
        });
    };
}();

// wait for page to fully load to make sure we have all the elements we need
jQuery(document).ready(jira.plugin.charting);


/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:standalone-issue-nav', location = 'content/js/search/IssueNavInit.js' */
(function(){if(history&&history.pushState===undefined){var a=JIRA.Issues.hashTheUrl(window.location);if(a.changed){window.location=a.uri}}jQuery("html").addClass("hide-until-domready");jQuery(function(){jQuery("html").removeClass("hide-until-domready")});jQuery(document).on("keydown",function(b){if(b.which===27){b.preventDefault()}})})();AJS.$(function(){var g=AJS.$(".navigator-content");var j=g.data("issue-table-model-state");if(j&&!j.table){var a=AJS.$("<div></div>").append(g.children().clone());j.issueTable.table=a.html()}var e=g.data("highlighted-issue-id");var f=AJS.$("#stableSearchIds").data("ids");var i=g.data("selected-issue");var c=jQuery.parseJSON(jQuery("#criteriaJson").text());var d=g.data("session-search-state");var h=jQuery.parseJSON(jQuery("#systemFiltersJson").text());var b=new JIRA.Issues.IssueNavCreator().create(AJS.$(document),{initialIssueTableState:j,initialSearcherCollectionState:c,initialSessionSearchState:d,initialSelectedIssue:i,initialHighlightedIssueId:e,initialIssueIds:f,systemFilters:h});Backbone.history.start({pushState:!AJS.DarkFeatures.isEnabled("ka.I_ROOT"),root:JIRA.Issues.IssueNavRouter.getBackboneRoot()});if(jQuery.browser.webkit){JIRA.Issues.ignorePopState=true;window.addEventListener("load",function(){setTimeout(function(){JIRA.Issues.ignorePopState=false},0)})}JIRA.Issues.Api.initialize({searchPageModule:b.searchPageModule,saveInProgressManager:b.saveInProgressManager});JIRA.Issues.IssueAPI.override({searchPageModule:b.searchPageModule});JIRA.Issues.IssueNavigatorAPI.override({searchPageModule:b.searchPageModule});JIRA.Dialogs.BeforeShowIssueDialogHandler.add(JIRA.Issues.Api.waitForSavesToComplete);AJS.KeyboardShortcut.addIgnoreCondition(function(n,m,l){return l==="issueaction"&&JIRA.Issues.Api.isCurrentlyLoadingIssue()});var k=parseInt(jQuery("body").css("minWidth"),10);jQuery(document).bind("resultsWidthChanged",function(){var l=jQuery(".contained-content");var p=l.parent();if(l.length>0){var o=l.offset().left;var n=jQuery(window).width();var q=Math.max(n,k)-o;var m=q/p.width()*100;if(m<100){l.css("width",m+"%")}else{l.css("width","")}jQuery(document).trigger("issueNavWidthChanged")}});jQuery(window).resize(function(){jQuery(document).trigger("resultsWidthChanged")});AJS.$(document).trigger("resultsWidthChanged");JIRA.Issues.onVerticalResize(function(){jQuery.event.trigger("updateOffsets.popout")});JIRA.bind(JIRA.Events.LAYOUT_RENDERED,function(){_.defer(function(){jQuery.event.trigger("updateOffsets.popout")})})});JIRA.Issues.displayFailSearchMessage=function(a){if(a&&a.statusText!=="abort"){return JIRA.Messages.showErrorMsg(JIRA.SmartAjax.buildSimpleErrorContent(a),{closeable:true})}};
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:standalone-issue-nav', location = 'content/js/search/util/OverrideSparklerPadding.js' */
JIRA.bind(JIRA.Events.CHECKBOXMULITSELECT_READY,function(b,a){a.closest(".form-body").addClass("checkboxmultiselect-container")});
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:standalone-issue-nav', location = 'content/js/search/util/OverrideIssueDialogs.js' */
(function(){var e,f,b;JIRA.Dialogs.getDefaultAjaxOptions=function(){var g=this.options.url||this.getRequestUrlFromTrigger();this.issueId=JIRA.Issues.Api.getSelectedIssueId();this.issueKey=JIRA.Issues.Api.getSelectedIssueKey();if(/id=\{0\}/.test(g)){if(!this.issueId){return false}else{g=g.replace(/(id=\{0\})/,"id="+this.issueId)}}return{data:{decorator:"dialog",inline:"true"},url:g}};JIRA.Issues.overrideIssueDialogs=function(g){g=_.defaults({},g,{isNavigator:false});e=g.getIssueId;f=!!g.isNavigator;b=g.updateIssue;if(f){JIRA.LabelsDialog.prototype._handleSubmitResponse=JIRA.FormDialog.prototype._handleSubmitResponse}JIRA.unbind("QuickEdit.sessionComplete");JIRA.bind("QuickEdit.sessionComplete",function(){b(JIRA.Dialog.current)});JIRA.unbind("QuickCreateSubtask.sessionComplete");JIRA.bind("QuickCreateSubtask.sessionComplete",function(){b(JIRA.Dialog.current)});JIRA.bind("Dialog.show",function(j,i,h){if(h){h.issueId=e(JIRA.Dialog.current)}});JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(i,h){h.find(".issueaction-workflow-transition").each(function(){var k=AJS.$(this);var j=k.attr("href");j=j.replace(/atl_token=[^&]*/,"atl_token="+atl_token());k.attr("href",j)})});JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(l,j){var k=AJS.$("#ops-login-lnk");if(k.length==0){return}var h=window.location;var i=parseUri(k.attr("href"));i.queryKey.os_destination=h.pathname.slice(contextPath.length)+h.search;k.attr("href",i.path+"?"+AJS.$.param(i.queryKey))})};var d=JIRA.FormDialog.prototype._getDefaultOptions;JIRA.FormDialog.prototype._getDefaultOptions=function(){var g=d.call(this),h=g.onDialogFinished;g.onDialogFinished=function(){if(this.isIssueDialog()){c.apply(this,arguments)}else{h.apply(this,arguments)}};return g};var a=JIRA.FormDialog.prototype._performRedirect;JIRA.FormDialog.prototype._performRedirect=function(){if(this.isIssueDialog()){c.apply(this,arguments)}else{a.apply(this,arguments)}};function c(){if(this.options.id==="clone-issue-dialog"){a.apply(this,arguments)}else{if(this.options.id==="delete-issue-dialog"){if(f){this.hide();b(this)}else{var h=this._getTargetUrlValue();if(h&&h!==""){AJS.reloadViaWindowLocation(h)}else{if(AJS.$(".page-navigation #next-issue").length>0){AJS.reloadViaWindowLocation(AJS.$(".page-navigation #next-issue").attr("href"))}else{if(AJS.$(".page-navigation #return-to-search").length>0){AJS.reloadViaWindowLocation(AJS.$(".page-navigation #return-to-search").attr("href"))}else{AJS.reloadViaWindowLocation(AJS.$("#find_link").attr("href"))}}}}}else{var g=this;this.showFooterLoadingIndicator();b(this).always(function(){JIRA.trace("jira.issue.update");g.hideFooterLoadingIndicator();g.hide()})}}}})();
/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:standalone-issue-nav', location = 'content/js/search/IssueNavigatorAPI.js' */
JIRA.Issues.IssueNavigatorAPI=(function(){var a;var b={isNavigator:function(){return a.isIssueVisible()}};var c={focusSearch:JIRA.Issues.Api.focusSearch,isNavigator:b.isNavigator,selectNextIssue:JIRA.Issues.Api.nextIssue,selectPreviousIssue:JIRA.Issues.Api.prevIssue,viewSelectedIssue:JIRA.Issues.Api.viewSelectedIssue};return{override:function(d){a=d.searchPageModule;JIRA.IssueNavigator=_.extend(JIRA.IssueNavigator,b);JIRA.IssueNavigator.Shortcuts=_.extend(JIRA.IssueNavigator.Shortcuts,c)}}})();
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-public', location = 'js/applinks.public.js' */
var ApplinksUtils=ApplinksUtils||(function(f){var c={},b={};var p="com_atlassian_applinks_authentication";function o(r){var q=f('<span class="aui-icon icon-close"></span>').click(function(){r.trigger("messageClose",[this]).remove()});r.append(q);q.each(AJS.icons.addIcon.init)}function g(){if(window===parent.window){return null}var r=null,q=window;f("iframe",parent.document.body).each(function(s){if(this.contentWindow.window===q){r=this}});return r}function d(r,w,v,q,s){if(w in c){var t=c[w];if(v){t.authAdminUri=q;delete c[w]}j(t,v)}if(!s&&parent&&(parent!==window)){var u=window;f("iframe",parent.document.body).each(function(x,z){var y=z.contentWindow;if(y!==u){if(y.AJS&&y.AJS.$){y.AJS.$(y.document).trigger("applinks.auth.completion",[w,v,q,true])}}})}}function j(q,t){var s=f(document);if(t){var r=function(u){if(u.isDefaultPrevented()){m(q)}else{h(q);document.location.reload(true)}};s.bind("applinks.auth.approved",r);s.trigger("applinks.auth.approved",q);s.unbind("applinks.auth.approved",r)}else{s.trigger("applinks.auth.denied",q)}}function k(r,q){var s=r.find("a.applink-authenticate");if(r.hasClass("aui-message")){o(r)}s.click(function(t){window.open(q.authUri,p);t.preventDefault()});c[q.id]=q;return r}function n(){f(".applinks-auth-request").each(function(t){var s=f(this),v=s.find(".applinkId").val(),q=s.find(".appName").val(),r=s.find(".appUri").val(),u=s.find(".authUri").val();if(v&&u){k(s,{id:v,appName:q,appUri:r,authUri:u})}})}function i(q){var r=f('<div class="aui-message warning closeable applinks-auth-request"><p><span class="aui-icon icon-applinks-key"></span></p></div>');r.append(AJS.format("Additional information may be available, please \u003ca class=\"applink-authenticate\" href=\"{0}\">authenticate\u003c\/a> with \u003ca href=\"{1}\">{2}\u003c\/a>.",AJS.escapeHtml(q.authUri),AJS.escapeHtml(q.appUri),AJS.escapeHtml(q.appName)));k(r,q);return r}function e(u,r){var q=f('<span class="applinks-auth-request"></span>'),s=f('<span class="applinks-request-description"></span>'),t=AJS.format("\u003ca class=\"applink-authenticate\" href=\"{0}\">Authenticate\u003c\/a> to see additional information.",AJS.escapeHtml(r.authUri));if(u){s.append(u);s.append(" - ")}s.append(t);q.append(s);k(q,r);return q}function h(q){var r=g();if((!r)||(!r.id)){return}if(!parent.ApplinksUtils.pendingConfirmations){parent.ApplinksUtils.pendingConfirmations={}}if(!(r.id in parent.ApplinksUtils.pendingConfirmations)){parent.ApplinksUtils.pendingConfirmations[r.id]=[]}parent.ApplinksUtils.pendingConfirmations[r.id].push(q);return}function l(){if(parent&&parent.ApplinksUtils&&parent.ApplinksUtils.pendingConfirmations){var r=g();if(r){if(r.id in parent.ApplinksUtils.pendingConfirmations){var s=parent.ApplinksUtils.pendingConfirmations[r.id];delete parent.ApplinksUtils.pendingConfirmations[r.id];for(var q=0,t=s.length;q<t;q++){m(s[q])}}}}}function m(s){var t=f(document),r=f('<div class="aui-message success closeable applinks-auth-confirmation"><p><span class="aui-icon icon-applinks-key-success"></span></p></div>'),q=t.find("div.applinks-auth-confirmation-container");if(!q.length){q=t.find("body")}r.append(AJS.format("This application is now using \u003ca href=\"{0}\">{1}\u003c\/a>\'\'s credentials. Revoke access at any time by going to \u003ca href=\"{2}\">OAuth access tokens\u003c\/a>.",AJS.escapeHtml(s.appUri),AJS.escapeHtml(s.appName),AJS.escapeHtml(s.authAdminUri)));o(r);q.prepend(r);setTimeout(function(){r.fadeOut(1000,function(){f(this).remove()})},5000)}function a(){if(parent&&!(parent===window)){if(!parent.ApplinksUtils){parent.ApplinksUtils={}}}f(document).bind("applinks.auth.completion",d);n();l()}f(document).ready(a);return{createAuthRequestBanner:i,createAuthRequestInline:e}})(AJS.$);
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/fecru-compatibility.js' */
if(jQuery!=undefined&&AJS!=undefined){jQuery=AJS.$};
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/rest-service.js' */
AppLinks=AJS.$.extend(window.AppLinks||{},{Event:{NAMESPACE:"applinks",PREREADY:this.NAMESPACE+".preready",READY:this.NAMESPACE+".ready"}});if(AJS.AppLinksInitialisationBinder){AppLinks.initialisationBinder=AJS.AppLinksInitialisationBinder}else{AppLinks.initialisationBinder=function(a){AJS.toInit(a)}}AppLinks.initialisationBinder(function(){AppLinks=AJS.$.extend(window.AppLinks||{},{failure:function(e){if(e.status==401){window.location.reload()}else{var c=AppLinks.parseError(e);var d=AJS.$(".page-error");if(d.length>0){d.html(c).fadeIn("slow")}else{alert("REST request failed: "+c)}}},jsonRequest:function(d,e,f,g,c){if(f){f=JSON.stringify(f)}AJS.$(".page-error").fadeOut("fast");if(!c){c=AppLinks.failure}jQuery.ajax({url:d,type:e,data:f,dataType:"json",contentType:"application/json; charset=utf-8",cache:false,success:g,error:c})},parseError:function(f){var c;try{c=JSON.parse(f.responseText)}catch(d){if(f.statusText){return c=f.statusText}else{return f}}if(c.message){if(AJS.$.isArray(c.message)){return c.message.join(" ")}return c.message}else{return f.statusText}},put:function(d,e,f,c){AppLinks.jsonRequest(d,"PUT",e,f,c)},post:function(d,e,f,c){AppLinks.jsonRequest(d,"POST",e,f,c)},update:function(d,e,c){AppLinks.put(AppLinks.self_link(d),d,e,c)},get:function(d,e,c){AppLinks.jsonRequest(d,"GET",null,e,c)},self_link:function(e){for(var c=0,f=e.link.length;c<f;c++){var d=e.link[c];if(d.rel=="self"){return d.href}}throw"No self-link found"},del:function(f,e,d){var c;if(typeof(f)=="string"){c=f}else{c=AppLinks.self_link(f)}AppLinks.jsonRequest(c,"DELETE",null,e,d)},SPI:AJS.$.extend({},{BASE_URL:AJS.contextPath()+"/rest/applinks/1.0",getAllLinks:function(e,d){var c=AppLinks.SPI.BASE_URL+"/applicationlink";AppLinks.get(c,e,d)},getAllLinksWithAuthInfo:function(e,d){var c=AppLinks.SPI.BASE_URL+"/listApplicationlinks";AppLinks.get(c,e,d)},getLinksOfType:function(e,f,d){var c=AppLinks.SPI.BASE_URL+"/applicationlink/type/"+e;AppLinks.get(c,f,d)},tryToFetchManifest:function(e,f,d){var c=AppLinks.SPI.BASE_URL+"/applicationlinkForm/manifest.json?url="+encodeURIComponent(e);AppLinks.get(c,f,d)},getManifestFor:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/manifest/"+f+".json";AppLinks.get(c,e,d)},createStaticUrlAppLink:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/applicationlinkForm/createStaticUrlAppLink?typeId="+f;AppLinks.post(c,null,e,d)},createLink:function(j,h,l,d,i,k,f,m,e){var c=AppLinks.SPI.BASE_URL+"/applicationlinkForm/createAppLink";var g={applicationLink:j,username:h,password:l,createTwoWayLink:d,customRpcURL:i,rpcUrl:k,configFormValues:f};AppLinks.post(c,g,m,e)},createLinkWithOrphanedTrust:function(j,h,m,d,i,k,f,l,n,e){var c=AppLinks.SPI.BASE_URL+"/applicationlinkForm/createAppLink";var g={applicationLink:j,username:h,password:m,createTwoWayLink:d,customRpcURL:i,rpcUrl:k,configFormValues:f,orphanedTrust:l};AppLinks.post(c,g,n,e)},verifyTwoWayLinkDetails:function(c,i,j,f,h,e){var d=AppLinks.SPI.BASE_URL+"/applicationlinkForm/details";var g={username:j,password:f,remoteUrl:c,rpcUrl:i};AppLinks.post(d,g,h,e)},getApplicationLinkInfo:function(e,f,d){var c=AppLinks.SPI.BASE_URL+"/applicationlinkInfo/id/"+e;AppLinks.get(c,f,d)},deleteLink:function(g,c,f,e){var d=AppLinks.SPI.BASE_URL+"/applicationlink/"+g.id;if(c){d+="?reciprocate=true"}AppLinks.del(d,f,e)},makePrimary:function(e,d){var c=AppLinks.SPI.BASE_URL+"/applicationlink/primary/"+e.id;AppLinks.post(c,null,d)},relocate:function(h,f,c,g,e){var d=AppLinks.SPI.BASE_URL+"/relocateApplicationlink/"+h.id+"?newUrl="+encodeURIComponent(f)+"&nowarning="+(c?"true":"false");AppLinks.post(d,null,g,e)},legacyUpgrade:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/upgrade/legacy/"+f.id;AppLinks.post(c,null,e,d)},ualUpgrade:function(g,c,f,e){var d=AppLinks.SPI.BASE_URL+"/upgrade/ual/"+g.id;AppLinks.post(d,c,f,e)},getEntityTypesForApplicationType:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/type/entity/"+f;AppLinks.get(c,e,d)},getLocalEntitiesWithLinksToApplication:function(c,f,e){var d=AppLinks.SPI.BASE_URL+"/entitylink/localEntitiesWithLinksTo/"+c+".json";AppLinks.get(d,f,e)},getEntityLinksForApplication:function(c,f,e){var d=AppLinks.SPI.BASE_URL+"/entities/"+c+".json";AppLinks.get(d,f,e)},getEntityLinksForApplicationUsingAnonymousAccess:function(c,f,e){var d=AppLinks.SPI.BASE_URL+"/entities/anonymous/"+c+".json";AppLinks.get(d,f,e)},createNonUalEntityLink:function(l,g,d,f,j,e,k,i){var c=AppLinks.SPI.BASE_URL+"/entitylink/"+l+"/"+g+"?reciprocate=false";var h={applicationId:d,typeId:f,key:j,name:e,isPrimary:false};AppLinks.put(c,h,k,i)},createEntityLink:function(h,g,d,c,i,f){var e=AppLinks.SPI.BASE_URL+"/entitylink/"+h+"/"+g+"?reciprocate=";e+=(c?"true":"false");AppLinks.put(e,d,i,f)},getConfiguredEntityLinks:function(f,e,g,d){var c=AppLinks.SPI.BASE_URL+"/entitylink/primaryLinks/"+f+"/"+e+".json";AppLinks.get(c,g,d)},deleteEntityLink:function(h,g,d,c,i,f){var e=AppLinks.SPI.BASE_URL+"/entitylink/"+h+"/"+g+"?typeId="+d.typeId+"&key="+d.key+"&applicationId="+d.applicationId+"&reciprocate="+c;AppLinks.del(e,i,f)},makePrimaryEntityLink:function(g,f,c,h,e){var d=AppLinks.SPI.BASE_URL+"/entitylink/primary/"+g+"/"+f+"?typeId="+c.typeId+"&key="+c.key+"&applicationId="+c.applicationId;AppLinks.post(d,null,h,e)},canDeleteAppLink:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/permission/reciprocate-application-delete/"+f;AppLinks.get(c,e,d)},canDeleteEntityLink:function(g,f,c,h,e){var d=AppLinks.SPI.BASE_URL+"/permission/reciprocate-entity-delete/"+c.applicationId+"/"+g+"/"+f+"/"+c.typeId+"/"+c.key;AppLinks.get(d,h,e)},canCreateReciprocateEntityLink:function(f,e,d){var c=AppLinks.SPI.BASE_URL+"/permission/reciprocate-entity-create/"+f;AppLinks.get(c,e,d)},processPermissionCode:function(d){var c={noPermission:function(){},missing:function(){},credentialsRequired:function(e){},authenticationFailed:function(e){},noAuthentication:function(e){},noAuthenticationConfigured:function(){},noConnection:function(){},allowed:function(){},unrecognisedCode:function(e){},updateView:function(g,f,e){}};if(!d){d={}}d=AJS.$.extend(c,d);return function(f){var e=f.code;if(e=="NO_PERMISSION"){d.noPermission()}else{if(e=="MISSING"){d.missing()}else{if(e=="CREDENTIALS_REQUIRED"){d.credentialsRequired(f.url)}else{if(e=="AUTHENTICATION_FAILED"){d.authenticationFailed(f.url)}else{if(e=="NO_AUTHENTICATION"){d.noAuthentication(f.url)}else{if(e=="NO_AUTHENTICATION_CONFIGURED"){d.noAuthenticationConfigured()}else{if(e=="NO_CONNECTION"){d.noConnection()}else{if(e=="ALLOWED"){d.allowed()}else{d.unrecognisedCode(f.code)}}}}}}}}}},addAuthenticationTrigger:function(e,c,d){if(!d){d={}}if(typeof d.onSuccess=="undefined"){d.onSuccess=function(){location.reload()}}if(typeof d.onFailure=="undefined"){d.onFailure=function(){return true}}AJS.$(e).unbind("click");AJS.$(e).click(function(){if(d.before){d.before()}AppLinks.authenticateRemoteCredentials(c,d.onSuccess,d.onFailure)})},deleteOrphanedTrust:function(g,e,f,d){var c=AppLinks.SPI.BASE_URL+"/orphaned-trust/"+e+"/"+g;AppLinks.del(c,f,d)},getOrphanedTrust:function(e,d){var c=AppLinks.SPI.BASE_URL+"/orphaned-trust/";AppLinks.get(c,e,d)},showCreateEntityLinkSuggestion:function(){return true}},(window.AppLinks&&window.AppLinks.SPI)||{})});var b="applinks";var a=function(f,e){if(e){if(!AJS.$.isArray(e)){e=[new String(e)]}for(var c=0;c<e.length;c++){var d=new RegExp("\\{"+c+"\\}","g");f=f.replace(d,e[c])}}return f};AppLinks.UI={showInfoBox:function(c){AJS.$(".aui-message.success").remove();AppLinks.UI.createMessage("success",c,"page-info")},hideInfoBox:function(){AJS.$(".aui-message.success").remove()},showErrorBox:function(c){AppLinks.UI.createMessage("error",c,"page-error")},hideErrorBox:function(){AJS.$(".aui-message.error").remove()},showWarningBox:function(d){if(AJS.$.isArray(d)&&d.length>0){var c=AJS.$("<ul></ul>");AJS.$(d).each(function(f){c.append(AJS.$("<li/>",{text:d[f]}))});var e=AJS.$('<div class="page-warning"></div>').append(c);AppLinks.UI.createMessage("warning",e.html(),"page-warning")}else{AppLinks.UI.createMessage("warning",d,"page-warning")}},hideWarningBox:function(){AJS.$(".aui-message.warning").remove()},shortenString:function(d,c){if(d.length>c){d=d.substring(0,c)+"..."}return d},createMessage:function(d,e,c){var f=AJS.$('<div class="'+c+'">');f.html(e);AJS.messages[d](".applinks-message-bar",{title:"",body:f.wrap("<div></div>").parent().html(),closeable:true})},displayValidationErrorMessages:function(c,f,e){if(AJS.$.isArray(e)){AJS.$(e).each(function(j,h){var k=AJS.$('<div class="error applinks-error">');k.text(h);AJS.$(f).find("."+c).append(k)})}else{var g=AJS.$('<div class="error applinks-error">');g.text(e.toString());AJS.$(f).find("."+c).append(g)}},displayValidationError:function(c,d,e){return function(j){if(j.status==401){window.location.reload();return}AJS.$(".applinks-error").remove();AJS.$(".loading").remove();var h=j.responseText;var i=AJS.$.parseJSON(h);var g=i.message;if(typeof i.fields=="undefined"){AppLinks.UI.displayValidationErrorMessages(c,d,g)}else{var f=i.fields;AJS.$(f).each(function(k){var l=AJS.$('<div class="error applinks-error" id="'+f[k]+'-error">');l.text(g[k]);if(AJS.$(d).find("."+f[k]).length>0){l.insertAfter(AJS.$(d).find("."+f[k]))}else{l.insertAfter(AJS.$(d).find("."+c).append(l))}})}AJS.$(d).find("."+c).addClass("fully-populated-errors");if(e){e()}}},addProtocolToURL:function(c){var f=AJS.$.trim(c);var e=f.toLowerCase();var d=false;if(e.length>=7){if(e.substring(0,7).indexOf("http")!=-1){d=true}}if(!d){f="http://"+f}return f},prettyJoin:function(d,g,f){if(!f){f=AppLinks.I18n.getText("applinks.and")}var c=d.length;var e="";AJS.$.each(d,function(h,i){if(h==(c-1)&&c>1){e+=" "+f+"  "+g(i)}else{e+=g(i);if(h+2<c){e+=", "}}});return e},showLoadingIcon:function(c){AJS.$('<span class="loading">&nbsp;</span>').insertAfter(c)},hideLoadingIcon:function(c){AJS.$(c).next(".loading").remove()},findUrl:function(f){var e=undefined;var g=f.toLowerCase();var d=g.indexOf("http:");if(d==-1){d=g.indexOf("https:")}if(d>-1){var c=g.indexOf(" ",d);if(c==-1){c=g.length}e=f.substring(d,c)}return e},findApplicationType:function(c){c=c.toLowerCase();if(c.indexOf("jira")!=-1){return"jira"}else{if(c.indexOf("fisheye")!=-1){return"fecru"}else{if(c.indexOf("confluence")!=-1){return"confluence"}else{if(c.indexOf("refapp")!=-1){return"refapp"}else{return undefined}}}}},escapeSelector:function(c){return c.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")},sanitiseHTML:function(c){var d={"<":"&lt;",'"':"&quot;","&":"&amp;"};return c.replace(/[<"&]/g,function(e){return d[e]})},refreshOrphanedTrust:function(){var c=function(d){AJS.$("tr.orphaned-trust-row").each(function(){var j=AJS.$(this);var k=j.attr("data-id");var g=j.attr("data-type");var f=false;for(var e=0;e<d.orphanedTrust.length;e++){var h=d.orphanedTrust[e];if(k==h.id&&g==h.type){f=true;break}}if(!f){j.remove();if(d.orphanedTrust.length==0){AJS.$(".orphaned-trust-warning").hide()}}})};AppLinks.SPI.getOrphanedTrust(c)},removeCssClass:function(c,d){AJS.$(c).removeClass(function(f,h){var g=h.split(" ");var e="";AJS.$.each(g,function(i,j){if(j.indexOf(d)!=-1){e=j}});return e})}};AppLinks.I18n={getTextWithPrefix:function(c,d){return a(appLinksI18n.entries[b+"."+c],d)},getText:function(c,d){return a(AppLinks.I18n.resolveValue(c),d)},getApplicationTypeName:function(c){return appLinksI18n.entries["applinks.application.type."+c]},getEntityTypeName:function(c){return appLinksI18n.entries["applinks.entity.type."+c]},getPluralizedEntityTypeName:function(c){return appLinksI18n.entries["applinks.entity.type.plural."+c]},getAuthenticationTypeName:function(c){return appLinksI18n.entries["applinks.auth.provider."+c]},resolveValue:function(c){var d=appLinksI18n.entries[c];return typeof d=="undefined"?c:d}};AppLinks.Docs={createDocLink:function(d,e,c){if(!c){c=""}else{c=" "+c}return AJS.$("<a/>",{"class":"ual-help-link"+c,href:AppLinks.Docs.getDocHref(d,e),target:"_blank",text:AppLinks.I18n.getText("applinks.help"),title:AppLinks.I18n.getText("applinks.help")})},getDocHref:function(d,e){var c=AppLinks.Docs.resolveValue("applinks.docs.root")+"/"+AppLinks.Docs.resolveValue(d);if(e){c+="#"+AppLinks.Docs.resolveValue(e)}return c},resolveValue:function(c){var d=applinksDocs.entries[c];return typeof d=="undefined"?c:d}};AJS.$(document).trigger(AppLinks.Event.PREREADY);AJS.$(document).trigger(AppLinks.Event.READY)});
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/json2.js' */
if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/autocomplete.js' */
AJS.$(document).bind(AppLinks.Event.READY,function(){AppLinks.autoComplete={cacheManager:function(c){var a={},b=[],c=c||30;return{get:function(d){return a[d]},put:function(d,e){a[d]=e;b.push(d);if(b.length>c){delete a[b.shift()]}},clear:function(){a={};b=[]}}}};(function(d){var c=function(f){AJS.log("InputDrivenDropDown: truncating text");var h=f.$.closest(".aui-dropdown").width(),g=20;d("a span:not(.icon)",f.$).each(function(){var j=d(this),i=AJS("var","&#8230;"),l=i.width(),k=false;j.wrapInner(d("<em>"));d("em",j).each(function(){var m=d(this);m.show();if(this.offsetLeft+this.offsetWidth>h){var t=this.childNodes,s=false;for(var o=t.length-1;o>=0;o--){var p=t[o],n=1,r=(p.nodeType==3)?"nodeValue":"innerHTML",q=p[r];do{if(n<=q.length){p[r]=q.substr(0,q.length-n++)}else{break}}while(this.offsetLeft+this.offsetWidth+l>h-g);if(n<=q.length){s=true;break}}if(s){k=true}else{m.hide()}}});if(k){j.append(i);this.elpss=i}})};var b=function(f,l){if(!l.length||!l[0]){return}AJS.log("InputDrivenDropDown: highlighting tokens");for(var h=0,j=l.length;h<j;h++){var g=l[h];l[h]=g?g.replace(/[\.\*\+\?\|\(\)\[\]{}\\]/g,"\\$"):""}var k=new RegExp("("+l.join("|")+")","gi");d("li a:not(.dropdown-prevent-highlight) span",f.$).each(function(){var m=d(this),i=m.html().replace(k,"<strong>$1</strong>");m.html(i)})};var e=function(j,g){var i=j.options,h=j.dd;if(h){h.hide();h.$.remove()}i.ajsDropDownOptions=i.ajsDropDownOptions||{};if(i.ajsDropDownOptions&&!i.ajsDropDownOptions.alignment){i.ajsDropDownOptions.alignment="left"}i.ajsDropDownOptions.selectionHandler=i.ajsDropDownOptions.selectionHandler||function(l,k){if(l.type!="click"){l.preventDefault();d("a",k).click();document.location=d("a",k).attr("href")}};i.ajsDropDownOptions.displayHandler=function(k){return AJS.escapeHtml(k.name)};var f=j.dd=new AJS.dropDown(g.matrix,i.ajsDropDownOptions)[0];if(i.ajsDropDownOptions&&i.ajsDropDownOptions.className){f.$.addClass(i.ajsDropDownOptions.className)}if(i.dropdownPlacement){i.dropdownPlacement(f.$)}else{AJS.log("No dropdownPlacement function specified. Appending dropdown to the body.");d("body").append(f.$)}b(f,g.queryTokens||[g.query]);c(f);if(i.dropdownPostprocess){i.dropdownPostprocess(f.$)}f.show(j._effect);if(typeof i.onShow=="function"){i.onShow.call(f,f.$)}return f};function a(g,f){this._effect="appear";this._timer=null;this.id=g;this.options=f;this.inactive=false;this.busy=false;this.cacheManager=AppLinks.autoComplete.cacheManager()}a.prototype.clearCache=function(){this.cacheManager.clear()};a.prototype.change=function(h,g){var f=this;if(h!=f._value||g){f._value=h;f.busy=false;clearTimeout(f._timer);if(g||(/\S{0,}/).test(h)){var i=f.cacheManager.get(h);if(i){e(f,i)}else{f.busy=true;f._timer=setTimeout(function(){f.options.getDataAndRunCallback.call(f,h,f.show)},200)}}else{f.dd&&f.dd.hide()}}};a.prototype.dropDownLength=function(){return this.dd.links?this.dd.links.length:0};a.prototype.dropDownItem=function(f){return this.dropDownLength()>f?this.dd.links[f]:null};a.prototype.hide=function(){this.dd&&this.dd.hide()};a.prototype.remove=function(){var f=this.dd;if(f){this.hide();f.$.remove()}this.inactive=true;this.options.onDeath&&this.options.onDeath()};a.prototype.show=function(g,i,h){if(this.inactive){AJS.log("Quick search abandoned before server response received, ignoring. "+this);return}var f={matrix:g,query:i,queryTokens:h};this.cacheManager.put(i,f);e(this,f);this.busy=false};AppLinks.inputDrivenDropdown=function(f){return new a("inputdriven-dropdown",f)}})(jQuery)});
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/wizard.js' */
AJS.$(document).bind(AppLinks.Event.PREREADY,function(){(function(d){d.fn.wizard=function(v){var u={width:500,height:350,onshow:function(w,x){return true},aftershow:function(){return true},oncancel:function(){return true},onsubmit:function(){return true},aftersubmit:function(){return true},onnext:function(){return true},onprevious:function(){return true},cancelLabel:AppLinks.I18n.getText("applinks.cancel"),submitLabel:AppLinks.I18n.getText("applinks.create"),nextLabel:AppLinks.I18n.getText("applinks.next"),previousLabel:AppLinks.I18n.getText("applinks.previous"),id:""};if(!v){v={}}v=d.extend(u,v);var t=this;this.each(function(){var D=d(this);var w=new AJS.Dialog(v.width,v.height,v.id);var L=q(w,v.onshow,v.aftershow);var K=c(w,v.oncancel);var z=h(w,v.onsubmit,v.aftersubmit);var M=a(w,v.onprevious);var I=m(w,v.onnext);var G=k(w);var B=o(w);var C=g(w);var H=l(w);var J=s(w);var E=n(w);if(v.showButtonId){d("#"+v.showButtonId).click(L)}var y=f(D);for(var A=0;A<y.length;A++){var F=y[A];j(w,F);if(F.className){w.addHeader(F.title,F.className+"-header")}else{w.addHeader(F.title)}if(A!=0&&d(F.div).attr("previous")!="false"){w.addButton(v.previousLabel,M,"applinks-previous-button")}if(A<y.length-1&&d(F.div).attr("submit")!="true"&&d(F.div).attr("next")!="false"){w.addButton(v.nextLabel,I,"applinks-next-button")}if(d(F.div).attr("submit")=="true"){w.addButton(v.submitLabel,z,"wizard-submit")}if(!w.getPage(A).buttonpanel){w.addButton("",null);d(w.getPage(A).buttonpanel).empty();var x=d('<a class="button-panel-button applinks-cancel-link">'+v.cancelLabel+"</a>");w.getPage(A).buttonpanel.append(x);x.click(K)}else{var x=d('<a class="button-panel-link button-panel-cancel-link applinks-cancel-link">'+v.cancelLabel+"</a>");d(w.getPage(A).buttonpanel).append(x);x.click(K)}if(A<y.length-1){w.addPage()}}t={dialog:w,nextPage:I,prevPage:M,submit:z,cancel:K,show:L,disableNextBtn:G,enableNextBtn:B,disableSubmitBtn:C,enableSubmitBtn:H,disablePreviousBtn:J,enablePreviousBtn:E};w.gotoPage(0);w.gotoPanel(0)});return t};function s(t){return function(){b(r(t,"applinks-previous-button"))}}function n(t){return function(){i(r(t,"applinks-previous-button"))}}function k(t){return function(){b(r(t,"applinks-next-button"))}}function o(t){return function(){i(r(t,"applinks-next-button"))}}function g(t){return function(v){var u=r(t,"wizard-submit");b(u);if(typeof(v)=="undefined"||v){d('<span class="loading">&nbsp;</span>').insertBefore(u)}else{u.parent().find(".loading").remove()}}}function l(t){return function(){var u=r(t,"wizard-submit");i(u);u.parent().find(".loading").remove()}}function r(u,t){return d(u.getPage(u.curpage).buttonpanel).find("."+t)}function p(t){d(t.popup.element).find("form").each(function(){this.reset()})}function i(t){t.attr("disabled",false)}function b(t){t.attr("disabled",true)}function q(t,u,v){return function(w){if(u(t,w)!==false){t.gotoPage(0);t.gotoPanel(0);d(document).unbind("keydown.ual.dialog");d(document).bind("keydown.ual.dialog",e(t));t.show();v()}}}function c(t,u){return function(){if(u(t)!==false){t.hide();p(t)}}}function a(t,u){return function(){if(u(t)!==false){t.prevPage()}}}function m(t,u){return function(){if(u(t)!==false){t.nextPage()}}}function e(t){return function(u){if(u.keyCode===27){p(t);d(document).unbind("keydown.ual.dialog")}}}function h(u,v,t){return function(){if(v(u)!==false){t(u);p(u)}}}function j(v,w){var u=d("> div[panel]",w.div);if(u.length>0){u.each(function(y,z){var x=v.addPanel(z.title,null,z.className,"menu-"+z.id);x.getCurrentPanel().body.append(u[y])})}else{var t=v.addPanel(w.title);t.getCurrentPanel().body.append(w.div)}}function f(v){var u=d(" > div",v);var t=[];u.each(function(x){var w=d(this);t[x]={title:w.attr("title")||null,className:w.attr("class"),div:w}});return t}})(jQuery)});
/* module-key = 'com.atlassian.applinks.applinks-plugin:applinks-util-js', location = 'js/applinkwizard.js' */
(function(a){AppLinks.Wizard={initAuthenticationUI:function(d){var h=a(d);var f=h.find(".create-reciprocal-link");var c=h.find(".ual-arrow");var l=h.find(".two-way-link-details");var j=h.find(".reciprocal-link-description");var b=h.find(".no-reciprocal-link-description");f.click(function(){if(f.is(":checked")){c.removeClass("no-background");l.show();j.show();b.hide()}else{c.addClass("no-background");l.hide();j.hide();b.show()}});var i=h.find(".same-user-radio-btn");var k=h.find(".different-user-radio-btn");var e=h.find(".different-userbase-image");var g=h.find(".same-userbase-image");i.click(function(){e.addClass("different-userbase-image-grey");g.removeClass("same-userbase-image-grey")});k.click(function(){g.addClass("same-userbase-image-grey");e.removeClass("different-userbase-image-grey")})},initNonUALUI:function(e){var c=a(e);var b=c.find(".application-types");for(var d=0;d<nonAppLinksApplicationTypes.length;d++){a('<option value="'+nonAppLinksApplicationTypes[d].typeId+'">'+nonAppLinksApplicationTypes[d].label+"</option>").appendTo(b)}},fetchManifest:function(e,h,d,b){var i=h.find("#application-url");if(i.val()==""){var c=h.find("#application-types");if(c.val()==""){a('<div class="error applinks-error">'+AppLinks.I18n.getText("applinks.error.url.field.empty")+"</div>").insertAfter(i);return false}var g=function(j){e.enableSubmitBtn();e.enablePreviousBtn();e.cancel();AppLinks.UI.listApplicationLinks(j.applicationLink.id,"new",j)};AppLinks.SPI.createStaticUrlAppLink(c.val(),g,null);return true}var f=AppLinks.UI.addProtocolToURL(i.val());AppLinks.UI.showLoadingIcon(i);var g=function(l){var k=l;e.enableNextBtn();h.find(".loading").remove();h.find(".reciprocal-rpc-url").val(a("#baseUrl").val());if(typeof l.typeId!="undefined"){AppLinks.Wizard.handleUALManifest(k,h);e.dialog.gotoPage(2);h.find(".reciprocal-link-username").focus();if(d){d(k)}}else{if(l.code=="applinks.warning.redirected.host"&&!i.data("hasWarnedAboutRedirection")){AppLinks.UI.displayValidationErrorMessages("manifest-validation-errors",h,l.warning);i.data("hasWarnedAboutRedirection","true");var m=function(){a(i).removeData("hasWarnedAboutRedirection");a(i).unbind("change",m)};i.bind("change",m)}else{if(l.code=="applinks.warning.unknown.host"&&!i.data("forceWhenHostIsOffline")){AppLinks.UI.displayValidationErrorMessages("manifest-validation-errors",h,l.warning);i.data("forceWhenHostIsOffline","true");var j=function(){a(i).removeData("forceWhenHostIsOffline");a(i).unbind("change",j)};i.bind("change",j)}else{if(k.code=="applinks.warning.unknown.host"||k.code=="applinks.warning.redirected.host"){delete k.warning;delete k.code}AppLinks.Wizard.handleNonUALManifest(k,f,h);e.dialog.gotoPage(1);h.find(".application-name").focus();if(b){b(k)}}}}};e.disableNextBtn();AppLinks.SPI.tryToFetchManifest(f,g,AppLinks.UI.displayValidationError("manifest-validation-errors",h,function(){e.enableNextBtn()}));return f},handleUALManifest:function(f,e){var c=a(e);c.find(".remote-app-image").removeClass(function(j,l){var k=l.split(" ");var i="";a.each(k,function(m,n){if(n.indexOf("application-type-image-")!=-1){i=n}});return i});c.find(".remote-app-image").addClass("application-type-image-"+f.typeId);c.find(".link-to-app-type").html(AppLinks.I18n.getText("applinks.create.title.link.to",AppLinks.I18n.getApplicationTypeName(f.typeId)));c.find(".remote-app-name").html(AppLinks.UI.shortenString(f.name,20));c.find(".create-reciprocal-link").attr("checked",true);c.find("#reciprocal-link-back-to-server").html(AppLinks.I18n.getText("applinks.create.link.back.to.server",f.name));var d=["administrator",f.name,'<a target="_blank" href="'+AppLinks.Docs.getDocHref("applinks.docs.adding.application.link")+'">',"</a>"];var h=f.applinksVersion.split(".");var b=parseInt(h[0]);var g=parseInt(h[1]);if((f.typeId=="jira"||f.typeId=="confluence")&&(b==3&&g<10)){d[0]="system administrator"}c.find(".reciprocal-link-description").html(AppLinks.I18n.getText("applinks.create.two.way.link",d));c.find(".no-reciprocal-link-description").hide();c.find(".no-reciprocal-link-description").html(AppLinks.I18n.getText("applinks.create.two.way.no.link",f.name));c.find(".reciprocal-link-username").val("");c.find(".reciprocal-link-password").val("");c.find(".ual-arrow").removeClass("no-background");c.find(".two-way-link-details").show();c.find(".reciprocal-link-description").show();c.find(".no-reciprocal-link-description").hide()},handleNonUALManifest:function(d,e,c){var b=a(c);b.find(".application-name").val("");b.find(".application-types option:first-child").attr("selected","selected");b.find(".non-ual-application-url").text(e);if(d.warning){b.find(".create-non-ual-warning").show();b.find(".create-non-ual-warning").html(d.warning)}else{b.find(".create-non-ual-warning").hide()}},checkReciprocalLinkFormThreeStepMode:function(c,d,g,j,f){var h=a(c);if(h.find(".create-reciprocal-link").is(":checked")){var k=a.trim(h.find(".reciprocal-rpc-url").val());if(k==""){a("<div class='error applinks-error'>"+AppLinks.I18n.getText("applinks.error.url.field.empty")+"</div>").insertAfter(h.find(".reciprocal-rpc-url"));if(f){f()}return}var e=h.find(".reciprocal-link-username");var b=h.find(".reciprocal-link-password");if(e.val()==""){a('<div class="error applinks-error">'+AppLinks.I18n.getText("applinks.error.username.empty")+"</div>").insertAfter(e);if(f){f()}return false}var i=function(l){h.find(".same-user-description").find("input").attr("checked",true);h.find(".trust-radio-btn").attr("checked",true);h.find(".same-user-radio-btn").click();g(l)};k=AppLinks.UI.addProtocolToURL(k);AppLinks.SPI.verifyTwoWayLinkDetails(j,k,e.val(),b.val(),i,AppLinks.UI.displayValidationError("two-way-link-errors",c,f));return false}else{d();return false}},checkReciprocalLinkFormTwoStepMode:function(f,h,b,i){var c=a(f);var g=a.trim(c.find(".reciprocal-rpc-url").val());if(g==""){a("<div class='error applinks-error'>"+AppLinks.I18n.getText("applinks.error.url.field.empty")+"</div>").insertAfter(c.find(".reciprocal-rpc-url"));if(i){i()}return}var d=c.find(".reciprocal-link-username");var e=c.find(".reciprocal-link-password");if(d.val()==""){a('<div class="error applinks-error">'+AppLinks.I18n.getText("applinks.error.username.empty")+"</div>").insertAfter(d);if(i){i()}return false}g=AppLinks.UI.addProtocolToURL(g);AppLinks.SPI.verifyTwoWayLinkDetails(h,g,d.val(),e.val(),b,AppLinks.UI.displayValidationError("two-way-link-errors",f,i));return false}}})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-link-applinks-common-plugin:issue-link-applinks', location = 'js/issuelink-applinks.js' */
/**
 * Initialises anything requiring OAuth authentication. Requires the following elements:
 * <div class="issue-link-applinks-authentication-message"></div>
 */
var IssueLinkAppLinks = IssueLinkAppLinks || (function($) {
    function createHelper(servers, context, settings) {
        var helper = {};
        var selectedServer = null;

        function selectServer(appId) {
            selectedServer = getServer(servers, appId);

            var authenticationRequired = selectedServer && selectedServer.requireCredentials;
            doAuthenticationRequired(authenticationRequired, context);

            return {"authenticationRequired": authenticationRequired};
        }

        function setAuthenticationRequired(appId, authenticationRequired) {
            var server = getServer(servers, appId);
            if (server) {
                server.requireCredentials = authenticationRequired;

                // Refresh the authenication message if we have updated the selected server
                if (selectedServer && selectedServer.id === appId) {
                    doAuthenticationRequired(authenticationRequired, context);
                }
            }
        }

        function doAuthenticationRequired(required, context) {
            $(".issue-link-applinks-authentication-message", context).empty();
            if (required) {
                createAuthRequiredBanner($(".issue-link-applinks-authentication-message", context), context);
                $(".issue-link-oauth-toggle").hide();
                $(".buttons-container input[type=submit]", context).attr("disabled", "disabled")
            } else {
                $(".issue-link-oauth-toggle").show();
                $(".buttons-container input[type=submit]", context).removeAttr("disabled");
            }
        }

        function createAuthRequiredBanner($container, context) {
            var oauthCallbacks = {
                onSuccess: function () {
                    selectedServer.requireCredentials = false;
                    doAuthenticationRequired(false, context);
                    if (settings.onAuthenticationSuccessCallback) {
                        settings.onAuthenticationSuccessCallback(context, selectedServer.id, helper);
                    }
                },
                onFailure: function () {
                    if (settings.onAuthenticationFailedCallback) {
                        settings.onAuthenticationFailedCallback(context, selectedServer.id, helper);
                    }
                }
            };

            var encodedServerName = AJS.escapeHtml(selectedServer.name);
            if (selectedServer.authUrl) {
                var $banner = $('<div class="aui-message warning closeable shadowed applinks-auth-request"><p><span class="aui-icon icon-applinks-key"></span></p></div>');
                $banner.append(AJS.format("Authorization required to create issue link. Please \u003ca href=\"{0}\" class=\"applink-authenticate\">authenticate\u003c\/a> with \u003ca href=\"{1}\">{2}\u003c\/a>.", selectedServer.authUrl, selectedServer.url, encodedServerName));
                $("a", $banner).addClass("applink-authenticate");
                $('.applink-authenticate', $banner).click(function (e) {
                    authenticateRemoteCredentials(selectedServer.authUrl, oauthCallbacks.onSuccess, oauthCallbacks.onFailure);
                    e.preventDefault();
                });
                $container.append($banner);
            } else {
                var warningMessage = AJS.format("Unable to create a link to \u003ca href=\"{0}\">{1}\u003c\/a> as the application does not have any authentication configured.", selectedServer.url, encodedServerName);
                AJS.messages.warning($container, {body: warningMessage});
            }
        }

        function createOAuthCallback() {
            if (!AppLinks.OAuthCallback && typeof(oauthCallback) === "undefined") {
                AppLinks.OAuthCallback = function() {

                };

                AppLinks.OAuthCallback.prototype.success = function() {
                    this.aouthWindow.close();
                    this.onSuccess();
                    delete oauthCallback;
                    delete AppLinks.OAuthCallback;
                };

                AppLinks.OAuthCallback.prototype.failure = function() {
                    this.aouthWindow.close();
                    this.onFailure();
                    delete oauthCallback;
                    delete AppLinks.OAuthCallback;
                };

                AppLinks.OAuthCallback.prototype.show = function(url, onSuccess, onFailure) {
                    this.onSuccess = onSuccess;
                    this.onFailure = onFailure;
                    this.aouthWindow = window.open(url, "com_atlassian_applinks_authentication");
                };
                // set the global oAuthCallback variable required by AppLinks
                oauthCallback = new AppLinks.OAuthCallback();
            }
        }

        function authenticateRemoteCredentials(url, onSuccess, onFailure) {
            createOAuthCallback();

            $('.applinks-error').remove();
            oauthCallback.show(url, onSuccess, onFailure);
        }

        return $.extend(helper, {
            selectServer: selectServer,
            setAuthenticationRequired: setAuthenticationRequired
        });
    }

    function getServer(servers, appId) {
        var i;
        if (servers.length) {
            for (i = 0; i < servers.length; i++) {
                if (servers[i].id === appId) {
                    return servers[i];
                }
            }
        }
        return null;
    }

    /**
     * Called only once during the initialisation to retrieve the list of servers.
     *
     * @param context the context to perform the initialisation. This is either the inline dialog or the entire document
     *                body.
     */
    function initApplinkServers(settings, context, deferred) {
        var currentAppId = settings.getCurrentAppId(context);
        var applicationType = $(".issue-link-applinks-application-type", context).val();
        $.get(AJS.contextPath() + '/rest/issueLinkAppLink/1/appLink/info?type=' + applicationType, function (servers) {
            var helper = createHelper(servers, context, settings);
            var currentRequiresCredentials;
            if (servers && servers.length) {
                var currentServer = getServer(servers, currentAppId);
                if (currentServer) {
                    currentRequiresCredentials = $(".issue-link-applinks-authentication-message", context).hasClass("required");
                    if (currentRequiresCredentials) {
                        currentServer.requireCredentials = true;
                    }
                    helper.selectServer(currentAppId);
                }
                deferred.resolve(context, helper);
            } else {
                deferred.reject(context);
            }
        });
    }

    /**
     * @return jQuery.Promise<String>
     */
    function init(settings, context) {
        var deferred = $.Deferred();

        var isIssueLinkAppLinkContent = $(".issue-link-applinks-authentication-message", context).length !== 0;
        if (isIssueLinkAppLinkContent && settings.shouldExecute(context)) {
            initApplinkServers(settings, context, deferred);
        }

        return deferred.promise();
    }

    return {
        init: init
    };
})(AJS.$);

/* module-key = 'com.atlassian.jira.jira-issue-link-remote-jira-plugin:issue-link-remote-jira-js', location = 'js/issuelink-jira.js' */
/**
 * Initialises OAuth authentication for JIRA Application Links. Requires the following elements:
 * <div class="issue-link-applinks-authentication-message"></div>
 */
(function ($) {

    var settings = {
        getCurrentAppId: function (context) {
            return $("#jira-app-link", context).val();
        },
        shouldExecute: function (context) {
            return $("#jira-app-link", context).length !== 0;
        }
    };

    var updateIssuePicker = function($select, appId) {
        if ($select.length) {
            // Update the appId param
            $select.attr("data-ajax-options.data.app-id", appId);
            if (appId && appId !== "") {
                // Set the url for remote JIRA queries
                $select.attr("data-ajax-options.url", contextPath + "/rest/remoteJiraIssueLink/1/remoteJira/picker");
            }
            else {
                // Set the url for local JIRA queries
                $select.attr("data-ajax-options.url", contextPath + "/rest/api/1.0/issues/picker");
            }
        
            $select.trigger("updateOptions");

            // Now that we have changed server, our current issue selection is no longer relevant
            $select.trigger("clearSelection");
        }
    };

    var updateCreateReciprocalCheckbox = function(appId, context) {
        var $reciprocalCheckbox = $("#create-reciprocal", context);
        if ($reciprocalCheckbox.length) {
            if (appId && appId !== "") {
                // Get default choice for creating a remote reciprocal link
                var defaultChoice = ($("#create-reciprocal-default", context).val() == "true");
                if (defaultChoice) {
                    $reciprocalCheckbox.attr("checked", "checked");
                } else {
                    $reciprocalCheckbox.removeAttr("checked");
                }
                $reciprocalCheckbox.removeAttr("disabled");
                $("#create-reciprocal-fieldset", context).removeClass("disabled");
            } else {
                // Set to checked for local links, as they always create a reciprocal link
                $reciprocalCheckbox.attr("checked", "checked");
                $reciprocalCheckbox.attr("disabled", "disabled");
                $("#create-reciprocal-fieldset", context).addClass("disabled");
            }
        }
    };

    JIRA.bind(JIRA.Events.NEW_PAGE_ADDED, function (e, context) {

        var $select = $("#jira-issue-keys", context);
        if ($select.length) {
            var appId = $("#jira-app-link", context).val();
            updateIssuePicker($select, appId);
            updateCreateReciprocalCheckbox(appId, context);
        }

        IssueLinkAppLinks.init(settings, context).done(function (context, helper) {
            $("#jira-app-link", context).change(function () {
                var appId = $(this).val();
                helper.selectServer(appId);
                updateIssuePicker($select, appId);
                updateCreateReciprocalCheckbox(appId, context);
            });
        });
    });
})(AJS.$);

/* module-key = 'jira.webresources:jqlautocomplete', location = '/includes/jira/autocomplete/JQLAutoComplete.js' */
(function(){var jql_order_by=[{value:"ORDER BY",displayName:"ORDER BY"}];var jql_operators=[{value:"=",displayName:"="},{value:"!=",displayName:"!="},{value:"~",displayName:"~"},{value:"<=",displayName:"&lt;="},{value:">=",displayName:"&gt;="},{value:">",displayName:"&gt;"},{value:"<",displayName:"&lt;"},{value:"!~",displayName:"!~"},{value:"is not",displayName:"is not"},{value:"is",displayName:"is"},{value:"not in",displayName:"not in"},{value:"in",displayName:"in"},{value:"was",displayName:"was"},{value:"was not",displayName:"was not"},{value:"was in",displayName:"was in"},{value:"was not in",displayName:"was not in"},{value:"changed",displayName:"changed"}];var jql_logical_operators=[{value:"AND",displayName:"AND"},{value:"OR",displayName:"OR"}];var jql_logical_operators_and_order_by=jql_logical_operators.concat(jql_order_by);var jql_order_by_direction=[{value:"ASC",displayName:"ASC"},{value:"DESC",displayName:"DESC"}];var empty_operand=[{value:"EMPTY",displayName:"EMPTY",types:["java.lang.Object"]}];var jql_not_logical_operator=[{value:"NOT",displayName:"NOT"}];var jql_was_predicates=[{value:"AFTER",displayName:"AFTER",type:"java.util.Date",supportsList:"false"},{value:"BEFORE",displayName:"BEFORE",type:"java.util.Date",supportsList:"false"},{value:"BY",displayName:"BY",type:"com.atlassian.crowd.embedded.api.User",supportsList:"false",auto:"true"},{value:"DURING",displayName:"DURING",type:"java.util.Date",supportsList:"true"},{value:"ON",displayName:"ON",type:"java.util.Date",supportsList:"false"}];var jql_changed_predicates=jql_was_predicates.concat([{value:"FROM",displayName:"FROM",type:"java.lang.String",supportsList:"true",auto:"true"},{value:"TO",displayName:"TO",type:"java.lang.String",supportsList:"true",auto:"true"}]);var jql_was_predicates_and_order_by=jql_was_predicates.concat(jql_logical_operators_and_order_by);var jql_was_predicates_and_logical_operators=jql_was_predicates.concat(jql_logical_operators);var jql_changed_predicates_and_order_by=jql_changed_predicates.concat(jql_logical_operators_and_order_by);var jql_changed_predicates_and_logical_operators=jql_changed_predicates.concat(jql_logical_operators);var REGEXP_ANDS=/^AND\s/i;var REGEXP_ORS=/^OR\s/i;var REGEXP_NOTS=/^NOT\s/i;var REGEXP_SNOT=/^\s+not/i;var REGEXP_SIN=/^\s+in/i;var REGEXP_SNOT_IN=/^\s+(not\s+in|not|in)/i;var REGEXP_COMMA_DELIMITER=/^\s*,/;var REGEXP_ASCENDING=/^\s+asc/i;var REGEXP_DESCENDING=/^\s+desc/i;var REGEXP_ORDER_BY=/^order\s+by/i;var REGEXP_WHITESPACE=/^\s/;var REGEXP_UNICODE=/^u[a-fA-F0-9]{4}/;var REGEXP_FIELD_NAME=/^\s-\scf\[\d\d\d\d\d\]/;var REGEXP_NEW_LINE=/[\r\n]/;var REGEXP_NUMBER=/\d/;var REGEXP_TOKEN_CHAR=/[^=!~<>(),\s&|]/;var REGEXP_SPECIAL_CHAR=/[{}*\/%+$#@?.;\][]/;var REGEXP_SPACE_OR_ELSE=/[\s(]/;var REGEXP_CHARS_TO_ESCAPE=/[^trn"'\\\s]/;var REGEXP_NOTSTART=/^NO?$/i;var REGEXP_INSTART=/^IN?$/i;var REGEXP_PREDICATE=/^(after|before|by|during|from|on|to)/i;JIRA.JQLAutoComplete=function(options){var that=begetObject(JIRA.AutoComplete);var parser=options.parser;var result;var jql_field_names=jQuery.grep(options.jqlFieldNames,function(arrValue){return arrValue.searchable});var jql_order_by_field_names=jQuery.grep(options.jqlFieldNames,function(arrValue){return arrValue.orderable});var jql_function_names=options.jqlFunctionNames;var PARSE_INDICATOR=jQuery("#"+options.errorID);var suggestionCount=0;var jqlcolumnnum=jQuery("#jqlcolumnnum");var jqlrownum=jQuery("#jqlrownum");var autoCompleteUrl=options.autoCompleteUrl||contextPath+"/rest/api/1.0/jql/autocomplete";that.textToSuggestionCursorPosition=function(){return this.field.selectionRange().textBefore};that.pushSuggestionsOnHtmlStack=function(suggestions,suggestionNodes,htmlParts,listItemIdentifier,mayNeedParenthesis){var length=Math.min(15,suggestions.length);for(var i=0;i<length;i++){var actualValueSug;var displayNameSug;if(suggestions[i].value){var resultSug=suggestions[i];if(result&&mayNeedParenthesis){actualValueSug=((result.getNeedsOpenParen())?"(":"")+resultSug.value}else{actualValueSug=resultSug.value}displayNameSug=resultSug.displayName}else{displayNameSug=suggestions[i];actualValueSug=displayName}suggestionNodes.push(actualValueSug);htmlParts.push('<li id="',listItemIdentifier,i,'">',displayNameSug,"</li>")}};that.renderSuggestions=function(suggestions,moreSuggestions,operatorSuggestions){var suggestionNodes=[];if(suggestions instanceof Array){if(suggestions.length<1&&(moreSuggestions&&moreSuggestions.length<1)&&(operatorSuggestions&&operatorSuggestions.length<1)){return suggestionNodes}var htmlParts=["<ul>"];if(operatorSuggestions&&operatorSuggestions.length>0){that.pushSuggestionsOnHtmlStack(operatorSuggestions,suggestionNodes,htmlParts,"jql_operator_suggest_",false)}that.pushSuggestionsOnHtmlStack(suggestions,suggestionNodes,htmlParts,"jql_value_suggest_",true);if(moreSuggestions&&moreSuggestions.length>0){that.pushSuggestionsOnHtmlStack(moreSuggestions,suggestionNodes,htmlParts,"jql_function_suggest_",false)}htmlParts.push("</ul>");var syntaxHelpLink=AJS.$('<a class="syntax-help" target="_jiraHelp"></a>').attr("title",AJS.Meta.get("advanced-search-help-title")).attr("href",AJS.Meta.get("advanced-search-help-url")).text("\u8BED\u6CD5");var syntaxHelpContainer=AJS.$('<div class="syntax-help-container">').append(syntaxHelpLink);that.responseContainer.html(htmlParts.join("")).append(syntaxHelpContainer).find("li").each(function(i){suggestionNodes[i]=[jQuery(this),suggestionNodes[i]]});that.addSuggestionControls(suggestionNodes)}return suggestionNodes};that.completeField=function(value){var start=that.getReplacementStartIndex(result,value);var end=that.getReplacementEndIndex(result,start);that.replaceValue(start,end,value);var newToken=parser.parse(this.field.val());that.updateParseIndicator(newToken)};that.prepareOperandSuggestions=function(canAutoComplete,fieldName,functionSuggestions,operatorSuggestions,suggestedValue){if(canAutoComplete){var currentSuggestionCount=suggestionCount;var fieldValue=(suggestedValue==null)?((result.getLastOperand()===null)?"":that.stripEscapeCharacters(result.getLastOperand())):suggestedValue;var fieldNameValueKey=fieldName+":"+fieldValue;var data={fieldName:that.stripEscapeCharacters(fieldName)};if(result.getLastOperand()!==null||suggestedValue!==null){data.fieldValue=fieldValue}var includeEmpty=that.isWasOperator(result.getLastOperator());if(!that.getSavedResponse(fieldNameValueKey)){that.dropdownController.dropdown.removeClass("dropdown-ready");this.delay(function(){that._makeRequest({url:autoCompleteUrl,dataType:"json",data:data,success:function(response){var results;if(response!==null&&response.results!==null){results=response.results}else{results=[]}if(includeEmpty){var suggestion=data.fieldValue;results=that.appendEmpty(suggestion,results)}that.saveResponse(fieldNameValueKey,results);that.renderSuggestionsForOperands(fieldValue,results,functionSuggestions,operatorSuggestions,currentSuggestionCount)},error:function(){that.renderSuggestionsForOperands(fieldValue,[],functionSuggestions,operatorSuggestions,currentSuggestionCount)}})},that.queryDelay)}else{that.renderSuggestionsForOperands(fieldValue,that.getSavedResponse(fieldNameValueKey),functionSuggestions,operatorSuggestions,currentSuggestionCount)}}else{that.renderSuggestionsForOperands(that.stripEscapeCharacters(result.getLastOperand()),[],functionSuggestions,operatorSuggestions,suggestionCount)}};that.preparePredicateSuggestions=function(predicateName,suggestedValue){var currentSuggestionCount=suggestionCount;if(typeof suggestedValue=="undefined"){suggestedValue=null}var functionSuggestions=that.slimListForPredicates(suggestedValue,jql_function_names,predicateName);that.boldMatchingString(suggestedValue,functionSuggestions);var predicateValue=(suggestedValue==null)?((result.getLastOperand()===null)?"":that.stripEscapeCharacters(result.getLastOperand())):suggestedValue;var predicateNameValueKey=predicateName+":"+predicateValue;var data={predicateName:that.stripEscapeCharacters(predicateName)};if(result.getLastOperand()!==null||suggestedValue!==null){data.predicateValue=predicateValue}if(result.getLastFieldName()!==null){data.fieldName=result.getLastFieldName();predicateNameValueKey=result.getLastFieldName()+":"+predicateNameValueKey}if(that.predicateSupportsAutoComplete(predicateName)){if(!that.getSavedResponse(predicateNameValueKey)){that.dropdownController.dropdown.removeClass("dropdown-ready");this.delay(function(){that._makeRequest({url:autoCompleteUrl,dataType:"json",data:data,success:function(response){var results;if(response!==null&&response.results!==null){results=response.results}else{results=[]}var suggestion=data.predicateValue;results=that.appendEmpty(suggestion,results);that.saveResponse(predicateNameValueKey,results);that.renderSuggestions(results,functionSuggestions)},error:function(){that.renderSuggestionsForOperands(predicateValue,[])}})},that.queryDelay)}else{that.renderSuggestions(that.getSavedResponse(predicateNameValueKey),functionSuggestions)}}else{that.renderSuggestions([],functionSuggestions)}};that.incompleteOperator=function(){var tokens=result.getTokens();if(tokens==null||tokens.length<2){return""}else{var tokens=that.textToSuggestionCursorPosition().split(" ");if(tokens.length>2){return tokens[tokens.length-1]}}return""};that.incompletePredicateValue=function(){var tokens=result.getTokens();if(tokens==null||tokens.length<3){return""}else{var tokens=that.textToSuggestionCursorPosition().split(/[\s(,]+/);if(tokens.length>3){return tokens[tokens.length-1]}}return""};that.appendEmpty=function(suggestion,results){var empty_list=that.slimListForMapResults(suggestion,empty_operand,true);if(suggestion!=null){that.boldMatchingString(suggestion,empty_list)}if(results.length<15){results=results.concat(empty_list)}else{results[14]=empty_list[0]}return results};that.dispatcher=function(val){var that=this;var selectionRange=jQuery(that.field).selectionRange();var parseValue=val.substring(0,selectionRange.start);result=parser.parse(parseValue).getResult();suggestionCount++;if(result.getNeedsField()){that.renderSuggestionsFromMap(that.stripEscapeCharacters(result.getLastFieldName()),jql_field_names,jql_not_logical_operator,true)}else{if(result.getNeedsOperatorOrOperand()){var operator=result.getLastOperator();var operatorLength=operator.length;var parsedOperator=(operator.length>0)?parseValue.substr(result.getLastOperatorStartIndex()):null;var functionSuggestions=(that.isEmptyOnlyOperator(result.getLastOperator()))?empty_operand:jql_function_names;var operatorSuggestions=that.getSuggestionsForOperators(parsedOperator,jql_operators);if(operatorLength>0){var numSpaces=operator.length-(operator.replace(/\s+/g,"")).length;result.setLastOperandStartIndex(result.getLastOperatorStartIndex()+operatorLength+numSpaces+1)}if(operatorSuggestions&&operatorSuggestions.length>0){var tokens=result.getTokens();var operandSuggestion=that.incompleteOperator();that.prepareOperandSuggestions(true,result.getLastFieldName(),functionSuggestions,operatorSuggestions,operandSuggestion)}}else{if(result.getNeedsOperator()){that.renderSuggestionsForOperators(result.getLastOperator(),jql_operators)}else{if(result.getNeedsPredicateOperand()){var predicate=result.getLastWasPredicate();that.preparePredicateSuggestions(predicate,that.stripEscapeCharacters(result.getLastOperand()))}else{if(result.getNeedsLogicalOperator()){if(result.getNeedsWasPredicate()){if(result.getNeedsOrderBy()){var value=(result.getLastOrderBy()===null)?result.getLastWasPredicate():result.getLastOrderBy();if(result.getLastOperator()=="was"){that.renderSuggestionsFromMap(value,jql_was_predicates_and_order_by,false)}else{that.renderSuggestionsFromMap(value,jql_changed_predicates_and_order_by,false)}}else{if(result.getLastOperator()=="was"){that.renderSuggestionsFromMap(result.getLastWasPredicate(),jql_was_predicates_and_logical_operators,false)}else{that.renderSuggestionsFromMap(result.getLastWasPredicate(),jql_changed_predicates_and_logical_operators,false)}}}else{if(result.getNeedsOrderBy()){var value=(result.getLastOrderBy()===null)?result.getLastLogicalOperator():result.getLastOrderBy();that.renderSuggestionsFromMap(value,jql_logical_operators_and_order_by,false)}else{that.renderSuggestionsFromMap(result.getLastLogicalOperator(),jql_logical_operators,false)}}}else{if(result.getNeedsOrderByField()){that.renderSuggestionsFromMap(that.stripEscapeCharacters(result.getLastOrderByFieldName()),jql_order_by_field_names,true)}else{if(result.getNeedsOrderByDirection()){that.renderSuggestionsFromMap(result.getLastOrderByDirection(),jql_order_by_direction,false)}else{if(result.getNeedsOperand()){var fieldName=result.getLastFieldName();var canAutoComplete=false;if(!that.isEmptyOnlyOperator(result.getLastOperator())){for(var i=0;i<jql_field_names.length;i++){if(that.equalsIgnoreCase(result.getUnquotedString(jql_field_names[i].value),fieldName)||(jql_field_names[i].cfid&&that.equalsIgnoreCase(jql_field_names[i].cfid,fieldName))){canAutoComplete=jql_field_names[i].auto;break}}}var functionSuggestions=(that.isEmptyOnlyOperator(result.getLastOperator()))?empty_operand:jql_function_names;that.prepareOperandSuggestions(canAutoComplete,fieldName,functionSuggestions,{})}else{if(result.getNeedsOrderBy()){that.renderSuggestionsFromMap(result.getLastOrderBy(),jql_logical_operators_and_order_by,false)}else{that.dropdownController.hideDropdown()}}}}}}}}}that.parse(val)};that.stripEscapeCharacters=function(val){if(val==null){return val}var newVal="";var strArr=val.split("");for(var i=0;i<strArr.length;i++){if(strArr[i]=="\\"){if(!REGEXP_UNICODE.test(val.substring(i,val.length))){i++;if(i>=val.length){break}}}newVal+=strArr[i]}return newVal};that.parse=function(val){var newToken=parser.parse(val);that.updateParseIndicator(newToken);that.updateColumnLineCount();return newToken.getResult()};that.renderSuggestionsFromMap=function(stringVal,list,otherSuggestions,showFull){if(!otherSuggestions){otherSuggestions={}}var suggestions=that.slimListForMapResults(stringVal,list,showFull);var relevantOtherSuggestions=that.slimListForMapResults(stringVal,otherSuggestions,showFull);that.boldMatchingString(stringVal,relevantOtherSuggestions);that.boldMatchingString(stringVal,suggestions);that.renderSuggestions(suggestions,relevantOtherSuggestions);if(suggestions.length===0&&relevantOtherSuggestions.length===0){that.dropdownController.hideDropdown()}};that.getSuggestionsForOperators=function(stringVal,list){var suggestions=that.slimListForMapResults(stringVal,list,false);var fieldName=result.getLastFieldName();var supportedOperators;for(var i=0;i<jql_field_names.length;i++){if(that.equalsIgnoreCase(result.getUnquotedString(jql_field_names[i].value),fieldName)||(jql_field_names[i].cfid&&that.equalsIgnoreCase(jql_field_names[i].cfid,fieldName))){supportedOperators=jql_field_names[i].operators;break}}if(supportedOperators){suggestions=jQuery.grep(suggestions,function(arrValue){return jQuery.inArray(arrValue.value,supportedOperators)>-1})}that.boldMatchingString(stringVal,suggestions);return suggestions};that.renderSuggestionsForOperators=function(stringVal,list){var suggestions=that.getSuggestionsForOperators(stringVal,list);that.renderSuggestions(suggestions);if(suggestions.length===0){that.dropdownController.hideDropdown()}};that.renderSuggestionsForOperands=function(stringVal,ajaxSuggestions,functions,operatorSuggestions,providedSuggestionCount){if(providedSuggestionCount===suggestionCount){var functionsSuggestions=that.slimListForFunctionResults(stringVal,functions,result.getLastOperator());that.boldMatchingString(stringVal,functionsSuggestions);that.renderSuggestions(ajaxSuggestions,functionsSuggestions,operatorSuggestions);if(ajaxSuggestions.length===0&&functionsSuggestions.length===0&&operatorSuggestions.length==0){that.dropdownController.hideDropdown()}}};that.boldMatchingString=function(stringVal,list){if(stringVal==null||list.length===0){return }var boldLength=stringVal.length;for(var j=0,n=boldLength;j<n;j++){switch(stringVal.charAt(j)){case"<":case">":boldLength+=3;break;case"&":boldLength+=4;break;case'"':boldLength+=5;break}}for(var i=0;i<list.length;i++){if(list[i].displayName){var origVal=list[i].displayName;list[i]={value:list[i].value,displayName:"<b>"+origVal.substring(0,boldLength)+"</b>"+origVal.substring(boldLength)}}else{list[i]={value:list[i],displayName:"<b>"+list[i].substring(0,boldLength)+"</b>"+list[i].substring(boldLength)}}}};that.htmlEscape=function(stringVal){if(stringVal==null){return null}var escapedVal="";var strArr=stringVal.split("");for(var j=0;j<strArr.length;j++){if(strArr[j]==="<"){escapedVal+="&lt;"}else{if(strArr[j]===">"){escapedVal+="&gt;"}else{if(strArr[j]==="&"){escapedVal+="&amp;"}else{if(strArr[j]==='"'){escapedVal+="&quot;"}else{escapedVal+=strArr[j]}}}}}return escapedVal},that.getReplacementStartIndex=function(result,value){var jQueryReference=jQuery(this.field);var start;if(result.getNeedsField()){start=result.getLastFieldNameStartIndex()}else{if(result.getNeedsOperatorOrOperand()){if(result.getNeedsOperator()&&that.isWasOperator(value)){start=result.getLastOperatorStartIndex()}else{start=result.getLastOperandStartIndex()}}else{if(result.getNeedsOperand()){start=result.getLastOperandStartIndex()}else{if(result.getNeedsOperator()){start=result.getLastOperatorStartIndex()}else{if(result.getNeedsOrderByField()){start=result.getLastOrderByFieldNameStartIndex()}else{if(result.getNeedsOrderByDirection()){start=result.getLastOrderByDirectionStartIndex()}else{if(result.getNeedsPredicateOperand()){start=result.getLastOperandStartIndex()}else{if(result.getNeedsLogicalOperator()){if(result.getLastLogicalOperatorStartIndex()!==null&&result.getLastLogicalOperatorStartIndex()!==0){start=result.getLastLogicalOperatorStartIndex()}else{if(result.getLastOrderBy()!==null&&result.getLastOrderByStartIndex()!==0){start=result.getLastOrderByStartIndex()}else{if(result.getLastWasPredicate()!=null&&result.getLastWasPredicateStartIndex()!==0){start=result.getLastWasPredicateStartIndex()}else{if(result.getMustBeOperatorOrPredicate()===true){start=jQueryReference.selectionRange().start}else{start=jQueryReference.selectionRange().start-1}}}}}else{if(result.getNeedsWasPredicate()){start=result.getLastWasPredicateStartIndex()}else{if(result.getNeedsOrderBy()){start=result.getLastOrderByStartIndex()}else{start=jQueryReference.selectionRange().start-1}}}}}}}}}}return start!=null?start:jQueryReference.selectionRange().start};that.getReplacementEndIndex=function(result,start){var jQueryReference=jQuery(this.field);var selectionRange=jQueryReference.selectionRange();var end=null;if(selectionRange.start===selectionRange.end&&selectionRange.end!==this.field.val().length){var currentTokenIdx=result.getTokens().length-1;var token=parser.parse(this.field.val());if(!token.getParseError()){var fullTokenValue=token.getResult().getTokens()[currentTokenIdx];if(fullTokenValue!==null&&fullTokenValue!=="("&&fullTokenValue!==")"){var fullTextVal=this.field.val();var remainingString=fullTextVal.substring(start,fullTextVal.length);var remainingStringArr=remainingString.split("");var whitespaceCount=0;for(var i=0;i<remainingStringArr.length;i++){if(REGEXP_WHITESPACE.test(remainingStringArr[i])){whitespaceCount++}else{break}}end=start+fullTokenValue.length+whitespaceCount}}}if(end===null){end=selectionRange.end}if(end<start){that.replaceValue(start,end," ");end=start}return end};that.replaceValue=function(start,end,newValue){var jQueryReference=jQuery(this.field);jQueryReference.selectionRange(start,end);jQueryReference.selection(newValue);var newEnd=jQueryReference.selectionRange().end;jQueryReference.selectionRange(newEnd,newEnd)};that.slimListForMapResults=function(stringVal,list,showFull){var escString=that.htmlEscape(stringVal);var slimedList=jQuery.grep(list,function(arrValue){return that.startsWithIgnoreCaseNullsMeanAll(escString,arrValue.displayName)});if(!showFull){if(slimedList.length===1&&!that.startsWithNotEqualsIgnoreCaseNullMeansAll(escString,slimedList[0].displayName)){return{}}}return slimedList};that.slimListForFunctionResults=function(stringVal,list,operator){var fieldName=result.getLastFieldName();var supportedTypes;for(var i=0;i<jql_field_names.length;i++){if(that.equalsIgnoreCase(result.getUnquotedString(jql_field_names[i].value),fieldName)||(jql_field_names[i].cfid&&that.equalsIgnoreCase(jql_field_names[i].cfid,fieldName))){supportedTypes=jql_field_names[i].types;break}}var slimedList=jQuery.grep(list,function(arrValue){if((arrValue.isList&&!that.isListSupportingOperator(operator))||(!arrValue.isList&&that.isListSupportingOperator(operator))){return false}if(supportedTypes){var supportsFunction=jQuery.inArray("java.lang.Object",arrValue.types)>-1||jQuery.inArray("java.lang.Object",supportedTypes)>-1;for(var i=0;i<supportedTypes.length&&!supportsFunction;i++){supportsFunction=jQuery.inArray(supportedTypes[i],arrValue.types)!==-1}if(!supportsFunction){return false}}else{return false}return that.startsWithIgnoreCaseNullsMeanAll(stringVal,arrValue.value)||that.startsWithIgnoreCaseNullsMeanAll(stringVal,arrValue.displayName)});if(slimedList.length===1&&!that.startsWithNotEqualsIgnoreCaseNullMeansAll(stringVal,slimedList[0].displayName)){return{}}return slimedList};that.slimListForPredicates=function(stringVal,list,predicate){var supportedType;var supportsList;for(var i=0;i<jql_changed_predicates.length;i++){if(that.equalsIgnoreCase(result.getUnquotedString(jql_changed_predicates[i].value),predicate)){supportedType=jql_changed_predicates[i].type;supportsList=jql_changed_predicates[i].supportsList;break}}var slimedList=jQuery.grep(list,function(arrValue){if(typeof arrValue.isList!="undefined"){if((arrValue.isList&&!!supportsList)||(!arrValue.isList&&supportsList)){return false}}var supportsFunction=jQuery.inArray(supportedType,arrValue.types)!==-1;return supportsFunction?that.startsWithIgnoreCaseNullsMeanAll(stringVal,arrValue.value)||that.startsWithIgnoreCaseNullsMeanAll(stringVal,arrValue.displayName):false});if(slimedList.length===1&&!that.startsWithNotEqualsIgnoreCaseNullMeansAll(stringVal,slimedList[0].displayName)){return{}}return slimedList};that.predicateSupportsAutoComplete=function(predicate){var auto;for(var i=0;i<jql_changed_predicates.length;i++){if(that.equalsIgnoreCase(result.getUnquotedString(jql_changed_predicates[i].value),predicate)){auto=jql_changed_predicates[i].auto;break}}return auto};that.isListSupportingOperator=function(operator){return operator==="in"||operator==="not in"||operator=="was not in"||operator=="was in"};that.isEmptyOnlyOperator=function(operator){return operator==="is"||operator==="is not"};that.isWasOperator=function(operator){return operator==="was"||operator==="was in"||operator=="was not in"||operator=="was not"};that.isChangedOperator=function(operator){return operator==="changed"};that.isHistoryOperator=function(operator){return this.isWasOperator(operator)||this.isChangedOperator(operator)};that.startsWithIgnoreCaseNullsMeanAll=function(startStr,str){if(str===null||startStr===null){return true}if(str.length<startStr.length){return false}else{return startStr.toLowerCase()==str.substr(0,startStr.length).toLowerCase()}};that.startsWithNotEqualsIgnoreCaseNullMeansAll=function(startStr,str){if(str===null||startStr===null){return true}if(str.length<startStr.length){return false}else{var subStrEquals=startStr.toLowerCase()==str.substr(0,startStr.length).toLowerCase();if(subStrEquals){var equalsString=null;if(REGEXP_FIELD_NAME.test(str.substr(startStr.length,str.length))){equalsString=str.substr(0,startStr.length)}else{equalsString=str}return startStr.toLowerCase()!=equalsString.toLowerCase()}return false}};that.equalsIgnoreCase=function(str1,str2){if(str1===null&&str2===null){return true}else{if(str1===null||str1===null){return false}else{return str1.toLowerCase()===str2.toLowerCase()}}};that.getSavedResponse=function(val){if(!this.requested){this.requested={}}return this.requested[val]};that.saveResponse=function(val,response){if(typeof val==="string"&&typeof response==="object"){if(!this.requested){this.requested={}}this.requested[val]=response}};that.startsWithIgnoreCase=function(startStr,str){if(str===null||startStr===null||str.length<startStr.length){return false}else{return startStr.toLowerCase()==str.substr(0,startStr.length).toLowerCase()}};that.updateParseIndicator=function(token){if(token.getParseError()){PARSE_INDICATOR.attr("title",token.getResult().getParseErrorMsg()).removeClass("jqlgood").addClass("jqlerror")}else{PARSE_INDICATOR.attr("title","").removeClass("jqlerror").addClass("jqlgood")}};that.updateColumnLineCount=function(){var jQueryReference=jQuery(that.field);var totalCharCountToCursor=0;if(that.field[0]===document.activeElement){var selectionRange=jQueryReference.selectionRange();totalCharCountToCursor=selectionRange.start}else{totalCharCountToCursor=that.field[0].value.length}var rowCount=1;var colCount=1;var fieldValue=that.field.val();for(var i=0;i<totalCharCountToCursor;i++){if(REGEXP_NEW_LINE.test(fieldValue.charAt(i))){rowCount++;colCount=1}else{colCount++}}jqlcolumnnum.text(colCount);jqlrownum.text(rowCount)};that.init(options);return that};JIRA.JQLAutoComplete.MyParser=function(jqlReservedWords){var jql_reserved_words=jqlReservedWords;return{parse:function(input){var token=JIRA.JQLAutoComplete.Token();token.init(input);this.jql(token);return token},orderByClause:function(token){var remainingString=token.remainingString();var matchArray=remainingString.match(REGEXP_ORDER_BY);if(matchArray){var orderByString=remainingString.substring(0,matchArray[0].length);token.consumeCharacters(orderByString.length);token.getResult().setLastOrderBy(orderByString,token);if(!token.isComplete()){remainingString=token.remainingString();if(REGEXP_WHITESPACE.test(remainingString)){this.chewWhitespace(token);this.orderByFields(token)}else{token.getResult().resetLogicalOperators();token.setParseError()}}else{token.getResult().resetLogicalOperators();token.setParseError()}}else{token.consumeCharacters(remainingString.length);token.getResult().setLastOrderBy(remainingString,token);token.setParseError()}},orderByFields:function(token){this.orderByField(token);this.chewWhitespace(token);if(token.isComplete()){if(!token.getResult().getNeedsOrderByField()){token.getResult().setLastOrderByDirection("",token)}}else{var remainingString=token.remainingString();if(this.startsWithIgnoreCase(",",remainingString)){token.consumeCharacter();this.orderByFields(token);this.chewWhitespace(token)}else{remainingString=token.remainingString();if(remainingString!==null){token.consumeCharacters(remainingString.length)}token.getResult().setNeedsOrderByDirection();token.getResult().setLastOrderByDirection(remainingString,token);token.setParseError()}}},orderByField:function(token){this.chewWhitespace(token);var fieldName=this.fieldName(token);if(fieldName.length!==0){token.getResult().setLastOrderByFieldName(fieldName,token);var remainingString=token.remainingString();if(!token.isComplete()&&!REGEXP_COMMA_DELIMITER.test(remainingString)){if(REGEXP_ASCENDING.test(remainingString)){this.chewWhitespace(token);token.consumeCharacters(3);token.getResult().setLastOrderByDirection("asc",token);token.getResult().setNeedsOrderByComma()}else{if(REGEXP_DESCENDING.test(remainingString)){this.chewWhitespace(token);token.consumeCharacters(4);token.getResult().setLastOrderByDirection("desc",token);token.getResult().setNeedsOrderByComma()}else{token.getResult().setNeedsOrderByDirection()}}}else{token.getResult().setNeedsOrderByField();this.chewWhitespace(token)}}else{token.getResult().setLastOrderByFieldName("",token);token.getResult().setNeedsOrderByField();token.setParseError()}},jql:function(token){this.orClause(token);var remainingString=token.remainingString();if(this.startsWithIgnoreCase("ord",remainingString)){this.orderByClause(token)}},orClause:function(token){while(!token.isComplete()&&!this.startsWithIgnoreCase(")",token.remainingString())){this.chewWhitespace(token);var remainingString=token.remainingString();if(this.startsWithIgnoreCase("ord",remainingString)){break}if(token.getResult().getMustBeOperatorOrPredicate()){token.getResult().resetLastPredicates()}else{token.getResult().resetLogicalOperators();this.andClause(token)}if(!token.isComplete()&&token.getResult().getLastLogicalOperator()===null){if(token.getResult().getNeedsWasPredicate()){this.predicateClause(token)}if(token.isComplete()){return }remainingString=token.remainingString();if(this.startsWithIgnoreCase("ord",remainingString)){break}else{if(remainingString!==null&&(REGEXP_ORS.test(remainingString)||this.startsWithIgnoreCase("|",remainingString)||this.startsWithIgnoreCase("||",remainingString))){if(this.startsWithIgnoreCase("||",remainingString)){token.getResult().setLastLogicalOperator("||",token.getTokenStringIdx());token.consumeCharacters(2)}else{if(REGEXP_ORS.test(remainingString)){token.getResult().setLastLogicalOperator("OR",token.getTokenStringIdx());token.consumeCharacters(3)}else{token.getResult().setLastLogicalOperator("|",token.getTokenStringIdx());token.consumeCharacters(1)}}token.getResult().resetTerminalClause();if(token.isComplete()){token.setParseError()}token.getResult().setNeedsField()}else{if(!this.startsWithIgnoreCase(")",remainingString)||!token.getInParens()){this.chewWhitespace(token);var errorIdx=(remainingString===null)?token.getMaxTokenStringIdx():token.getMaxTokenStringIdx()-remainingString.length;var tokens;if(remainingString!=null){tokens=remainingString.split(" ");token.getResult().setLastLogicalOperator(tokens[0],errorIdx);token.getResult().setLastWasPredicate(tokens[0],token);token.getResult().setNeedsLogicalOperator(token)}if(token.getResult().getLastWasOperator()==null){token.setParseError()}else{if(tokens!=null){if(REGEXP_PREDICATE.test(tokens[0])){token.getResult().setLastLogicalOperator(null);token.getResult().resetNeedsPredicateOperand()}else{if(REGEXP_ANDS.test(remainingString)){token.consumeCharacters(4);token.getResult().resetTerminalClause();token.getResult().setNeedsField()}if(token.isComplete()||tokens.length==1){token.setParseError()}}}}}}}}}},andClause:function(token){this.chewWhitespace(token);this.notClause(token);if(!token.isComplete()&&token.getResult().getLastLogicalOperator()===null){this.chewWhitespace(token);var remainingString=token.remainingString();if(remainingString!==null&&(REGEXP_ANDS.test(remainingString)||this.startsWithIgnoreCase("&",remainingString)||this.startsWithIgnoreCase("&&",remainingString))){if(this.startsWithIgnoreCase("&&",remainingString)){token.getResult().setLastLogicalOperator("&&",token.getTokenStringIdx());token.consumeCharacters(2)}else{if(this.startsWithIgnoreCase("&",remainingString)){token.getResult().setLastLogicalOperator("&",token.getTokenStringIdx());token.consumeCharacters(1)}else{token.getResult().setLastLogicalOperator("AND",token.getTokenStringIdx());token.consumeCharacters(4)}}token.getResult().resetTerminalClause();if(token.isComplete()){token.setParseError()}token.getResult().setNeedsField()}else{token.getResult().setNeedsLogicalOperator(token);if(token.isComplete()){token.getResult().setLastLogicalOperator(null,token.getMaxTokenStringIdx())}}}},notClause:function(token){this.chewWhitespace(token);if(!token.isComplete()){this.chewWhitespace(token);var remainingString=token.remainingString();if(remainingString!==null&&(REGEXP_NOTS.test(remainingString)||this.startsWithIgnoreCase("!",remainingString))){token.getResult().needsField=false;if(this.startsWithIgnoreCase("!",remainingString)){token.getResult().setLastLogicalOperator("!",token.getTokenStringIdx());token.consumeCharacters(1)}else{token.getResult().setLastLogicalOperator("NOT",token.getTokenStringIdx());token.consumeCharacters(4)}token.getResult().resetTerminalClause();if(token.isComplete()){token.setParseError()}token.getResult().setNeedsField()}else{this.terminalClause(token)}}else{this.terminalClause(token);token.setParseError()}},predicateClause:function(token){this.chewWhitespace(token);if(!token.isComplete()){var remainingString=token.remainingString();var tokens=remainingString.split(/[\s(]+/);if(remainingString!==null){token.getResult().setMustBeOperatorOrPredicate(false);if(this.startsWithLogicalOperator(remainingString)){if(tokens.length==1){token.getResult().setLastWasPredicate(tokens[0],token);token.setParseError();return }return }token.getResult().resetNeedsPredicateOperand();token.consumeCharacters(tokens[0].length);token.getResult().setLastWasPredicate(tokens[0],token);if(tokens.length==1){token.setParseError();return }if(this.wasPredicateComplete(tokens[0])){token.getResult().setNeedsPredicateOperand();token.getResult().setLastOperand(null,token);this.predicateOperand(token)}else{token.setParseError()}}}else{token.setParseError()}},predicateOperand:function(token){this.chewWhitespace(token);var predicateOperand=this.collectPredicateOperands(token);if(predicateOperand==null||predicateOperand==""){token.getResult().setLastOperandStartIndex(token.getTokenStringIdx());token.setParseError()}if(token.remainingString()!=null){token.getResult().resetNeedsPredicateOperand();token.getResult().resetLastPredicates();token.getResult().setMustBeOperatorOrPredicate(true);token.getResult().setNeedsLogicalOperator(token);this.chewWhitespace(token)}},collectPredicateOperands:function(token){if(token.getResult().getLastWasPredicate()==="DURING"){token.getResult().setNeedsOpenParen(true)}var predicateOperand=this.listOperand(token,true);if(predicateOperand.length===0){predicateOperand=this.functionOperand(token);if(predicateOperand.length===0){predicateOperand=this.singleValueOperand(token)}else{token.getResult().setNeedsOpenParen(false)}}else{token.getResult().setNeedsOpenParen(false)}return token.getResult().getUnquotedString(predicateOperand)},terminalClause:function(token){token.getResult().resetTerminalClause();this.chewWhitespace(token);var remainingString=token.remainingString();if(this.startsWithIgnoreCase("(",remainingString)){token.getResult().addToken("(");token.setInParens();token.consumeCharacter();this.orClause(token);this.chewWhitespace(token);remainingString=token.remainingString();if(this.startsWithIgnoreCase(")",remainingString)){token.getResult().addToken(")");token.consumeCharacter();token.setOutOfParens();if(token.isComplete()){token.getResult().resetLogicalOperators();token.getResult().resetLastPredicates()}}else{token.setParseError()}}else{this.field(token);if(!token.isComplete()){this.oper(token);if(!token.isComplete()){if(token.getResult().getLastWasOperator()==="changed"){token.getResult().setNeedsLogicalOperator(token);return }this.operand(token);if(token.getResult().getOperandComplete()){var lastWasOperator=token.getResult().getLastWasOperator();token.getResult().setNeedsNothing();if(lastWasOperator){token.getResult().setLastWasOperator(lastWasOperator)}}else{if(token.isComplete()&&!token.getResult().getNeedsListComma()){token.getResult().setNeedsOperand()}}}else{if(token.getResult().getLastOperator()=="was"||token.getResult().getLastOperator()=="was not"){token.getResult().setNeedsOperandOrOperator()}else{if(token.getResult().getLastWasOperator()==="changed"){var currentChar=token.currentCharacter();if(currentChar!==null&&REGEXP_SPACE_OR_ELSE.test(currentChar)){token.getResult().setNeedsLogicalOperator(token)}else{token.getResult().resetLogicalOperators();token.getResult().setNeedsOrderBy(false)}return }else{token.getResult().setNeedsOperator()}}token.setParseError()}}else{token.getResult().setNeedsField();token.setParseError()}}},field:function(token){var fieldName=this.fieldName(token);if(fieldName.length!==0){token.getResult().setLastFieldName(fieldName,token)}else{if(token.getResult().getLastFieldName()===null){remainingString=token.remainingString();token.getResult().setNeedsField();token.getResult().setLastFieldName(remainingString,token);token.setParseError()}}},fieldName:function(token){this.chewWhitespace(token);var remainingString=token.remainingString();if(this.startsWithIgnoreCase("cf",remainingString)){var origIdx=token.getTokenStringIdx();var origString=token.remainingString();token.consumeCharacters(2);this.chewWhitespace(token);remainingString=token.remainingString();if(this.startsWithIgnoreCase("[",remainingString)){token.consumeCharacter();remainingString=token.remainingString();var custFieldId=this.numberValue(token);if(custFieldId.length!==0){this.chewWhitespace(token);remainingString=token.remainingString();if(this.startsWithIgnoreCase("]",remainingString)){token.consumeCharacter();return origString.substring(0,token.getTokenStringIdx()-origIdx)}}}token.setParseError();return origString}else{return this.fieldOrFunctionName(token)}},oper:function(token){this.chewWhitespace(token);var remainingString=token.remainingString();var operator=this.getLongestOperatorMatch(remainingString,jql_operators);if(operator!==null){token.getResult().setLastOperator(operator,token.getTokenStringIdx());if(this.isWasOperator(operator)||this.isChangedOperator(operator)){token.getResult().setLastWasOperator(operator)}token.consumeCharacters(operator.length);if(operator=="in"||operator=="is"||operator=="is not"||operator=="not in"||operator=="was"||operator=="was not"||operator=="was in"||operator=="was not in"){var currentChar=token.currentCharacter();if(currentChar!==null&&!REGEXP_SPACE_OR_ELSE.test(currentChar)){token.setParseError()}}if(operator=="was"){token.getResult().setNeedsOperandOrOperator();this.chewWhitespace(token);var remainingString=token.remainingString();if(remainingString!=null&&(REGEXP_NOTSTART.test(remainingString)||REGEXP_INSTART.test(remainingString))){token.setParseError()}}else{if(operator=="was not"){token.getResult().setNeedsOperandOrOperator();this.chewWhitespace(token);var remainingString=token.remainingString();if(remainingString!=null&&(REGEXP_INSTART.test(remainingString))){token.setParseError()}}else{if(operator=="changed"){token.getResult().setNeedsLogicalOperator(token)}else{token.getResult().setNeedsOperand()}}}}else{if(token.getResult().getLastOperator()===null){var errorIdx=(remainingString===null)?token.getMaxTokenStringIdx():token.getMaxTokenStringIdx()-remainingString.length;token.getResult().setLastOperator(remainingString,errorIdx);token.getResult().setNeedsOperator();token.setParseError()}}},operand:function(token){this.chewWhitespace(token);if(token.getResult().getLastOperator()==="in"||token.getResult().getLastOperator()==="not in"||token.getResult().getLastOperator()==="was not in"||token.getResult().getLastOperator()==="was in"){token.getResult().setNeedsOpenParen(true)}var operand=this.listOperand(token,true);if(operand.length===0){operand=this.functionOperand(token);if(operand.length===0){operand=this.singleValueOperand(token)}else{token.getResult().setNeedsOpenParen(false)}}else{token.getResult().setNeedsOpenParen(false)}if(operand===null||operand.length===0){var remainingString=token.remainingString();token.getResult().setLastOperand(remainingString,token);token.getResult().setNeedsOperand();token.setParseError()}if(operand.length!==0){return operand}return""},singleValueOperand:function(token){var operand=this.stringValue(token);if(operand.length!==0){token.getResult().setLastOperand(operand,token);if(operand.toLowerCase()!="empty"&&operand.toLowerCase()!="null"&&this.isReservedWord(operand.toLowerCase())){token.setParseError()}return operand}return""},functionOperand:function(token){var startIdx=token.getTokenStringIdx();var functionName=this.fieldOrFunctionName(token);this.chewWhitespace(token);var listArguments=this.listOperand(token,false);if(functionName.length!==0&&listArguments.length!==0){var operand=functionName+listArguments;token.getResult().setLastOperand(operand,token);return operand}else{token.backTrackToIdx(startIdx);return""}},listOperand:function(token,treatAsOperands){if(token.currentCharacter()=="("){token.consumeCharacter();var listValue=this.collectListValues(token,treatAsOperands);var operandVal="("+listValue;this.chewWhitespace(token);if(token.currentCharacter()==")"){token.consumeCharacter();operandVal+=")";if(operandVal=="()"&&treatAsOperands){token.getResult().setLastOperand(operandVal,token)}if(treatAsOperands){token.getResult().setOperandComplete();token.getResult().resetNeedsPredicateOperand()}}else{token.setParseError()}return operandVal}else{return""}},collectListValues:function(token,treatAsOperands){if(treatAsOperands){token.getResult().setNeedsOperand()}this.chewWhitespace(token);var currentOperand=(treatAsOperands)?this.operand(token):this.stringValue(token);if(currentOperand.length!==0){if(this.chewWhitespace(token)&&treatAsOperands){token.getResult().setNeedsListComma()}if(token.currentCharacter()==","){token.consumeCharacter();var nextValue=this.collectListValues(token,treatAsOperands);if(nextValue.length===0){token.setParseError()}return currentOperand+", "+nextValue}else{return currentOperand}}else{return""}},startsWithIgnoreCase:function(startStr,str){if(str===null||startStr===null||str.length<startStr.length){return false}else{return startStr.toLowerCase()==str.substr(0,startStr.length).toLowerCase()}},startsWithLogicalOperator:function(str){if(str===null){return false}else{return this.startsWithOr(str)||this.startsWithAnd(str)||this.startsWithNot(str)||this.startsWithBraces(str)}},startsWithOr:function(str){return this.startsWithIgnoreCase("|",str)||this.startsWithIgnoreCase("||",str)||this.startsWithIgnoreCase("or",str)},startsWithAnd:function(str){return this.startsWithIgnoreCase("&",str)||this.startsWithIgnoreCase("&&",str)||this.startsWithIgnoreCase("and",str)},startsWithNot:function(str){return this.startsWithIgnoreCase("!",str)||this.startsWithIgnoreCase("not",str)},startsWithBraces:function(str){return this.startsWithIgnoreCase("(",str)||this.startsWithIgnoreCase(")",str)},chewWhitespace:function(token){var foundWhiteSpace=false;var currentChar=token.currentCharacter();while(currentChar!==null&&REGEXP_WHITESPACE.test(currentChar)){token.consumeCharacter();currentChar=token.currentCharacter();foundWhiteSpace=true}return foundWhiteSpace},getLongestOperatorMatch:function(value,listOfValues){var longestMatch=null;if(this.startsWithIgnoreCase("is",value)){var matchArray=value.substring(2).match(REGEXP_SNOT);if(matchArray){longestMatch=value.substring(0,matchArray[0].length+2)}else{longestMatch="is"}}if(this.startsWithIgnoreCase("was",value)){var matchArray=value.substring(3).match(REGEXP_SNOT_IN);if(matchArray){longestMatch=value.substring(0,matchArray[0].length+3)}else{longestMatch="was"}}else{if(this.startsWithIgnoreCase("not",value)){var matchArrayNot=value.substring(3).match(REGEXP_SIN);if(matchArrayNot){longestMatch=value.substring(0,matchArrayNot[0].length+3)}}else{for(var i=0;i<listOfValues.length;i++){if(this.startsWithIgnoreCase(listOfValues[i].value,value)){if(longestMatch===null||jql_operators[i].value.length>longestMatch){longestMatch=jql_operators[i].value}}}}}return longestMatch},getValueMinusExtraWhitespace:function(value){if(value===null){return null}var newValue="";var firstWhitespace=true;var valueArr=value.split("");for(var i=0;i<valueArr.length;i++){var currentChar=valueArr[i];if(REGEXP_WHITESPACE.test(currentChar)){if(firstWhitespace){firstWhitespace=false;newValue=newValue+currentChar}}else{firstWhitespace=true;newValue=newValue+currentChar}}return newValue},fieldOrFunctionName:function(token){var stringValue=this.stringValue(token);if(stringValue==='""'||stringValue==="''"){token.setParseError()}if(this.isReservedWord(stringValue.toLowerCase())){token.setParseError()}return stringValue},isReservedWord:function(word){return jQuery.inArray(word,jql_reserved_words)!==-1},isWasOperator:function(operator){return operator==="was"||operator==="was in"||operator=="was not in"||operator=="was not"},isChangedOperator:function(operator){return operator==="changed"},stringValue:function(token){var stringValue="";var inQuote=false;var inSingleQuote=false;var currentChar=token.currentCharacter();while(currentChar!==null&&(inQuote||inSingleQuote||REGEXP_TOKEN_CHAR.test(currentChar))){stringValue=stringValue+currentChar;token.consumeCharacter();if(currentChar=="\\"){currentChar=token.currentCharacter();if(currentChar===null){token.setParseError();break}else{if(REGEXP_CHARS_TO_ESCAPE.test(currentChar)){var remainingString=token.remainingString();if(!REGEXP_UNICODE.test(remainingString)){token.setParseError();break}}}stringValue=stringValue+currentChar;token.consumeCharacter()}else{if(REGEXP_SPECIAL_CHAR.test(currentChar)&&!(inQuote||inSingleQuote)){token.setParseError();break}else{if(currentChar=='"'&&!inSingleQuote){inQuote=!inQuote}else{if(currentChar=="'"&&!inQuote){inSingleQuote=!inSingleQuote}}}}currentChar=token.currentCharacter()}if(token.isComplete()&&(inQuote||inSingleQuote)){token.setParseError()}return stringValue},numberValue:function(token){var numberVal="";this.chewWhitespace(token);var currentChar=token.currentCharacter();while(currentChar!==null){if(REGEXP_NUMBER.test(currentChar)){numberVal=numberVal+currentChar;token.consumeCharacter()}else{break}currentChar=token.currentCharacter()}return numberVal},wasPredicateComplete:function(predicate){var foundPredicate=false;var arLen=jql_changed_predicates.length;for(var i=0,len=arLen;i<len;++i){if(predicate.toLowerCase()==jql_changed_predicates[i].value.toLowerCase()){foundPredicate=true;break}}return foundPredicate}}};JIRA.JQLAutoComplete.ParseResult=function(){var tokens=[];var tokenIdx=0;return{getTokens:function(){return tokens},addToken:function(token){tokens[tokenIdx++]=token},setLastFieldName:function(lastFieldName,token){this.fieldNameStartIndex=(lastFieldName===null)?token.getMaxTokenStringIdx():(token.getTokenStringIdx()-lastFieldName.length);this.lastFieldName=this.getUnquotedString(lastFieldName);tokens[tokenIdx++]=lastFieldName},getLastFieldName:function(){return this.lastFieldName},getLastFieldNameStartIndex:function(){return this.fieldNameStartIndex},setLastOrderByFieldName:function(lastFieldName,token){this.orderByFieldNameStartIndex=(lastFieldName===null)?token.getMaxTokenStringIdx():(token.getTokenStringIdx()-lastFieldName.length);this.lastOrderByFieldName=this.getUnquotedString(lastFieldName);this.lastOrderByDirection=null;tokens[tokenIdx++]=lastFieldName},getLastOrderByFieldName:function(){return this.lastOrderByFieldName},getLastOrderByFieldNameStartIndex:function(){return this.orderByFieldNameStartIndex},setLastOrderByDirection:function(lastDirection,token){this.orderByDirectionStartIndex=(lastDirection===null)?token.getMaxTokenStringIdx():(token.getTokenStringIdx()-lastDirection.length);this.lastOrderByDirection=lastDirection;tokens[tokenIdx++]=lastDirection},getLastOrderByDirection:function(){return this.lastOrderByDirection},getLastOrderByDirectionStartIndex:function(){return this.orderByDirectionStartIndex},setNeedsField:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=true;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false;this.needsWasPredicate=false;this.lastWasOperator=null},getNeedsField:function(){return this.needsField},setNeedsOrderByField:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=true;this.needsOrderByDirection=false;this.lastOrderByDirection=null;this.needsListComma=false},getNeedsOrderByField:function(){return this.needsOrderByField},setNeedsOrderByDirection:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=true;this.needsListComma=false},getNeedsOrderByDirection:function(){return this.needsOrderByDirection},setNeedsOrderByComma:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false},setNeedsListComma:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=true},getNeedsListComma:function(){return this.needsListComma},setLastOperator:function(lastOperator,startIndex){this.lastOperator=lastOperator;this.operatorStartIndex=startIndex;tokens[tokenIdx++]=lastOperator},setLastWasOperator:function(lastWasOperator){this.lastWasOperator=lastWasOperator},getLastWasOperator:function(){return this.lastWasOperator},getLastOperator:function(){return this.lastOperator},getLastOperatorStartIndex:function(){return this.operatorStartIndex},setLastOperand:function(lastOperand,token){this.operandStartIndex=(lastOperand===null)?token.getMaxTokenStringIdx():(token.getTokenStringIdx()-lastOperand.length);this.lastOperand=this.getUnquotedString(lastOperand);tokens[tokenIdx++]=lastOperand},getLastOperand:function(){return this.lastOperand},setNeedsOperand:function(){this.needsField=false;this.needsOperator=false;this.needsLogicalOperator=false;this.needsOperand=true;this.needsOrderBy=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false},setNeedsOperandOrOperator:function(){this.needsField=false;this.needsOperator=true;this.needsLogicalOperator=false;this.needsOperand=true;this.needsOrderBy=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false},getNeedsOperand:function(){return this.needsOperand},setNeedsPredicateOperand:function(){this.needsPredicateOperand=true},resetNeedsPredicateOperand:function(){this.needsPredicateOperand=false;this.needsOperand=false},getNeedsPredicateOperand:function(){return this.needsPredicateOperand},getLastOperandStartIndex:function(){return this.operandStartIndex},setLastOperandStartIndex:function(index){this.operandStartIndex=index},setLastLogicalOperator:function(lastLogicalOperator,startIndex){this.lastLogicalOperator=lastLogicalOperator;this.logicalOperatorStartIndex=startIndex;tokens[tokenIdx++]=lastLogicalOperator},setNeedsOperator:function(){this.needsField=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsOperator=true;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false},getNeedsOperatorOrOperand:function(){return this.needsOperator&&this.needsOperand},getNeedsOperator:function(){return this.needsOperator},getLastLogicalOperator:function(){return this.lastLogicalOperator},getLastLogicalOperatorStartIndex:function(){return this.logicalOperatorStartIndex},setNeedsLogicalOperator:function(token){this.needsLogicalOperator=true;this.needsOperator=false;this.needsOperand=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsListComma=false;this.needsOrderBy=!token.getInParens();if(this.lastWasOperator!=null){this.needsWasPredicate=true}},setNeedsOpenParen:function(value){this.needsOpenParen=value},getNeedsOpenParen:function(){return this.needsOpenParen},getNeedsLogicalOperator:function(){return this.needsLogicalOperator},setNeedsOrderBy:function(value){this.needsOrderBy=value},getNeedsOrderBy:function(){return this.needsOrderBy},getNeedsWasPredicate:function(){return this.needsWasPredicate},setLastWasPredicate:function(lastWasPredicate,token){this.wasPredicateStartIndex=(lastWasPredicate===null)?token.getMaxTokenStringIdx():(token.getTokenStringIdx()-lastWasPredicate.length);this.lastWasPredicate=lastWasPredicate;tokens[tokenIdx++]=lastWasPredicate},getLastWasPredicate:function(){return this.lastWasPredicate},resetLastPredicates:function(){this.lastLogicalOperator=null;this.lastWasPredicate=null;this.lastOperand=null;this.wasPredicateStartIndex=null;this.operandStartIndex=null},getLastWasPredicateStartIndex:function(){return this.wasPredicateStartIndex},setLastOrderBy:function(lastOrderBy,token){this.orderByStartIndex=(lastOrderBy===null)?token.getMaxTokenStringIdx():(token.getTokenStringIdx()-lastOrderBy.length);this.lastOrderBy=lastOrderBy;tokens[tokenIdx++]=lastOrderBy},getLastOrderBy:function(){return this.lastOrderBy},getLastOrderByStartIndex:function(){return this.orderByStartIndex},resetLogicalOperators:function(){this.lastLogicalOperator=null;this.logicalOperatorStartIndex=null;this.needsLogicalOperator=null},getUnquotedString:function(value){var secondToLastNotEsacape=value!=null&&value.length>=3&&value.charAt(value.length-2)!="\\";if(value!=null&&value.charAt(0)=='"'){value=value.substring(1,value.length);if(value.charAt(value.length-1)=='"'&&secondToLastNotEsacape){value=value.substring(0,value.length-1)}}else{if(value!=null&&value.charAt(0)=="'"){value=value.substring(1,value.length);if(value.charAt(value.length-1)=="'"&&secondToLastNotEsacape){value=value.substring(0,value.length-1)}}}return value},setParseError:function(message){this.parseError=true;this.parseErrorMsg=message},getParseError:function(){return this.parseError},getParseErrorMsg:function(){return this.parseErrorMsg},setNeedsNothing:function(){this.needsOperator=false;this.needsOperand=false;this.needsLogicalOperator=false;this.needsOrderBy=false;this.needsField=false;this.needsOrderByField=false;this.needsOrderByDirection=false;this.needsOpenParen=false;this.needsListComma=false;this.needsWasPredicate=null;this.needsPredicateOperand=null;this.mustBeOperatorOrPredicate=null;this.lastWasOperator=null},setOperandComplete:function(){this.operandComplete=true},getOperandComplete:function(){return this.operandComplete},setMustBeOperatorOrPredicate:function(state){this.mustBeOperatorOrPredicate=state},getMustBeOperatorOrPredicate:function(){return this.mustBeOperatorOrPredicate},resetTerminalClause:function(){this.lastFieldName=null;this.fieldNameStartIndex=null;this.needsField=null;this.lastOperator=null;this.operatorStartIndex=null;this.needsOperator=null;this.lastOperand=null;this.operandStartIndex=null;this.needsOperand=null;this.operandComplete=null;this.needsOpenParen=null;this.needsListComma=false;this.mustBeOperatorOrPredicate=null},init:function(){this.lastFieldName=null;this.fieldNameStartIndex=null;this.needsField=null;this.lastOperator=null;this.operatorStartIndex=null;this.needsOperator=null;this.lastOperand=null;this.operandStartIndex=null;this.needsOperand=null;this.lastLogicalOperator=null;this.logicalOperatorStartIndex=null;this.lastOrderByFieldName=null;this.lastOrderByFieldNameStartIndex=null;this.lastOrderByDirection=null;this.lastOrderByDirectionStartIndex=null;this.orderByStartIndex=null;this.lastOrderBy=null;this.needsOrderBy=null;this.needsOrderByField=null;this.needsOrderByDirection=null;this.operandComplete=null;this.needsOpenParen=null;this.needsListComma=null;this.wasPredicateStartIndex=null;this.lastWasPredicate=null;this.needsWasPredicate=null;this.needsPredicateOperand=null;this.mustBeOperatorOrPredicate=null;this.lastWasOperator=null}}};JIRA.JQLAutoComplete.Token=function(){return{init:function(tokenString){this.tokenStringIdx=0;this.tokenString=tokenString;this.parseError=false;this.parseErrorMsg=null;this.result=JIRA.JQLAutoComplete.ParseResult();this.result.init();this.inParens=0},consumeCharacter:function(){this.tokenStringIdx++},consumeCharacters:function(numChars){this.tokenStringIdx=this.tokenStringIdx+numChars},backTrackToIdx:function(backTrackIdx){this.tokenStringIdx=backTrackIdx;this.parseError=false;this.parseErrorMsg=null;this.result.parseError=false;this.result.parseErrorMsg=null},getTokenStringIdx:function(){return this.tokenStringIdx},currentCharacter:function(){if(this.tokenStringIdx>=this.tokenString.length){return null}return this.tokenString.charAt(this.tokenStringIdx)},remainingString:function(){if(this.tokenStringIdx>=this.tokenString.length){return null}return this.tokenString.substr(this.tokenStringIdx,this.tokenString.length)},getMaxTokenStringIdx:function(){return this.tokenString.length},isComplete:function(){if(this.parseError){return true}return this.tokenStringIdx>=this.tokenString.length},setInParens:function(){this.inParens++},setOutOfParens:function(){if(this.inParens!==0){this.inParens--}},getInParens:function(){return this.inParens!==0},setParseError:function(){this.parseError=true;var preFixIdx=((this.tokenStringIdx-9)<0)?0:this.tokenStringIdx-9;var errorPrefix=this.tokenString.substring(preFixIdx,this.tokenStringIdx-1);this.result.setParseError("..."+errorPrefix+"^"+this.tokenString.substring(this.tokenStringIdx,this.tokenString.length))},getParseError:function(){return this.parseError},getResult:function(){return this.result}}};jQuery(function(){restore("jqlHistory");jQuery(".jql-autocomplete-params").each(function(){var params={};jQuery(this).find("input").each(function(){var $this=jQuery(this);params[$this.attr("id")]=$this.val()});var jqlFieldNames=JSON.parse(jQuery("#jqlFieldz").text());var jqlFunctionNames=JSON.parse(jQuery("#jqlFunctionNamez").text());var jqlReservedWords=JSON.parse(jQuery("#jqlReservedWordz").text());var jqlAutoComplete=JIRA.JQLAutoComplete({fieldID:"jqltext",parser:JIRA.JQLAutoComplete.MyParser(jqlReservedWords),queryDelay:0.65,jqlFieldNames:jqlFieldNames,jqlFunctionNames:jqlFunctionNames,minQueryLength:0,allowArrowCarousel:true,autoSelectFirst:false,errorID:"jqlerrormsg"});var jQueryRef=jQuery("#jqltext");jQueryRef.unbind("keypress",submitOnEnter).keypress(function(e){if(jqlAutoComplete.dropdownController===null||!jqlAutoComplete.dropdownController.displayed||jqlAutoComplete.selectedIndex<0){if(e.keyCode==13&&!e.ctrlKey&&!e.shiftKey){jQuery("#jqlform").submit();return false}else{return true}}});jqlAutoComplete.buildResponseContainer();jqlAutoComplete.parse(jQueryRef.text());jqlAutoComplete.updateColumnLineCount();jQueryRef.click(function(){jqlAutoComplete.dropdownController.hideDropdown()})})})})();AJS.namespace("jira.widget.autocomplete.JQL",null,JIRA.JQLAutoComplete);
/* module-key = 'com.atlassian.jira.jira-issue-link-remote-jira-plugin:issue-link-jira-search-js', location = 'js/issuelink-jira-jqlautocomplete.js' */
/**
 * Instantiates jql autocomplete functionality on request instead of on page load.
 */
var IssueLinkJQLAutoComplete = IssueLinkJQLAutoComplete || (function($) {

    /**
     * Initializes an auto complete field
     */
    function initialize(options) {

        var fieldID = options.fieldID;
        var errorID = options.errorID;
        var autoCompleteUrl = options.autoCompleteUrl;
        var autoCompleteData = options.autoCompleteData;
        var formSubmitFunction = options.formSubmitFunction;

        var $field = $('#'+fieldID);
        var hasFocus = $field.length > 0 && $field[0] == document.activeElement;

        var jqlFieldNames = autoCompleteData.visibleFieldNames || [];
        var jqlFunctionNames = autoCompleteData.visibleFunctionNames || [];
        var jqlReservedWords = autoCompleteData.jqlReservedWords || [];

        var jqlAutoComplete = JIRA.JQLAutoComplete({
            fieldID: fieldID,
            parser: JIRA.JQLAutoComplete.MyParser(jqlReservedWords),
            queryDelay: .65,
            jqlFieldNames: jqlFieldNames,
            jqlFunctionNames: jqlFunctionNames,
            minQueryLength: 0,
            allowArrowCarousel: true,
            autoSelectFirst: false,
            errorID: errorID,
            autoCompleteUrl: autoCompleteUrl
        });

        $field.unbind("keypress", submitOnEnter);

        if (formSubmitFunction) {
            $field.keypress(function (e) {
                if (jqlAutoComplete.dropdownController === null || !jqlAutoComplete.dropdownController.displayed || jqlAutoComplete.selectedIndex < 0) {
                    if (e.keyCode == 13 && !e.ctrlKey && ! e.shiftKey)
                    {
                        formSubmitFunction();
                        return false;
                    }
                    else
                    {
                        return true;
                    }
                }
            });
        }

        jqlAutoComplete.buildResponseContainer();
        jqlAutoComplete.parse($field.text());
        jqlAutoComplete.updateColumnLineCount();

        $field.click(function(){
            jqlAutoComplete.dropdownController.hideDropdown();
        });

        if (hasFocus) {
            $field.select();
        }
    }

    return {
        initialize: initialize
    };
})(AJS.$);

/* module-key = 'com.atlassian.jira.jira-issue-link-remote-jira-plugin:issue-link-jira-search-js', location = 'js/issuelink-jira-search.js' */
AJS.$(function ($) {
    var remoteJiraSearchDialog =  new JIRA.FormDialog({
        id: "remote-jira-search-dialog",
        trigger: "#link-jira-issue .remote-jira-search-trigger",
        widthClass: "large",
        content: function (render) {
            render(JIRA.Templates.RemoteJiraIssueSearch.dialog());
            initSearchDialog(this.$popup);
        },
        submitHandler: function(e, callback){
            e.preventDefault();
            $("#simple-search-panel-button").removeAttr("disabled");
            $("#advanced-search-panel-button").removeAttr("disabled");
            if($(e.target).attr("id") == "remote-jira-simple-search-form"){
                $("#simple-search-panel-button").click();
            } else {
                $("#advanced-search-panel-button").click();
            }
            callback();
        }
    });

    function initSearchDialog($dialog) {
        // Gather the JQL auto complete data
        var appId = $("#jira-app-link").val();
        var autoCompletePromise = getJqlAutoCompleteData(appId);

        // Bind the simple search button
        $("#simple-search-panel-button", $dialog).click(function () {
            $("#search-results-table", $dialog).empty();
            var searchText = $("#link-search-text", $dialog).val();
            searchText = $.trim(searchText);
            if (searchText) {
                doSimpleSearch(searchText, $dialog);
            } else {
                AJS.messages.info("#search-results-table", {
                    body: "Please enter search value.",
                    closeable: false
                });
            }

            return false;
        });

        // Bind the advanced search button
        $("#advanced-search-panel-button", $dialog).click(function() {
            advancedSearchButtonClick($dialog);
            return false;
        });

        $("#simple-search-toggle", $dialog).click(function() {
            $("#remote-jira-simple-search-form", $dialog).show();
            $("#remote-jira-advanced-search-form", $dialog).hide();
            return false;
        });

        $("#linkjiraissue-add-selected", $dialog).click(function(){
            //select selected checkboxes of only *visible* rows
            //filtering to visible is necessary due to tabbed layout
            $("table tbody tr:visible  td.selection input:checked", $dialog).each(function(){
                var issueKey = $(this).parent().data("key");
                $("#jira-issue-keys").trigger("selectOption", [{
                    value: issueKey
                }]);
            });


            // Clear all error messages on the parent dialog, as we now have a newly selected issue
            $("#link-issue-dialog .error").hide();

            remoteJiraSearchDialog.hide();

            $("#link-issue-dialog")
                    .show()
                    .trigger("multiSelectRevealed");

            $("#jira-issue-keys-textarea").focus().select();
        });


        $("#advanced-search-toggle", $dialog).click(function() {
            $("#remote-jira-advanced-search-form", $dialog).show();
            $("#remote-jira-simple-search-form", $dialog).hide();

            // Initialise the JQL auto complete once we have the data
            // Ensure that we only initialise it once only
            var $jqlSearchText = $("#jql-search-text");
            if (!$jqlSearchText.attr("jql-initialized")) {
                setAutoCompleteLoadingIconVisible(true, $dialog);
                autoCompletePromise.done(function (smartAjaxResult) {
                    if (smartAjaxResult.successful) {
                        // Enable JQL AutoComplete
                        IssueLinkJQLAutoComplete.initialize({
                            fieldID: "jql-search-text",
                            errorID: "jql-search-error",
                            autoCompleteUrl: getAutoCompleteUrl(appId),
                            autoCompleteData: smartAjaxResult.data,
                            formSubmitFunction: function() {
                                advancedSearchButtonClick($dialog);
                            }
                        });
                    }
                    else {
                        setJQLErrorVisible(false, $dialog);
                        setAutoCompleteFailedIconVisible(true, $dialog);
                    }
                    setAutoCompleteLoadingIconVisible(false, $dialog);
                    $jqlSearchText.attr("jql-initialized", 1);
                });
            }
            $jqlSearchText.focus();

            return false;
        });

        $("#simple-search-toggle", $dialog).trigger("click");
    }

    function getAutoCompleteUrl(appId) {
        if (appId && appId !== "") {
            // Remote JIRA instance
            return contextPath + "/rest/remoteJiraIssueLink/1/remoteJira/autocomplete?appId=" + appId;
        }
        // Local JIRA instance - will use the default URL in JQLAutoComplete
        return "";
    }

    function advancedSearchButtonClick($dialog) {
        $("#search-results-table", $dialog).empty();
        var searchText = $("#jql-search-text", $dialog).val();
        searchText = $.trim(searchText);
        if (searchText) {
            doAdvancedSearch(searchText, $dialog);
        } else {
            AJS.messages.info("#search-results-table", {
                body: "Please enter search value.",
                closeable: false
            });
        }
    }

    function setLoadingIconVisible(visible, $context) {
        $("#link-search-loading", $context).toggleClass("hidden", !visible);
    }

    function setAutoCompleteLoadingIconVisible(visible, $context) {
        $("#autocomplete-loading", $context).toggleClass("hidden", !visible);
    }

    function setAutoCompleteFailedIconVisible(visible, $context) {
        $("#autocomplete-failed", $context).toggleClass("hidden", !visible);
    }

    function setJQLErrorVisible(visible, $context) {
        $("#jql-search-error", $context).toggleClass("hidden", !visible);
    }

    function doSimpleSearch(searchText, $context) {
        setLoadingIconVisible(true, $context);
        var appId = $("#jira-app-link").val();
        var issueKeyJql = 'key = "' + searchText + '"';
        var projectJql = 'project = "' + searchText + '"';
        var plainTextJql = 'summary ~ "' + searchText + '" OR description ~ "' + searchText + '" OR comment ~ "' + searchText + '"';

        // First, check if search text is an issue key
        // We need to do this because the search will fail if it is not an issue key,
        // even if it is OR'd with a condition that returns results!
        jqlSearch(issueKeyJql, appId).done(function (smartAjaxResult) {
            if (smartAjaxResult.successful && smartAjaxResult.data.issues.length > 0) {
                setLoadingIconVisible(false, $context);
                showResults(smartAjaxResult, $context);
            } else {

                // Then check if search text is a project
                jqlSearch(projectJql, appId).done(function (smartAjaxResult) {
                    if (smartAjaxResult.successful && smartAjaxResult.data.issues.length > 0) {
                        // The search text is a project name or key
                        setLoadingIconVisible(false, $context);
                        showResults(smartAjaxResult, $context);
                    } else {

                        // Finally, a plain text search
                        jqlSearch(plainTextJql, appId).done(function (smartAjaxResult) {
                            setLoadingIconVisible(false, $context);
                            if (smartAjaxResult.successful) {
                                showResults(smartAjaxResult, $context);
                            } else {
                                showResultsError(smartAjaxResult);
                            }
                        });
                    }
                });
            }
        });
    }

    function doAdvancedSearch(jql, $context) {
        setLoadingIconVisible(true, $context);
        var appId = $("#jira-app-link").val();
        jqlSearch(jql, appId).done(function (smartAjaxResult) {
            setLoadingIconVisible(false, $context);
            if (smartAjaxResult.successful) {
                showResults(smartAjaxResult, $context);
            } else {
                if (smartAjaxResult.status === 400) {
                    AJS.messages.warning("#search-results-table", {
                        body: "Invalid JQL query.",
                        closeable: false
                    });
                } else {
                    showResultsError(smartAjaxResult);
                }
            }
        });
    }

    function jqlSearch(jql, appId) {
        var deferred = $.Deferred();
        var url;
        if (appId && appId !== "") {
            // Remote JIRA instance
            url = contextPath + "/rest/remoteJiraIssueLink/1/remoteJira/search?jql=" + jql + "&appId=" + appId + "&maxResults=10";
        } else {
            // Local JIRA instance
            // Filter out current issue from results
            var currentIssueKey = $("#current-issue-key").val();
            jql = "(" + jql + ") and key != " + currentIssueKey;
            url = contextPath + "/rest/api/2/search?jql=" + jql + "&maxResults=10";
        }
        JIRA.SmartAjax.makeRequest({
            url: url,
            complete: function (xhr, textStatus, smartAjaxResult) {
                deferred.resolve(smartAjaxResult);
            }
        });
        return deferred.promise();
    }

    function getJqlAutoCompleteData(appId) {
        var deferred = $.Deferred();
        var remote;
        var url;
        if (appId && appId !== "") {
            // Remote JIRA instance
            url = contextPath + "/rest/remoteJiraIssueLink/1/remoteJira/autocompletedata?appId=" + appId;
            remote = true;
        } else {
            // Local JIRA instance
            url = contextPath + "/rest/api/2/jql/autocompletedata";
            remote = false;
        }
        JIRA.SmartAjax.makeRequest({
            url: url,
            complete: function (xhr, textStatus, smartAjaxResult) {
                if (!smartAjaxResult.successful && remote) {
                    // If a remote JIRA request fails, it probably doesn't have the autocompletedata REST endpoint (added in JIRA v5.1)
                    // Get the auto complete data by parsing the issue navigator page
                    JIRA.SmartAjax.makeRequest({
                        url: contextPath + "/rest/remoteJiraIssueLink/1/remoteJira/autocompletedata/legacy?appId=" + appId,
                        complete: function (xhr, textStatus, smartAjaxResult) {
                            deferred.resolve(smartAjaxResult);
                        }
                    });
                } else {
                    deferred.resolve(smartAjaxResult);
                }
            }
        });
        return deferred.promise();
    }

    function showResults(smartAjaxResult, $context) {
        var resultHtml = JIRA.Templates.RemoteJiraIssueSearch.resultsTable({result: smartAjaxResult.data});
        $("#search-results-table", $context).html(resultHtml);

        $("#linkjiraissue-select-all", $context).click(function(){
            var $masterStatus = $(this).prop("checked");
            $("tbody tr td.selection input", $context).prop("checked", $masterStatus);
        });

        $("tbody tr", $context).click(function (e) {

            //if we click on checkbox directly we don't want to change its value
            if($(e.target).is(":checkbox")){
                return;
            }
            var checkbox = $(this).find("td.selection input");
            checkbox.prop("checked", !checkbox.prop("checked"));


        });
    }

    function showResultsError(smartAjaxResult) {
        AJS.messages.error("#search-results-table", {
            body: JIRA.SmartAjax.buildSimpleErrorContent(smartAjaxResult),
            closeable: false
        });
    }
});

/* module-key = 'com.atlassian.jira.jira-issue-link-remote-jira-plugin:issue-link-jira-search-js', location = 'templates/dialog/linkjiraissue-search.soy' */
// This file was automatically generated from linkjiraissue-search.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.RemoteJiraIssueSearch == 'undefined') { JIRA.Templates.RemoteJiraIssueSearch = {}; }


JIRA.Templates.RemoteJiraIssueSearch.dialog = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<h2>', soy.$$escapeHtml("Find JIRA issues"), '</h2><form class="aui search-form" id="remote-jira-simple-search-form" action="#" method="post"><div class="field-group"><label for="link-search-text">', soy.$$escapeHtml("Search"), ':</label><input id="link-search-text" type="text" tabindex="0" class="text" size="50"> <input type="submit" tabindex="0" class="button" id="simple-search-panel-button" value="', soy.$$escapeHtml("Search"), '"> <a id="advanced-search-toggle" href="#" title="', soy.$$escapeHtml("Perform a JQL search"), '">', soy.$$escapeHtml("Advanced Search"), '</a><span id="link-search-loading" class="icon loading throbber hidden"/></div></form><form class="aui search-form" id="remote-jira-advanced-search-form" action="#" method="post"><div class="field-group"><label for="jql-search-text">', soy.$$escapeHtml("JQL Search"), '<span id="autocomplete-loading" class="hidden"><span class="icon loading throbber"/>', soy.$$escapeHtml("Loading auto-complete"), '</span><span id="autocomplete-failed" class="hidden">', soy.$$escapeHtml("(auto-complete unavailable)"), '</span></label><div id="jql-search-container"><span id="jql-search-error" class="icon jqlgood" /><div class="atlassian-autocomplete"><textarea id="jql-search-text" class="text full-width-field" tabindex="0" /></div><button class="aui-button aui-button-primary search-button" id="advanced-search-panel-button" type="submit"><span class="aui-icon aui-icon-small aui-iconfont-search" title="', soy.$$escapeHtml("Search"), '"></span></button></div> <a id="simple-search-toggle" href="#" title="', soy.$$escapeHtml("Perform a plain text search"), '">', soy.$$escapeHtml("Simple Search"), '</a><span id="link-search-loading" class="icon loading throbber hidden"/></div></form><div class="message-panel hidden"></div><div id="search-results-table" class="data-table"></div><div class="buttons-container form-footer"><div class="buttons"><button type="button" class="aui-button" id="linkjiraissue-add-selected">', soy.$$escapeHtml("\u589e\u52a0"), '</button><button class="aui-button aui-button-link cancel" href="#" id="remote-jira-link-cancel" title="', soy.$$escapeHtml("Press Esc to close"), '">', soy.$$escapeHtml("\u5173\u95ed"), '</button></div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.RemoteJiraIssueSearch.resultsTable = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.result.issues.length > 0) {
    output.append('<table id="remote-jira-searchresult" class="aui"><thead><tr><th class="selection" ><input id="linkjiraissue-select-all" type="checkbox"/></th><th class="type">', soy.$$escapeHtml("Type"), '</th><th class="key">', soy.$$escapeHtml("Key"), '</th><th class="summary">', soy.$$escapeHtml("Summary"), '</th><th class="status">', soy.$$escapeHtml("Status"), '</th></tr></thead><tbody>');
    var issueList44 = opt_data.result.issues;
    var issueListLen44 = issueList44.length;
    for (var issueIndex44 = 0; issueIndex44 < issueListLen44; issueIndex44++) {
      var issueData44 = issueList44[issueIndex44];
      output.append('<tr title="', soy.$$escapeHtml(issueData44.key), '"><td class="selection" data-key="', soy.$$escapeHtml(issueData44.key), '"><input type="checkbox"/></td><td class="type">');
      JIRA.Templates.RemoteJiraIssueSearch.issueType({issueType: issueData44.fields.issuetype}, output);
      output.append('</td><td class="key" title="', soy.$$escapeHtml(issueData44.key), '">', soy.$$escapeHtml(issueData44.key), '</td><td class="summary" title="', soy.$$escapeHtml(issueData44.fields.summary), '">', soy.$$escapeHtml(issueData44.fields.summary), '</td><td class="status">');
      JIRA.Templates.RemoteJiraIssueSearch.status({status: issueData44.fields.status}, output);
      output.append('</td></tr>');
    }
    output.append('</tbody></table>');
  } else {
    output.append('<div class="aui-message info"><span class="aui-icon icon-info"></span><p>', soy.$$escapeHtml("Search returned no results."), '</p></div>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.RemoteJiraIssueSearch.issueType = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<img src="', soy.$$escapeHtml(opt_data.issueType.iconUrl), '" alt="', soy.$$escapeHtml(opt_data.issueType.name), '" title="', soy.$$escapeHtml(opt_data.issueType.name), ' - ', soy.$$escapeHtml(opt_data.issueType.description), '"/>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.RemoteJiraIssueSearch.status = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<img src="', soy.$$escapeHtml(opt_data.status.iconUrl), '" alt="" title=""/> ', soy.$$escapeHtml(opt_data.status.name));
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-feedback-plugin:shared-resources', location = '/js/shared/Link.js' */
(function(){var c;var a=function(d){return AJS.Meta.getBoolean(d)===true};var b=Class.extend({suppress:function(){c=true;return undefined},isSuppressed:function(){if(c===true){return true}return a("disable-issue-collector")}});JIRA=JIRA||{};JIRA.Feedback=JIRA.Feedback||{};JIRA.Feedback.Link=new b()})();
/* module-key = 'com.atlassian.jira.jira-feedback-plugin:bootstrap-resources', location = '/templates/feedback-link.soy' */
// This file was automatically generated from feedback-link.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Feedback == 'undefined') { JIRA.Feedback = {}; }
if (typeof JIRA.Feedback.Plugin == 'undefined') { JIRA.Feedback.Plugin = {}; }


JIRA.Feedback.Plugin.subtleLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'jira-feedback-link-container float subtle-style\'><a class=\'js-feedback-link jira-feedback-link\' href=\'#\'>', soy.$$escapeHtml("GOT FEEDBACK?"), '</a></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Feedback.Plugin.footerLinkBTF = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class=\'jira-feedback-link-container footer-style\'><a class="aui-button jira-feedback-link ">', soy.$$escapeHtml("GOT FEEDBACK?"), '</a></li>');
  return opt_sb ? '' : output.toString();
};


JIRA.Feedback.Plugin.footerLinkOD = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="jira-feedback-link-container footer-style"><a class="aui-button jira-feedback-link">', soy.$$escapeHtml("GOT FEEDBACK?"), '</a></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Feedback.Plugin.charlieLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="jira-feedback-link-container float charlie-style" ><a href="#" class="jira-feedback-link"><span class="aui-icon aui-icon-small aui-iconfont-jira">JIRA</span><span class="aui-label feedback-label">', soy.$$escapeHtml("GOT FEEDBACK?"), '</span></a></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-feedback-plugin:bootstrap-resources', location = '/js/jic-bootstrap.js' */
(function($){$=jQuery.noConflict(true);if(typeof window.jQuery==="undefined"){window.jQuery=$}if(typeof window.$==="undefined"){window.$=$}var ATL_JQ=function(){return $.apply($,arguments)};var baseUrl="https://jira.atlassian.com";var css=".atlwdg-blanket {background: black;height: 100%;left: 0;opacity: .5;position: fixed;top: 0;width: 100%;z-index: 1000000;}.atlwdg-popup {background: white;border: 1px solid #666;position: fixed;top: 50%;left: 50%;z-index: 10000011;}.atlwdg-popup.atlwdg-box-shadow {-moz-box-shadow: 10px 10px 20px rgba(0,0,0,0.5);-webkit-box-shadow: 10px 10px 20px rgba(0,0,0,0.5);box-shadow: 10px 10px 20px rgba(0,0,0,0.5);background-color: white;}.atlwdg-hidden {display: none;}.atlwdg-trigger {position: fixed;background: #013466;padding: 5px;border: 2px solid white;border-top: none;font-weight: bold;color: white !important;display: block;white-space: nowrap;text-decoration: none !important;font-family: arial, FreeSans, Helvetica, sans-serif;font-size: 12px;box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5);-webkit-box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5);-moz-box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5);border-radius: 0 0 5px 5px;-moz-border-radius: 0 0 5px 5px;}.atlwdg-trigger.atlwdg-TOP {left: 45%;top: 0;}.atlwdg-trigger.atlwdg-RIGHT {left: 100%;top: 40%;-webkit-transform-origin: top left;-webkit-transform: rotate(90deg);-moz-transform: rotate(90deg);-moz-transform-origin: top left;-ms-transform: rotate(90deg);-ms-transform-origin: top left;}.atlwdg-trigger.atlwdg-SUBTLE {right: 0;bottom: 0;border: 1px solid #ccc;border-bottom: none;border-right: none;background-color: #f5f5f5;color: #444;font-size: 11px;padding: 6px;box-shadow: -1px -1px 2px rgba(0, 0, 0, 0.5);border-radius: 2px 0 0 0;}.atlwdg-loading {position: absolute;top: 220px;left: 295px;}";var cssIE=".atlwdg-trigger {position: absolute;}.atlwdg-blanket {position: absolute;filter: alpha(opacity=50);width: 110%;}.atlwdg-popup {position: absolute;}.atlwdg-trigger.atlwdg-RIGHT {left: auto;right: 0;filter: progid:DXImageTransform.Microsoft.BasicImage(rotation=1);}";ATL_JQ.isQuirksMode=function(){return document.compatMode!="CSS1Compat"};ATL_JQ.IssueDialog=function(options){var $body=$("body"),that=this,showDialog=function(){that.show();return false};this.options=options;this.frameUrl=baseUrl+"/rest/collectors/1.0/template/form/"+this.options.collectorId+"?os_authType=none";$("head").append("<style type='text/css'>"+css+"</style>");if(this.options.triggerPosition==="CUSTOM"){var oldTriggerFunction;if(this.options.triggerFunction){try{oldTriggerFunction=eval("("+this.options.triggerFunction+")")}catch(ex){}}$(function(){try{var newTriggerFunction;if(window.ATL_JQ_PAGE_PROPS&&((window.ATL_JQ_PAGE_PROPS.triggerFunction)||(window.ATL_JQ_PAGE_PROPS[this.options.collectorId]&&window.ATL_JQ_PAGE_PROPS[this.options.collectorId].triggerFunction))){newTriggerFunction=window.ATL_JQ_PAGE_PROPS.triggerFunction||window.ATL_JQ_PAGE_PROPS[this.options.collectorId].triggerFunction}else{newTriggerFunction=oldTriggerFunction}if($.isFunction(newTriggerFunction)){newTriggerFunction(showDialog)}}catch(ex){}})}else{if($.isFunction(this.options.triggerPosition)){try{this.options.triggerPosition(showDialog)}catch(ex){}}else{if(this.options.triggerPosition&&this.options.triggerText){var triggerClass="atlwdg-trigger atlwdg-"+this.options.triggerPosition;var $trigger=$("<a href='#' id='atlwdg-trigger'/>").addClass(triggerClass).text(this.options.triggerText);$body.append($trigger);$trigger.click(showDialog)}}}var $iframeContainer=$("<div id='atlwdg-container'/>").addClass("atlwdg-popup atlwdg-box-shadow atlwdg-hidden");var $blanket=$("<div id='atlwdg-blanket' class='atlwdg-blanket'/>").hide();$body.append($blanket).append($iframeContainer);if($.browser.msie&&(ATL_JQ.isQuirksMode()||$.browser.version<9)){$("head").append("<style type='text/css'>"+cssIE+"</style>");var triggerAdjuster=function(e){};if(this.options.triggerPosition==="TOP"){triggerAdjuster=function(e){$("#atlwdg-trigger").css("top",$(window).scrollTop()+"px")}}else{if(this.options.triggerPosition==="RIGHT"){triggerAdjuster=function(e){var $trigger=$("#atlwdg-trigger");$trigger.css("top",($(window).height()/2-$trigger.outerWidth()/2+$(window).scrollTop())+"px");if(!ATL_JQ.isQuirksMode()&&$.browser.version==="8.0"){$trigger.css("right",-($trigger.outerHeight()-$trigger.outerWidth())+"px")}}}else{if(this.options.triggerPosition==="SUBTLE"){var outerHeight=$trigger.outerHeight();triggerAdjuster=function(e){var $window=$(window);$trigger.css("top",($window.scrollTop()+$window.height()-outerHeight)+"px")}}}}$(window).bind("scroll resize",triggerAdjuster);triggerAdjuster()}};ATL_JQ.IssueDialog.prototype={hideDialog:undefined,updateContainerPosition:function(){var width=810,height=450;$("#atlwdg-container").css({height:height+"px",width:width+"px","margin-top":-Math.round(height/2)+"px","margin-left":-Math.round(width/2)+"px"});$("#atlwdg-frame").height("100%").width("100%")},show:function(){var that=this,$iframeContainerElem=$("#atlwdg-container"),$body=$("body"),$iframeElem=$('<iframe id="atlwdg-frame" frameborder="0" src="'+this.frameUrl+'"></iframe>'),$loadingImage=$('<img class="atlwdg-loading" style="display:none;" src="https://jira.atlassian.com/images/throbber/loading_barber_pole_horz.gif">');hideDialog=function(e){if(e.keyCode===27){that.hide()}};$iframeContainerElem.append($loadingImage);var throbberTimeout=setTimeout(function(){$loadingImage.show()},300);$body.css("overflow","hidden").keydown(hideDialog);window.scroll(0,0);var feedbackString="";if(this.options.collectFeedback){var feedback=this.options.collectFeedback();for(var prop in feedback){if(feedback.hasOwnProperty(prop)&&feedback[prop]!==undefined&&feedback[prop]!==""&&typeof feedback[prop]==="string"){feedbackString+="*"+prop+"*: "+feedback[prop]+"\n"}}}var fieldValues={};if(this.options.fieldValues&&!$.isEmptyObject(this.options.fieldValues)){$.extend(fieldValues,this.options.fieldValues)}$iframeElem.load(function(){var message={feedbackString:feedbackString,fieldValues:fieldValues};$iframeElem[0].contentWindow.postMessage(JSON.stringify(message),"https://jira.atlassian.com");$(window).bind("message",function(e){if(e.originalEvent.data&&e.originalEvent.data==="cancelFeedbackDialog"){that.hide()}})});$iframeElem.load(function(e){clearTimeout(throbberTimeout);$loadingImage.hide();$iframeElem.show()});var currentMilis=new Date().getTime();var dummyElement=document.createElement("a");dummyElement.href="https://jira.atlassian.com";$iframeContainerElem.append($iframeElem);this.updateContainerPosition();$iframeContainerElem.show();$("#atlwdg-blanket").show()},hide:function(){$("body").css("overflow","auto").unbind("keydown",hideDialog);$("#atlwdg-container").hide().empty();$("#atlwdg-blanket").hide()}};var filterStrings=function(obj,recursingIn){for(var key in obj){if(!obj.hasOwnProperty(key)){continue}var value=obj[key];if(recursingIn===undefined&&$.isArray(value)){filterStrings(value,key);continue}if(typeof value!=="string"){var paramName=recursingIn===undefined?key:recursingIn+":"+key;console.log("bootstrap.js:filterStrings ignoring key for value '"+paramName+"'; typeof must be string");delete obj[key]}}return obj};window.JIRAS_OWN_ATL_JQ=ATL_JQ})(jQuery);var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());
/* module-key = 'com.atlassian.jira.jira-feedback-plugin:bootstrap-resources', location = '/js/jira-feedback-plugin.js' */
AJS.$(function(f){var d="d3de7fb5";var g="c612fb25";var e=AJS.Meta.get("version-number");var c=!(f.browser.msie&&parseInt(f.browser.version,10)<9);var b=function(){if(!c){return false}if(AJS.DarkFeatures.isEnabled("com.atlassian.jira.config.CoreFeatures.ON_DEMAND")){return g}if(AJS.params.baseURL&&AJS.params.baseURL.indexOf("sandbox.onjira.com")>=0){return d}if(/.*v[0-9](\.[0-9])+\-(rc[0-9]+)|(SNAPSHOT)|(beta[0-9]+)|(m[0-9]+).*/.test(e)){return d}if(f(".licensemessagered:contains('JIRA evaluation license')").length>0){return d}return false};var a=b();if(!JIRA.Feedback.Link.isSuppressed()&&a){h();JIRA.bind(JIRA.Events.LAYOUT_RENDERED,i);JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,i)}function i(o,l,n){if((o.type==="newContentAdded"&&n==="pageLoad")||(o.type==="layoutRendered"&&l==="list-view")){var m=f(".navigator-sidebar").hasClass("collapsed");var k=f(".jira-feedback-link-container");k.remove();k=h();if(m&&k.hasClass("subtle-style")){k.addClass("left noborder")}}}function j(){var k=f("#footer-build-information").text();var m=function(){return{Location:window.location.href,"User-Agent":navigator.userAgent,Referrer:document.referrer,"Screen Resolution":screen.width+" x "+screen.height,"JIRA Version":e,"JIRA Footer Version":k}};var l=new JIRAS_OWN_ATL_JQ.IssueDialog({collectorId:a,collectFeedback:m});l.show()}function h(){var m=".jira-feedback-link";var o=f("#footer .footer-body > ul").eq(0).filter(":visible");var l=f("#footer #studio-footer p").eq(0).filter(":visible");var n;if(o.length>0){n=o;n.append(JIRA.Feedback.Plugin.footerLinkBTF())}else{if(l.length>0){n=l;n.append(JIRA.Feedback.Plugin.footerLinkOD())}else{n=f("body");n.append(JIRA.Feedback.Plugin.subtleLink())}}var k=n.find(".jira-feedback-link-container");k.on("click",m,j);return k}});
/* module-key = 'com.atlassian.jira.plugins.greenhopper-marketing-plugin:gh-advertising-resources', location = '/js/urls.js' */
var GHA=GHA||{};
GHA.Urls=GHA.Urls||{};
GHA.HelpPaths={};
GHA.HelpPaths.getHelpPath=function(){return null
};
GHA.Urls.macUri={"url":"https://my.atlassian.com","isLocal":false}.url;
GHA.Urls.lassoUri={"url":"https://id.atlassian.com/","isLocal":false}.url;
GHA.Urls.hamletUri={"url":"https://hamlet.atlassian.com/","isLocal":false}.url;
/* module-key = 'com.atlassian.jira.plugins.greenhopper-marketing-plugin:gh-advertising-resources', location = '/js/greenhopper-advertising.js' */
var GHA=GHA||{};
GHA.Advertising=GHA.Advertising||{};
GHA.Advertising.events={};
GHA.Advertising.events.scrum="com.atlassian.jira.plugins.greenhopper-marketing-plugin:gha-scrum-template-item";
GHA.Advertising.events.kanban="com.atlassian.jira.plugins.greenhopper-marketing-plugin:gha-kanban-template-item";
GHA.Advertising.events.scrumOD="com.atlassian.jira.plugins.greenhopper-marketing-plugin:gha-od-scrum-template-item";
GHA.Advertising.events.kanbanOD="com.atlassian.jira.plugins.greenhopper-marketing-plugin:gha-od-kanban-template-item";
GHA.Advertising.selectedTemplateType;
GHA.Advertising.init=function(){AJS.$("body").on(GHA.Advertising.events.scrum,GHA.Advertising.handleAdvertisedProjectTemplateSelection);
AJS.$("body").on(GHA.Advertising.events.kanban,GHA.Advertising.handleAdvertisedProjectTemplateSelection);
AJS.$("body").on(GHA.Advertising.events.scrumOD,GHA.Advertising.handleScrumOnDemandProjectTemplateSelection);
AJS.$("body").on(GHA.Advertising.events.kanbanOD,GHA.Advertising.handleKanbanOnDemandProjectTemplateSelection)
};
GHA.Advertising.handleAdvertisedProjectTemplateSelection=function(B,A){if(B.namespace.indexOf("scrum")>-1){GHA.Advertising.selectedTemplateType="SCRUM"
}else{if(B.namespace.indexOf("kanban")>-1){GHA.Advertising.selectedTemplateType="KANBAN"
}}A.addPage();
A.addHeader("Create Agile Project");
A.addPanel("ExplainGreenhopperInstallationPanel",GHA.tpl.advertising.renderExplainInstallation({isScrum:GHA.Advertising.selectedTemplateType==="SCRUM",isKanban:GHA.Advertising.selectedTemplateType==="KANBAN"}),"gh-explain-gh-installation");
A.addButton("Install Greenhopper",GHA.Advertising.startInstallation,"gh-start-install-button");
A.addCancel("\u53D6\u6D88",function(){A.remove()
});
A.popup.element.find(".gh-start-install-button").removeClass().addClass("aui-button aui-button-primary gh-install-btn")
};
GHA.Advertising.handleScrumOnDemandProjectTemplateSelection=function(B,A){GHA.Advertising.handleOnDemandProjectTemplateSelection(B,A,GHA.Advertising.startScrumOnDemandInstallation)
};
GHA.Advertising.handleKanbanOnDemandProjectTemplateSelection=function(B,A){GHA.Advertising.handleOnDemandProjectTemplateSelection(B,A,GHA.Advertising.startKanbanOnDemandInstallation)
};
GHA.Advertising.handleOnDemandProjectTemplateSelection=function(B,A,C){A.addPage();
A.addHeader("Create Agile Project");
A.addPanel("ExplainGreenhopperInstallationPanel",GHA.tpl.advertising.renderExplainOnDemandInstallation(),"gh-explain-gh-installation");
A.addButton("Enable GreenHopper",C,"gh-start-install-button");
A.addCancel("\u53D6\u6D88",function(){A.remove()
});
A.popup.element.find(".gh-start-install-button").removeClass().addClass("aui-button aui-button-primary gh-install-btn")
};
GHA.Advertising.startInstallation=function(){GHA.Installer.serverId=JPT.ConfigModel.serverId;
GHA.Installer.selectedTemplateType=GHA.Advertising.selectedTemplateType;
GHA.Installer.start()
};
GHA.Advertising.startScrumOnDemandInstallation=function(){GHA.Advertising.startOnDemandInstallation("scrum")
};
GHA.Advertising.startKanbanOnDemandInstallation=function(){GHA.Advertising.startOnDemandInstallation("kanban")
};
GHA.Advertising.startOnDemandInstallation=function(A){JIRA.SmartAjax.makeWebSudoRequest({type:"GET",url:contextPath+"/rest/plugins/1.0/?updates=false",dataType:"json",contentType:GHA.Installer.contentType,globalThrobber:false,global:false}).done(function(E){var D=(E.hostStatus&&E.hostStatus.hostLicense)?E.hostStatus.hostLicense.supportEntitlementNumber:undefined;
if(D!==undefined){var B=D.split("-")[1];
var C=GHA.Urls.macUri+"/ondemand/configure/"+B+"?modifyAction=activate&productKey=greenhopper.jira.ondemand&callback="+GHA.Advertising.buildGreenHopperUrl(A)+"&cancelCallback="+GHA.Advertising.buildCancelUrl();
location.href=C
}})
};
GHA.Advertising.buildCancelUrl=function(){var A=AJS.parseUri(window.location.href);
A.queryKey.projectTemplatesOpen=true;
return A.toString()
};
GHA.Advertising.buildGreenHopperUrl=function(A){var B=AJS.parseUri(window.location.href);
var C=B.protocol+"://"+B.authority+contextPath+"/secure/ProjectCreationRedirect.jspa?projectType="+A;
return C
};
AJS.$(GHA.Advertising.init);
/* module-key = 'com.atlassian.jira.plugins.greenhopper-marketing-plugin:gh-advertising-resources', location = '/js/greenhopper-installer.js' */
GHA.Installer={};
GHA.Installer.productKey="com.pyxis.greenhopper.jira";
GHA.Installer.pluginKey=GHA.Installer.productKey+"-key";
GHA.Installer.key="com.pyxis.greenhopper.jira-key";
GHA.Installer.contentType="application/vnd.atl.plugins.install.uri+json";
GHA.Installer.serverInfoUri=contextPath+"/rest/installer/1.0/";
GHA.Installer.browserSupportsCORS="withCredentials" in new XMLHttpRequest();
GHA.Installer.serverId=null;
GHA.Installer.selectedTemplateType;
GHA.Installer.scrumTemplateKey="com.pyxis.greenhopper.jira:gh-scrum-template-item";
GHA.Installer.kanbanTemplateKey="com.pyxis.greenhopper.jira:gh-kanban-template-item";
GHA.Installer.pollInterval=500;
GHA.Installer.start=function(){GHA.Installer.Wizard.start();
GHA.Installer.Wizard.showProgressCheckStatusStep();
var A=GHA.Installer.UpmApi.getAvailablePluginInfo(GHA.Installer.pluginKey);
A.fail(function(B){GHA.Installer.Wizard.showError()
}).done(function(E){GHA.Installer.Wizard.showSuccessCheckStatusStep();
if(E.installed){var D=AJS.$.Deferred();
GHA.Installer.Wizard.showProgressDownloadingStep();
setTimeout(function(){GHA.Installer.Wizard.showSuccessDownloadingStep();
GHA.Installer.Wizard.showProgressInstallingStep();
setTimeout(function(){GHA.Installer.Wizard.showSuccessInstallingStep();
GHA.Installer.Wizard.showMacLoginForm()
},500)
},1000)
}else{GHA.Installer.Wizard.showProgressDownloadingStep();
var C=E.links.binary;
var B=GHA.Installer.UpmApi.getUpmToken();
B.fail(function(){GHA.Installer.Wizard.showError()
}).done(function(G){GHA.Installer.Wizard.showSuccessDownloadingStep();
GHA.Installer.Wizard.showProgressInstallingStep();
var F=GHA.Installer.UpmApi.installPlugin(C,G);
F.fail(function(){GHA.Installer.Wizard.showError()
}).done(function(H){GHA.Installer.updateInstallStatus(H)
})
})
}})
};
GHA.Installer.updateInstallStatus=function(C){if(C.status&&!C.status.done){var B=C.links.self;
var A=B.substring(B.lastIndexOf("/")+1);
setTimeout(function(){var D=GHA.Installer.UpmApi.getInstallProgress(A);
D.done(function(E){GHA.Installer.updateInstallStatus(E)
})
},GHA.Installer.pollInterval)
}else{if(C.vendor){GHA.Installer.Wizard.showSuccessInstallingStep();
GHA.Installer.Wizard.showMacLoginForm()
}}};
GHA.Installer.loginUserToMAC=function(C,A){var B=GHA.Installer.LassoApi.login(C,A);
B.done(function(D){GHA.Installer.Wizard.hideMacLoginForm();
GHA.Installer.Wizard.showProgressLicensingStep();
var E=GHA.Installer.HamletApi.generateEvaluationLicense(D.xsrfToken);
E.done(function(F){var G=GHA.Installer.storeLicense(F);
G.done(function(){GHA.Installer.Wizard.showSuccessLicensingStep();
GHA.Installer.Wizard.showSuccess()
});
G.fail(function(){GHA.Installer.Wizard.showError()
})
});
E.fail(function(){GHA.Installer.Wizard.showError()
})
});
return B
};
GHA.Installer.storeLicense=function(B){var A=AJS.$.Deferred();
var C=GHA.Installer.UpmApi.getPluginInfo(GHA.Installer.pluginKey);
C.done(function(E){E.licenseDetails={rawLicense:B.licenseKey};
var D=GHA.Installer.UpmApi.updatePluginInfo(GHA.Installer.pluginKey,E);
D.done(function(F){A.resolve()
});
D.fail(function(){A.reject()
})
});
C.fail(function(D){A.reject()
});
return A
};
GHA.Installer.UpmApi={};
GHA.Installer.UpmApi.getPluginInfo=function(A){return JIRA.SmartAjax.makeWebSudoRequest({type:"GET",url:contextPath+"/rest/plugins/1.0/"+A,dataType:"json",contentType:GHA.Installer.contentType,global:false},{cancel:function(B){B.preventDefault()
}})
};
GHA.Installer.UpmApi.updatePluginInfo=function(B,A){return JIRA.SmartAjax.makeWebSudoRequest({type:"PUT",url:contextPath+"/rest/plugins/1.0/"+B,dataType:"json",contentType:"application/vnd.atl.plugins.plugin+json",global:false,data:JSON.stringify(A)},{cancel:function(C){C.preventDefault()
}})
};
GHA.Installer.UpmApi.getAvailablePluginInfo=function(A){return JIRA.SmartAjax.makeWebSudoRequest({type:"GET",url:contextPath+"/rest/plugins/1.0/available/"+A,dataType:"json",contentType:GHA.Installer.contentType,global:false},{cancel:function(B){B.preventDefault()
}})
};
GHA.Installer.UpmApi.getUpmToken=function(){var A=AJS.$.Deferred();
JIRA.SmartAjax.makeWebSudoRequest({type:"head",url:contextPath+"/rest/plugins/1.0/",cache:false,complete:function(D,E,B){if(E==="success"){var C=D.getResponseHeader("upm-token");
A.resolve(C)
}else{A.reject();
alert("Failed to retrieve UPM token")
}}});
return A.promise()
};
GHA.Installer.UpmApi.installPlugin=function(B,A){return JIRA.SmartAjax.makeWebSudoRequest({type:"POST",url:contextPath+"/rest/plugins/1.0/?token="+A,dataType:"json",contentType:GHA.Installer.contentType,data:JSON.stringify({pluginUri:B}),globalThrobber:false,global:false})
};
GHA.Installer.UpmApi.getInstallProgress=function(A){return AJS.$.ajax({method:"GET",url:contextPath+"/rest/plugins/1.0/pending/"+A,contentType:GHA.Installer.contentType,global:false,globalThrobber:false})
};
GHA.Installer.LassoApi={};
GHA.Installer.LassoApi.login=function(C,A){var B={username:C,password:A};
if(GHA.Installer.browserSupportsCORS){return AJS.$.ajax({url:GHA.Urls.lassoUri+"id/rest/login",type:"POST",contentType:"application/json",dataType:"json",xhrFields:{withCredentials:true},data:JSON.stringify(B)})
}else{return AJS.$.ajax({url:GHA.Urls.lassoUri+"id/rest/login",type:"POST",contentType:"application/json",dataType:"jsonp",jsonp:"jsonp",data:{method:"POST","h-Content-Type":"application/json",body:GHA.Installer.Util._encodeRequestBody(B)}}).pipe(function(E,F){var D=new Object();
D.status=E[0].status||E.status;
D.message=E[0].message||E.message;
D.responseText=JSON.stringify(E[1])||"";
if(D.status!=200){return(jQuery.Deferred().rejectWith(E,[D,F]))
}else{D.username=E[1].username;
D.xsrfToken=E[1].xsrfToken;
return(jQuery.Deferred().resolveWith(E,[D,F]))
}})
}};
GHA.Installer.HamletApi={};
GHA.Installer.HamletApi.generateEvaluationLicense=function(B){var A={productKey:GHA.Installer.productKey,serverId:GHA.Installer.serverId,utmSource:"greenhopper"};
if(GHA.Installer.browserSupportsCORS){return AJS.$.ajax({url:GHA.Urls.hamletUri+"1.0/public/license/createEvaluation",type:"POST",beforeSend:function(C){C.setRequestHeader("ATL-XSRF-Token",B)
},xhrFields:{withCredentials:true},contentType:"application/json",dataType:"json",data:JSON.stringify(A)})
}else{return AJS.$.ajax({url:GHA.Urls.hamletUri+"1.0/public/license/createEvaluation",type:"GET",contentType:"application/json",dataType:"jsonp",jsonp:"jsonp",data:{method:"POST","h-Content-Type":"application/json","h-ATL-XSRF-Token":B,body:GHA.Installer.Util._encodeRequestBody(A)}}).pipe(function(D,E){var C=new Object();
C.status=D[0].status||D.status;
C.message=D[0].message||D.message;
C.responseText=JSON.stringify(D[1])||"";
if(C.status!=200){return(jQuery.Deferred().rejectWith(D,[C,E]))
}else{C.licenseKey=D[1].licenseKey;
C.id=D[1].id;
return(jQuery.Deferred().resolveWith(D,[C,E]))
}})
}};
GHA.Installer.Wizard={};
GHA.Installer.Wizard.dialog;
GHA.Installer.Wizard.$progressLabel;
GHA.Installer.Wizard.$progressBar;
GHA.Installer.Wizard.$statusLabel;
GHA.Installer.Wizard.$loginPanel;
GHA.Installer.Wizard.$loginForm;
GHA.Installer.Wizard.start=function(){var A=JPT.DialogController.dialog;
A.addPage();
A.addHeader("Create Agile Project");
A.addPanel("Installing",GHA.tpl.installer.renderInstallationPanel({baseUrl:contextPath}));
GHA.Installer.Wizard.dialog=A;
GHA.Installer.Wizard.$dialog=A.popup.element;
GHA.Installer.Wizard.$progressLabel=AJS.$("#gh-installer-install-percentage");
GHA.Installer.Wizard.$progressBar=AJS.$(".upm-progress-amount");
GHA.Installer.Wizard.$statusLabel=AJS.$("#gh-installer-install-status");
GHA.Installer.Wizard.$loginPanel=AJS.$("#gh-installer-login-panel");
GHA.Installer.Wizard.$loginForm=AJS.$("#gh-installer-login-form");
GHA.Installer.Wizard.$loginForm.submit(GHA.Installer.Wizard.handleLoginFormSubmit)
};
GHA.Installer.Wizard.showSuccessCheckStatusStep=function(){var A=GHA.Installer.Wizard.$dialog.find("#gh-install-step-check-status");
GHA.Installer.Wizard._successStepIcon(A)
};
GHA.Installer.Wizard.showProgressCheckStatusStep=function(){var A=GHA.Installer.Wizard.$dialog.find("#gh-install-step-check-status");
GHA.Installer.Wizard._progressStepIcon(A)
};
GHA.Installer.Wizard.showSuccessDownloadingStep=function(){var A=GHA.Installer.Wizard.$dialog.find("#gh-install-step-downloading");
GHA.Installer.Wizard._successStepIcon(A)
};
GHA.Installer.Wizard.showProgressDownloadingStep=function(){var A=GHA.Installer.Wizard.$dialog.find("#gh-install-step-downloading");
GHA.Installer.Wizard._progressStepIcon(A)
};
GHA.Installer.Wizard.showSuccessInstallingStep=function(){var A=GHA.Installer.Wizard.$dialog.find("#gh-install-step-installing");
GHA.Installer.Wizard._successStepIcon(A)
};
GHA.Installer.Wizard.showProgressInstallingStep=function(){var A=GHA.Installer.Wizard.$dialog.find("#gh-install-step-installing");
GHA.Installer.Wizard._progressStepIcon(A)
};
GHA.Installer.Wizard.showSuccessLicensingStep=function(){var A=GHA.Installer.Wizard.$dialog.find("#gh-install-step-licensing");
GHA.Installer.Wizard._successStepIcon(A)
};
GHA.Installer.Wizard.showProgressLicensingStep=function(){var A=GHA.Installer.Wizard.$dialog.find("#gh-install-step-licensing");
GHA.Installer.Wizard._progressStepIcon(A)
};
GHA.Installer.Wizard._successStepIcon=function(A){A.removeClass().addClass("gh-install-step-indicator gh-install-green aui-icon aui-icon-small aui-iconfont-success")
};
GHA.Installer.Wizard._progressStepIcon=function(A){A.removeClass().addClass("gh-install-step-indicator aui-icon aui-icon-wait")
};
GHA.Installer.Wizard.showMacLoginForm=function(){GHA.Installer.Wizard.$loginPanel.removeClass("hidden")
};
GHA.Installer.Wizard.hideMacLoginForm=function(){GHA.Installer.Wizard.$loginPanel.addClass("hidden")
};
GHA.Installer.Wizard.handleLoginFormSubmit=function(C){C.preventDefault();
var A=AJS.$(C.target||C.srcElement);
var D=A.find("#username").val();
var B=A.find("#password").val();
GHA.Installer.Wizard.$loginForm.find(":input").attr("disabled",true);
GHA.Installer.Wizard.$loginForm.find("button > span").removeClass("hidden");
GHA.Installer.loginUserToMAC(D,B).done(function(){GHA.Installer.Wizard.hideMacLoginForm()
}).fail(function(E){var F=GHA.Installer.Wizard.$loginPanel.find("#form-error");
var G;
if(_.isString(E.responseText)&&E.responseText.length>0){G=JSON.parse(E.responseText).error;
F.find("p").text(G)
}else{G=AJS.format("An unexpected error occurred when trying to install GreenHopper. Please check your internet connection is working. If this problem persists, please contact {0}Atlassian Support{1}.",'<a href="http://support.atlassian.com">',"</a>");
F.find("p").html(G)
}F.removeClass("hidden");
GHA.Installer.Wizard.$loginForm.find(":input").attr("disabled",false);
GHA.Installer.Wizard.$loginForm.find("button > span").addClass("hidden")
})
};
GHA.Installer.Wizard.showSuccess=function(){var A=GHA.Installer.Wizard.dialog;
A.addPage();
A.addHeader("Create Agile Project");
A.addPanel("Success",GHA.tpl.installer.renderInstallFinished({baseUrl:contextPath}));
A.addButton("\u5411\u540E",GHA.Installer.Wizard.closeSuccessDialog,"gh-complete-install-button");
A.popup.element.find(".gh-complete-install-button").removeClass("button-panel-button").addClass("aui-button aui-button-primary")
};
GHA.Installer.Wizard.showError=function(){var A=GHA.Installer.Wizard.dialog;
A.addPage();
A.addHeader("Create Agile Project");
A.addPanel("Error",GHA.tpl.installer.renderInstallFailed({baseUrl:contextPath}));
A.addButton("\u5173\u95ED",GHA.Installer.Wizard.closeErrorDialog);
A.popup.element.find(".gh-complete-install-button").removeClass("button-panel-button").addClass("aui-button aui-button-primary")
};
GHA.Installer.Wizard.closeSuccessDialog=function(){switch(GHA.Installer.selectedTemplateType){case"KANBAN":JPT.DialogController.openWithSelectedProjectTemplate(GHA.Installer.kanbanTemplateKey);
break;
case"SCRUM":JPT.DialogController.openWithSelectedProjectTemplate(GHA.Installer.scrumTemplateKey);
break
}};
GHA.Installer.Wizard.closeErrorDialog=function(){GHA.Installer.Wizard.dialog.remove()
};
GHA.Installer.Util={};
GHA.Installer.Util._encodeRequestBody=function(C){var F="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";
var H=A(JSON.stringify(C))+"  ";
var I=[];
for(var D=0;
D+2<H.length;
D+=3){var G=0;
for(var B=0;
B<3;
++B){G=(G<<8)+H.charCodeAt(D+B)
}for(var B=3;
B>=0;
--B){var E=(G>>(6*B))&63;
I.push(F.charAt(E))
}}return I.join("");
function A(J){return unescape(encodeURIComponent(J))
}};
/* module-key = 'com.atlassian.jira.plugins.greenhopper-marketing-plugin:gh-advertising-resources', location = '/js/greenhopper-advertising.soy' */
// This file was automatically generated from greenhopper-advertising.soy.
// Please don't edit this file by hand.

if (typeof GHA == 'undefined') { var GHA = {}; }
if (typeof GHA.tpl == 'undefined') { GHA.tpl = {}; }
if (typeof GHA.tpl.advertising == 'undefined') { GHA.tpl.advertising = {}; }


GHA.tpl.advertising.renderExplainInstallation = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.isScrum) ? '<p>' + soy.$$escapeHtml("The Atlassian GreenHopper add-on is required to set up an Agile Scrum project.") + '</p>' : '', (opt_data.isKanban) ? '<p>' + soy.$$escapeHtml("The Atlassian GreenHopper add-on is required to set up an Agile Kanban project.") + '</p>' : '', '<p>', soy.$$escapeHtml("Would you like to install Atlassian GreenHopper now?"), '</p>');
  return opt_sb ? '' : output.toString();
};


GHA.tpl.advertising.renderExplainOnDemandInstallation = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<p>', soy.$$escapeHtml("Scrum and Kanban projects require a GreenHopper license.  Click \x27Enable GreenHopper\x27 below to enable a trial license."), '</p><p>', soy.$$escapeHtml("Once you\x27ve set up a trial, starter, or regular GreenHopper license at my.atlassian.com, we\x27ll enable this instance and  you\x27ll land on the GreenHopper Getting Started page."), '</p>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.plugins.greenhopper-marketing-plugin:gh-advertising-resources', location = '/js/greenhopper-installer.soy' */
// This file was automatically generated from greenhopper-installer.soy.
// Please don't edit this file by hand.

if (typeof GHA == 'undefined') { var GHA = {}; }
if (typeof GHA.tpl == 'undefined') { GHA.tpl = {}; }
if (typeof GHA.tpl.installer == 'undefined') { GHA.tpl.installer = {}; }


GHA.tpl.installer.renderInstallationPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="gh-installer-installation-panel"><ul class="gh-install-steps"><li><span id="gh-install-step-check-status" class="gh-install-step-indicator"></span>', soy.$$escapeHtml("Checking add-on status"), '</li><li><span id="gh-install-step-downloading" class="gh-install-step-indicator"></span>', soy.$$escapeHtml("Downloading add-on from Marketplace"), '</li><li><span id="gh-install-step-installing" class="gh-install-step-indicator"></span>', soy.$$escapeHtml("Installing add-on in JIRA"), '</li><li><span id="gh-install-step-licensing" class="gh-install-step-indicator"></span>', soy.$$escapeHtml("Licensing"));
  GHA.tpl.installer.renderMacLoginPanel(null, output);
  output.append('</li></ul></div>');
  return opt_sb ? '' : output.toString();
};


GHA.tpl.installer.renderMacLoginPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="gh-installer-login-panel" class="hidden"><div class="aui-message hint shadowed"><span class="aui-icon aui-icon-small aui-iconfont-info" style="color:#4a6785;"></span><p>', soy.$$escapeHtml("Please log in with your \x27Atlassian ID\x27 to generate an evaluation license."), '</p></div><div id="form-error" class="hidden"><div class="aui-message error"><span class="aui-icon aui-icon-small aui-iconfont-error" style="color:#fff;"></span><p></p></div></div><form method="post" id="gh-installer-login-form" class="aui"><fieldset><div class="field-group"><label for="username">', soy.$$escapeHtml("Username"), '<span class="aui-icon icon-required"></span><span class="content"> required</span></label><input value="" class="text normal-field" type="text" id="username" name="username" title="Username"></div><div class="field-group"><label for="password">', soy.$$escapeHtml("Password"), '<span class="aui-icon icon-required"></span><span class="content"> required</span></label><input value="" class="text normal-field" type="password" id="password" name="password" title="Password"></div><fieldset><div class="buttons-container"><div class="buttons"><button class="aui-button" type="submit"><span class=" hidden aui-icon aui-icon-small aui-icon-wait" style="margin-right: 5px"></span>', soy.$$escapeHtml("Log In"), '</button><a href="https://id.atlassian.com/id/forgotPassword.action" target="_blank" class="cancel">', soy.$$escapeHtml("Forgot password?"), '</a></div></div></form></div>');
  return opt_sb ? '' : output.toString();
};


GHA.tpl.installer.renderInstallFinished = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="gh-installer-finished-panel"><div class="aui-message success shadowed"><p class="title">', soy.$$escapeHtml("Success!"), '</p><span class="aui-icon icon-success"></span><p>', soy.$$escapeHtml("GreenHopper was successfully installed with a 30-day evaluation license. You can now start creating Agile projects!"), '</p></div></div>');
  return opt_sb ? '' : output.toString();
};


GHA.tpl.installer.renderInstallFailed = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div id="gh-installer-failed-panel"><div class="aui-message error shadowed"><p class="title">', soy.$$escapeHtml("Installation failed!"), '</p><span class="aui-icon icon-error"></span><p>', AJS.format("An unexpected error occurred when trying to install GreenHopper. Please check your internet connection is working. If this problem persists, please contact {0}Atlassian Support{1}.",'<a href="http://support.atlassian.com">','</a>'), '</p></div></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'jira.webresources:field-templates', location = '/includes/jira/field/templates/singleUserPicker.soy' */
// This file was automatically generated from singleUserPicker.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.Fields == 'undefined') { JIRA.Templates.Fields = {}; }
if (typeof JIRA.Templates.Fields.Pickers == 'undefined') { JIRA.Templates.Fields.Pickers = {}; }
if (typeof JIRA.Templates.Fields.Pickers.User == 'undefined') { JIRA.Templates.Fields.Pickers.User = {}; }


JIRA.Templates.Fields.Pickers.User.single = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<select id="', soy.$$escapeHtml(opt_data.field.id), '" name="', soy.$$escapeHtml(opt_data.field.name), '" class="single-user-picker js-', (opt_data.type) ? soy.$$escapeHtml(opt_data.type) : 'default-user-picker', '"', (opt_data.inputText) ? ' data-input-text="' + soy.$$escapeHtml(opt_data.inputText) + '"' : '', (opt_data.editValue) ? ' data-edit-value="' + soy.$$escapeHtml(opt_data.editValue) + '"' : '', (opt_data.showDropdownButton) ? ' data-show-dropdown-button="true"' : '', (opt_data.userType) ? ' data-user-type="' + soy.$$escapeHtml(opt_data.userType) + '"' : '', (opt_data.containerClass) ? ' data-container-class="' + soy.$$escapeHtml(opt_data.containerClass) + '"' : '', '>');
  var optionList38 = opt_data.options;
  var optionListLen38 = optionList38.length;
  for (var optionIndex38 = 0; optionIndex38 < optionListLen38; optionIndex38++) {
    var optionData38 = optionList38[optionIndex38];
    if (optionData38.optionGroup) {
      output.append('<optgroup id="', soy.$$escapeHtml(opt_data.field.id), '-group-', soy.$$escapeHtml(optionData38.id), '" label="', soy.$$escapeHtml(optionData38.display), '"', (optionData38.footer) ? ' data-footer-text="' + soy.$$escapeHtml(optionData38.footer) + '"' : '', '>', (optionData38.weight != -1) ? ' data-weight="' + soy.$$escapeHtml(optionData38.weight) + '"' : '', '>');
      var groupOptionList60 = optionData38.groupOptions;
      var groupOptionListLen60 = groupOptionList60.length;
      for (var groupOptionIndex60 = 0; groupOptionIndex60 < groupOptionListLen60; groupOptionIndex60++) {
        var groupOptionData60 = groupOptionList60[groupOptionIndex60];
        JIRA.Templates.Fields.Pickers.User.option(groupOptionData60, output);
      }
      output.append('</optgroup>');
    } else {
      JIRA.Templates.Fields.Pickers.User.option(optionData38, output);
    }
  }
  output.append('</select>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Fields.Pickers.User.option = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<option ', (opt_data.loggedInUser) ? 'class="current-user" ' : '', (opt_data.selected) ? 'selected="selected" ' : '', 'value="', soy.$$escapeHtml(opt_data.optionName), '" data-field-text="', soy.$$escapeHtml(opt_data.displayName), '" data-field-label="', soy.$$escapeHtml(opt_data.displayName), (opt_data.optionName && opt_data.optionName != '-1') ? ' - ' + soy.$$escapeHtml(opt_data.emailAddress) + ' (' + soy.$$escapeHtml(opt_data.optionName) + ')' : '', '" data-icon="', soy.$$escapeHtml(opt_data.avatarURL), '" >', soy.$$escapeHtml(opt_data.displayName), '</option>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'jira.webresources:field-templates', location = '/includes/jira/field/templates/assigneeField.soy' */
// This file was automatically generated from assigneeField.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.Fields == 'undefined') { JIRA.Templates.Fields = {}; }
if (typeof JIRA.Templates.Fields.Pickers == 'undefined') { JIRA.Templates.Fields.Pickers = {}; }
if (typeof JIRA.Templates.Fields.Pickers.User == 'undefined') { JIRA.Templates.Fields.Pickers.User = {}; }


JIRA.Templates.Fields.Pickers.User.assignee = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  JIRA.Templates.Fields.Pickers.User.single(soy.$$augmentData(opt_data, {options: opt_data.assigneeOptions.options, showDropdownButton: true, userType: 'assignee', type: 'assignee-picker', containerClass: 'long-field'}), output);
  output.append((opt_data.isLoggedInUserAssignable) ? '<a href="#' + soy.$$escapeHtml(opt_data.field.id) + '" id="assign-to-me-trigger">' + soy.$$escapeHtml("\u5206\u914d\u7ed9\u6211") + '</a>' : '', '<fieldset class="hidden parameters"><input type="hidden" title="projectKeys" value="', soy.$$escapeHtml(opt_data.projectKeys), '"/>', (opt_data.issueKey) ? '<input type="hidden" title="assigneeEditIssueKey" value="' + soy.$$escapeHtml(opt_data.issueKey) + '"/>' : '', (opt_data.actionDescriptorId) ? '<input type="hidden" title="actionDescriptorId" value="' + soy.$$escapeHtml(opt_data.actionDescriptorId) + '"/>' : '', '</fieldset>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/js/lib/jquery.dotdotdot-1.5.7.js' */
(function(i){if(i.fn.dotdotdot){return}i.fn.dotdotdot=function(v){if(this.length==0){if(!v||v.debug!==false){b(true,'No element found for "'+this.selector+'".')}return this}if(this.length>1){return this.each(function(){i(this).dotdotdot(v)})}var r=this;if(r.data("dotdotdot")){r.trigger("destroy.dot")}r.bind_events=function(){r.bind("update.dot",function(y,A){y.preventDefault();y.stopPropagation();t.maxHeight=(typeof t.height=="number")?t.height:o(r);t.maxHeight+=t.tolerance;if(typeof A!="undefined"){if(typeof A=="string"||A instanceof HTMLElement){A=i("<div />").append(A).contents()}if(A instanceof i){w=A}}s=r.wrapInner('<div class="dotdotdot" />').children();s.empty().append(w.clone(true)).css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var z=false,x=false;if(q.afterElement){z=q.afterElement.clone(true);q.afterElement.remove()}if(k(s,t)){if(t.wrap=="children"){x=d(s,t,z)}else{x=m(s,r,s,t,z)}}s.replaceWith(s.contents());s=null;if(i.isFunction(t.callback)){t.callback.call(r[0],x,w)}q.isTruncated=x;return x}).bind("isTruncated.dot",function(y,x){y.preventDefault();y.stopPropagation();if(typeof x=="function"){x.call(r[0],q.isTruncated)}return q.isTruncated}).bind("originalContent.dot",function(y,x){y.preventDefault();y.stopPropagation();if(typeof x=="function"){x.call(r[0],w)}return w}).bind("destroy.dot",function(x){x.preventDefault();x.stopPropagation();r.unwatch().unbind_events().empty().append(w).data("dotdotdot",false)});return r};r.unbind_events=function(){r.unbind(".dot");return r};r.watch=function(){r.unwatch();if(t.watch=="window"){var z=i(window),y=z.width(),x=z.height();z.bind("resize.dot"+q.dotId,function(){if(y!=z.width()||x!=z.height()||!t.windowResizeFix){y=z.width();x=z.height();if(p){clearInterval(p)}p=setTimeout(function(){r.trigger("update.dot")},10)}})}else{u=j(r);p=setInterval(function(){var A=j(r);if(u.width!=A.width||u.height!=A.height){r.trigger("update.dot");u=j(r)}},100)}return r};r.unwatch=function(){i(window).unbind("resize.dot"+q.dotId);if(p){clearInterval(p)}return r};var w=r.contents(),t=i.extend(true,{},i.fn.dotdotdot.defaults,v),q={},u={},p=null,s=null;q.afterElement=c(t.after,r);q.isTruncated=false;q.dotId=l++;r.data("dotdotdot",true).bind_events().trigger("update.dot");if(t.watch){r.watch()}return r};i.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",lastCharacter:{remove:[" ",",",";",".","!","?"],noEllipsis:[]},tolerance:0,callback:null,after:null,height:null,watch:false,windowResizeFix:true,debug:false};var l=1;function d(s,w,v){var u=s.children(),p=false;s.empty();for(var r=0,q=u.length;r<q;r++){var t=u.eq(r);s.append(t);if(v){s.append(v)}if(k(s,w)){t.remove();p=true;break}else{if(v){v.remove()}}}return p}function m(s,r,A,t,q){var w=s.contents(),x=false;s.empty();var z="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, select, optgroup, option, textarea, script, style";for(var y=0,u=w.length;y<u;y++){if(x){break}var v=w[y],p=i(v);if(typeof v=="undefined"){continue}s.append(p);if(q){s[(s.is(z))?"after":"append"](q)}if(v.nodeType==3){if(k(A,t)){x=e(p,r,A,t,q)}}else{x=m(p,r,A,t,q)}if(!x){if(q){q.remove()}}}return x}function e(q,r,p,w,s){var D=false,A=q[0];if(typeof A=="undefined"){return false}var E=(w.wrap=="letter")?"":" ",t=h(A).split(E),F=-1,v=-1,G=0,y=t.length-1;while(G<=y){var x=Math.floor((G+y)/2);if(x==v){break}v=x;a(A,t.slice(0,v+1).join(E)+w.ellipsis);if(!k(p,w)){F=v;G=v}else{y=v}}if(F!=-1&&!(t.length==1&&t[0].length==0)){var u=f(t.slice(0,F+1).join(E),w);D=true;a(A,u)}else{var z=q.parent();q.remove();var C=(s)?s.length:0;if(z.contents().size()>C){var B=z.contents().eq(-1-C);D=e(B,r,p,w,s)}else{var A=z.prev().contents().eq(-1)[0];if(typeof A!="undefined"){var u=f(h(A),w);a(A,u);z.remove();D=true}}}return D}function k(q,p){return q.innerHeight()>p.maxHeight}function f(p,q){while(i.inArray(p.slice(-1),q.lastCharacter.remove)>-1){p=p.slice(0,-1)}if(i.inArray(p.slice(-1),q.lastCharacter.noEllipsis)<0){p+=q.ellipsis}return p}function j(p){return{width:p.innerWidth(),height:p.innerHeight()}}function a(q,p){if(q.innerText){q.innerText=p}else{if(q.nodeValue){q.nodeValue=p}else{if(q.textContent){q.textContent=p}}}}function h(p){if(p.innerText){return p.innerText}else{if(p.nodeValue){return p.nodeValue}else{if(p.textContent){return p.textContent}else{return""}}}}function c(p,q){if(typeof p=="undefined"){return false}if(!p){return false}if(typeof p=="string"){p=i(p,q);return(p.length)?p:false}if(typeof p=="object"){return(typeof p.jquery=="undefined")?false:p}return false}function o(s){var t=s.innerHeight(),r=["paddingTop","paddingBottom"];for(var u=0,q=r.length;u<q;u++){var p=parseInt(s.css(r[u]),10);if(isNaN(p)){p=0}t-=p}return t}function b(q,p){if(!q){return false}if(typeof p=="string"){p="dotdotdot: "+p}else{p=["dotdotdot:",p]}if(typeof window.console!="undefined"){if(typeof window.console.log!="undefined"){window.console.log(p)}}return false}var n=i.fn.html;i.fn.html=function(p){if(typeof p!="undefined"){if(this.data("dotdotdot")){if(typeof p!="function"){return this.trigger("update",[p])}}return n.call(this,p)}return n.call(this)};var g=i.fn.text;i.fn.text=function(q){if(typeof q!="undefined"){if(this.data("dotdotdot")){var p=i("<div />");p.text(q);q=p.html();p.remove();return this.trigger("update",[q])}return g.call(this,q)}return g.call(this)}})(jQuery);
/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/js/DialogController.js' */
JPT={};JPT.DialogController={};JPT.DialogController.welcomeRestUrl=AJS.contextPath()+"/rest/welcome/1.0/show/welcome";JPT.DialogController.init=function init(){if(AJS.Meta.getBoolean("show-welcome-screen")){JPT.DialogController.handleProjectTemplateTriggered()}};JPT.DialogController.handleProjectTemplateTriggered=function handleProjectTemplateTriggered(){JPT.DialogController.openWithSelectedProjectTemplate()};JPT.DialogController.openWithSelectedProjectTemplate=function openWithSelectedProjectTemplate(b){if(b&&JPT.DialogController.dialog){JPT.DialogController.dialog.remove()}var a=JPT.SelectProjectTemplateController.loadProjectTemplatesData();a.fail(function(c){if(c.status===401&&c.responseText.toLowerCase().indexOf("requires websudo")>=0){JPT.DialogController.enableWebSudo()}else{JPT.DialogController.handleUnknownErrorOfPTRetrieval()}});a.done(function(c){JPT.DialogController.dialog=JPT.DialogView.draw();JPT.DialogController.$dialogElement=JPT.DialogController.dialog.popup.element;var d;if(!_.isUndefined(JPT.ConfigModel)&&!_.isUndefined(JPT.ConfigModel.selectedTemplate)){d=JPT.ConfigModel.selectedTemplate}JPT.ConfigModel=c;JPT.ConfigModel.selectedTemplate=d;JPT.SelectProjectTemplateController.init(c.projectTemplates,b)})};JPT.DialogController.enableWebSudo=function enableWebSudo(){JIRA.SmartAjax.showWebSudoDialog({success:function(a){JPT.DialogController.handleProjectTemplateTriggered();a()}})};JPT.DialogController.handleUnknownErrorOfPTRetrieval=function handleUnknownErrorOfPTRetrieval(){JPT.DialogView.draw();JPT.DialogView.showErrorMessage("An error occurred while trying to contact JIRA")};JPT.DialogController.hideDialogFromNewUser=function hideDialogFromNewUser(a){if(AJS.Meta.getBoolean("show-welcome-screen")){AJS.$.ajax({url:JPT.DialogController.welcomeRestUrl+"/"+a,type:"DELETE",success:function(){if(AJS.isDevMode&&AJS.isDevMode()){AJS.log("don't show project template dialog anymore")}}})}};AJS.$(JPT.DialogController.init);
/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/js/DialogView.js' */
(function(){JPT.DialogViewImpl=Backbone.View.extend({events:{"click   .add-project-trigger":"_onClickAddProject","click   #add-project-dialog .import-project-trigger":"_onClickImportProject","keydown #add-project-dialog .pt-templates-list":"_onKeydownInTemplatesList"},draw:function(){var b=new AJS.Dialog({width:840,height:400,id:"add-project-dialog",closeOnOutsideClick:false,keypressListener:_.bind(this._onKeyPressed,this)});var c=b.popup.element;b.addPage("project-templates-page");b.addHeader("Select Project Type","add-project-dialog-header");b.addPanel("ProjectTemplatesListPanel",JIRA.Templates.ProjectTemplates.loadingTemplatesList(),"pt-content");this._dialog=b;this._$dialogElement=c;b.show();return b},remove:function(){this._dialog&&this._dialog.remove()},showErrorMessage:function(b){this._dialog.getPanel(1,0).html(JIRA.Templates.errorMsg({closable:false,msg:b}))},get$PTContent:function a(){return JPT.DialogController.$dialogElement.find(".pt-content")},_onKeyPressed:function(c){var b=27;if(this._dialog){if(c.keyCode===b){JPT.DialogController.hideDialogFromNewUser("dismissed");this._dialog.remove();return false}}return true},_onKeydownInTemplatesList:function(c){var b=13;if(this._dialog){if(c.keyCode===b){this._$dialogElement.find(".pt-submit-button:visible").click();return false}}return true},_onClickAddProject:function(b){b.preventDefault();JPT.DialogController.handleProjectTemplateTriggered()},_onClickImportProject:function(b){JPT.DialogController.hideDialogFromNewUser("importproject")}});JPT.DialogView=new JPT.DialogViewImpl({el:AJS.$(document)})})();
/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/js/SelectProjectTemplateController.js' */
JPT.SelectProjectTemplateController={};JPT.SelectProjectTemplateController.init=function init(b,a){JPT.DialogController.$dialogElement.hide();JPT.SelectProjectTemplateView.draw(b);if(a){var c=_.find(b,function(d){return d.itemModuleCompleteKey===a});if(!_.isUndefined(c)){JPT.SelectProjectTemplateController.openAddProjectPage(c)}else{JPT.DialogView.showErrorMessage("Unable to find the template you were redirected to.");JPT.SelectProjectTemplateView.disableNextButton()}}JPT.DialogController.$dialogElement.show();JPT.SelectProjectTemplateView.truncateTemplateDescriptions()};JPT.SelectProjectTemplateController.loadProjectTemplatesData=function loadProjectTemplatesData(){return AJS.$.ajax({url:contextPath+"/rest/project-templates/1.0/templates",type:"GET",timeout:5000})};JPT.SelectProjectTemplateController.dialogSubmitted=function dialogSubmitted(){var a=JPT.SelectProjectTemplateView.getSelectedTemplateData();JPT.DialogController.hideDialogFromNewUser("templateselected");JPT.SelectProjectTemplateController.raiseAtlassianEvent(a.itemModuleCompleteKey);JPT.SelectProjectTemplateController.openAddProjectPage(a)};JPT.SelectProjectTemplateController.openAddProjectPage=function openAddProjectPage(a){if(!a){JPT.DialogView.showErrorMessage("An error occurred while trying to contact JIRA");return}if(!_.isUndefined(a.templateKey)){JPT.AddProjectController.initProjectTemplate(a)}else{JPT.DialogController.dialog.addPage("blank-template-page");AJS.$("body").trigger(a.itemModuleCompleteKey,JPT.DialogController.dialog)}};JPT.SelectProjectTemplateController.raiseAtlassianEvent=function raiseAtlassianEvent(a){JPT.ConfigModel.selectedTemplate=a;if(AJS.EventQueue){AJS.EventQueue.push({name:"projecttemplates.templateselected",properties:{selectedTemplate:a}})}};
/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/js/SelectProjectTemplateView.js' */
JPT.SelectProjectTemplateView={};JPT.SelectProjectTemplateView.ROW_LENGTH=2;JPT.SelectProjectTemplateView.draw=function draw(b){JPT.DialogController.dialog.getPanel(1,0).html(JIRA.Templates.ProjectTemplates.renderList({projectTemplates:b}));if(JPT.ConfigModel.projectCount>=2){AJS.$(JIRA.Templates.ProjectTemplates.addWorkflowsLink({baseUrl:contextPath})).appendTo(JPT.DialogController.$dialogElement.find(".dialog-title"))}JPT.DialogController.dialog.addButton("Next",JPT.SelectProjectTemplateController.dialogSubmitted,"create-project-dialog-create-button pt-submit-button");var c=JPT.DialogController.$dialogElement.find(".create-project-dialog-create-button");JPT.DialogController.dialog.addCancel("Cancel",function(d){JPT.DialogController.hideDialogFromNewUser("dismissed");JPT.DialogController.dialog.remove()});c.removeClass("button-panel-button").addClass("aui-button aui-button-primary");JPT.DialogController.$dialogElement.find(".template").click(function(){var d=AJS.$(this);d.addClass("selected").siblings().removeClass("selected")}).dblclick(function(d){c.click()}).focus(function(){AJS.$(this).click()});var a=JPT.SelectProjectTemplateView.get$TemplatesContainer();AJS.$(JIRA.Templates.ProjectTemplates.importProjectLink({baseUrl:contextPath})).prependTo(JPT.DialogController.$dialogElement.find(".dialog-button-panel"));JPT.SelectProjectTemplateView.bindKeyboardEvents(a);if(b.length==0){c.attr("disabled","disabled")}JPT.SelectProjectTemplateView.focusOnFirstTemplate(a)};JPT.SelectProjectTemplateView.get$TemplatesContainer=function getTemplatesContainer(){return JPT.DialogController.$dialogElement.find(".templates")};JPT.SelectProjectTemplateView.focusOnFirstTemplate=function focusOnFirstTemplate(a){JPT.DialogController.$dialogElement.find(".template:first-child").click();setTimeout(function(){a.focus()},0)};JPT.SelectProjectTemplateView.getSelectedTemplateData=function getSelectedTemplateData(){var b=JPT.DialogController.$dialogElement.find(".template.selected");var a=b.data();a.name=b.find(".template-meta .template-name").text();a.description=b.find(".template-meta .template-description").text();return a};JPT.SelectProjectTemplateView.getMoveDeltaForKey=function(a){switch(a){case 37:return -1;case 39:return +1;case 38:return -JPT.SelectProjectTemplateView.ROW_LENGTH;case 40:return +JPT.SelectProjectTemplateView.ROW_LENGTH}return 0};JPT.SelectProjectTemplateView.bindKeyboardEvents=function(a){a.bind("keydown",function(b){var c=JPT.SelectProjectTemplateView.getMoveDeltaForKey(b.which);if(c){JPT.SelectProjectTemplateView.moveSelection(a,c);return AJS.stopEvent(b)}})};JPT.SelectProjectTemplateView.moveSelection=function(c,f){var b=c.find(".template");var e=b.filter(".selected");var d=b.index(e)+f;if(d<b.length&&d>=0){var a=b.eq(d);a.click().focus();JPT.SelectProjectTemplateView.scrollToSelectedElement(a)}};JPT.SelectProjectTemplateView.scrollToSelectedElement=function scrollToSelectedElement(c){var f=AJS.$(".dialog-panel-body.pt-content");var a=f.offset().top;var b=c.offset().top;var e=b+c.height();var d=a+f.height();if(b<a){f.scrollTop(f.scrollTop()-(a-b))}else{if(e>(a+f.height())){f.scrollTop(f.scrollTop()+e-d)}}};JPT.SelectProjectTemplateView.get$NextButton=function getNextButton(){return JPT.DialogController.$dialogElement.find(".create-project-dialog-create-button")};JPT.SelectProjectTemplateView.disableNextButton=function disableNextButton(){JPT.SelectProjectTemplateView.get$NextButton().attr("disabled","disabled")};JPT.SelectProjectTemplateView.truncateTemplateDescriptions=function truncateTemplateDescriptions(){var a=AJS.Meta.get("user-locale");var b="word";if(a==="ja_JP"){b="letter"}JPT.DialogController.$dialogElement.find(".template-description").each(function(){AJS.$(this).dotdotdot({wrap:b,lastCharacter:{remove:[" ",",",";",".","!","?","。"],noEllipsis:[]}})})};
/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/soy/ProjectTemplatesList.soy' */
// This file was automatically generated from ProjectTemplatesList.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.ProjectTemplates == 'undefined') { JIRA.Templates.ProjectTemplates = {}; }


JIRA.Templates.ProjectTemplates.renderList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.projectTemplates.length == 0) {
    JIRA.Templates.errorMsg({closeable: false, msg: "No project templates could be found."}, output);
  } else {
    output.append('<div class="pt-templates-list">');
    JIRA.Templates.ProjectTemplates.renderItems(opt_data, output);
    output.append('</div>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.renderItems = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ol class="templates" tabindex="100">');
  var templateList15 = opt_data.projectTemplates;
  var templateListLen15 = templateList15.length;
  for (var templateIndex15 = 0; templateIndex15 < templateListLen15; templateIndex15++) {
    var templateData15 = templateList15[templateIndex15];
    output.append('<li class="template"', (templateData15.itemModuleCompleteKey) ? 'data-item-module-complete-key="' + soy.$$escapeHtml(templateData15.itemModuleCompleteKey) + '"' : '', (templateData15.projectTemplateModuleCompleteKey) ? 'data-project-template-module-complete-key="' + soy.$$escapeHtml(templateData15.projectTemplateModuleCompleteKey) + '"' : '', (templateData15.templateKey) ? 'data-template-key="' + soy.$$escapeHtml(templateData15.templateKey) + '"' : '', (templateData15.backgroundIconUrl) ? 'data-background-icon-url="' + soy.$$escapeHtml(templateData15.backgroundIconUrl) + '"' : '', (templateData15.longDescription) ? 'data-long-description="' + soy.$$escapeHtml(templateData15.longDescription) + '"' : '', '><img class="template-preview" src="', soy.$$escapeHtml(templateData15.iconURL), '" /><div class="template-meta"><div class="template-name" title="', soy.$$escapeHtml(templateData15.name), '">', soy.$$escapeHtml(templateData15.name), '</div><div class="template-description" title="', soy.$$escapeHtml(templateData15.description), '">', soy.$$escapeHtml(templateData15.description), '</div></div></li>');
  }
  output.append('</ol>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.loadingTemplatesList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="wait-container"><img class="wait-icon" src="', soy.$$escapeHtml(""), '/images/icons/wait.gif"><span class="wait-text">', soy.$$escapeHtml("Loading project templates"), '&hellip;</span></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.importProjectLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class="import-project-trigger button-panel-link" href="', soy.$$escapeHtml(opt_data.baseUrl), '/secure/admin/views/ExternalImport1.jspa" tabindex="-1">', soy.$$escapeHtml("Import from external system"), '</a>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.addWorkflowsLink = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class="add-workflow-link" href="', soy.$$escapeHtml(opt_data.baseUrl), '/plugins/servlet/wfshare-import?src=projecttemplates" tabindex="-1">', soy.$$escapeHtml("View Marketplace Workflows"), '</a>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/js/AddProjectController.js' */
(function(){JPT.AddProjectControllerImpl=Class.extend({postProjectCreationCallbacks:[],projectKeyValidationCallbacks:[],projectNamesUpperCased:[],init:function(g){this._window=g.window||window;_.bindAll(this,"projectCreatedHandler","projectValidationFailedHandler","nameTimeout","keyTimeout","submit")},initProjectTemplate:function(g){this.desiredKeyLength=4;this.lastKeyValidated="";this._getExistingProjects();JPT.ProjectKeyGenerator.init(this.desiredKeyLength,JPT.ConfigModel.maxKeyLength);this.webItemData=g;JPT.AddProjectView.prepareDialog();JPT.AddProjectView.draw({webItemData:this.webItemData,maxKeyLength:JPT.ConfigModel.maxKeyLength,maxNameLength:JPT.ConfigModel.maxNameLength,currentUserName:JPT.ConfigModel.currentUserName,currentUserDisplayName:JPT.ConfigModel.currentUserDisplayName,currentUserAvatarUrl:JPT.ConfigModel.currentUserAvatarUrl,errors:{}})},_resetProjectLeadValues:function(){JPT.ConfigModel.currentUserDisplayName="";JPT.ConfigModel.currentUserName="";JPT.ConfigModel.currentUserAvatarUrl=""},_hasFullyConfiguredProjectLead:function(){return JPT.AddProjectView.getLeadDisplayName()&&JPT.AddProjectView.getAvatarUrlOfSelectedLead()!=""},submit:function(g){var h=JPT.AddProjectView.getAddProjectForm().serialize();if(JPT.AddProjectView.hasInlineErrors()){return}if(JPT.AddProjectView.enterLoadingState()){if(this._hasFullyConfiguredProjectLead()){JPT.ConfigModel.currentUserDisplayName=JPT.AddProjectView.getLeadDisplayName();JPT.ConfigModel.currentUserName=JPT.ConfigModel.currentUserDisplayName?JPT.AddProjectView.getLeadUserName():"";JPT.ConfigModel.currentUserAvatarUrl=JPT.AddProjectView.getAvatarUrlOfSelectedLead()}else{this._resetProjectLeadValues()}var i=AJS.$.ajax({url:contextPath+"/rest/project-templates/1.0/templates",type:"POST",data:h,timeout:50000,headers:{"X-Atlassian-Token":"nocheck"}});i.then(this.projectCreatedHandler,this.projectValidationFailedHandler)}},registerPostProjectCreationCallback:function(g){this.postProjectCreationCallbacks.push(g)},registerProjectKeyValidationCallback:function(g){this.projectKeyValidationCallbacks.push(g)},localStoragePrefix:"jira.projecttemplates.",projectCreatedHandler:function(h){JPT.AddProjectView.avoidDirtyFormWarning();var g=this.localStoragePrefix;var i=["confluenceProject","fisheyeProject","crucibleProject","bambooProject"];_.map(i,function(j){if(h.remoteProjectLinks[j]){localStorage.setItem(g+j,h.remoteProjectLinks[j])}});if(!_.isEmpty(this.postProjectCreationCallbacks)){JPT.DialogController.dialog.addPage("post-project-created-page");_.each(this.postProjectCreationCallbacks,function(j){j(JPT.DialogController.dialog,h.returnUrl,h.projectId,h.projectKey,h.projectName)})}else{this._window.location=contextPath+h.returnUrl}},projectValidationFailedHandler:function(h,j){var i={};if(h.status===400){i=JSON.parse(h.responseText)}else{if(h.status===500&&!_.isUndefined(JSON.parse(h.responseText).message)){var g=JSON.parse(h.responseText);JIRA.Messages.showReloadErrorMsg(g.message);JPT.AddProjectView.avoidDirtyFormWarning();this._window.location=contextPath+g.returnUrl;return}else{if(j==="timeout"){i={errorMessages:["Request timeout when creating project"]}}else{i={errorMessages:[AJS.format("Error creating project, {0}",h.responseText)]}}}}JPT.AddProjectView.draw({webItemData:this.webItemData,errors:i,currentName:JPT.AddProjectView.getName(),currentKey:JPT.AddProjectView.getKey(),currentUserDisplayName:JPT.ConfigModel.currentUserDisplayName,currentUserName:JPT.ConfigModel.currentUserName,currentUserAvatarUrl:JPT.ConfigModel.currentUserAvatarUrl});JPT.AddProjectView.hideLoadingState()},_updateAndValidateKey:function e(g){JPT.AddProjectView.setKey(g);this._validateKey()},_shouldUpdateKey:function d(){return(JPT.AddProjectView.getKeyEdited()!="true")},autofillKeyIfNeeded:function b(){if(this._shouldUpdateKey()){var g=JPT.ProjectKeyGenerator.generate(JPT.AddProjectView.getName());if(g.length>1){this._updateAndValidateKey(g)}else{JPT.AddProjectView.setKey("")}}},_doesProjectNameExists:function(h){var g;for(g in this.projectNamesUpperCased){if(h.toUpperCase()==this.projectNamesUpperCased[g]){return true}}return false},_validateName:function(){var g=AJS.$.trim(JPT.AddProjectView.getName());if(!g){return}if(g.length<JPT.ConfigModel.minNameLength){JPT.AddProjectView.showInlineErrorForName(AJS.format("The project name should be at least {0} characters in length.",JPT.ConfigModel.minNameLength));return}if(g.length>JPT.ConfigModel.maxNameLength){JPT.AddProjectView.showInlineErrorForName(AJS.format("\u9879\u76EE\u540D\u79F0\u4E0D\u80FD\u957F\u5EA6\u5927\u4E8E {0} \u4E2A\u5B57\u7B26\u3002",JPT.ConfigModel.maxNameLength));return}if(this._doesProjectNameExists(g)){JPT.AddProjectView.showInlineErrorForName("\u5DF2\u7ECF\u5B58\u5728\u540C\u540D\u9879\u76EE");return}JPT.AddProjectView.hideInlineErrorForName()},_performKeyValidationChecks:function(g){var h=AJS.$.ajax({url:contextPath+"/rest/api/latest/projectvalidate/key?key="+g.toUpperCase(),timeout:5000});h.done(function(j){if(j.errors&&j.errors.projectKey){JPT.AddProjectView.showInlineErrorForKey(j.errors.projectKey)}else{var i=false;_.each(this.projectKeyValidationCallbacks,function(l){var k=l(g.toUpperCase());if(k.errors&&k.errors.projectKey){i=true;JPT.AddProjectView.showInlineErrorForKey(k.errors.projectKey)}});if(!i){JPT.AddProjectView.hideInlineErrorForKey()}}})},_validateKey:function a(){var g=JPT.AddProjectView.getKey();if(this.lastKeyValidated===g){return}if(g){this.lastKeyValidated=g;this._performKeyValidationChecks(g)}else{JPT.AddProjectView.hideInlineErrorForKey()}},nameTimeout:function c(){this._validateName();this.autofillKeyIfNeeded()},keyTimeout:function f(){JPT.AddProjectView.setKeyEdited();this._validateKey()},_getExistingProjects:function(){if(this.projectNamesUpperCased.length>0){return this.projectNamesUpperCased}var g=AJS.$.ajax({url:contextPath+"/rest/api/latest/project",timeout:5000});g.done(_.bind(function(h){this.projectNamesUpperCased=_.map(h,function(i){return i.name.toUpperCase()})},this))}});JPT.AddProjectController=new JPT.AddProjectControllerImpl({el:AJS.$(document)})})();
/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/js/AddProjectView.js' */
(function(){JPT.AddProjectViewImpl=Backbone.View.extend({TIMEOUT_MS:100,postDrawCallbacks:[],events:{"submit #add-project-form":"onSubmitForm"},initialize:function(w){_.bindAll(this,"bindHook")},addPostDrawCallback:function(w){this.postDrawCallbacks.push(w)},prepareDialog:function(){if(!JPT.DialogController.dialog.getPage(2)){JPT.DialogController.dialog.addPage("add-project");JPT.DialogController.dialog.addHeader("Add a new project","add-project-dialog-header");JPT.DialogController.dialog.addPanel("title","","pt-content");JPT.DialogController.dialog.addButton("Back",function(){var y=JPT.DialogView.get$PTContent();y.css("background-image","none");JPT.DialogController.dialog.gotoPage(1);JPT.SelectProjectTemplateView.focusOnFirstTemplate(JPT.SelectProjectTemplateView.get$TemplatesContainer())},"add-project-back-button");var x=JPT.DialogController.$dialogElement.find(".add-project-back-button");x.removeClass("button-panel-button").addClass("aui-button");JPT.DialogController.dialog.addButton("Submit",this.onSubmitForm,"add-project-dialog-create-button pt-submit-button");var w=JPT.DialogController.$dialogElement.find(".add-project-dialog-create-button");w.removeClass("button-panel-button").addClass("aui-button aui-button-primary");JPT.DialogController.dialog.addCancel("Cancel",function(y){JPT.DialogController.hideDialogFromNewUser("dismissed");JPT.DialogController.dialog.remove()})}},draw:function(C){function B(D){if(!D.errors){D.errors={}}return D}JPT.DialogController.dialog.gotoPage(2);var z={maxNameLength:JPT.ConfigModel.maxNameLength,maxKeyLength:JPT.ConfigModel.maxKeyLength,shouldShowLead:JPT.ConfigModel.shouldShowProjectLead,projectTemplateWebItemKey:JPT.ConfigModel.selectedTemplate||C.webItemData.itemModuleCompleteKey,projectTemplateModuleKey:C.webItemData.projectTemplateModuleCompleteKey,projectTemplateTitle:C.webItemData.name,projectTemplateDescription:C.webItemData.longDescription||C.webItemData.description,currentKey:C.currentKey||"",currentName:C.currentName||"",errors:B(C.errors),projectLeadPickerField:{id:"lead",name:"lead"},leadOptions:[{selected:true,displayName:C.currentUserDisplayName,optionName:C.currentUserName,avatarURL:C.currentUserAvatarUrl}]};var x=JIRA.Templates.ProjectTemplates.addProjectForm(z);JPT.DialogController.dialog.getPanel(2,0).html(x);if(C.webItemData.backgroundIconUrl){var w=JPT.DialogController.$dialogElement.find(".pt-content");w.css("background-image",'url("'+C.webItemData.backgroundIconUrl+'")')}var y=AJS.$("#add-project-form");JIRA.trigger(JIRA.Events.NEW_CONTENT_ADDED,[y]);this.nameElement=JPT.DialogController.$dialogElement.find("#name");this.keyElement=JPT.DialogController.$dialogElement.find("#key");this.keyEditedElement=JPT.DialogController.$dialogElement.find("#keyEdited");this.leadDisplayElement=JPT.DialogController.$dialogElement.find("#lead-field");this.leadValueElement=JPT.DialogController.$dialogElement.find("#lead");var A=this.keyElement.parent().find(".aui-icon-help");if(A.length){new AJS.InlineDialog(A,"project-key-help-popup",function(F,E,D){F.html(JIRA.Templates.ProjectTemplates.keyHelp());D()},{width:330,offsetX:-30})}this.keyElement.attr("style","text-transform: uppercase");this.nameElement.focus(_.bind(function(D){this.bindHook(D,JPT.AddProjectController.nameTimeout)},this));this.nameElement.blur(function(D){JPT.AddProjectView.unbindHook(D)});this.nameElement.focus();this.keyElement.focus(_.bind(function(E){var D=AJS.$(E.target);D.data("lastValue",D.val());this.bindHook(E,JPT.AddProjectController.keyTimeout)},this));this.keyElement.blur(_.bind(function(D){this.unbindHook(D)},this));this.keyElement.blur(function(){JPT.AddProjectController.autofillKeyIfNeeded()});if(!_.isEmpty(this.postDrawCallbacks)){_.each(this.postDrawCallbacks,function(D){D()})}},onSubmitForm:function(w){JPT.AddProjectController.submit();return false},get$SubmitButton:function(){return JPT.DialogController.$dialogElement.find(".add-project-dialog-create-button")},get$BackButton:function(){return JPT.DialogController.$dialogElement.find(".add-project-back-button")},bindHook:function j(z,x){var w=AJS.$(z.target),y;y=_.bind(function(){this.unbindHook(z);x.apply();if(w.is(":visible")){w.data("checkHook",setTimeout(y,this.TIMEOUT_MS))}},this);if(!w.data("checkHook")){w.data("checkHook",setTimeout(y,0))}},unbindHook:function(x){var w=AJS.$(x.target);clearTimeout(w.data("checkHook"));w.removeData("checkHook")},showInlineError:function(x,y){var w=x.parent().find(".error");if(!w.length){w=AJS.$("<div class='error'></div>");x.parent().append(w)}w.text(y);w.show()},showInlineErrorForName:function v(w){this.showInlineError(this.nameElement,w)},showInlineErrorForKey:function s(w){this.showInlineError(this.keyElement,w)},hideInlineError:function r(w){w.parent().find(".error").hide()},hideInlineErrorForName:function b(){this.hideInlineError(this.nameElement)},hideInlineErrorForKey:function n(){this.hideInlineError(this.keyElement)},setName:function f(w){this.nameElement.val(w)},getName:function m(){return this.nameElement.val()},setKey:function c(w){this.keyElement.val(w)},getKey:function k(){return this.keyElement.val()},getLeadDisplayName:function o(){return this.leadDisplayElement.val()},getLeadUserName:function p(){return this.leadValueElement.val()},getAvatarUrlOfSelectedLead:function l(){var w=JPT.DialogController.$dialogElement.find("#lead-single-select .aui-ss-entity-icon").css("background-image");if(!_.isUndefined(w)){var x=w.match(/^url\((.+)\)$/);return(x&&x[1])?x[1]:""}else{return""}},setKeyEdited:function i(w){this.keyEditedElement.val(w)},getKeyEdited:function t(){return this.keyEditedElement.val()},setKeyEdited:function i(){var w=this.getKey();if(this.keyElement.data("lastValue")!==w){this.keyEditedElement.val((w)?"true":"false")}this.keyElement.data("lastValue",w)},hasNameErrors:function d(){return this.nameElement.parent().find(".error").size()>0},getAddProjectForm:function e(){return AJS.$("#add-project-form")},get$FormFields:function h(){return JPT.DialogController.$dialogElement.find(":input")},enterLoadingState:function g(){$submitButton=this.get$SubmitButton();if(!$submitButton.attr("disabled")){$backButton=this.get$BackButton();$submitButton.attr("disabled","disabled");$backButton.attr("disabled","disabled");$backButton.before(JIRA.Templates.ProjectTemplates.spinner({id:"addproject-loading"}));this.get$FormFields().attr("disabled","disabled");return true}else{return false}},hideLoadingState:function q(){JPT.DialogController.$dialogElement.find("#addproject-loading").remove();this.get$SubmitButton().removeAttr("disabled");this.get$BackButton().removeAttr("disabled");this.get$FormFields().removeAttr("disabled")},avoidDirtyFormWarning:function a(){if(jQuery.fn.removeDirtyWarning){this.getAddProjectForm().removeDirtyWarning()}},hasInlineErrors:function u(){return JPT.DialogController.$dialogElement.find(".error:visible").length!=0}});JPT.AddProjectView=new JPT.AddProjectViewImpl({el:AJS.$(document),dialogView:JPT.DialogView})})();
/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/soy/AddProject.soy' */
// This file was automatically generated from AddProject.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.ProjectTemplates == 'undefined') { JIRA.Templates.ProjectTemplates = {}; }


JIRA.Templates.ProjectTemplates.addProjectForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.errors.errorMessages) {
    var errorList5 = opt_data.errors.errorMessages;
    var errorListLen5 = errorList5.length;
    for (var errorIndex5 = 0; errorIndex5 < errorListLen5; errorIndex5++) {
      var errorData5 = errorList5[errorIndex5];
      JIRA.Templates.errorMsg({closeable: false, msg: errorData5}, output);
    }
  }
  output.append('<div class="add-project-wrapper"><div class="add-project-form-wrapper">');
  var param11 = new soy.StringBuilder();
  var param13 = new soy.StringBuilder();
  JIRA.Templates.ProjectTemplates.longTextField({id: 'name', name: 'name', isRequired: false, maxLength: opt_data.maxNameLength, labelContent: "\u540d\u79f0", descriptionText: AJS.format("\u6700\u5927 {0} \u4e2a\u5b57\u7b26",opt_data.maxNameLength), value: opt_data.currentName ? opt_data.currentName : '', errorTexts: opt_data.errors.errors.projectName ? [opt_data.errors.errors.projectName] : []}, param13);
  JIRA.Templates.ProjectTemplates.textFieldWithHelpIcon({id: 'key', name: 'key', isRequired: false, maxLength: opt_data.maxKeyLength, labelContent: "\u952e\u503c", descriptionText: AJS.format("\u6700\u5927 {0} \u4e2a\u5b57\u7b26",opt_data.maxKeyLength), helpTitle: "What\x27s a project key?", value: opt_data.currentKey ? opt_data.currentKey : '', errorTexts: opt_data.errors.errors.projectKey ? [opt_data.errors.errors.projectKey] : []}, param13);
  if (opt_data.shouldShowLead) {
    JIRA.Templates.ProjectTemplates.projectLeadField({field: opt_data.projectLeadPickerField, isRequired: false, errorTexts: opt_data.errors.errors.projectLead ? [opt_data.errors.errors.projectLead] : [], options: opt_data.leadOptions}, param13);
  }
  param13.append('<input type="hidden" name="keyEdited" id="keyEdited" value="false"><input type="hidden" name="projectTemplateWebItemKey" value="', soy.$$escapeHtml(opt_data.projectTemplateWebItemKey), '"><input type="hidden" name="projectTemplateModuleKey" value="', soy.$$escapeHtml(opt_data.projectTemplateModuleKey), '"><input type="submit" class="pt-hidden-submit offscreen-left">');
  aui.form.fieldset({legendContent: '', content: param13.toString()}, param11);
  aui.form.form({content: param11.toString(), id: 'add-project-form'}, output);
  output.append('</div>', (opt_data.projectTemplateDescription) ? '<div class="add-project-description-wrapper"><div class="project-template-title"><h3>' + soy.$$escapeHtml(opt_data.projectTemplateTitle) + '</h3></div><div class="project-template-description">' + opt_data.projectTemplateDescription + '</div></div>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.keyHelp = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="project-key-help"><p><b>', soy.$$escapeHtml("\u4ec0\u4e48\u662f\u9879\u76ee\u952e\u503c?"), '</b></p><ul><li>', soy.$$escapeHtml("\u5b83\u662f\u9879\u76ee\u4e2d\u6240\u6709\u95ee\u9898\u952e\u503c\u7684\u524d\u7f00"), '</li><li>', soy.$$escapeHtml("\u4e00\u65e6\u521b\u5efa\uff0c\u5219\u65e0\u6cd5\u4fee\u6539"), '</li></ul></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.projectLeadField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var param67 = new soy.StringBuilder();
  aui.form.label({forField: opt_data.field.name + '-field', isRequired: opt_data.isRequired, content: "\u9879\u76ee\u8d1f\u8d23\u4eba"}, param67);
  JIRA.Templates.Fields.Pickers.User.single({field: opt_data.field, options: opt_data.options, editValue: opt_data.value}, param67);
  aui.form.fieldDescription({message: "\u8f93\u5165\u9879\u76ee\u8d1f\u8d23\u4eba\u7684\u7528\u6237\u540d"}, param67);
  if (opt_data.errorTexts) {
    var errorList80 = opt_data.errorTexts;
    var errorListLen80 = errorList80.length;
    for (var errorIndex80 = 0; errorIndex80 < errorListLen80; errorIndex80++) {
      var errorData80 = errorList80[errorIndex80];
      aui.form.fieldError({message: errorData80}, param67);
    }
  }
  aui.form.fieldGroup({content: param67.toString()}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.textFieldWithHelpIcon = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var param86 = new soy.StringBuilder();
  aui.form.label({forField: opt_data.name, isRequired: opt_data.isRequired, content: opt_data.labelContent}, param86);
  aui.form.input({id: opt_data.id, name: opt_data.name, type: 'text', maxLength: opt_data.maxLength, value: opt_data.value}, param86);
  param86.append('<a class="help-lnk" title="', soy.$$escapeHtml(opt_data.helpTitle), '" id="', soy.$$escapeHtml(opt_data.id), '-help-icon"><span class="aui-icon aui-icon-help">', soy.$$escapeHtml(opt_data.helpTitle), '</span></a>');
  if (opt_data.descriptionText) {
    aui.form.fieldDescription({message: opt_data.descriptionText}, param86);
  }
  if (opt_data.errorTexts) {
    var errorList110 = opt_data.errorTexts;
    var errorListLen110 = errorList110.length;
    for (var errorIndex110 = 0; errorIndex110 < errorListLen110; errorIndex110++) {
      var errorData110 = errorList110[errorIndex110];
      aui.form.fieldError({message: errorData110}, param86);
    }
  }
  aui.form.fieldGroup({content: param86.toString()}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.longTextField = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var param116 = new soy.StringBuilder();
  aui.form.label({forField: opt_data.name, isRequired: opt_data.isRequired, content: opt_data.labelContent}, param116);
  aui.form.input({id: opt_data.id, name: opt_data.name, type: 'text', maxLength: opt_data.maxLength, value: opt_data.value, extraClasses: 'long-field'}, param116);
  if (opt_data.descriptionText) {
    aui.form.fieldDescription({message: opt_data.descriptionText}, param116);
  }
  if (opt_data.errorTexts) {
    var errorList134 = opt_data.errorTexts;
    var errorListLen134 = errorList134.length;
    for (var errorIndex134 = 0; errorIndex134 < errorListLen134; errorIndex134++) {
      var errorData134 = errorList134[errorIndex134];
      aui.form.fieldError({message: errorData134}, param116);
    }
  }
  aui.form.fieldGroup({content: param116.toString()}, output);
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.spinner = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span id=\'', soy.$$escapeHtml(opt_data.id), '\' class=\'icon throbber loading\'/>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ProjectTemplates.formatAnchor = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a href="', soy.$$escapeHtml(opt_data.href), '"', (opt_data.title) ? ' title="' + soy.$$escapeHtml(opt_data.title) + '"' : '', '>', soy.$$escapeHtml(opt_data.body), '</a>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/js/ProjectKeyGenerator.js' */
JPT.ProjectKeyGenerator={};JPT.ProjectKeyGenerator.IGNORED_WORDS=["THE","A","AN","AS","AND","OF","OR"];JPT.ProjectKeyGenerator.CHARACTER_MAP={};JPT.ProjectKeyGenerator.CHARACTER_MAP[199]="C";JPT.ProjectKeyGenerator.CHARACTER_MAP[231]="c";JPT.ProjectKeyGenerator.CHARACTER_MAP[252]="u";JPT.ProjectKeyGenerator.CHARACTER_MAP[251]="u";JPT.ProjectKeyGenerator.CHARACTER_MAP[250]="u";JPT.ProjectKeyGenerator.CHARACTER_MAP[249]="u";JPT.ProjectKeyGenerator.CHARACTER_MAP[233]="e";JPT.ProjectKeyGenerator.CHARACTER_MAP[234]="e";JPT.ProjectKeyGenerator.CHARACTER_MAP[235]="e";JPT.ProjectKeyGenerator.CHARACTER_MAP[232]="e";JPT.ProjectKeyGenerator.CHARACTER_MAP[226]="a";JPT.ProjectKeyGenerator.CHARACTER_MAP[228]="a";JPT.ProjectKeyGenerator.CHARACTER_MAP[224]="a";JPT.ProjectKeyGenerator.CHARACTER_MAP[229]="a";JPT.ProjectKeyGenerator.CHARACTER_MAP[225]="a";JPT.ProjectKeyGenerator.CHARACTER_MAP[239]="i";JPT.ProjectKeyGenerator.CHARACTER_MAP[238]="i";JPT.ProjectKeyGenerator.CHARACTER_MAP[236]="i";JPT.ProjectKeyGenerator.CHARACTER_MAP[237]="i";JPT.ProjectKeyGenerator.CHARACTER_MAP[196]="A";JPT.ProjectKeyGenerator.CHARACTER_MAP[197]="A";JPT.ProjectKeyGenerator.CHARACTER_MAP[201]="E";JPT.ProjectKeyGenerator.CHARACTER_MAP[230]="ae";JPT.ProjectKeyGenerator.CHARACTER_MAP[198]="Ae";JPT.ProjectKeyGenerator.CHARACTER_MAP[244]="o";JPT.ProjectKeyGenerator.CHARACTER_MAP[246]="o";JPT.ProjectKeyGenerator.CHARACTER_MAP[242]="o";JPT.ProjectKeyGenerator.CHARACTER_MAP[243]="o";JPT.ProjectKeyGenerator.CHARACTER_MAP[220]="U";JPT.ProjectKeyGenerator.CHARACTER_MAP[255]="Y";JPT.ProjectKeyGenerator.CHARACTER_MAP[214]="O";JPT.ProjectKeyGenerator.CHARACTER_MAP[241]="n";JPT.ProjectKeyGenerator.CHARACTER_MAP[209]="N";JPT.ProjectKeyGenerator.desiredKeyLength=4;JPT.ProjectKeyGenerator.maxKeyLength=10;JPT.ProjectKeyGenerator.getTotalLength=function getTotalLength(a){return a.join("").length};JPT.ProjectKeyGenerator.removeIgnoredWords=function removeIgnoredWords(a){return _.reject(a,function(b){return AJS.$.inArray(b,JPT.ProjectKeyGenerator.IGNORED_WORDS)!==-1})};JPT.ProjectKeyGenerator.createAcronym=function createAcronym(b){var a="";AJS.$.each(b,function(c,d){a+=d.charAt(0)});return a};JPT.ProjectKeyGenerator.getFirstSyllable=function getFirstSyllable(c){var b=false;var a;for(a=0;a<c.length;a++){if(JPT.ProjectKeyGenerator.isVowelOrY(c[a])){b=true}else{if(b){return c.substring(0,a+1)}}}return c};JPT.ProjectKeyGenerator.isVowelOrY=function isVowelOrY(a){return a&&a.length===1&&a.search("[AEIOUY]")!==-1};JPT.ProjectKeyGenerator.init=function init(b,a){JPT.ProjectKeyGenerator.desiredKeyLength=b;JPT.ProjectKeyGenerator.maxKeyLength=a};JPT.ProjectKeyGenerator.generate=function generate(b){b=AJS.$.trim(b);if(!b){return""}var a=[];for(var d=0,f=b.length;d<f;d++){var e=JPT.ProjectKeyGenerator.CHARACTER_MAP[b.charCodeAt(d)];a.push(e?e:b[d])}b=a.join("");var h=[];AJS.$.each(b.split(/\s+/),function(j,k){if(k){k=k.replace(/[^a-zA-Z]/g,"");k=k.toUpperCase();k.length&&h.push(k)}});if(JPT.ProjectKeyGenerator.desiredKeyLength&&JPT.ProjectKeyGenerator.getTotalLength(h)>JPT.ProjectKeyGenerator.desiredKeyLength){h=JPT.ProjectKeyGenerator.removeIgnoredWords(h)}var c;if(h.length==0){c=""}else{if(h.length==1){var g=h[0];if(JPT.ProjectKeyGenerator.desiredKeyLength&&g.length>JPT.ProjectKeyGenerator.desiredKeyLength){c=JPT.ProjectKeyGenerator.getFirstSyllable(g)}else{c=g}}else{c=JPT.ProjectKeyGenerator.createAcronym(h)}}if(JPT.ProjectKeyGenerator.maxKeyLength&&c.length>JPT.ProjectKeyGenerator.maxKeyLength){c=c.substr(0,JPT.ProjectKeyGenerator.maxKeyLength)}return c};
/* module-key = 'com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources', location = '/js/RemoteProjectsCreatedMessage.js' */
AJS.$(function(){var b=localStorage.getItem(JPT.AddProjectController.localStoragePrefix+"confluenceProject");var h=localStorage.getItem(JPT.AddProjectController.localStoragePrefix+"fisheyeProject");var f=localStorage.getItem(JPT.AddProjectController.localStoragePrefix+"crucibleProject");var d=localStorage.getItem(JPT.AddProjectController.localStoragePrefix+"bambooProject");localStorage.removeItem(JPT.AddProjectController.localStoragePrefix+"confluenceProject");localStorage.removeItem(JPT.AddProjectController.localStoragePrefix+"fisheyeProject");localStorage.removeItem(JPT.AddProjectController.localStoragePrefix+"crucibleProject");localStorage.removeItem(JPT.AddProjectController.localStoragePrefix+"bambooProject");var i;function c(k,j){return JIRA.Templates.ProjectTemplates.formatAnchor({href:k,body:j,title:j})}function a(l,m,k,n){var j=[];j.push("a JIRA project");if(l){j.push(c(l,"a Confluence space"))}if(m){j.push(c(m,"a FishEye repository"))}if(k){j.push(c(k,"a Crucible project"))}if(n){j.push(c(n,"a Bamboo project"))}return j}function g(k,m,j,p){var o="The following entities were created: {0} and {1}.";var l=a(k,m,j,p);var n=l.pop();return(l.length>0)?AJS.format(o,l.join(", "),n):null}function e(j){var k=AJS.$(j).offset();if(k){window.scrollTo(k.left,k.top)}}if(b||h||f||d){i=g(b,h,f,d);if(i){JIRA.Messages.showSuccessMsg(i,{closeable:true})}e("#project-config-webpanel-summary-settings")}});
/* module-key = 'com.atlassian.labs.remoteapps-plugin:big-pipe', location = 'js/bigpipe/big-pipe.js' */
// This code makes a xhr request back to the server before dom ready looking for big pipe content to replace.
(function (global, AJS) {
  var $ = AJS.$;
  var AP = global._AP = global._AP || {};
  var contextPath = AJS.contextPath() || AJS.Meta.get("context-path");
  var counter = 0;

  function insertContent(contentId, html) {
    var contentDiv$ = $('#' + contentId);
    if (contentDiv$.length == 0) {
      if (html) {
        $("body").append(html);
      }
    } else {
      contentDiv$.html(html).removeClass("bp-loading");
    }
  }

  function replaceLoadingWithMessage() {
    $(function() {
      $('.bp-loading').html("<img src='" + contextPath + "/download/resources/com.atlassian.labs.remoteapps-plugin:images/images/ajax-loader.gif' alt='loader'>");
    });
  }

  function replaceLoadingWithError(errType, status) {
    $(function() {
      $('.bp-loading').html("<div>Error: " + status + "</div>").removeClass("bp-loading");
    });
  }

  function processContents(contents) {
    if (contents.items && contents.items.length > 0) {
      $.each(contents.items, function () {
        if (this.channelId === "html" && this.content) {
          insertContent(this.contentId, this.content);
        }
      });
    }
  }

  function poll(requestId) {
    $.ajax({
      url: contextPath + "/bigpipe/request/" + requestId + "/" + (counter += 1),
      dataType: "json",
      timeout: 30000,
      success: function (response) {
        if (response.items && response.items.length !== 0) {
          poll(requestId);
          $(function() { processContents(response); });
        }
      },
      error: function(xhr, status, err) {
        replaceLoadingWithError(err, status);
      }
    });
  }

  var isStarted;
  AP.BigPipe = {
    start: function (options) {
      if (!isStarted) {
        isStarted = true;
        if (options.ready) processContents(options.ready);
        if (!options.ready || options.ready.pending.length > 0) {
          poll(options.requestId);
          setTimeout(replaceLoadingWithMessage, 1000);
        }
      }
    }
  };

})(this, AJS);

/* module-key = 'com.atlassian.labs.remoteapps-plugin:remote-condition', location = 'js/condition/remote-condition.js' */
/*
  Hides UI elements that are protected by remote conditions.  These are all hacks hiding is supported
  by the module types directly
 */
(function ($, global) {
  var AP = global._AP = global._AP || {},
      hidden;

  function hide() {
    if (!hidden) {
      hidden = true;
      // Connect any Remotable Plugin hosted Web Items to a dialog that loads the appropriate IFrame Servlet,
      // look for jira issue tabs, and look for jira project tabs
      $(".remote-condition, #issue-tabs a[id$='-remote-condition'], .tabs a[id$='-remote-condition-panel']").each(function (i, el) {
        var el$ = $(el), parent$ = el$.parent();
        el$.addClass("hidden");
        if (parent$[0].tagName == "LI") {
          parent$.addClass("hidden");
        }
      });
    }
  }

  AJS.toInit(hide);

  AP.RemoteConditions = {
    hide: hide
  };
}(AJS.$, this));

/* module-key = 'com.atlassian.labs.remoteapps-plugin:dialog', location = 'js/dialog/dialog.js' */
(function(global, AJS, $) {

  var AP = global._AP = global._AP || {};

  var enc = encodeURIComponent;

  var $global = $(global);

  var idSeq = 0;

  /**
   * Constructs a new AUI dialog wrapper for a Remotable Plugin. The dialog has a single content panel containing a single
   * iframe. The iframe's content is retrieved from the Remotable Plugin via a redirect URl from the host Atlassian app,
   * which the request to the Remotable Plugin to be signed with outgoing OAuth credentials.
   *
   * @param contentUrl The URL (relative to the Atlassian app root) that will retrieve the content to display,
   *           eg. "/plugins/servlet/remotable-plugins/app-key/macro".
   * @param options Options to configure the behaviour and appearance of the dialog.
   */
  AP.makeDialog = function (contentUrl, options) {
    var $nexus;

    var defaultOptions = {
      // These options really _should_ be provided by the caller, or else the dialog is pretty pointless

      // Dialog header
      header: "Remotable Plugins Dialog Title",

      // These options may be overridden by the caller, but the defaults are OK
      headerClass: "ap-dialog-header",
      // Default width and height of the dialog
      width: "50%",
      height: "50%"
    };

    var dialogId = options.id || "ap-dialog-" + (idSeq += 1);
    var mergedOptions = $.extend({id: dialogId}, defaultOptions, options);
    mergedOptions.width = parseDimension(mergedOptions.width, $global.width());
    mergedOptions.height = parseDimension(mergedOptions.height, $global.height());

    var dialog = new AJS.Dialog(mergedOptions.width, mergedOptions.height, mergedOptions.id);
    dialog.addHeader(mergedOptions.header, mergedOptions.headerClass);

    var hasClosed = false;
    function closeDialog() {
      if (hasClosed) return;
      $nexus
        .trigger("ra.iframe.destroy")
        .removeData("ra.dialog.buttons")
        .unbind();
      dialog.remove();
      hasClosed = true;
    }

    // the dialog automatically closes on ESC. but we also want to do our clean up
    $(document).keydown(function(e){ if (e.keyCode === 27) { closeDialog(); }});

    var placeholderContent = "<div class='ap-servlet-placeholder'></div>";
    dialog.addPanel(null, placeholderContent, "ap-dialog-content");
    var $dialog = $("#" + dialogId);
    $nexus = $dialog.find(".ap-servlet-placeholder");

    return {
      id: dialogId,
      show: function() {
        dialog.show();

        var $panelBody = $dialog.find(".ap-dialog-content");
        contentUrl += (contentUrl.indexOf("?") > 0 ? "&" : "?") + "dialog=1";
        contentUrl = setDimension(contentUrl, "width", $panelBody.width());
        contentUrl = setDimension(contentUrl, "height", $panelBody.height());

        var timeout = setTimeout(function () {
          $nexus
            .append("<div class='ap-dialog-loading hidden'>&nbsp;</div>")
            .find(".ap-dialog-loading").height($panelBody.height()).fadeIn();
        }, 500);

        function preventTimeout() {
          if (timeout) {
            clearTimeout(timeout);
            timeout = null;
          }
        }

        function enableButtons() {
          buttons.setEnabled(true);
        }

        var buttons = makeButtons(dialog, [{
          name: "submit",
          displayName: "Submit",
          type: "Button",
          actions: {
            done: closeDialog
          }
        }, {
          name: "cancel",
          displayName: "Cancel",
          type: "Link",
          actions: {
            done: closeDialog,
            fail: enableButtons
          },
          noDisable: true
        }]);

        var iframeCreated = false;
        buttons.getButton("cancel").click(function () {
          if (!iframeCreated) {
            // default cancel handler should only run before the iframe is created and takes over
            closeDialog();
          }
        });

        $nexus
          .data("ra.dialog.buttons", buttons)
          .bind("ra.dialog.close", closeDialog)
          .bind("ra.iframe.create", function () { iframeCreated = true; })
          .bind("ra.iframe.init", enableButtons);
        // @todo should we instead start with all but cancel set to hidden, showing when iframe is inited?
        buttons.setEnabled(false);

        $.ajax(contentUrl, {
          dataType: "html",
          success: function(data) {
            preventTimeout();
            $nexus.html(data);
          },
          error: function(xhr, status, ex) {
            preventTimeout();
            var title = "Unable to load plugin content.  Please try again later.";
            $nexus.html("<div class='aui-message error' style='margin: 10px'></div>");
            $nexus.find(".error").append("<p class='title'>" + title + "</p>");
            var msg = status + (ex ? ": " + ex.toString() : "");
            $nexus.find(".error").append(msg);
            AJS.log(msg);
          }
        });
      }
    };
  };

  function makeButtons(dialog, specs) {
    var buttons = {},
        controls;
    $.each(specs, function () {
      var $dialog = $(dialog.popup.element),
          spec = this,
          className = "ap-dialog-" + spec.name,
          disabledAttr = "disabled",
          disabledClass = "ap-link-disabled",
          isEnabled = true;
      function dispatch(result) {
        var name = result ? "done" : "fail";
        spec.actions && spec.actions[name] && spec.actions[name]();
      }
      function handler() {
        // ignore clicks on disabled links
        if (buttons[spec.name].$el().hasClass(disabledClass)) return;
        $dialog.find("." + className).trigger("ra.dialog.click", dispatch);
      }
      dialog["add" + spec.type](spec.displayName, handler, className);
      buttons[spec.name] = {
        $el: function () { return $dialog.find("." + className); },
        isEnabled: function () { return isEnabled; },
        setEnabled: function (enabled) {
          if (!spec.noDisable) {
            var $button = this.$el();
            if (enabled) {
              if (spec.type === "Button") {
                $button.removeAttr(disabledAttr);
              }
              else {
                $button.addClass(disabledClass);
              }
            }
            else {
              if (spec.type === "Button") {
                $button.attr(disabledAttr, true);
              }
              else {
                $button.removeClass(disabledClass);
              }
            }
          }
        },
        click: function (listener) {
          if (listener) {
            this.$el().bind("ra.dialog.click", listener);
          }
          else {
            dispatch(true);
          }
        }
      };
    });
    controls = {
      each: function (it) {
        $.each(buttons, it);
      },
      setEnabled: function (enabled) {
        this.each(function () {
          this.setEnabled(enabled);
        });
      },
      getButton: function (name) {
        return buttons[name];
      }
    };
    return controls;
  }

  function parseDimension(value, viewport) {
    if (typeof value === "string") {
      var percent = value.indexOf("%") === value.length - 1;
      value = parseInt(value, 10);
      if (percent) value = value / 100 * viewport;
    }
    return value;
  }

  function setDimension(url, name, value) {
    name = enc(name);
    if (url.indexOf(name + "=")) {
      url = url.replace(new RegExp(name + "=[^&]+"), function () {
        return name + "=" + enc(value);
      });
    }
    else {
      url += "&" + name + "=" + enc(value);
    }
    return url;
  }

})(this, AJS, AJS.$);

/* module-key = 'com.atlassian.labs.remoteapps-plugin:dialog-page-resource', location = '/js/dialog/binder.js' */
AJS.toInit(function ($) {

  var AP = _AP;

  function createEventHandler() {
    return function(event) {
      event.preventDefault();
      var $el = $(event.target);
      var href = $el.attr("href");
      var options = {header: $el.text()};
      var re = /[?&](width|height)=([^&]+)/g, match;
      while (match = re.exec(href)) {
        options[match[1]] = decodeURIComponent(match[2]);
      }
      AP.makeDialog(href, options).show();
    };
  }
  // jquery 1.7 or later
  if ($().on) {
    // Connect any web items to the dialog.  Necessary to bind to dynamic action cogs in JIRA
    $(window.document).on("click", ".ap-dialog", createEventHandler());
  } else {
    // Bind to all static links
    var $dialogWebItems = $(".ap-dialog");
    $dialogWebItems.each(function (index, el) {
      var $el = $(el);
      $el.click(createEventHandler());
    });
  }

});

/* module-key = 'jira.webresources:jira-analytics', location = '/includes/jira/analytics/analytics.js' */
AJS.toInit(function($){function getBrowseProjectTab(){return $("li.active a.browse-tab").attr("id")}if(AJS.EventQueue){$(document).delegate("#project-admin-link","click",function(){var selectedTab=getBrowseProjectTab();AJS.EventQueue.push({name:"browseproject.administerproject",properties:{selectedtab:selectedTab}})});$(document).delegate("#browse-projects-create-project","click",function(){AJS.EventQueue.push({name:"browseprojects.createproject",properties:{}})});$(document).delegate("#no-issues-create-issue","click",function(){AJS.EventQueue.push({name:"browseproject.issuesblankslate.createissue",properties:{}})});$(document).delegate("a.issue-filter-link","click",function(){var $el=$(this);var id=$el.attr("id").replace("filter_","");var type=$el.attr("data-type");AJS.EventQueue.push({name:"browse"+type+".issuefilter."+id,properties:{}})});$(document).on("click","#project_import_link_lnk",function(){AJS.EventQueue.push({name:"topnav.jim",properties:{}})});$.fn.ready(function captureWindowSize(){var width,height,shouldCapture=false;shouldCapture=shouldCapture||$(document.body).hasClass("page-type-navigator");if(!shouldCapture){return }width=$(window).width();height=$(window).height();AJS.EventQueue.push({name:"browserWindowSize",properties:{width:width,height:height}})})}});
/* module-key = 'jira.webresources:avatar-picker', location = '/includes/jquery/plugins/avataror/avataror.js' */
jQuery.fn.avataror=function(options){var $=jQuery,$document=$(document);this.each(function(){var $this=$(this);var imgsrc=$this.find("img").attr("src");$this.css({"-moz-border-radius":"10px","-webkit-border-radius":"10px"});$this.html("<p>Loading?</p>");var avataror={previewSize:48};avataror.preview=$("<div/>").addClass("avataror-preview").css({border:"solid 1px #000","float":"left",height:avataror.previewSize+"px",overflow:"hidden",width:avataror.previewSize+"px",position:"relative",top:"-9999em",left:"-9999em"});avataror.preview.prependTo(options.previewElement);avataror.img=$('<img src="'+imgsrc+'" alt="Avatar Source"/>');avataror.img.load(function(){avataror.image=$("<div/>").css({background:"url('"+imgsrc+"') no-repeat",clear:"left",position:"relative"});avataror.marker=$("<div/>").css({cursor:"move",position:"relative"});avataror.dash=$("<div/>");avataror.shadow=$("<div/>");avataror.dash.add(avataror.shadow).css({cursor:"move",opacity:0.5,left:0,top:0,position:"absolute"});avataror.image.append(avataror.shadow).append(avataror.dash).append(avataror.marker);$this.append(avataror.image);avataror.marker.html("<div></div><div></div><div></div><div></div>");$("div",avataror.marker).each(function(i){var $this=$(this);$this.css({background:"#000",border:"solid 1px #fff",width:"10px",height:"10px",position:"absolute","font-size":"1px"});$this.css(["left","right","right","left"][i],"-6px");$this.css(["top","top","bottom","bottom"][i],"-6px");$this.css("cursor",["nw-resize","ne-resize","se-resize","sw-resize"][i]);$this.mousedown(function(e){e.preventDefault();e.stopPropagation();avataror.dragging={x:e.pageX,y:e.pageY,ax:avataror.x,ay:avataror.y,w:avataror.width,h:avataror.height,i:i+1};avataror.shadow.hide()})});avataror.marker.add(avataror.image).mousedown(function(e){e.preventDefault();avataror.dragging={x:e.pageX,y:e.pageY,ax:avataror.x,ay:avataror.y,w:avataror.width,h:avataror.height};avataror.shadow.hide()});$document.mouseup(function(e){avataror.handleMouseUp(e)});$document.mousemove(function(e){if(avataror.dragging){avataror.handleMouseMove(e.pageX,e.pageY);e.preventDefault()}});avataror.imgwidth=avataror.img.width();avataror.imgheight=avataror.img.height();avataror.x=parseInt($("#avatar-offsetX").val());avataror.y=parseInt($("#avatar-offsetY").val());avataror.width=parseInt($("#avatar-width").val());avataror.height=avataror.width;avataror.image.css({width:avataror.imgwidth+"px",height:avataror.imgheight+"px"});avataror.setMarker();$this.css({width:avataror.imgwidth+"px"});avataror.preview.css({position:"static"});$("p",$this).remove();$this.trigger("AvatarImageLoaded")});avataror.preview.append(avataror.img);avataror.setMarker=function(){avataror.marker.css("border","dashed 1px #fff");avataror.dash.css("border","solid 1px #000");avataror.shadow.css("border","solid 1px #000");avataror.marker.add(this.dash).css("left",this.x-1+"px");avataror.marker.add(avataror.dash).css("top",avataror.y-1+"px");avataror.shadow.css("border-left-width",avataror.x+"px");avataror.shadow.css("border-right-width",avataror.imgwidth-avataror.x-avataror.width+"px");avataror.shadow.css("border-top-width",avataror.y+"px");avataror.shadow.css("border-bottom-width",avataror.imgheight-avataror.y-avataror.height+"px");avataror.shadow.css("width",avataror.width+"px");avataror.shadow.css("height",avataror.height+"px");avataror.marker.add(avataror.dash).css("width",avataror.width+"px");avataror.marker.add(avataror.dash).css("height",avataror.height+"px")};avataror.adjustPreview=function(){avataror.img.attr("width",avataror.imgwidth*avataror.previewSize/avataror.width);avataror.img.attr("height",avataror.imgheight*avataror.previewSize/avataror.height);avataror.img.css("margin-left","-"+avataror.x*avataror.previewSize/avataror.width+"px");avataror.img.css("margin-top","-"+avataror.y*avataror.previewSize/avataror.height+"px");avataror.preview.select()};avataror.handleMouseMove=function(newX,newY){avataror.dragging.nextExec=avataror.dragging.nextExec||0;if(avataror.dragging.nextExec==0){avataror.dragging.nextExec=3}else{avataror.dragging.nextExec--;return }var dx=newX-avataror.dragging.x;var dy=newY-avataror.dragging.y;if(this.dragging.i){var handler=avataror.resizeHandlers[this.dragging.i-1];handler(dx,dy)}else{avataror.x=avataror.dragging.ax+dx;avataror.y=avataror.dragging.ay+dy;if(avataror.x+avataror.width>avataror.imgwidth){avataror.x=avataror.imgwidth-avataror.width}if(avataror.y+avataror.height>avataror.imgheight){avataror.y=avataror.imgheight-avataror.height}if(avataror.x<0){avataror.x=0}if(avataror.y<0){avataror.y=0}}avataror.setMarker();avataror.adjustPreview()};avataror.handleMouseUp=function(e){$("#avatar-offsetX").val(avataror.x);$("#avatar-offsetY").val(avataror.y);$("#avatar-width").val(avataror.width);avataror.dragging=null;avataror.shadow.show()};avataror.originX=function(){return avataror.dragging.ax};avataror.originY=function(){return avataror.dragging.ay};avataror.originBottomX=function(){return avataror.dragging.ax+avataror.dragging.w};avataror.originBottomY=function(){return avataror.dragging.ay+avataror.dragging.h};avataror.originNw=function(){return{x:avataror.originX(),y:avataror.originY()}};avataror.originNe=function(){return{x:avataror.originBottomX(),y:avataror.originY()}};avataror.originSe=function(){return{x:avataror.originBottomX(),y:avataror.originBottomY()}};avataror.originSw=function(){return{x:avataror.originX(),y:avataror.originBottomY()}};avataror.nwHandler=function(dx,dy){var anchor=avataror.originSe();var tmpBase={x:avataror.originX()+dx,y:avataror.originY()+dy};var diffX=Math.abs(tmpBase.x-anchor.x),diffY=Math.abs(tmpBase.y-anchor.y);var newSize=Math.min(diffX,diffY);if(newSize<20){newSize=20}if(anchor.x-newSize<0){newSize=anchor.x}if(anchor.y-newSize<0){newSize=anchor.y}avataror.x=anchor.x-newSize;avataror.y=anchor.y-newSize;avataror.width=avataror.height=newSize};avataror.neHandler=function(dx,dy){var anchor=avataror.originSw();var tmpBase={x:avataror.originBottomX()+dx,y:avataror.originY()+dy};var diffX=Math.abs(tmpBase.x-anchor.x),diffY=Math.abs(tmpBase.y-anchor.y);var newSize=Math.min(diffX,diffY);if(newSize<20){newSize=20}if(anchor.x+newSize>avataror.imgwidth){newSize=avataror.imgwidth-anchor.x}if(anchor.y-newSize<0){newSize=anchor.y}avataror.y=anchor.y-newSize;avataror.width=avataror.height=newSize};avataror.seHandler=function(dx,dy){var anchor=avataror.originNw();var tmpBase={x:avataror.originBottomX()+dx,y:avataror.originBottomY()+dy};var diffX=Math.abs(tmpBase.x-anchor.x),diffY=Math.abs(tmpBase.y-anchor.y);var newSize=Math.min(diffX,diffY);if(newSize<20){newSize=20}if(anchor.x+newSize>avataror.imgwidth){newSize=avataror.imgwidth-anchor.x}if(anchor.y+newSize>avataror.imgheight){newSize=avataror.imgheight-anchor.y}avataror.width=avataror.height=newSize};avataror.swHandler=function(dx,dy){var anchor=avataror.originNe();var tmpBase={x:avataror.originX()+dx,y:avataror.originBottomY()+dy};var diffX=Math.abs(tmpBase.x-anchor.x),diffY=Math.abs(tmpBase.y-anchor.y);var newSize=Math.min(diffX,diffY);if(newSize<20){newSize=20}if(anchor.x-newSize<0){newSize=anchor.x}if(anchor.y+newSize>avataror.imgheight){newSize=avataror.imgheight-anchor.y}avataror.x=anchor.x-newSize;avataror.width=avataror.height=newSize};avataror.resizeHandlers=[avataror.nwHandler,avataror.neHandler,avataror.seHandler,avataror.swHandler]})};
/* module-key = 'jira.webresources:avatar-picker', location = '/includes/ajs/avatarpicker/Avatar.js' */
JIRA.Avatar=Class.extend({init:function(options){this._id=options.id;this._isSystemAvatar=options.isSystemAvatar;this._isSelected=options.isSelected},setUnSelected:function(){this._isSelected=false},setSelected:function(){this._isSelected=true},isSelected:function(){return !!this._isSelected},isSystemAvatar:function(){return this._isSystemAvatar},getId:function(){return this._id},toJSON:function(){return{id:this._id,isSystemAvatar:this._isSystemAvatar,isSelected:this._isSelected}}});JIRA.Avatar.createCustomAvatar=function(descriptor){descriptor.isSystemAvatar=false;return new JIRA.Avatar(descriptor)};JIRA.Avatar.createSystemAvatar=function(descriptor){descriptor.isSystemAvatar=true;return new JIRA.Avatar(descriptor)};JIRA.Avatar.LARGE={param:"large",height:48,width:48};JIRA.Avatar.MEDIUM={param:"medium",width:32,height:32};JIRA.Avatar.SMALL={param:"small",width:16,height:16};
/* module-key = 'jira.webresources:avatar-picker', location = '/includes/ajs/avatarpicker/AvatarManager.js' */
JIRA.AvatarManager=Class.extend({init:function(options){this.store=options.store;this.ownerId=options.ownerId;this.username=options.username;this.anonymousAvatarId=options.anonymousAvatarId;this.avatarSrcBaseUrl=options.avatarSrcBaseUrl},selectAvatar:function(avatar,options){return this.store.selectAvatar(avatar,options)},getById:function(id){return this.store.getById(id)},destroy:function(avatar,options){this.store.destroy(avatar,options)},update:function(avatar,options){this.store.update(avatar,options)},add:function(avatar,options){this.store._add(avatar,options)},getAllSystemAvatars:function(){return this.store.getAllSystemAvatars()},getAllCustomAvatars:function(){return this.store.getAllCustomAvatars()},getSelectedAvatar:function(){return this.store.getSelectedAvatar()},getAllAvatars:function(){return this.store.getAllAvatars()},getAllAvatarsRenderData:function(size){var i,instance=this,avatars=this.getAllAvatars(),renderData={system:[],custom:[]};for(i=0;i<avatars.system.length;i++){renderData.system.push(instance.getAvatarRenderData(avatars.system[i],size))}for(i=0;i<avatars.custom.length;i++){renderData.custom.push(instance.getAvatarRenderData(avatars.custom[i],size))}return renderData},getAvatarRenderData:function(avatar,size){var data=avatar.toJSON();data.src=this.getAvatarSrc(avatar,size);data.width=size.width;data.height=size.height;return data},refreshStore:function(options){this.store.refresh(options)},getAvatarSrc:function(avatar,size){if(this.store.isTempAvatar(avatar)){return contextPath+"/secure/temporaryavatar?"+jQuery.param({cropped:true,magic:new Date().getTime(),size:size.param})}var params={avatarId:avatar.getId(),size:size.param};if(this.username){params["username"]=this.username}else{params["ownerId"]=this.ownerId}return this.avatarSrcBaseUrl+"?"+jQuery.param(params)},createTemporaryAvatar:function(field,options){this.store.createTemporaryAvatar(field,options)},createAvatarFromTemporary:function(instructions,options){this.store.createAvatarFromTemporary(instructions,options)},getAnonymousAvatarId:function(){return this.anonymousAvatarId}});JIRA.AvatarManager.createProjectAvatarManager=function(options){var restQueryUrl,restUpdateUrl="",restCreateTempUrl="",restUpdateTempUrl="",restSingleAvatarUrl="";if(options.projectKey){restQueryUrl=contextPath+"/rest/api/latest/project/"+options.projectKey+"/avatars";restUpdateUrl=contextPath+"/rest/api/latest/project/"+options.projectKey+"/avatar";restCreateTempUrl=contextPath+"/rest/api/latest/project/"+options.projectKey+"/avatar/temporary";restUpdateTempUrl=restUpdateUrl;restSingleAvatarUrl=restUpdateUrl}else{restQueryUrl=contextPath+"/rest/api/latest/avatar/project/system";restCreateTempUrl=contextPath+"/rest/api/latest/avatar/project/temporary";restUpdateTempUrl=contextPath+"/rest/api/latest/avatar/project/temporaryCrop"}var store=new JIRA.AvatarStore({restQueryUrl:restQueryUrl,restUpdateUrl:restUpdateUrl,restCreateTempUrl:restCreateTempUrl,restUpdateTempUrl:restUpdateTempUrl,restSingleAvatarUrl:restSingleAvatarUrl,defaultAvatarId:options.defaultAvatarId});return new JIRA.AvatarManager({store:store,ownerId:options.projectId,avatarSrcBaseUrl:contextPath+"/secure/projectavatar"})};JIRA.AvatarManager.createUserAvatarManager=function(options){var userRestUrl=contextPath+"/rest/api/latest/user";var store=new JIRA.AvatarStore({restQueryUrl:userRestUrl+"/avatars",restUpdateUrl:userRestUrl+"/avatar",restCreateTempUrl:userRestUrl+"/avatar/temporary",restUpdateTempUrl:userRestUrl+"/avatar",restSingleAvatarUrl:userRestUrl+"/avatar",restParams:{"username":options.username},defaultAvatarId:options.defaultAvatarId});return new JIRA.AvatarManager({store:store,username:options.username,avatarSrcBaseUrl:contextPath+"/secure/useravatar"})};
/* module-key = 'jira.webresources:avatar-picker', location = '/includes/ajs/avatarpicker/AvatarStore.js' */
JIRA.AvatarStore=Class.extend({TEMP_ID:"TEMP",init:function(options){if(!options.restQueryUrl){throw new Error("JIRA.AvatarStore.init: You must specify [restQueryUrl], The rest url for querying avatars (see class description)")}if(!options.restCreateTempUrl){throw new Error("JIRA.AvatarStore.init: You must specify [restCreateTempUrl], The rest url for creating a temporary avatar (see class description)")}if(!options.restUpdateTempUrl){throw new Error("JIRA.AvatarStore.init: You must specify [restUpdateTempUrl], The rest url for updating a temporary avatar (see class description)")}if(!options.defaultAvatarId){throw new Error("JIRA.AvatarStore.init: You must specify [defaultAvatarId] to the contructor so the store "+"knows what to select if you delete the selected one")}this.restQueryUrl=options.restQueryUrl;this.restUpdateUrl=options.restUpdateUrl;this.restCreateTempUrl=options.restCreateTempUrl;this.restUpdateTempUrl=options.restUpdateTempUrl;this.restSingleAvatarUrl=options.restSingleAvatarUrl;this.restParams=options.restParams;this.defaultAvatarId=options.defaultAvatarId;this.avatars={system:[],custom:[]}},_buildCompleteUrl:function(url){var completeUrl=url;if(this.restParams){var queryParams="";for(var name in this.restParams){queryParams+=AJS.format("&{0}={1}",encodeURIComponent(name),encodeURIComponent(this.restParams[name]))}completeUrl+=("?"+queryParams.substr(1))}return completeUrl},getById:function(avatarId){var match;jQuery.each(this.avatars.system,function(i,avatar){if(this.getId()===avatarId){match=avatar;return false}});if(!match){jQuery.each(this.avatars.custom,function(i,avatar){if(this.getId()===avatarId){match=avatar;return false}})}return match},isTempAvatar:function(avatar){return(avatar.getId()===this.TEMP_ID)},_selectAvatar:function(avatar){var selected=this.getSelectedAvatar();if(selected){selected.setUnSelected()}avatar.setSelected()},selectAvatar:function(avatar,options){var instance=this;if(!avatar){throw new Error("JIRA.AvatarStore.selectAvatar: Cannot select Avatar that does not exist")}if(this.restUpdateUrl){JIRA.SmartAjax.makeRequest({type:"PUT",contentType:"application/json",dataType:"json",url:this._buildCompleteUrl(this.restUpdateUrl),data:JSON.stringify(avatar.toJSON()),success:function(){instance._selectAvatar(avatar);if(options.success){options.success.call(this,avatar)}},error:options.error})}else{instance._selectAvatar(avatar);if(options.success){options.success.call(this,avatar)}}},_destory:function(avatar){var index=jQuery.inArray(avatar,this.avatars.custom);if(index!==-1){this.avatars.custom.splice(index,1)}else{throw new Error("JIRA.AvatarStore._destroy: Cannot remove avatar ["+avatar.getId()+"], "+"it might be a system avatar (readonly) or does not exist.")}},destroy:function(avatar,options){var instance=this;options=options||{};if(!avatar){throw new Error("JIRA.AvatarStore.destroy: Cannot delete Avatar that does not exist")}JIRA.SmartAjax.makeRequest({type:"DELETE",url:this.getRestUrlForAvatar(avatar),success:function(){instance._destory(avatar);if(avatar.isSelected()){instance.selectAvatar(instance.getById(instance.defaultAvatarId),options)}else{if(options.success){options.success.apply(this,arguments)}}},error:options.error})},getSelectedAvatar:function(){for(var i=0;i<this.avatars.custom.length;i++){if(this.avatars.custom[i].isSelected()){return this.avatars.custom[i]}}for(i=0;i<this.avatars.system.length;i++){if(this.avatars.system[i].isSelected()){return this.avatars.system[i]}}},_update:function(avatar){var instance=this;if(this.getById(avatar.getId())){jQuery.each(this.avatars.custom,function(i){if(this.getId()===avatar.getId()){instance.avatars.custom[i]=avatar}})}else{throw new Error("JIRA.AvatarStore._update: Cannot update avatar ["+avatar.getId()+"], "+"it might be a system avatar (readonly) or does not exist.")}},update:function(avatar,options){var instance=this;options=options||{};JIRA.SmartAjax.makeRequest({type:"PUT",url:this.getRestUrlForAvatar(avatar),error:options.error,success:function(){instance._update(avatar);if(options.success){options.success.apply(this,arguments)}}})},_add:function(avatar){if(avatar.isSystemAvatar()){this.avatars.system.push(avatar)}else{this.avatars.custom.push(avatar)}},createAvatarFromTemporary:function(instructions,options){var instance=this;options=options||{};if(this.restUpdateTempUrl){JIRA.SmartAjax.makeRequest({type:"POST",url:this._buildCompleteUrl(this.restUpdateTempUrl),data:JSON.stringify(instructions),contentType:"application/json",dataType:"json",success:function(data){if(!data){data={id:instance.TEMP_ID,isSelected:true}}var avatar=JIRA.Avatar.createCustomAvatar(data);instance._add(avatar);if(options.success){options.success.call(this,data)}},error:options.error})}},createTemporaryAvatar:function(fileInput,options){options=AJS.$.extend(true,{},options,{params:this.restParams});JIRA.AvatarUtil.uploadTemporaryAvatar(this.restCreateTempUrl,fileInput,options)},_refresh:function(avatars){var instance=this;instance.avatars.system=[];instance.avatars.custom=[];if(avatars.system){jQuery.each(avatars.system,function(i,descriptor){instance.avatars.system.push(JIRA.Avatar.createSystemAvatar(descriptor))})}if(avatars.custom){jQuery.each(avatars.custom,function(i,descriptor){instance.avatars.custom.push(JIRA.Avatar.createCustomAvatar(descriptor))})}},refresh:function(options){var instance=this;var tempAvatar=this.getById(instance.TEMP_ID);options=options||{};JIRA.SmartAjax.makeRequest({url:this._buildCompleteUrl(this.restQueryUrl),error:options.error,success:function(avatars){instance._refresh(avatars);if(tempAvatar){instance._add(tempAvatar)}if(options.success){options.success.apply(this,arguments)}}})},getAllAvatars:function(){return this.avatars},getAllSystemAvatars:function(){return this.avatars.system},getAllCustomAvatars:function(){return this.avatars.custom},getRestUrlForAvatar:function(avatar){return this._buildCompleteUrl(this.restSingleAvatarUrl+"/"+avatar.getId())}});
/* module-key = 'jira.webresources:avatar-picker', location = '/includes/ajs/avatarpicker/AvatarUtil.js' */
JIRA.AvatarUtil={uploadUsingIframeRemoting:function(url,field,options){options=options||{};var fileName=field.val(),form=new AJS.InlineAttach.Form(new AJS.InlineAttach.FileInput(field,false)),progress=form.addStaticProgress(fileName);var $oldInput=form.cloneFileInput();form.fileSelector.clear();var timer=new AJS.InlineAttach.Timer(function(){!this.cancelled&&progress.show()},this);var upload=new AJS.InlineAttach.FormUpload({$input:$oldInput,url:url,params:AJS.$.extend({},options.params,{filename:fileName,atl_token:atl_token()}),scope:this,before:function(){!this.cancelled&&progress.start()},success:function(val,status){if(val.errorMessages&&val.errorMessages.length){form.addErrorWithFileName(val.errorMessages[0],fileName,JIRA.AvatarUtil.getErrorTarget(form))}else{if(options.success){options.success(val,status)}}},error:function(text){console.log(text);if(this.cancelled){return }if(text.indexOf("SecurityTokenMissing")>=0){form.addError(AJS.InlineAttach.Text.tr("upload.xsrf.timeout",fileName),JIRA.AvatarUtil.getErrorTarget(form))}else{form.addError(AJS.InlineAttach.Text.tr("upload.error.unknown",fileName),JIRA.AvatarUtil.getErrorTarget(form))}},after:function(){timer.cancel();progress.remove();if(!this.cancelled){form.enable()}}});progress.onCancel(function(){upload.abort()});upload.upload()},uploadUsingFileApi:function(url,field,options){var timer,upload,cancelled,file=field[0].files[0],form=new AJS.InlineAttach.Form(new AJS.InlineAttach.FileInput(field,false)),progress=form.addProgress(file);options=options||{};timer=new AJS.InlineAttach.Timer(function(){if(!cancelled){progress.show()}});upload=new AJS.InlineAttach.AjaxUpload({file:file,params:AJS.$.extend({},options.params,{filename:file.name,size:file.size,atl_token:atl_token()}),scope:this,url:url,before:function(){field.hide();!cancelled&&progress.start()},progress:function(val){progress.progress.$progress.parent().parent().show();!cancelled&&progress.update(val)},success:function(val,status){if(cancelled){return }if(val.errorMessages&&val.errorMessages.length){form.addErrorWithFileName(val.errorMessages[0],file.name,JIRA.AvatarUtil.getErrorTarget(form))}else{if(status===201){options.success(val,status)}}},error:function(text,status){if(status<0){form.addError(text,JIRA.AvatarUtil.getErrorTarget(form))}else{form.addError(AJS.InlineAttach.Text.tr("upload.error.unknown",file.name),JIRA.AvatarUtil.getErrorTarget(form))}if(options.error){options.error(text,status)}},after:function(){timer.cancel();progress.finish().remove();field.val("").show()}});upload.upload();progress.onCancel(function(){upload.abort()})},getErrorTarget:function(form){return{$element:form.$form.find(".error")}},uploadTemporaryAvatar:function(url,field,options){if(AJS.InlineAttach.AjaxPresenter.isSupported(field)){this.uploadUsingFileApi(url,field,options)}else{this.uploadUsingIframeRemoting(url,field,options)}}};
/* module-key = 'jira.webresources:avatar-picker', location = '/includes/ajs/avatarpicker/AvatarPicker.js' */
JIRA.AvatarPicker=AJS.Control.extend({init:function(options){this.avatarManager=options.avatarManager;this.avatarRenderer=options.avatarRenderer;this.imageEditor=options.imageEditor;this.size=options.size;this.selectCallback=options.select;this.cropperDialog=null},render:function(ready){var instance=this;this.avatarManager.refreshStore({success:function(){if(instance.cropperDialog instanceof JIRA.Dialog){instance.cropperDialog.hide();delete instance.cropperDialog}instance.element=jQuery('<div id="jira-avatar-picker" />');instance.element.html(JIRA.Templates.AvatarPicker.picker({avatars:instance.avatarManager.getAllAvatarsRenderData(instance.size)}));instance._assignEvents("selectAvatar",instance.element.find(".jira-avatar img"));instance._assignEvents("deleteAvatar",instance.element.find(".jira-delete-avatar"));instance._assignEvents("uploader",instance.element.find("#jira-avatar-uploader"));ready(instance.element)},error:function(xhr,error,textStatus,smartAjaxResult){instance.appendErrorContent(instance.element,smartAjaxResult);ready(instance.element)}})},appendErrorContent:function(el,smartAjaxResult){try{var errors=JSON.parse(smartAjaxResult.data);if(errors&&errors.errorMessages){jQuery.each(errors.errorMessages,function(i,message){AJS.messages.error(el,{body:AJS.escapeHTML(message),closeable:false,shadowed:false})})}else{el.append(JIRA.SmartAjax.buildDialogErrorContent(smartAjaxResult,true))}}catch(e){el.append(JIRA.SmartAjax.buildDialogErrorContent(smartAjaxResult,true))}},uploadTempAvatar:function(field){var instance=this;this.avatarManager.createTemporaryAvatar(field,{success:function(data){if(data.id){instance.render(function(){instance.selectAvatar(data.id)})}else{field.val("");instance.cropperDialog=new JIRA.Dialog({id:"project-avatar-cropper",width:560,content:function(ready){var $el=instance.imageEditor.render(data);instance.imageEditor.edit({confirm:function(instructions){instance.avatarManager.createAvatarFromTemporary(instructions,{success:function(data){instance.render(function(){instance.selectAvatar(data.id)})}})}});$el.find(".cancel").click(function(){instance.cropperDialog.hide()});ready($el)}});instance.cropperDialog.bind("dialogContentReady",function(){AJS.$(instance).trigger(JIRA.AvatarPicker.ImageEditor.LOADED)});instance.cropperDialog.bind("Dialog.hide",function(){AJS.$(instance).trigger(JIRA.AvatarPicker.ImageEditor.DISMISSED)});instance.cropperDialog.show()}},error:function(){console.log(arguments)}})},getAvatarElById:function(id){return this.element.find(".jira-avatar[data-id='"+id+"']")},selectAvatar:function(id){var avatar,instance=this;avatar=this.avatarManager.getById(id);this.avatarManager.selectAvatar(this.avatarManager.getById(id),{error:function(){},success:function(){instance.getAvatarElById(id).remove();if(instance.selectCallback){instance.selectCallback.call(instance,avatar,instance.avatarManager.getAvatarSrc(avatar,instance.size))}}})},deleteAvatar:function(id){var instance=this;if(confirm("\u786E\u5B9E\u8981\u5220\u9664\u8FD9\u4E2A\u56FE\u6807?")){this.avatarManager.destroy(this.avatarManager.getById(id),{error:function(){},success:function(){var selectedAvatar=instance.avatarManager.getSelectedAvatar(),$avatar=instance.getAvatarElById(id);$avatar.fadeOut(function(){$avatar.remove()});if(selectedAvatar.getId()!==id){instance.getAvatarElById(selectedAvatar.getId()).addClass("jira-selected-avatar");instance.selectCallback.call(instance,selectedAvatar,instance.avatarManager.getAvatarSrc(selectedAvatar,instance.size),true)}}})}},_events:{uploader:{change:function(e,el){this.uploadTempAvatar(el)}},deleteAvatar:{click:function(e,el){this.deleteAvatar(el.attr("data-id"))}},selectAvatar:{click:function(e,el){if(e.target===el[0]){this.selectAvatar(el.attr("data-id"))}}}}});JIRA.AvatarPicker.ImageEditor=AJS.Control.extend({render:function(data){this.element=jQuery('<div id="avatar-picker-image-editor"/>').html(JIRA.Templates.AvatarPicker.imageEditor(data));return this.element},edit:function(options){var instance=this,avator=this.element.find(".avataror");options=options||{};avator.unbind();avator.bind("AvatarImageLoaded",function(){if(options.ready){options.ready()}});avator.find("img").load(function(){avator.avataror({previewElement:instance.element.find(".jira-avatar-cropper-header"),parent:instance.element})});this.element.find("#avataror").submit(function(e){e.preventDefault();if(options.confirm){options.confirm({cropperOffsetX:jQuery("#avatar-offsetX").val(),cropperOffsetY:jQuery("#avatar-offsetY").val(),cropperWidth:jQuery("#avatar-width").val()})}}).find(".cancel").click(function(e){e.preventDefault();if(options.cancel){options.cancel()}})}});JIRA.AvatarPicker.ImageEditor.LOADED="imageEditorLoaded";JIRA.AvatarPicker.ImageEditor.DISMISSED="imageEditorDismissed";JIRA.AvatarPicker.createProjectAvatarPicker=function(options){return new JIRA.AvatarPicker({avatarManager:JIRA.AvatarManager.createProjectAvatarManager({projectKey:options.projectKey,projectId:options.projectId,defaultAvatarId:options.defaultAvatarId}),imageEditor:new JIRA.AvatarPicker.ImageEditor(),size:JIRA.Avatar.LARGE,select:options.select})};JIRA.AvatarPicker.createUserAvatarPicker=function(options){return new JIRA.AvatarPicker({avatarManager:JIRA.AvatarManager.createUserAvatarManager({username:options.username,defaultAvatarId:options.defaultAvatarId}),imageEditor:new JIRA.AvatarPicker.ImageEditor(),size:JIRA.Avatar.LARGE,select:options.select})};JIRA.createProjectAvatarPickerDialog=function(options){var projectAvatarDialog=new JIRA.FormDialog({trigger:options.trigger,id:"project-avatar-picker",width:560,stacked:true,content:function(ready){var avatarPicker,$dialogWrapper;$dialogWrapper=jQuery('<div id="projectavatar-content-wrapper"/>');jQuery("<h2 />").text("\u9009\u62E9\u4E00\u4E2A\u9879\u76EE\u56FE\u6807").appendTo($dialogWrapper);avatarPicker=JIRA.AvatarPicker.createProjectAvatarPicker({projectKey:options.projectKey,projectId:options.projectId,defaultAvatarId:options.defaultAvatarId,select:function(avatar,src,implicit){if(options.select){options.select.apply(this,arguments)}if(!implicit){projectAvatarDialog.hide()}}});avatarPicker.render(function(content){$dialogWrapper.append(content);ready($dialogWrapper)})}});projectAvatarDialog._focusFirstField=function(){}};JIRA.createUserAvatarPickerDialog=function(options){var userAvatarDialog=new JIRA.FormDialog({trigger:options.trigger,id:"user-avatar-picker",width:560,stacked:true,content:function(ready){var avatarPicker,$dialogWrapper;$dialogWrapper=jQuery('<div id="useravatar-content-wrapper"/>');jQuery("<h2 />").text("\u9009\u62E9\u4E00\u4E2A\u7528\u6237\u5934\u50CF").appendTo($dialogWrapper);avatarPicker=JIRA.AvatarPicker.createUserAvatarPicker({username:options.username,defaultAvatarId:options.defaultAvatarId,select:function(avatar,src,implicit){if(options.select){options.select.apply(this,arguments)}jQuery(".avatar-image").attr("src",src);if(!implicit){userAvatarDialog.hide()}}});avatarPicker.render(function(content){$dialogWrapper.append(content);ready($dialogWrapper)})}});userAvatarDialog._focusFirstField=function(){}};jQuery(function(){JIRA.createUserAvatarPickerDialog({trigger:"#user_avatar_image",username:jQuery("#avatar-owner-id").text(),defaultAvatarId:jQuery("#default-avatar-id").text()})});
/* module-key = 'jira.webresources:avatar-picker', location = '/includes/ajs/avatarpicker/GravatarUtil.js' */
(function(){AJS.namespace("JIRA.GravatarUtil");JIRA.GravatarUtil.showGravatarHelp=function(data){if(typeof (data)!=="undefined"&&typeof (data.entry)!=="undefined"){AJS.$(".gravatar-signup-text").addClass("hidden");AJS.$(".gravatar-login-text").removeClass("hidden")}};var displayGravatarHelp=function(){var gravatarJsonUrl=AJS.$("#gravatar_json_url");if(gravatarJsonUrl.length){AJS.$.ajax(gravatarJsonUrl.val(),{dataType:"jsonp",success:JIRA.GravatarUtil.showGravatarHelp})}};AJS.$(document).ready(function(){if(AJS.$("#gravatar_help_params")){displayGravatarHelp()}})}());
/* module-key = 'jira.webresources:avatar-picker', location = '/includes/ajs/avatarpicker/AvatarPicker.soy' */
// This file was automatically generated from AvatarPicker.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.AvatarPicker == 'undefined') { JIRA.Templates.AvatarPicker = {}; }


JIRA.Templates.AvatarPicker.picker = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form class="jira-avatar-upload-form" action="#"><input name="id" value="10000" type="hidden" ><input name="pid" value="10000" type="hidden" ><div class="field-group"><label>', soy.$$escapeHtml("\u4e0a\u4f20\u4e00\u4e2a\u56fe\u6807"), '</label><input type="file" class="ignore-inline-attach" name="avatar" id="jira-avatar-uploader" /><div class="error"></div></div></form><div class="form-body"><ul class="jira-avatars">');
  var avatarList6 = opt_data.avatars.system;
  var avatarListLen6 = avatarList6.length;
  for (var avatarIndex6 = 0; avatarIndex6 < avatarListLen6; avatarIndex6++) {
    var avatarData6 = avatarList6[avatarIndex6];
    output.append('<li class="jira-avatar jira-system-avatar ', (avatarData6.isSelected) ? 'jira-selected-avatar' : '', '" title="Select this Avatar" data-id="', soy.$$escapeHtml(avatarData6.id), '"><span><img id="avatar-', soy.$$escapeHtml(avatarData6.id), '" data-id="', soy.$$escapeHtml(avatarData6.id), '" src="', soy.$$escapeHtml(avatarData6.src), '" width="', soy.$$escapeHtml(avatarData6.width), '" height="', soy.$$escapeHtml(avatarData6.height), '" /></span></li>');
  }
  var avatarList25 = opt_data.avatars.custom;
  var avatarListLen25 = avatarList25.length;
  for (var avatarIndex25 = 0; avatarIndex25 < avatarListLen25; avatarIndex25++) {
    var avatarData25 = avatarList25[avatarIndex25];
    output.append('<li class="jira-avatar jira-custom-avatar ', (avatarData25.isSelected) ? 'jira-selected-avatar' : '', '" title="Select this avatar" data-id="', soy.$$escapeHtml(avatarData25.id), '"><span><img id="avatar-', soy.$$escapeHtml(avatarData25.id), '" data-id="', soy.$$escapeHtml(avatarData25.id), '" src="', soy.$$escapeHtml(avatarData25.src), '" width="', soy.$$escapeHtml(avatarData25.width), '" height="', soy.$$escapeHtml(avatarData25.height), '" /></span><span class="jira-delete-avatar" data-id="', soy.$$escapeHtml(avatarData25.id), '" title="', soy.$$escapeHtml("\u5220\u9664\u8fd9\u4e2a\u56fe\u6807"), '">Delete</span></li>');
  }
  output.append('</ul></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.AvatarPicker.imageEditor = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form id="avataror" class="jira-avatar-cropper-form aui" action="/jira/secure/project/AvatarPicker.jspa"><input type="hidden" name="cropperOffsetX" id="avatar-offsetX" value="', soy.$$escapeHtml(opt_data.cropperOffsetX), '"><input type="hidden" name="cropperOffsetY" id="avatar-offsetY" value="', soy.$$escapeHtml(opt_data.cropperOffsetY), '"><input type="hidden" name="cropperWidth" id="avatar-width"  value="', soy.$$escapeHtml(opt_data.cropperWidth), '"><div class="jira-avatar-cropper-header"><p>', soy.$$escapeHtml("\u8bf7\u622a\u53d6\u9700\u8981\u4e0a\u4f20\u56fe\u50cf\u7684\u533a\u57df\u3002"), '</p></div><div class="form-body"><div class="avataror"><img src="', soy.$$escapeHtml(opt_data.url), '" height="300" /></div></div><div class="form-footer buttons-container"><div class="buttons"><input type="submit" class="aui-button" value="', soy.$$escapeHtml("\u786e\u8ba4"), '"><a class="aui-button aui-button-link cancel" href="#">', soy.$$escapeHtml("\u53d6\u6d88"), '</a></div></div></form>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'jira.webresources:avatar-picker-trigger', location = '/includes/jira/admin/initAvatarPickerTrigger.js' */
(function(){var AvatarPickerContentRetriever=AJS.ContentRetriever.extend({init:function(avatarPicker){this.avatarPicker=avatarPicker},content:function(finished){this.avatarPicker.render(function(el){finished(jQuery("<div />").html(el))})},cache:function(){return false},isLocked:function(){},startingRequest:function(){},finishedRequest:function(){}});var InlineAvatarPicker=AJS.InlineLayer.extend({init:function(options){var instance=this;this.avatarPicker=JIRA.AvatarPicker.createProjectAvatarPicker({projectId:options.projectId,projectKey:options.projectKey,defaultAvatarId:options.defaultAvatarId,select:function(avatar,src,implicit){if(options.select){options.select.apply(this,arguments)}if(!implicit){instance.hide()}instance.offsetTarget().attr("src",src);instance.offsetTarget().trigger("AvatarSelected")}});options.contentRetriever=new AvatarPickerContentRetriever(this.avatarPicker);jQuery(this.avatarPicker.imageEditor).bind(JIRA.AvatarPicker.ImageEditor.LOADED,function(){instance.setWidth(instance.layer().attr("scrollWidth"))});this._super(options);var $triggerImg=this.offsetTarget();var $triggerContainer=jQuery("<span class='jira-avatar-picker-trigger'></span>");$triggerContainer.insertBefore($triggerImg).append($triggerImg);this._assignEvents("offsetTarget",$triggerContainer)},_events:{offsetTarget:{click:function(e){this.show()}}}});function initProjectAvatarPicker(ctx){var triggerImg=jQuery(".jira-avatar-picker-trigger",ctx);if("project"!==jQuery(ctx).find("#avatar-type").text()){return }JIRA.createProjectAvatarPickerDialog({trigger:triggerImg,projectId:jQuery(ctx).find("#avatar-owner-id").text(),projectKey:jQuery(ctx).find("#avatar-owner-key").text(),defaultAvatarId:jQuery(ctx).find("#default-avatar-id").text(),select:function(avatar,src){triggerImg.attr("src",src)}})}function initProjectInlineAvatarPicker(ctx){var $triggerImg=jQuery(".jira-inline-avatar-picker-trigger",ctx);if($triggerImg.length){new InlineAvatarPicker({offsetTarget:$triggerImg,projectId:jQuery(ctx).find("#avatar-owner-id").text(),projectKey:jQuery(ctx).find("#avatar-owner-key").text(),defaultAvatarId:jQuery(ctx).find("#default-avatar-id").text(),alignment:AJS.LEFT,width:420,allowDownsize:true})}}JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED,function(e,context,reason){if(reason!==JIRA.CONTENT_ADDED_REASON.panelRefreshed){initProjectAvatarPicker(context);initProjectInlineAvatarPicker(context)}})})();
/* module-key = 'jira.webresources:croneditor', location = '/includes/js/cron/croneditor.js' */
function hideCronEdit(elementid){document.getElementById(elementid).style.display="none"}function showCronEdit(elementid){document.getElementById(elementid).style.display=""}function toggleFrequencyControl(paramPrefix,setOriginal){var select=document.getElementById(paramPrefix+"interval");if(select.value==0){switchToOnce(paramPrefix,setOriginal)}else{switchToMany(paramPrefix,setOriginal)}}function switchToOnce(paramPrefix,setOriginal){hideCronEdit(paramPrefix+"runMany");showCronEdit(paramPrefix+"runOnce");if(setOriginal){timesOnce[paramPrefix]=true}}function switchToMany(paramPrefix,setOriginal){hideCronEdit(paramPrefix+"runOnce");showCronEdit(paramPrefix+"runMany");if(setOriginal){timesOnce[paramPrefix]=false}}function switchToDaysOfMonth(paramPrefix){hideCronEdit(paramPrefix+"daysOfWeek");showCronEdit(paramPrefix+"daysOfMonth");showCronEdit(paramPrefix+"freqDiv");hideCronEdit(paramPrefix+"innerFreqDiv");hideCronEdit(paramPrefix+"advanced");switchToOnce(paramPrefix,false)}function switchToDaysOfWeek(paramPrefix){showCronEdit(paramPrefix+"daysOfWeek");hideCronEdit(paramPrefix+"daysOfMonth");showCronEdit(paramPrefix+"freqDiv");showCronEdit(paramPrefix+"innerFreqDiv");hideCronEdit(paramPrefix+"advanced");switchToOriginal(paramPrefix)}function switchToDaily(paramPrefix){hideCronEdit(paramPrefix+"daysOfWeek");hideCronEdit(paramPrefix+"daysOfMonth");showCronEdit(paramPrefix+"freqDiv");showCronEdit(paramPrefix+"innerFreqDiv");hideCronEdit(paramPrefix+"advanced");switchToOriginal(paramPrefix)}function switchToAdvanced(paramPrefix){hideCronEdit(paramPrefix+"daysOfWeek");hideCronEdit(paramPrefix+"daysOfMonth");hideCronEdit(paramPrefix+"runOnce");hideCronEdit(paramPrefix+"runMany");hideCronEdit(paramPrefix+"freqDiv");showCronEdit(paramPrefix+"advanced")}function switchToOriginal(paramPrefix){if(timesOnce[paramPrefix]){switchToOnce(paramPrefix,false)}else{switchToMany(paramPrefix,false)}};
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-create-issue', location = 'js/Issue/create.js' */
JIRA.Forms.CreateIssueModel=JIRA.Forms.Model.extend({DEFAULT_NON_RETAINED_FIELDS:["summary","description","timetracking","timetracking_originalestimate","timetracking_remainingestimate"],init:function(A){A=A||{};
this.userFieldsResource=contextPath+"/rest/quickedit/1.0/userpreferences/create";
this._hasRetainFeature=true;
this._hasVisibilityFeature=true;
this.retainedFields=[];
this.initIssueType=A.issueType;
this.initProjectId=A.projectId;
this.parentIssueId=A.parentIssueId;
this.nonRetainedFields=this.DEFAULT_NON_RETAINED_FIELDS;
if(A.nonRetainedFields){this.nonRetainedFields=_.union(A.nonRetainedFields,this.DEFAULT_NON_RETAINED_FIELDS)
}},getParentIssueId:function(){return this.parentIssueId
},isInMultipleMode:function(){return this.multipleMode
},setIsMultipleMode:function(A){this.multipleMode=A
},getActiveFieldIds:function(){var A=this,B=jQuery.Deferred(),C=[];
this.getUserFields().done(function(D){jQuery.each(D,function(F,E){C.push(E)
});
A.getRequiredFields().done(function(E){jQuery.each(E,function(G,F){if(jQuery.inArray(F.id,C)===-1){C.push(F.id)
}});
B.resolve(C)
})
});
return B.promise()
},hasVisibilityFeature:function(A){return !A.required
},getFieldsResource:function(){var A=contextPath+"/secure/QuickCreateIssue!default.jspa?decorator=none";
if(this.parentIssueId){return A+"&parentIssueId="+this.parentIssueId
}if(this.initIssueType){A=A+"&issuetype="+this.initIssueType;
delete this.initIssueType
}if(this.initProjectId){A=A+"&pid="+this.initProjectId;
delete this.initProjectId
}return A
},addFieldToRetainValue:function(C,B){var A=!_.contains(this.nonRetainedFields,C);
if(A||B){this._super(C)
}},getRequiredFields:function(){var A=jQuery.Deferred(),B=[];
this.getFields().done(function(C){jQuery.each(C,function(D,E){if(E.required){B.push(E)
}});
A.resolve(B)
});
return A.promise()
},getConfigurableFields:function(){var A=jQuery.Deferred(),B=[];
this.getFields().done(function(C){jQuery.each(C,function(D,E){if(E.id!=="project"&&E.id!=="issuetype"){B.push(E)
}});
A.resolve(B)
});
return A.promise()
},getIssueSetupFields:function(){var A=jQuery.Deferred(),B=[];
this.getFields().done(function(C){jQuery.each(C,function(D,E){if(E.id==="project"||E.id==="issuetype"){B.push(E)
}});
A.resolve(B)
});
return A.promise()
}});
JIRA.Forms.CreateIssueHelper=Class.extend({init:function(A){this.form=A
},handleSubmitSuccess:function(D){function C(E,G,F){var H='<a href="'+F+'">'+E+" - "+AJS.escapeHTML(G)+"</a>";
return AJS.format("Issue {0} has been successfully created",H)
}var A=this,B=this.form.$element.find("#summary").val();
D.summary=B;
this.form.triggerEvent("submitted",[D,this]);
this.form.triggerEvent("issueCreated",[D,this],true);
if(A.form.model.isInMultipleMode()){this.form.render().done(function(){var E=C(D.issueKey,B,contextPath+"/browse/"+D.issueKey);
JIRA.applySuccessMessageToForm(A.form.getForm(),E)
})
}else{this.form.triggerEvent("sessionComplete")
}},getCreateAnotherCheckbox:function(){return this.form.$element.find("#qf-create-another")
},isInMultipleMode:function(){return this.getCreateAnotherCheckbox().is(":checked")
},getProjectField:function(){return this.form.$element.find(".issue-setup-fields #project")
},getIssueTypeField:function(){return this.form.$element.find(".issue-setup-fields #issuetype")
},serializeForToggle:function(C){if(!this.form.model.hasRetainFeature()){return this.form.getForm().serialize()
}var E=this.form.model.prevActiveFields||[];
var J=this.form.getForm().serializeArray();
var D=this.form.getActiveFieldIds();
var F=jQuery.grep(J,function(K){return jQuery.inArray(K.name,D)!==-1
});
var A=jQuery.grep(E,function(K){return jQuery.inArray(K.name,D)===-1
});
var B=jQuery.map(A,function(K){return K.name
});
var H=jQuery.merge(F,A);
var G=jQuery.merge(D,B);
this.form.model.prevActiveFields=jQuery.extend(true,[],H);
if(C){G=this.executeProjectChangedSecuritySettingAction(G)
}var I=jQuery.merge([{name:"retainValues",value:true}],H);
jQuery.each(J,function(K,L){if(L.name==="pid"||L.name==="issuetype"){I.push(L)
}});
jQuery.each(G,function(K,L){I.push({name:"fieldsToRetain",value:L})
});
return jQuery.param(I)
},executeProjectChangedSecuritySettingAction:function(A){return _.reject(A,function(B){return B==="security"
})
},prepareFieldsToRetain:function(A,B){jQuery.each(A,function(C,D){B.push({name:"fieldsToRetain",value:D})
});
return B
},setIssueType:function(){var A=this,B=this.serializeForToggle();
this.form.invalidateFieldsCache();
this.form.disable();
this.form.model.refresh(B).done(function(){A.form.render();
A.form.enable()
})
},setProjectId:function(){var A=this,B=this.serializeForToggle(true);
this.form.invalidateFieldsCache();
this.form.disable();
this.form.model.refresh(B).done(function(){A.form.render();
A.form.enable()
})
},decorate:function(){var A=this;
this.getProjectField().change(function(){A.setProjectId(this.value)
});
this.getIssueTypeField().change(function(){A.setIssueType(this.value)
});
this.getCreateAnotherCheckbox().change(function(){A.form.model.setIsMultipleMode(this.checked)
})
}});
JIRA.Forms.CreateIssueError=JIRA.Forms.Error.extend({_render:function(A){return jQuery(JIRA.Templates.Issue.createIssueError({errorHtml:A,useLegacyDecorator:JIRA.useLegacyDecorator()}))
}});
JIRA.Forms.UnconfigurableCreateIssueForm=JIRA.Forms.AbstractUnconfigurableForm.extend({init:function(A){this._serialization={};
this.globalEventNamespaces=A.globalEventNamespaces||[];
this.model=A.model;
this.helper=new JIRA.Forms.CreateIssueHelper(this);
this.title=A.title;
this.action=contextPath+"/secure/QuickCreateIssue.jspa?decorator=none";
this.$element=jQuery("<div class='qf-unconfigurable-form' />")
},handleSubmitSuccess:function(A){this.helper.handleSubmitSuccess(A)
},_render:function(){var B=jQuery.Deferred(),A=this;
this.getFieldsHtml().done(function(C){A.model.getIssueSetupFields().done(function(F){var E=JIRA.Templates.Issue.createIssueForm({issueSetupFields:F,fieldsHtml:C,parentIssueId:A.model.getParentIssueId(),atlToken:A.model.getAtlToken(),title:A.title,multipleMode:A.model.isInMultipleMode(),useLegacyDecorator:JIRA.useLegacyDecorator(),showFieldConfigurationToolBar:!JIRA.Users.LoggedInUser.isAnonymous(),modifierKey:AJS.Navigator.modifierKey()}),D=JIRA.extractScripts(E);
A.$element.empty().append(D.html);
A.helper.decorate();
B.resolveWith(A,[A.$element,D.scripts])
})
});
return B.promise()
}});
JIRA.Forms.ConfigurableCreateIssueForm=JIRA.Forms.AbstractConfigurableForm.extend({init:function(A){this.model=A.model;
this.helper=new JIRA.Forms.CreateIssueHelper(this);
this.globalEventNamespaces=A.globalEventNamespaces||[];
this.issueId=A.issueId;
this.title=A.title;
this._serialization={};
this.action=contextPath+"/secure/QuickCreateIssue.jspa?decorator=none";
this.$element=jQuery("<div />").addClass("qf-form qf-configurable-form")
},handleSubmitSuccess:function(A){return this.helper.handleSubmitSuccess(A)
},_render:function(){var B=jQuery.Deferred(),A=this;
A.model.getIssueSetupFields().done(function(D){var C=JIRA.Templates.Issue.createIssueForm({issueSetupFields:D,atlToken:A.model.getAtlToken(),isConfigurable:true,title:A.title,parentIssueId:A.model.getParentIssueId(),useLegacyDecorator:JIRA.useLegacyDecorator(),multipleMode:A.model.isInMultipleMode(),showFieldConfigurationToolBar:!JIRA.Users.LoggedInUser.isAnonymous(),modifierKey:AJS.Navigator.modifierKey()});
A.$element.html(C);
A.helper.decorate();
A.renderFormContents().done(function(F,E){B.resolveWith(A,[A.$element,E])
})
});
return B.promise()
}});
JIRA.Forms.createCreateIssueForm=function(A){A=A||{};
return new JIRA.Forms.Container(function(){A.globalEventNamespaces=A.globalEventNamespaces||["QuickCreateIssue"];
var E="\u521B\u5EFA\u95EE\u9898",B=new JIRA.Forms.CreateIssueModel({projectId:A.pid,issueType:A.issueType}),D=new JIRA.Forms.ConfigurableCreateIssueForm({model:B,title:E,globalEventNamespaces:A.globalEventNamespaces}),C=new JIRA.Forms.UnconfigurableCreateIssueForm({model:B,title:E,globalEventNamespaces:A.globalEventNamespaces});
return{globalEventNamespaces:A.globalEventNamespaces,model:B,errorHandler:new JIRA.Forms.CreateIssueError(),configurableForm:D,unconfigurableForm:C}
})
};
JIRA.Forms.createSubtaskForm=(function(){var A=function A(C){return C.parentIssueId||JIRA.Issue.getIssueId()||JIRA.IssueNavigator.getSelectedIssueId()
};
var B=function B(C){C=C||{};
return new JIRA.Forms.Container(function(){C.globalEventNamespaces=C.globalEventNamespaces||["QuickCreateSubtask"];
var G=A(C),H=JIRA.Dialog.getIssueActionTitle("Create Subtask"),D=new JIRA.Forms.CreateIssueModel({parentIssueId:G,projectId:C.pid,issueType:C.issueType}),F=new JIRA.Forms.ConfigurableCreateIssueForm({model:D,title:H,globalEventNamespaces:C.globalEventNamespaces}),E=new JIRA.Forms.UnconfigurableCreateIssueForm({model:D,title:H,globalEventNamespaces:C.globalEventNamespaces});
return{globalEventNamespaces:C.globalEventNamespaces,model:D,errorHandler:new JIRA.Forms.CreateIssueError(),configurableForm:F,unconfigurableForm:E}
})
};
return B
})();
jQuery(function(){var A;
jQuery(document).on("simpleClick",".create-issue, .create-issue-type",function(E){var B=jQuery(E.target);
var D=B.is("a")?B:B.find("a");
var F=parseUri(D.attr("href")).queryKey;
var C={pid:F.pid,issueType:F.issuetype};
C=jQuery.extend(C,{pid:B.attr("data-pid"),issueType:B.attr("data-issue-type")});
JIRA.Forms.createCreateIssueForm(C).asDialog({trigger:document.createElement("a"),id:"create-issue-dialog",windowTitle:"\u521B\u5EFA\u95EE\u9898"}).show();
E.preventDefault()
});
A=document.getElementById("stqc_show");
if(A){A.onclick=null
}JIRA.Forms.createSubtaskForm().asDialog({windowTitle:function(){return JIRA.Dialog.getIssueActionTitle("Create Subtask")
},trigger:".issueaction-create-subtask",id:"create-subtask-dialog"})
});
/* module-key = 'com.atlassian.jira.jira-quick-edit-plugin:quick-create-issue', location = 'js/Issue/issue.soy' */
// This file was automatically generated from issue.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.Issue == 'undefined') { JIRA.Templates.Issue = {}; }


JIRA.Templates.Issue.editIssueError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<h2>', soy.$$escapeHtml("\u7f16\u8f91\u95ee\u9898"), '</h2><div class="', (opt_data.useLegacyDecorator) ? 'content-body' : 'form-body', '">', opt_data.errorHtml, '</div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.editIssueForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form action="#" name="jiraform" class="aui"><h2>', (opt_data.showFieldConfigurationToolBar) ? '<div class="qf-form-operations aui-toolbar"><div class="toolbar-split toolbar-split-right"><div class="toolbar-group"><span class="toolbar-item"><a href="#" class="toolbar-trigger" id="qf-field-picker-trigger"><span class="icon icon-tools"></span>' + soy.$$escapeHtml("Configure Fields") + '<span class="icon drop-menu"></span></a></span></div></div></div>' : '', opt_data.title, '</h2><div class="', (opt_data.useLegacyDecorator) ? 'content-body' : 'form-body', '"><input type="hidden" name="id" value="', soy.$$escapeHtml(opt_data.issueId), '" /><input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /><div class="content">', (opt_data.fieldsHtml) ? opt_data.fieldsHtml : '', (opt_data.commentField) ? opt_data.commentField.editHtml : '', '<!-- fields inserted here via javascript --></div></div><div class="buttons-container ', (opt_data.useLegacyDecorator) ? 'content-footer' : 'form-footer', '"><div class="buttons"><input accesskey="', soy.$$escapeHtml("s"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.modifierKey)), '" class="button" id="edit-issue-submit" name="Edit" type="submit" value="', soy.$$escapeHtml("\u66f4\u65b0"), '" /><a href="#" accesskey="', soy.$$escapeHtml("`"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.modifierKey)), '" class="cancel">', soy.$$escapeHtml("\u53d6\u6d88"), '</a></div></div></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.issueFields = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.hasTabs) {
    output.append('<div class="aui-tabs horizontal-tabs" id="horizontal"><ul class="tabs-menu">');
    var tabList66 = opt_data.tabs;
    var tabListLen66 = tabList66.length;
    for (var tabIndex66 = 0; tabIndex66 < tabListLen66; tabIndex66++) {
      var tabData66 = tabList66[tabIndex66];
      output.append((tabData66) ? '<li class="menu-item ' + ((tabData66.isFirst) ? 'first active-tab' : '') + ' "><a href="#tab-' + soy.$$escapeHtml(tabData66.position) + '" ><strong>' + soy.$$escapeHtml(tabData66.label) + '</strong></a></li>' : '');
    }
    output.append('</ul>');
    var tabList80 = opt_data.tabs;
    var tabListLen80 = tabList80.length;
    for (var tabIndex80 = 0; tabIndex80 < tabListLen80; tabIndex80++) {
      var tabData80 = tabList80[tabIndex80];
      if (tabData80) {
        output.append('<div class="tabs-pane ', (tabData80.isFirst) ? 'active-pane' : '', '" id="tab-', soy.$$escapeHtml(tabData80.position), '">');
        var fieldList90 = tabData80.fields;
        var fieldListLen90 = fieldList90.length;
        for (var fieldIndex90 = 0; fieldIndex90 < fieldListLen90; fieldIndex90++) {
          var fieldData90 = fieldList90[fieldIndex90];
          output.append((fieldData90.editHtml) ? fieldData90.editHtml : '');
        }
        output.append('</div>');
      }
    }
    output.append('</div>');
  } else {
    var fieldList100 = opt_data.fields;
    var fieldListLen100 = fieldList100.length;
    for (var fieldIndex100 = 0; fieldIndex100 < fieldListLen100; fieldIndex100++) {
      var fieldData100 = fieldList100[fieldIndex100];
      output.append((fieldData100.editHtml) ? fieldData100.editHtml : '');
    }
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.createIssueForm = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<form name="jiraform" action="#" class="aui"><h2>', (opt_data.showFieldConfigurationToolBar) ? '<div class="qf-form-operations aui-toolbar"><div class="toolbar-split toolbar-split-right"><div class="toolbar-group"><span class="toolbar-item"><a href="#" class="toolbar-trigger" id="qf-field-picker-trigger"><span class="icon icon-tools"></span>' + soy.$$escapeHtml("Configure Fields") + '<span class="icon drop-menu"></span></a></span></div></div></div>' : '', soy.$$escapeHtml(opt_data.title), '</h2><div class="', (opt_data.useLegacyDecorator) ? 'content-body' : 'form-body', '">');
  if (opt_data.issueSetupFields) {
    output.append('<div class="issue-setup-fields">');
    var fieldList124 = opt_data.issueSetupFields;
    var fieldListLen124 = fieldList124.length;
    for (var fieldIndex124 = 0; fieldIndex124 < fieldListLen124; fieldIndex124++) {
      var fieldData124 = fieldList124[fieldIndex124];
      output.append('<div class="qf-field qf-field-', soy.$$escapeHtml(fieldData124.id), ' qf-required">', fieldData124.editHtml, '</div>');
    }
    output.append('</div>');
  }
  output.append((opt_data.parentIssueId) ? '<input type="hidden" name="parentIssueId" value="' + soy.$$escapeHtml(opt_data.parentIssueId) + '" />' : '', '<input type="hidden" name="atl_token" value="', soy.$$escapeHtml(opt_data.atlToken), '" /><div class="content">', (opt_data.fieldsHtml) ? opt_data.fieldsHtml : '', '<!-- fields inserted here via javascript --></div></div><div class="buttons-container ', (opt_data.useLegacyDecorator) ? 'content-footer' : 'form-footer', '"><div class="buttons"><label for="qf-create-another" class="qf-create-another"><input id="qf-create-another" type="checkbox" ', (opt_data.multipleMode) ? 'checked="checked"' : '', ' />', soy.$$escapeHtml("Create another"), '</label><input accesskey="', soy.$$escapeHtml("s"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355","s",opt_data.modifierKey)), '" class="button" id="create-issue-submit" name="Edit" type="submit" value="', soy.$$escapeHtml("\u521b\u5efa"), '" /><a href="#" accesskey="', soy.$$escapeHtml("`"), '" title="', soy.$$escapeHtml(AJS.format("\u6309 {1}+{0} \u53d6\u6d88","`",opt_data.modifierKey)), '" class="cancel">', soy.$$escapeHtml("\u53d6\u6d88"), '</a></div></div></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.Issue.createIssueError = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<h2>', soy.$$escapeHtml("\u521b\u5efa\u95ee\u9898"), '</h2><div class="', (opt_data.useLegacyDecorator) ? 'content-body' : 'form-footer', '">', opt_data.errorHtml, '</div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-invite-user-plugin:inviteuser-signup-resources', location = 'js/inviteuser-signup.js' */
(function(A){JIRA.bind(JIRA.Events.NEW_PAGE_ADDED,function(C,B){A("#consolation-login-link").click(function(){AJS.EventQueue&&AJS.EventQueue.push({name:"invitationsignupconsolationlogin",properties:{}})
})
})
})(AJS.$);
/* module-key = 'com.atlassian.jira-core-project-templates:jira-sample-project-resources', location = '/js/DemoProjectTemplate.js' */
JPT.DemoProjectTemplate={};JPT.DemoProjectTemplate.init=function init(){AJS.$("body").on("com.atlassian.jira-core-project-templates:jira-sample-item",function(b,a){JPT.DemoProjectTemplate.createDemoProject(a)})};JPT.DemoProjectTemplate.createDemoProject=function createDemoProject(a){a.addPanel("DemoProjectTemplate",JIRA.Templates.ProjectTemplates.CoreTemplates.renderLoadingSampleProject(),"");$demoProjectForm=AJS.$("<form></form>");$demoProjectForm.attr("action",contextPath+"/secure/CreateDemoProject.jspa");$demoProjectAtlTokenField=AJS.$("<input type='hidden' name='atl_token' value='' />");$demoProjectAtlTokenField.val(atl_token());$demoProjectForm.append($demoProjectAtlTokenField);$demoProjectForm.appendTo(JPT.DialogController.$dialogElement);$demoProjectForm.submit()};AJS.$(JPT.DemoProjectTemplate.init);
/* module-key = 'com.atlassian.jira-core-project-templates:jira-sample-project-resources', location = '/soy/CoreProjectTemplates.soy' */
// This file was automatically generated from CoreProjectTemplates.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.ProjectTemplates == 'undefined') { JIRA.Templates.ProjectTemplates = {}; }
if (typeof JIRA.Templates.ProjectTemplates.CoreTemplates == 'undefined') { JIRA.Templates.ProjectTemplates.CoreTemplates = {}; }


JIRA.Templates.ProjectTemplates.CoreTemplates.renderLoadingSampleProject = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class=\'demo-loading-container\'><span class=\'icon throbber loading\'/><span class=\'demo-loading-message\'>', soy.$$escapeHtml("Loading Demo Project"), '</span></div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:application-header-administration-cog-resource', location = 'header/cog.js' */
var NavLinks=(function(a){a.ApplicationHeader=function(b){b.Cog=(function(){var c=function(){var d=AJS.$("#system-admin-menu-content");if(d.length>0){return d}var e=AJS.$("#admin-menu-link-content");if(e.length>0){return e}return AJS.$("#bamboo\\.global\\.header-admin\\.menu")};return{getDropdown:c}}());return b}(a.ApplicationHeader||{});return a}(NavLinks||{}));
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:analytics', location = 'analytics/analytics.js' */
var _gaq=_gaq||[];AJS.$(function(){_gaq.push(["navlinks._setAccount","UA-20272869-14"]);_gaq.push(["navlinks._setDomainName","none"]);_gaq.push(["navlinks._setAllowLinker",true]);_gaq.push(["navlinks._trackPageview"]);AJS.$.ajax(AJS.contextPath()+"/rest/nav-links-analytics-data/1.0/",{success:function(a){_gaq.push(["navlinks._setCustomVar",1,"isUserAdmin",a.isUserAdmin?"true":"false",2])}})});(function(a){function b(e,g,d,c,f){AJS.log("Firing analytics event"+(c?" - synchronous":""));AJS.log("  Category: "+e);AJS.log("  Action:   "+g);AJS.log("  Label:    "+d);if(f!==undefined){AJS.log("  Value:    "+f)}}a.trackEvent=function(d,f,c,e){if(e===undefined){b(d,f,c,false);_gaq.push(["navlinks._trackEvent",d,f,c])}else{b(d,f,c,false,e);_gaq.push(["navlinks._trackEvent",d,f,c,e])}if(AJS.EventQueue){AJS.EventQueue.push({name:d+"."+f,properties:{label:c,value:e}})}};a.getCurrentApplication=function(){if(window.Confluence!==undefined){return"confluence"}else{if(window.BAMBOO!==undefined){return"bamboo"}else{if(window.JIRA!==undefined){return"jira"}else{return""}}}}}(window.NL=(window.NL||{})));
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:analytics', location = 'analytics/help-analytics.js' */
(function(c,b){function a(g,d,f){try{b.trackEvent("helpmenu",g,d,f)}catch(h){AJS.log("failed to track analytics event, category: helpmenu, action: "+g+", label: "+d+", value: "+f)}}c(function(){var d=c("#system-help-menu-content,#help-menu-link-content,#bamboo\\.global\\.header-help\\.menu");d.bind({"aui-dropdown2-show":function(f){a("show","")},"aui-dropdown2-hide":function(f){a("hide","")}}).find("a").unbind(".analytics").bind("click.analytics",function(){var e=this.attributes.href;a("linkFollowed",typeof e==="object"?e.value:e)}).addClass("interactive")})}(jQuery,window.NL=(window.NL||{})));
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.soy' */
// This file was automatically generated from projectshortcuts.soy.
// Please don't edit this file by hand.

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.projectshortcuts == 'undefined') { navlinks.templates.projectshortcuts = {}; }


navlinks.templates.projectshortcuts.dialogContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.localShortcuts && opt_data.localShortcuts.length > 0) {
    navlinks.templates.projectshortcuts.dialogContentShortcuts({shortcuts: opt_data.localShortcuts, listClass: 'projectshortcut-links'}, output);
  }
  if (opt_data.remoteShortcuts != null) {
    if (opt_data.remoteShortcuts.length > 0) {
      output.append('<h2 class="projectshortcuts-heading">Related Links</h2>');
      navlinks.templates.projectshortcuts.dialogContentShortcuts(soy.$$augmentData(opt_data.remoteShortcuts, {shortcuts: opt_data.remoteShortcuts, listClass: 'projectshortcut-links'}), output);
    }
  } else {
    navlinks.templates.projectshortcuts.dialogLoading(null, output);
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.projectshortcuts.headingWrapper = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="project-dialog-header-wrapper"><div class="project-header"><img class="project-img" src="', soy.$$escapeHtml(opt_data.logoUrl), '"><h2 class="dialog-title">', soy.$$escapeHtml(opt_data.title), '</h2></div><div class="project-content-wrapper">', opt_data.contentHtml, '</div></div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.projectshortcuts.dialogContentShortcuts = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul', (opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '', '>');
  var shortcutList35 = opt_data.shortcuts;
  var shortcutListLen35 = shortcutList35.length;
  for (var shortcutIndex35 = 0; shortcutIndex35 < shortcutListLen35; shortcutIndex35++) {
    var shortcutData35 = shortcutList35[shortcutIndex35];
    output.append('<li', (shortcutIndex35 == shortcutListLen35 - 1) ? ' class="last"' : '', '>');
    navlinks.templates.projectshortcuts.dialogContentShortcut(shortcutData35, output);
    output.append('</li>');
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.projectshortcuts.dialogContentShortcut = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a href="', soy.$$escapeHtml(opt_data.link), '"', (opt_data.tooltip) ? ' title="' + soy.$$escapeHtml(opt_data.tooltip) + '"' : '', '>', soy.$$escapeHtml(opt_data.label), '</a>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.projectshortcuts.dialogLoading = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="projectshortcuts-loading">', (opt_data != null && opt_data.text) ? soy.$$escapeHtml(opt_data.text) : '', '</div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-projectshortcuts', location = 'projectshortcuts/projectshortcuts.js' */
(function(e,h){var j,l={},o="key",b="name",k="entity-type";function n(r,p,q){try{h.trackEvent("projectshortcuts",r,p,q)}catch(s){AJS.log("failed to track analytics event, category: projectshortcuts, action: "+r+", label: "+p+", value: "+q)}}function f(u){var p=e(this),q=p.data(o),s=p.data(b),r=p.data(k);if(typeof q==="undefined"){return}u.preventDefault();j=new AJS.Dialog({width:600,keypressListener:function(w){if(w.which==jQuery.ui.keyCode.ESCAPE){j.remove()}},id:"project-shortcuts-dialog"}).addCancel("Close",function(){j.remove();n("hide",h.getCurrentApplication())}).addPanel("",navlinks.templates.projectshortcuts.headingWrapper({title:s,logoUrl:i(),contentHtml:navlinks.templates.projectshortcuts.dialogLoading({text:"Retrieving links…"})})).show();c(j);if(!l[q]){l[q]={entity:{title:s},localShortcuts:null,remoteShortcuts:null};d(AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+q,{entityType:r}).done(v);d(AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+q,{entityType:r}).done(t).fail(function(){var w=j.getCurrentPanel().body.find(".project-content-wrapper");w.find(".projectshortcuts-loading").remove();AJS.messages.error(w,{body:"Could not retrieve remote project shortcuts",closeable:false});c(j)})}else{m(l[q])}function v(w){l[q].localShortcuts=w.shortcuts;m(l[q])}function t(w){l[q].remoteShortcuts=w.shortcuts;m(l[q])}n("show",h.getCurrentApplication())}function i(){return e(".project-shortcut-dialog-trigger img").attr("src")}function g(p){p.getCurrentPanel().body.find("a").unbind(".analytics").bind("click.analytics",function(){var q=this.attributes.href;n("navLinkFollowed",typeof q==="object"?q.value:q)})}function m(p){if(p.localShortcuts){j.getCurrentPanel().html(navlinks.templates.projectshortcuts.headingWrapper({title:p.entity.title,logoUrl:i(),contentHtml:navlinks.templates.projectshortcuts.dialogContent(p)}));g(j);c(j)}}function a(r){var q=210;if(!r||r.length<=q){return r}var p=q;while(p>0&&r.charAt(p)!=" "){p--}if(p==0){p=q}r=r.substring(0,p);if(r.length>=p){r=r+"..."}return r}function c(p){var s=p.popup.element,r=s.find(".dialog-panel-body"),q=s.find(".dialog-components");r.height("auto");s.height(q.outerHeight()-1);e(".aui-shadow").remove()}function d(p,q){return e.ajax({url:p,cache:false,data:q,dataType:"json"})}e(document).on("click",".project-shortcut-dialog-trigger",f)}(jQuery,window.NL=(window.NL||{})));
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:atlassian-ui-popup-display-controller', location = 'popups/DisplayController.js' */
AJS.Popups=AJS.Popups||{};AJS.Popups.DisplayController=function(){var c=[];var a=false;var b=false;AJS.toInit(function(){setTimeout(function(){AJS.Popups.DisplayController.render()},0)});return{request:function(d){c.push(d);if(a&&b===false){this.render()}},render:function(){c.sort(function(e,d){return e.weight-d.weight});a=true;if(c.length!==0){b=true;c[0].show()}}}}();
/* module-key = 'com.atlassian.jira.plugin.ext.bamboo:bamboo-soy-resources', location = 'templates/plugins/bamboo/components.soy' */
// This file was automatically generated from components.soy.
// Please don't edit this file by hand.

if (typeof bamboo == 'undefined') { var bamboo = {}; }
if (typeof bamboo.components == 'undefined') { bamboo.components = {}; }


bamboo.components.pageHeader = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var param3 = new soy.StringBuilder();
  if (opt_data.headerImageContent) {
    aui.page.pageHeaderImage({content: opt_data.headerImageContent}, param3);
  }
  aui.page.pageHeaderMain({content: opt_data.headerMainContent}, param3);
  if (opt_data.headerActionsContent) {
    aui.page.pageHeaderActions({content: opt_data.headerActionsContent}, param3);
  }
  aui.page.pageHeader({content: param3.toString()}, output);
  return opt_sb ? '' : output.toString();
};


bamboo.components.icon = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="bamboo-icon bamboo-icon-', soy.$$escapeHtml(opt_data.type), '"', (opt_data.text && opt_data.showTitle) ? ' title="' + soy.$$escapeHtml(opt_data.text) + '"' : '', '>', (opt_data.text) ? '<span>' + soy.$$escapeHtml(opt_data.text) + '</span>' : '', '</span>');
  return opt_sb ? '' : output.toString();
};


bamboo.components.buildDetail = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<dl><dt class="', soy.$$escapeHtml(opt_data.keyClass), '">', soy.$$escapeHtml(opt_data.key), '</dt><dd>', opt_data.value, '</dd></dl>');
  return opt_sb ? '' : output.toString();
};


bamboo.components.artifacts = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul id="shared-artifacts">');
  var artifactList42 = opt_data.artifacts;
  var artifactListLen42 = artifactList42.length;
  for (var artifactIndex42 = 0; artifactIndex42 < artifactListLen42; artifactIndex42++) {
    var artifactData42 = artifactList42[artifactIndex42];
    bamboo.components.artifactItem(soy.$$augmentData(artifactData42, {id: artifactData42.name, url: artifactData42.link.href}), output);
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};


bamboo.components.artifactItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li>');
  bamboo.components.icon({type: 'artifact-shared'}, output);
  output.append(' <a id="artifact-', soy.$$escapeHtml(opt_data.id), '" href="', soy.$$escapeHtml(opt_data.url), '">', soy.$$escapeHtml(opt_data.name), '</a><span class="filesize">(', soy.$$escapeHtml(opt_data.prettySizeDescription), ')</span></li>');
  return opt_sb ? '' : output.toString();
};


bamboo.components.labels = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul class="labels">');
  var labelList63 = opt_data.labels;
  var labelListLen63 = labelList63.length;
  for (var labelIndex63 = 0; labelIndex63 < labelListLen63; labelIndex63++) {
    var labelData63 = labelList63[labelIndex63];
    bamboo.components.labelItem(soy.$$augmentData(labelData63, {url: opt_data.baseBambooUrl + '/browse/label/' + labelData63.name}), output);
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};


bamboo.components.labelItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li><a class="lozenge" href="', soy.$$escapeHtml(opt_data.url), '" title="', soy.$$escapeHtml(opt_data.name), '"><span>', soy.$$escapeHtml(opt_data.name), '</span></a></li>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-issue-link-web-plugin:issue-link-web-link', location = 'js/issuelink-weblink.js' */
(function () {
    var $hiddenImg = AJS.$("<img>"),
        $iconUrlInput,
        $urlInput,
        faviconUrl,
        throbberTimeoutId;

    $hiddenImg.load(function() {
        $iconUrlInput.val(faviconUrl);
        $urlInput.css("background-image", 'url("' + faviconUrl + '")');

        clearTimeout(throbberTimeoutId);
        $urlInput.removeClass("loading");
    });
    $hiddenImg.error(function() {
        clearTimeout(throbberTimeoutId);
        $urlInput.removeClass("loading");
    });

    function init(context) {
        $iconUrlInput = AJS.$("#web-link-icon-url", context);
        $urlInput = AJS.$("#web-link-url", context).bind("change", fetchFavicon);

        if ($iconUrlInput.val()) {
            $urlInput.css("background-image", "url(" + $iconUrlInput.val() + ")");
        }
    }

    function fetchFavicon() {
        // Initialise state
        $hiddenImg.attr("src", '');
        $iconUrlInput.val('');
        $urlInput.css("background-image", '');
        faviconUrl = parseFaviconUrl($urlInput.val());

        if (!faviconUrl) {
            return;
        }

        /**
         * IE specific hack: For some reason I cannot change the class inside event handler for the event source.
         */
        setTimeout(function() { $urlInput.addClass("loading"); }, 0);
        throbberTimeoutId = setTimeout(function() { $urlInput.removeClass("loading"); }, 3000);

        $hiddenImg.attr("src", faviconUrl);
    }

    function parseFaviconUrl(url) {
        var hostUrl = url.match(/^([^/]*\/\/[^/]+)/)[1];

        if (!hostUrl) {
            return;
        }

        return hostUrl + "/favicon.ico"
    }

    JIRA.bind(JIRA.Events.NEW_PAGE_ADDED, function (e, context) {
        init(context);
    });
})();
/* module-key = 'com.atlassian.jira.jira-issue-link-confluence-plugin:issue-link-confluence-js', location = 'js/issuelink-confluence.js' */
/**
 * Initialises OAuth authentication for Confluence Application Links. Requires the following elements:
 * <div class="issue-link-applinks-authentication-message"></div>
 */
(function ($) {

    var settings = {
        getCurrentAppId: function (context) {
            return $("#issue-link-confluence-app-id", context).val();
        },
        shouldExecute: function (context) {
            return $("#confluence-page-link", context).length !== 0;
        }
    };

    JIRA.bind(JIRA.Events.NEW_PAGE_ADDED, function (e, context) {
        IssueLinkAppLinks.init(settings, context);
    });

})(AJS.$);
/* module-key = 'com.atlassian.jira.jira-issue-link-confluence-plugin:confluence-page-resource', location = 'js/ConfluencePageSearch.js' */
AJS.$(function ($) {
    var confluenceSearchDialog =  new JIRA.FormDialog({
        id: "confluence-page-search-dialog",
        trigger: "#confluence-page-link .confluence-search-trigger",
        widthClass: "large",
        height: "565px",
        content: function (render) {
            var dialog = this;
            JIRA.SmartAjax.makeRequest({
                url: contextPath + "/rest/confluenceIssueLink/1/confluence/applink",
                complete: function (xhr, textStatus, smartAjaxResult) {
                    if (smartAjaxResult.successful) {
                        var appLinks = smartAjaxResult.data.applicationLinks;
                        render(JIRA.Templates.ConfluencePageSearch.result({appLinks: appLinks}));

                        initAppLinks(dialog.$popup).done(function (context, helper) {
                            initSearchDialog(context, helper);
                            $("#link-search-text", context).focus();
                        });
                    } else {
                        AJS.messages.error("#search-results-table", {
                            body: "\u65E0\u6CD5\u8FDE\u63A5JIRA\u670D\u52A1\u5668\u3002 \u53EF\u80FD\u662F\u7531\u4E8E\u670D\u52A1\u5668\u6545\u969C\u6216\u77ED\u6682\u4E2D\u65AD\u3002",
                            closeable: false
                        });
                        render();
                    }
                }
            });
        },
        submitHandler: function(e, callback){
            e.preventDefault();
            $("#search-panel-button").click().removeAttr("disabled");
            callback();
        }
    });

    function initSearchDialog($dialog, helper) {
        // Bind the select drop-down
        $("#confluence-app-link", $dialog).change(function () {
            var authenticationRequired = helper.selectServer($(this).val()).authenticationRequired;
            if (!authenticationRequired) {
                populateSpaces($dialog, $(this).val(), helper);
            }
            $("#search-results-table", $dialog).empty();

            // Any previous errors are not relevant to our new selection
            setSearchControlsEnabled(true, $dialog);
        });

        // Bind the search button
        $("#search-panel-button", $dialog).click(function () {
            $("#search-results-table", $dialog).empty();
            var searchText = $("#link-search-text", $dialog).val();
            searchText = $.trim(searchText);
            if (searchText) {
                doSearch(searchText, $dialog);
            } else {
                AJS.messages.info("#search-results-table", {
                    body: "Please enter search value.",
                    closeable: false
                });
            }

            return false;
        });
    }

    var spaceAjaxId = 0;
    function populateSpaces($context, appId, helper) {
        $("select#search-panel-space", $context).html(JIRA.Templates.ConfluencePageSearch.allSpacesOption());
        var myAjaxId = ++spaceAjaxId;
        JIRA.SmartAjax.makeRequest({
            url: contextPath + "/rest/confluenceIssueLink/1/confluence/space?appId=" + appId,
            complete: function (xhr, textStatus, smartAjaxResult) {
                if (myAjaxId !== spaceAjaxId) {
                    return;
                }
                if (smartAjaxResult.successful) {
                    var spaces = smartAjaxResult.data.spaces;
                    $("select#search-panel-space", $context).html(JIRA.Templates.ConfluencePageSearch.spaceOptions({spaces: spaces}));
                } else {
                    if (smartAjaxResult.status === 401) {
                        helper.setAuthenticationRequired(appId, true);
                    } else {
                        // Since we have an error, prevent the user from submitting a search
                        setSearchControlsEnabled(false, $context);

                        var msg;
                        if (smartAjaxResult.status === 403) {
                            msg = "Content on the Confluence site could not be accessed because the Confluence server\'s \'Remote API\' feature is disabled. The Confluence system administrator must enable this \'Remote API\' feature for JIRA to successfully access this content.";
                        } else {
                            msg = "Unable to gather information from the selected Confluence instance.";
                        }
                        AJS.messages.error("#search-results-table", {
                            body: msg,
                            closeable: false
                        });
                    }
                }
            }
        });
    }

    function setSearchControlsEnabled(enabled, $context) {
        if (enabled) {
            $("#link-search-text", $context).removeAttr("disabled");
            $("#search-panel-space", $context).removeAttr("disabled");
            $("#search-panel-button", $context).removeAttr("disabled");
        } else {
            $("#link-search-text", $context).attr("disabled", "disabled");
            $("#search-panel-space", $context).attr("disabled", "disabled");
            $("#search-panel-button", $context).attr("disabled", "disabled");
        }
    }

    function setLoadingIconVisible(visible, $context) {
        $("#link-search-loading", $context).toggleClass("hidden", !visible);
    }

    function doSearch(searchText, $context) {
        setLoadingIconVisible(true, $context);
        var appLinkId = $("#confluence-app-link", $context).val();
        var spaceKey = $("#search-panel-space option:selected", $context).val();
        JIRA.SmartAjax.makeRequest({
            url: contextPath + "/rest/confluenceIssueLink/1/confluence/search?query=" + searchText + "&appId=" + appLinkId + "&spaceKey=" + spaceKey + "&maxResults=10",
            complete: function (xhr, textStatus, smartAjaxResult) {
                setLoadingIconVisible(false, $context);
                if (smartAjaxResult.successful) {
                    var results = smartAjaxResult.data.result;
                    var resultHtml = JIRA.Templates.ConfluencePageSearch.resultsTable({results: results});
                    $("#search-results-table", $context).html(resultHtml);
                } else {
                    // This replicates the JIRA.SmartAjax.buildSimpleErrorContent method, but we can't use that because
                    // it mentions a JIRA instance.
                    var msg;
                    if (smartAjaxResult.hasData) {
                        msg = "\u5DF2\u7ECF\u94FE\u63A5\u5230JIRA\u670D\u52A1\u5668\uFF0C\u4F46\u8FD4\u56DE\u9519\u8BEF\u4FE1\u606F\u3002";
                    } else {
                        msg = "\u65E0\u6CD5\u8FDE\u63A5JIRA\u670D\u52A1\u5668\u3002 \u53EF\u80FD\u662F\u7531\u4E8E\u670D\u52A1\u5668\u6545\u969C\u6216\u77ED\u6682\u4E2D\u65AD\u3002";
                    }
                    AJS.messages.error("#search-results-table", {
                        body: msg,
                        closeable: false
                    });
                }

                $("#confluence-searchresult tbody tr", $context).click(function () {
                    var linkUrl = $(this).children().first().data("url");
                    $("#confluence-page-url").val(linkUrl);

        ////        If we want to display the title in the 'description' area on the main dialog
        ////        var linkTitle = $(this).children().first().text();
        ////        $("#confluence-page-url").siblings(".description").text(linkTitle);

                    // Clear all error messages on the parent dialog, as we now have a newly selected URL
                    $("#link-issue-dialog .error").hide();

                    confluenceSearchDialog.hide();
                    $("#link-issue-dialog").show();
                    $("#confluence-page-url").focus().select();
                });
            }
        });
    }

    function initAppLinks($dialog) {
        var settings = {
            getCurrentAppId: function (context) {
                return $("#confluence-app-link", context).val();
            },
            shouldExecute: function (context) {
                return $("#confluence-app-link", context).length !== 0;
            },
            onAuthenticationSuccessCallback: function (context, currentAppId, helper) {
                populateSpaces(context, currentAppId, helper);
            }
        };

        return IssueLinkAppLinks.init(settings, $dialog).done(function (context, helper) {
            populateSpaces(context, settings.getCurrentAppId(context), helper);
        });
    }
});

/* module-key = 'com.atlassian.jira.jira-issue-link-confluence-plugin:confluence-page-resource', location = 'templates/dialog/searchresult.soy' */
// This file was automatically generated from searchresult.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.ConfluencePageSearch == 'undefined') { JIRA.Templates.ConfluencePageSearch = {}; }


JIRA.Templates.ConfluencePageSearch.result = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<h2>', soy.$$escapeHtml("Find a Confluence page"), '</h2><form class="aui search-form" id="confluence-page-search-form" action="#" method="post"><div class="field-group"><label for="confluence-app-link">', soy.$$escapeHtml("Server"), ':</label>');
  if (opt_data.appLinks.length == 1) {
    output.append('<span class="field-value">', soy.$$escapeHtml(opt_data.appLinks[0].name), '</span><input id="confluence-app-link" class="hidden" type="hidden" name="appId" value="', soy.$$escapeHtml(opt_data.appLinks[0].id), '"/>');
  } else {
    output.append('<select id="confluence-app-link" class="select medium-field" name="appId">');
    var appLinkList17 = opt_data.appLinks;
    var appLinkListLen17 = appLinkList17.length;
    for (var appLinkIndex17 = 0; appLinkIndex17 < appLinkListLen17; appLinkIndex17++) {
      var appLinkData17 = appLinkList17[appLinkIndex17];
      output.append('<option value="', soy.$$escapeHtml(appLinkData17.id), '">', soy.$$escapeHtml(appLinkData17.name), '</option>');
    }
    output.append('</select>');
  }
  output.append('</div><div class="issue-link-applinks-authentication-message applinks-message-bar"></div><div class="hidden"><input class="issue-link-applinks-application-type" type="hidden" value="com.atlassian.applinks.api.application.confluence.ConfluenceApplicationType"/></div><div class="issue-link-oauth-toggle field-group"><label for="link-search-text" id="linkSearch-label">', soy.$$escapeHtml("Search"), ':</label><input id="link-search-text" type="text" tabindex="0" class="text" name="linkSearch" size="50" /> <select tabindex="0" class="search-space select" id="search-panel-space"><option value="">', soy.$$escapeHtml("All Spaces"), '</option></select> <input type="submit" tabindex="0" class="aui-button" id="search-panel-button" value="', soy.$$escapeHtml("Search"), '"/><span id="link-search-loading" class="icon loading throbber hidden"/></div><div class="message-panel hidden"></div><div id="search-results-table" class="data-table"></div><div class="buttons-container form-footer"><div class="buttons"><button class="aui-button aui-button-link cancel" id="confluence-link-cancel" title="', soy.$$escapeHtml("Press Esc to close"), '">', soy.$$escapeHtml("\u5173\u95ed"), '</button></div></div></form>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ConfluencePageSearch.resultsTable = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.results.length > 0) {
    output.append('<table id="confluence-searchresult" class="aui"><thead><tr><th width="180px">', soy.$$escapeHtml("Title"), '</th><th width="550px">', soy.$$escapeHtml("Excerpt"), '</th></tr></thead><tbody>');
    var resultList44 = opt_data.results;
    var resultListLen44 = resultList44.length;
    for (var resultIndex44 = 0; resultIndex44 < resultListLen44; resultIndex44++) {
      var resultData44 = resultList44[resultIndex44];
      output.append('<tr title="', soy.$$escapeHtml(resultData44.title), '"><td class="title" data-url="', soy.$$escapeHtml(resultData44.url), '">', soy.$$escapeHtml(resultData44.title), '</td><td class="excerpt">', soy.$$escapeHtml(resultData44.excerpt), '</td></tr>');
    }
    output.append('</tbody></table>');
  } else {
    output.append('<div class="aui-message info"><span class="aui-icon icon-info"></span><p>', soy.$$escapeHtml("Search returned no results."), '</p></div>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ConfluencePageSearch.spaceOptions = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<option value="">', soy.$$escapeHtml("All Spaces"), '</option>');
  var spaceList64 = opt_data.spaces;
  var spaceListLen64 = spaceList64.length;
  for (var spaceIndex64 = 0; spaceIndex64 < spaceListLen64; spaceIndex64++) {
    var spaceData64 = spaceList64[spaceIndex64];
    output.append('<option value="', soy.$$escapeHtml(spaceData64.key), '">', soy.$$escapeHtml(spaceData64.name), '</option>');
  }
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.ConfluencePageSearch.allSpacesOption = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<option value="">', soy.$$escapeHtml("All Spaces"), '</option><option value="" disabled="disabled">', soy.$$escapeHtml("Loading..."), '</option>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.welcome.jira-welcome-plugin:whats-new-resources', location = 'templates/whats-new.soy' */
// This file was automatically generated from whats-new.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.WhatsNew == 'undefined') { JIRA.Templates.WhatsNew = {}; }


JIRA.Templates.WhatsNew.whatsNewDialogPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="whats-new-dialog-text"><div class="whats-new-throbber hidden"></div><div class="whats-new-timeout hidden"><div class="aui-message warning"><p class="title"><span class="aui-icon icon-warning"></span><strong>', soy.$$escapeHtml("Oops."), '</strong></p><p>', AJS.format("We\u2019re having trouble downloading the \x3ca target\x3d\x22_blank\x22 href\x3d\x22{0}\x22\x3eWhat\u2019s New content\x3c/a\x3e from the Atlassian website. This may be because you have a slow internet connection or that no internet connection is available.",opt_data.whatsNewFullLink), '</p></div></div></div><iframe id="whats-new-iframe" class="hidden" scrolling="no" frameborder="0" src="', soy.$$escapeHtml(opt_data.whatsNewHelpLink), '"></iframe>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.WhatsNew.whatsNewDialogTipPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="dialog-tip"><input id="dont-show-whats-new" type="checkbox" name="dontshow"', (opt_data.dontShowAgain) ? ' checked="checked"' : '', '><label for="dont-show-whats-new" type="checkbox"><span class="checkbox-label">', soy.$$escapeHtml("Don\u2019t show again"), '</span></label>', (! opt_data.isOnDemand) ? '<span>' + soy.$$escapeHtml("(Access from \u2018Profile\u2019 menu)") + '</span>' : '', '</div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.welcome.jira-welcome-plugin:whats-new-resources', location = 'js/whats-new.js' */
Raphael.spinner=function(J,F,H){var N=H||"#fff",M=F*13/60,Q=F*35/60,O=F,D=O+M,C=O+M,L=Raphael(J,O*2+M*2,O*2+M*2),K=[],E=[],S=2*Math.PI/12,I={stroke:N,"stroke-width":M,"stroke-linecap":"round"};
for(var P=0;
P<12;
P++){var G=S*P-Math.PI/2,B=Math.cos(G),A=Math.sin(G);
E[P]=P/12;
K[P]=L.path([["M",D+Q*B,C+Q*A],["L",D+O*B,C+O*A]]).attr(I)
}var R;
(function T(){E.unshift(E.pop());
for(var U=0;
U<12;
U++){K[U].attr("opacity",E[U])
}L.safari();
R=setTimeout(T,80)
})();
return function(){clearTimeout(R);
L.remove()
}
};
var dim=AJS.dim;
AJS.dim=function(){try{dim.apply(this,arguments)
}catch(A){}};
AJS.toInit(function(L){var I=L("#whats-new-menu-link"),E,C,A,M,H,G,K=function(P){var O=!L(this).attr("checked");
var N=contextPath+"/rest/whatsnew/1.0/show";
L.ajax({url:N,data:{},type:O?"POST":"DELETE",success:function(){AJS.log("whatsnew > toggleDontShow > isWelcomeDialogShownForUser set to: "+O)
}})
},D=function(){if(!C){return 
}G&&clearTimeout(G);
F();
AJS.setVisible(C,true)
},J=function(P){var O=new AJS.Dialog({width:855,height:545,id:"whats-new-dialog",onCancel:function(){O.hide().remove();
G&&clearTimeout(G)
}});
var S=AJS.Meta.get("whats-new-iframe-src-override");
if(typeof (S)=="undefined"||S===""){S=AJS.Meta.get("whatsnew-full-link")
}var R="What\u2019s New in JIRA {0}";
var Q=AJS.Meta.get("version-number").match(/^\d+\.\d+/);
var T=AJS.format(R,Q);
O.addHeader(T);
var N=JIRA.Templates.WhatsNew.whatsNewDialogPanel({whatsNewHelpLink:S,whatsNewFullLink:AJS.Meta.get("whatsnew-full-link")});
O.addPanel("default",N);
O.addCancel("\u5173\u95ED",function(){O.hide().remove();
G&&clearTimeout(G);
return false
});
A=O.popup.element;
if(AJS.Meta.get("remote-user")){O.page[O.curpage].buttonpanel.append(JIRA.Templates.WhatsNew.whatsNewDialogTipPanel({isOnDemand:AJS.DarkFeatures.isEnabled("com.atlassian.jira.config.CoreFeatures.ON_DEMAND"),dontShowAgain:(!P)}));
A.find("#dont-show-whats-new").change(K)
}C=A.find("iframe");
C.load(D);
M=A.find(".whats-new-timeout");
return O
},F=function(){if(H){H();
H=null
}E.addClass("hidden")
},B=function(){var N=contextPath+"/rest/whatsnew/1.0/show";
L.getJSON(N,function(O){J(O.isShownForUser).show();
E=A.find(".whats-new-throbber.hidden");
E.removeClass("hidden");
H=Raphael.spinner(E[0],80,"#666");
G=setTimeout(function(){C=null;
F();
AJS.setVisible(M,true)
},10000)
})
};
I.click(function(N){N.preventDefault();
B()
});
if(AJS.Meta.getBoolean("show-whats-new")){AJS.Popups.DisplayController.request({name:"jira-whats-new-dialog",weight:100,show:function(){B()
}})
}});
/* module-key = 'com.atlassian.jira.welcome.jira-welcome-plugin:welcome-screen-resources', location = 'templates/welcome.soy' */
// This file was automatically generated from welcome.soy.
// Please don't edit this file by hand.

if (typeof JIRA == 'undefined') { var JIRA = {}; }
if (typeof JIRA.Templates == 'undefined') { JIRA.Templates = {}; }
if (typeof JIRA.Templates.WelcomeScreen == 'undefined') { JIRA.Templates.WelcomeScreen = {}; }


JIRA.Templates.WelcomeScreen.welcomeScreenPanel = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-group"><div class="welcome-screen-splash aui-item"><h1><span class="assistive">JIRA</span></h1></div><div class="welcome-screen-content-container aui-item"><div class="welcome-screen-content">', (opt_data.theirName) ? '<h1>' + soy.$$escapeHtml(AJS.format("Welcome, {0}!",opt_data.theirName)) + '</h1>' : '<h1>' + soy.$$escapeHtml("Welcome!") + '</h1>', '<p>', soy.$$escapeHtml("To begin working with JIRA, you need to create a project."), '</p><ul class="welcome-screen-options aui-group"><li class="aui-item">');
  JIRA.Templates.WelcomeScreen.welcomeScreenAction({type: 'demoproject', href: '/secure/CreateDemoProject.jspa?atl_token=' + opt_data.atl_token, title: "Start with a demo project", description: "Get started with a pre-populated project to get an idea of what you can do in JIRA.", cssClass: ''}, output);
  output.append('</li><li class="aui-item">');
  JIRA.Templates.WelcomeScreen.welcomeScreenAction({type: 'blankproject', href: '/secure/admin/AddProject!default.jspa?nextAction=browseprojects', title: "Create a blank project", description: "Start with an empty project to begin managing your issues.", cssClass: 'add-project-trigger'}, output);
  output.append('</li></ul></div><div class="welcome-screen-alternate-options"><p>', AJS.format("{0}I\x27\x27ll skip this{1}, I know what I\x27\x27m doing.",opt_data.cancelLinkHtml,'</a>'), '</p></div></div></div>');
  return opt_sb ? '' : output.toString();
};


JIRA.Templates.WelcomeScreen.welcomeScreenAction = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class="welcome-screen-action ', soy.$$escapeHtml(opt_data.cssClass), '" data-type="', soy.$$escapeHtml(opt_data.type), '" href="', soy.$$escapeHtml(""), soy.$$escapeHtml(opt_data.href), '"><h3>', soy.$$escapeHtml(opt_data.title), '</h3>', (opt_data.description) ? '<p>' + soy.$$escapeHtml(opt_data.description) + '</p>' : '', '</a>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.welcome.jira-welcome-plugin:welcome-screen-resources', location = 'js/welcome.js' */
(function(D){var C=contextPath+"/rest/welcome/1.0/show/welcome",B=contextPath+"/rest/welcome/1.0/show/browseprojects",E="welcome-screen-cancel-trigger";
function A(){return JIRA.Templates.WelcomeScreen.welcomeScreenPanel({theirName:AJS.Meta.get("remote-user-fullname")||"",cancelLinkHtml:'<a class="'+E+'" href="'+contextPath+'/">',atl_token:atl_token()})
}JIRA.Dialogs.demoProject=new JIRA.FormDialog({id:"demo-project-dialog",trigger:"a.welcome-screen-action[data-type='demoproject']",stayVisibleOnRedirect:true,onContentRefresh:function(){jQuery(".overflow-ellipsis").textOverflow()
}});
D(document).bind("focusShifterTip.show",function(F){if(AJS.Meta.getBoolean("suppress-focus-shifter-tip")){F.preventDefault()
}});
AJS.toInit(function(J){var G;
var F=function(){var K=new AJS.Dialog({width:860,height:500,id:"welcome-dialog",onCancel:function(){}});
K.addPanel("default",A());
JIRA.bind("Dialog.beforeHide",I);
J("a",K.popup.element).click(function(L){JIRA.unbind("Dialog.beforeHide",I)
});
J("."+E,K.popup.element).click(H);
J(".welcome-screen-action",K.popup.element).click(function(){AJS.EventQueue&&AJS.EventQueue.push({name:"welcomescreen.action",properties:{type:this.getAttribute("data-type")}});
J.ajax({url:C,type:"DELETE",success:function(){AJS.log("welcome dialog > action clicked > don't show dialog anymore")
}});
K.hide().remove()
});
return K
},I=function(K){if(JIRA.Dialog&&JIRA.Dialog.current&&G&&JIRA.Dialog.current.$popup==G.popup.element){K.preventDefault()
}},H=function(K){K.preventDefault();
G.hide().remove();
AJS.EventQueue&&AJS.EventQueue.push({name:"welcomescreen.dismiss"});
J.ajax({url:C,type:"DELETE",success:function(){AJS.log("welcome dialog > don't show dialog anymore")
}})
};
if(AJS.Meta.getBoolean("show-welcome-screen")){}J(".browse-projects-info-dismiss").click(function(){AJS.EventQueue&&AJS.EventQueue.push({name:"browseprojectsinfo.dismisstext"});
J.ajax({url:B,type:"DELETE",success:function(){AJS.log("browse projects > dismiss clicked > don't show info panel anymore")
}});
J("#browse-projects-info").fadeOut()
});
AJS.bind("messageClose",function(L,K){if(K.attr("id")=="browse-projects-info"){AJS.EventQueue&&AJS.EventQueue.push({name:"browseprojectsinfo.closebutton"});
J.ajax({url:B,type:"DELETE",success:function(){AJS.log("browse projects > close button clicked > don't show info panel anymore")
}})
}})
})
})(AJS.$);
/* module-key = 'com.atlassian.auiplugin:aui-experimental-dropdown2', location = 'js/atlassian/dropdown2.js' */
(function(G){var E=G(document),J=(jQuery.browser.msie&&parseInt(jQuery.browser.version,10)==8);var C=null;var B=(function(){var N=false;function L(Q){if(!N&&Q.which===1){N=true;E.bind("mouseup mouseleave",M);G(this).trigger("aui-button-invoke")}}function M(){E.unbind("mouseup mouseleave",M);setTimeout(function(){N=false},0)}function P(){if(!N){G(this).trigger("aui-button-invoke")}}function O(Q){Q.preventDefault()}if(typeof document.addEventListener==="undefined"){return{click:P,"click selectstart":O,mousedown:function(S){L.call(this,S);var T=this;var R=document.activeElement;if(R!==null){R.attachEvent("onbeforedeactivate",Q);setTimeout(function(){R.detachEvent("onbeforedeactivate",Q)},0)}function Q(U){switch(U.toElement){case null:case T:case document.body:case document.documentElement:U.returnValue=false}}}}}return{click:P,"click mousedown":O,mousedown:L}})();var A={"aui-button-invoke":function(h,R){R=G.extend({selectFirst:true},R);var O=I(this);var N=G(this).addClass("active");var r=N.hasClass("aui-dropdown2-sub-trigger");var m=O.parent()[0];var p=O.next()[0];var d=G(this).attr("data-dropdown2-hide-location");if(d){var Z=document.getElementById(d);if(Z){m=G(Z);p=undefined}else{throw new Error("The specified data-dropdown2-hide-location id doesn't exist")}}var T=R.$menu||N.closest(".aui-dropdown2-trigger-group");if(r){var e=N.closest(".aui-dropdown2");O.addClass(e.attr("class")).addClass("aui-dropdown2-sub-menu")}var S={click:function(t){var s=G(this);if(!P(s)){return }if(!s.hasClass("interactive")){l()}if(V(s)){f(s,{selectFirst:false});t.preventDefault()}},mousemove:function(){var t=G(this);var s=U(t);if(s){f(t,{selectFirst:false})}}};var n={"click focusin mousedown":function(s){var t=s.target;if(!D(t,O[0])&&!D(t,N[0])){l()}},keydown:function(u){if(u.shiftKey&&u.keyCode==9){j(-1)}else{switch(u.keyCode){case 13:var t=Y();if(V(t)){f(t)}else{K(t[0])}break;case 27:a();break;case 37:var t=Y();if(V(t)){var s=I(t);if(s.is(":visible")){O.trigger("aui-dropdown2-step-out");return }}if(r){a()}else{q(-1)}break;case 38:j(-1);break;case 39:var t=Y();if(V(t)){f(t)}else{q(1)}break;case 40:j(1);break;case 9:j(1);break;default:return }}u.preventDefault()}};function c(s,t){s.each(function(){var u=G(this);u.attr("role",t);if(u.hasClass("checked")){u.attr("aria-checked","true");if(t=="radio"){u.closest("ul").attr("role","radiogroup")}}else{u.attr("aria-checked","false")}})}N.attr("aria-controls",N.attr("aria-owns"));if(J){O.removeClass("aui-dropdown2-tailed")}O.find(".disabled").attr("aria-disabled","true");O.find("li.hidden > a").addClass("disabled").attr("aria-disabled","true");c(O.find(".aui-dropdown2-checkbox"),"checkbox");c(O.find(".aui-dropdown2-radio"),"radio");function Q(){var AB=N.offset();var AF=N.outerWidth();var AE=O.outerWidth();var AA=G("body").outerWidth(true);var t=Math.max(parseInt(O.css("min-width"),10),AF);var u=N.data("container")||false;var AD="left";if(J){var v=parseInt(O.css("border-left-width"),10)+parseInt(O.css("border-right-width"),10);AE=AE-v;t=t-v}if(!r){O.css("min-width",t+"px")}var w=AB.left,AC=AB.top+N.outerHeight();if(r){var y=3;w=AB.left+e.outerWidth()-y;AC=AB.top}if(AA<w+AE&&AE<=w+AF){w=AB.left+AF-AE;if(r){w=AB.left-AE}AD="right"}if(u){var s=N.closest(u),z=N.offset().left+N.outerWidth(),x=z+AE;if(t>=AE){AE=t}if(x>z){w=z-AE;AD="right"}if(J){w-=v}}O.attr({"data-dropdown2-alignment":AD,"aria-hidden":"false"}).css({display:"block",left:w+"px",top:AC+"px"});O.appendTo(document.body)}Q();if(N.hasClass("toolbar-trigger")){O.addClass("aui-dropdown2-in-toolbar")}if(N.parent().hasClass("aui-buttons")){O.addClass("aui-dropdown2-in-buttons")}if(N.parents().hasClass("aui-header")){O.addClass("aui-dropdown2-in-header")}O.trigger("aui-dropdown2-show",R);if(R.selectFirst){M()}i("on");function a(){L();i("off");setTimeout(function(){O.css("display","none").css("min-width","").insertAfter(N).attr("aria-hidden","true");if(!r){N.removeClass("active")}Y().removeClass("active");O.removeClass("aui-dropdown2-in-toolbar");O.removeClass("aui-dropdown2-in-buttons");if(p){O.insertBefore(p)}else{O.appendTo(m)}O.trigger("aui-dropdown2-hide")},0)}function l(){a();if(r){e.trigger("aui-dropdown2-hide-all")}}function g(s){if(r&&s.target===e[0]){a()}}function P(s){return !s.is(".disabled, [aria-disabled=true]")}function V(s){return s.hasClass("aui-dropdown2-sub-trigger")}function f(s,t){if(!V(s)){return }t=G.extend({},t,{$menu:T});var u=I(s);if(u.is(":visible")){u.trigger("aui-dropdown2-select-first")}else{s.trigger("aui-button-invoke",t)}}function Y(){return O.find("a.active")}var W=null;function U(s){if(W&&W[0]===s[0]){return false}W=s;Y().removeClass("active");if(P(s)){s.addClass("active")}O.trigger("aui-dropdown2-item-selected");X();return true}function M(){U(O.find("a:not(.disabled)").first())}function j(t){var s=O.find("> ul > li > a, > .aui-dropdown2-section > ul > li > a").not(".disabled");U(k(s,t,true))}function b(s){if(s.length>0){l();s.trigger("aui-button-invoke")}}function q(s){b(k(T.find(".aui-dropdown2-trigger").not(".disabled, [aria-disabled=true], .aui-dropdown2-sub-trigger"),s,false))}function k(u,v,t){var s=u.index(u.filter(".active"));s+=(s<0&&v<0)?1:0;s+=v;if(t){s%=u.length}else{if(s<0){s=u.length}}return u.eq(s)}function o(){b(G(this))}function L(){if(C===n){E.unbind(n);C=null}}function X(){if(C===n){return }E.unbind(C);E.bind(n);C=n}function i(t){var u="bind";var s="delegate";if(t!=="on"){u="unbind";s="undelegate"}if(!r){T[s](".aui-dropdown2-trigger:not(.active)","mousemove",o);N[u]("aui-button-invoke",a)}else{e[u]("aui-dropdown2-hide aui-dropdown2-item-selected aui-dropdown2-step-out",g)}O[u]("aui-dropdown2-hide-all",l);O[s]("a",S);O[u]("aui-dropdown2-hide",X);O[u]("aui-dropdown2-select-first",M)}},mousedown:function(L){if(L.which===1){G(this).bind(F)}}};var F={mouseleave:function(){E.bind(H)},"mouseup mouseleave":function(){G(this).unbind(F)}};var H={mouseup:function(L){var M=G(L.target).closest(".aui-dropdown2 a, .aui-dropdown2-trigger")[0];if(M){setTimeout(function(){K(M)},0)}},"mouseup mouseleave":function(){G(this).unbind(H)}};function K(L){if(L.click){L.click()}else{var M=document.createEvent("MouseEvents");M.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);L.dispatchEvent(M)}}function D(M,L){return(M===L)||G.contains(L,M)}function I(N){if(!(N instanceof jQuery)){N=G(N)}var O=N.attr("aria-owns"),L=N.attr("aria-haspopup"),M=document.getElementById(O);if(M){return G(M)}else{if(!O){throw new Error("Dropdown 2 trigger required attribute not set: aria-owns")}if(!L){throw new Error("Dropdown 2 trigger required attribute not set: aria-haspopup")}if(!M){throw new Error("Dropdown 2 trigger aria-owns attr set to nonexistent id: "+O)}throw new Error("Dropdown 2 trigger unknown error. I don't know what you did, but there's smoke everywhere. Consult the documentation.")}}E.delegate(".aui-dropdown2-trigger",B);E.delegate(".aui-dropdown2-trigger:not(.active):not([aria-disabled=true]),.aui-dropdown2-sub-trigger:not([aria-disabled=true])",A);E.delegate(".aui-dropdown2-checkbox:not(.disabled)","click",function(){var L=G(this);if(L.hasClass("checked")){L.removeClass("checked").attr("aria-checked","false");L.trigger("aui-dropdown2-item-uncheck")}else{L.addClass("checked").attr("aria-checked","true");L.trigger("aui-dropdown2-item-check")}});E.delegate(".aui-dropdown2-radio:not(.checked):not(.disabled)","click",function(){var L=G(this);var M=L.closest("ul").find(".checked");M.removeClass("checked").attr("aria-checked","false").trigger("aui-dropdown2-item-uncheck");L.addClass("checked").attr("aria-checked","true").trigger("aui-dropdown2-item-check")});E.delegate(".aui-dropdown2 a.disabled","click",function(L){L.preventDefault()})})(jQuery);
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.soy' */
// This file was automatically generated from appswitcher.soy.
// Please don't edit this file by hand.

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher == 'undefined') { navlinks.templates.appswitcher = {}; }


navlinks.templates.appswitcher.linkSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.list.length > 0) {
    output.append('<div class="aui-nav-heading sidebar-section-header">', soy.$$escapeHtml(opt_data.title), '</div><ul class="aui-nav nav-links">');
    var linkList8 = opt_data.list;
    var linkListLen8 = linkList8.length;
    for (var linkIndex8 = 0; linkIndex8 < linkListLen8; linkIndex8++) {
      var linkData8 = linkList8[linkIndex8];
      navlinks.templates.appswitcher.applicationsItem(linkData8, output);
    }
    output.append('</ul>');
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.applicationsItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="nav-link"><a href="', soy.$$escapeHtml(opt_data.link), '" class="interactive', (opt_data.self) ? ' checked' : '', '" title="', soy.$$escapeHtml(opt_data.link), '"><span class="nav-link-label">', soy.$$escapeHtml(opt_data.label), '</span></a></li>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.shortcutsItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="nav-link"><a href="', soy.$$escapeHtml(opt_data.link), '" class="interactive', (opt_data.self) ? ' checked' : '', '" title="', soy.$$escapeHtml(opt_data.link), '"><span class="nav-link-label">', soy.$$escapeHtml(opt_data.label), '</span>', (opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '', '</a></li>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.error = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="app-switcher-error">', "Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.", '</div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.sidebarContents = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="aui-page-panel-nav"><nav class="aui-navgroup aui-navgroup-vertical"><div class="app-switcher-section app-switcher-applications"><div class="aui-nav-heading">', soy.$$escapeHtml("Application Links"), '</div><div class="app-switcher-loading">', "Loading\x26hellip;", '</div></div><div class="app-switcher-section app-switcher-shortcuts"><div class="aui-nav-heading">', soy.$$escapeHtml("Shortcuts"), '</div><div class="app-switcher-loading">', "Loading\x26hellip;", '</div></div></nav></div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.trigger = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">', soy.$$escapeHtml("Linked Applications"), '</span>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.projectHeaderSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="app-switcher-title">');
  aui.avatar.avatar({size: 'large', avatarImageUrl: opt_data.avatarUrl, isProject: true, title: opt_data.name}, output);
  output.append('<div class="sidebar-project-name">', soy.$$escapeHtml(opt_data.name), '</div></div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.cogDropdown = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  var dropdownList__soy74 = new soy.StringBuilder();
  navlinks.templates.appswitcher.dropdownList({list: opt_data.links}, dropdownList__soy74);
  dropdownList__soy74 = dropdownList__soy74.toString();
  aui.dropdown2.dropdown2({menu: {'id': opt_data.id, 'content': dropdownList__soy74, 'extraClasses': 'aui-style-default sidebar-customize-section'}, trigger: {'showIcon': false, 'content': '<span class="aui-icon aui-icon-small aui-iconfont-configure"></span>', 'container': '#app-switcher'}}, output);
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.dropdownList = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<ul class="sidebar-admin-links">');
  var linkList82 = opt_data.list;
  var linkListLen82 = linkList82.length;
  for (var linkIndex82 = 0; linkIndex82 < linkListLen82; linkIndex82++) {
    var linkData82 = linkList82[linkIndex82];
    output.append('<li class="nav-link"><a href="', soy.$$escapeHtml(linkData82.href), '" title="', soy.$$escapeHtml(linkData82.title), '"><span class="nav-link-label">', soy.$$escapeHtml(linkData82.label), '</span></a></li>');
  }
  output.append('</ul>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.switcher = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (true) {
    if (AJS.DarkFeatures.isEnabled('rotp.sidebar')) {
      var sidebarContents__soy97 = new soy.StringBuilder();
      navlinks.templates.appswitcher.sidebarContents(null, sidebarContents__soy97);
      sidebarContents__soy97 = sidebarContents__soy97.toString();
      var triggerContent__soy99 = new soy.StringBuilder();
      navlinks.templates.appswitcher.trigger(null, triggerContent__soy99);
      triggerContent__soy99 = triggerContent__soy99.toString();
      navlinks.templates.appswitcher.sidebar({sidebar: {'id': 'app-switcher', 'content': sidebarContents__soy97}, trigger: {'showIcon': false, 'content': triggerContent__soy99}}, output);
      output.append('<script>\n                (function (NL) {\n                    var initialise = function () {\n                        new NL.SideBar({\n                            sidebarContents: \'#app-switcher\'\n                        });\n                    };\n                    if (NL.SideBar) {\n                        initialise();\n                    } else {\n                        NL.onInit = initialise;\n                    }\n                }(window.NL = (window.NL || {})));\n                window.NL.isUserAdmin = ', soy.$$escapeHtml(false), '<\/script>');
    } else {
      navlinks.templates.appswitcher_old.switcher(null, output);
    }
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher.sidebar = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<a class="sidebar-trigger app-switcher-trigger" aria-owns="', soy.$$escapeHtml(opt_data.sidebar.id), '" aria-haspopup="true">', opt_data.trigger.content, '</a><div id=', soy.$$escapeHtml(opt_data.sidebar.id), ' class="app-switcher-sidebar aui-style-default sidebar-offscreen">', opt_data.sidebar.content, '</div>');
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher.js' */
(function(c,a){a.SideBar=function(d){var e=this;this.$sidebar=null;d=c.extend({sidebarContents:null},d);this.getLinks=function(){return c.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateAppLinks).fail(this.showAppSwitcherError)};this.populateProjectHeader=function(g,f){e.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").after(navlinks.templates.appswitcher.projectHeaderSection({avatarUrl:f,name:g}))};this.getProjectData=function(){var f=c(".project-shortcut-dialog-trigger"),g=f.data("key"),h=f.data("entity-type");if(f.size()==0||!g||!h){c(".app-switcher-shortcuts").remove();return}var j,i;i=c.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/local/"+g,cache:false,data:{entityType:h},dataType:"json"});j=c.ajax({url:AJS.contextPath()+"/rest/project-shortcuts/1.0/remote/"+g,cache:false,data:{entityType:h},dataType:"json"});c.when(i,j).then(function(l,k){e.updateProjectShortcuts(l,k,{key:g,entityType:h,name:f.data("name"),avatarUrl:f.find("img").prop("src")})},e.showProjectShortcutsError)};this.getSidebar=function(){if(!this.$sidebar){this.$sidebar=c(d.sidebarContents)}return this.$sidebar};this.addApplicationsCog=function(){c(".app-switcher-applications .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-applications-admin-dropdown",links:[{href:AJS.contextPath()+"/plugins/servlet/customize-application-navigator",label:"Customize navigator",title:"Add new entries, hide existing or restrict who sees what"},{href:AJS.contextPath()+"/plugins/servlet/applinks/listApplicationLinks",label:"Manage application links",title:"Link to more Atlassian applications"}]}))};this.addProjectShortcutsCog=function(f,h){var g=[{href:AJS.contextPath()+"/plugins/servlet/custom-content-links-admin?entityKey="+f,label:"Customize shortcuts",title:""}];if(e.entityMappings[h]){g.push({href:e.generateEntityLinksUrl(f,e.entityMappings[h]),label:"Manage product links",title:""})}e.getSidebar().find(".app-switcher-shortcuts .aui-nav-heading").before(navlinks.templates.appswitcher.cogDropdown({id:"sidebar-project-shortcuts-admin-dropdown",links:g}))};this.updateAppLinks=function(f){c(function(){e.getSidebar().find(".app-switcher-applications").html(navlinks.templates.appswitcher.linkSection({title:"Application Links",list:f}));if(a.isUserAdmin){e.addApplicationsCog()}e.bindAnalyticsHandlers(e.getSidebar(),f)})};this.updateProjectShortcuts=function(i,g,h){var j=i[0].shortcuts,f=g[0].shortcuts;e.getSidebar().find(".app-switcher-shortcuts").html(navlinks.templates.appswitcher.linkSection({title:"Shortcuts",list:j.concat(f)}));if(a.isUserAdmin){e.addProjectShortcutsCog(h.key,h.entityType)}e.populateProjectHeader(h.name,h.avatarUrl);e.bindAnalyticsHandlers(e.getSidebar(),data)};this.entityMappings={"confluence.space":"com.atlassian.applinks.api.application.confluence.ConfluenceSpaceEntityType","jira.project":"com.atlassian.applinks.api.application.jira.JiraProjectEntityType","bamboo.project":"com.atlassian.applinks.api.application.bamboo.BambooProjectEntityType","stash.project":"com.atlassian.applinks.api.application.stash.StashProjectEntityType"};this.generateEntityLinksUrl=function(f,g){if(g===e.entityMappings["confluence.space"]){return AJS.contextPath()+"/spaces/listentitylinks.action?typeId="+g+"&key="+f}else{return AJS.contextPath()+"/plugins/servlet/applinks/listEntityLinks/"+g+"/"+f}};this.showAppSwitcherError=function(){c(function(){var f=e.getSidebar();f.find(".app-switcher-applications .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());f.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",c.proxy(e.retryLoading,e))})};this.showProjectShortcutsError=function(){c(function(){var f=e.getSidebar();f.find(".app-switcher-shortcuts .app-switcher-loading").replaceWith(navlinks.templates.appswitcher.error());f.off(".appswitcher").on("click.appswitcher",".app-switcher-retry",c.proxy(e.retryLoading,e))})};this.retryLoading=function(f){this.getSidebar().html(navlinks.templates.appswitcher.sidebarContents());this.getLinks();this.getProjectData();f&&f.stopPropagation()};this.trackEvent=function(h,f,g){try{a.trackEvent("appswitcher-new",h,f,g)}catch(i){AJS.log("failed to track analytics event, category: appswitcher, action: "+h+", label: "+f+", value: "+g)}};this.bindAnalyticsHandlers=function(f,g){};this.getLinks();c(this.getProjectData);this.toggleSidebar=function(h){var i=e.getSidebar(),g=c("body"),f=c(window.document);if(!g.hasClass("app-switcher-open")){var k=c("#header");i.css("left",-i.width());i.parent("body").length||i.appendTo("body");b({data:i});i.animate({left:0},300);function j(l){var n=l.target&&c(l.target),m=l.keyCode;if(l.originalEvent===h.originalEvent){return}if(n&&!m&&!(n.closest(i).length||n.closest(k).length)&&h.which==1&&!(l.shiftKey||l.ctrlKey||l.metaKey)){e.toggleSidebar()}else{if(m===27){e.toggleSidebar()}}}f.on("click.appSwitcher",j);f.on("keydown.appSwitcher",j);f.on("scroll.appSwitcher",i,b)}else{f.off(".appSwitcher")}g.toggleClass("app-switcher-open")};c("#header").on("click",".app-switcher-trigger",this.toggleSidebar)};function b(f){var d=c(document).scrollTop(),g=c("#header"),e=(g.height()+g.offset().top)-d;if(e>=0){f.data.css({top:e,position:"fixed"})}else{f.data.css({top:0,left:0,position:"fixed"})}}if(a.onInit){a.onInit()}}(jQuery,window.NL=(window.NL||{})));
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.js' */
(function(b,a){a.AppSwitcher=function(c){var d=AJS.contextPath()+"/plugins/servlet/customize-application-navigator";var e=this;this.$dropdown=null;c=b.extend({dropdownContents:null},c);this.getLinks=function(){return b.ajax({url:AJS.contextPath()+"/rest/menu/latest/appswitcher",cache:false,dataType:"json"}).done(this.updateDropdown).fail(this.showError)};this.getDropdown=function(){if(!this.$dropdown){this.$dropdown=b(c.dropdownContents)}return this.$dropdown};this.updateDropdown=function(f){b(function(){e.getDropdown().html(navlinks.templates.appswitcher_old.applications({apps:f,showAdminLink:a.isUserAdmin,adminLink:d}));e.bindAnalyticsHandlers(e.getDropdown(),f)})};this.showError=function(){b(function(){e.getDropdown().html(navlinks.templates.appswitcher_old.error()).off(".appswitcher").on("click.appswitcher",".app-switcher-retry",b.proxy(e.retryLoading,e))})};this.retryLoading=function(f){this.getDropdown().html(navlinks.templates.appswitcher_old.loading());this.getLinks();f&&f.stopPropagation()};this.trackEvent=function(h,f,g){try{a.trackEvent("appswitcher-new",h,f,g)}catch(i){AJS.log("failed to track analytics event, category: appswitcher, action: "+h+", label: "+f+", value: "+g)}};this.bindAnalyticsHandlers=function(i,h){function g(){var l=0;for(var j in h){var k=h[j];if(k.custom){l+=1}}return l}var f=g();i.on({"aui-dropdown2-show":function(j){e.trackEvent("show",a.getCurrentApplication(),h.length)},"aui-dropdown2-hide":function(j){e.trackEvent("hide",a.getCurrentApplication(),h.length)}});i.off(".analytics").on("click.analytics","a",function(j){e.trackEvent("appSelected",b(this).attr("href"),h.length)})};this.getLinks()};if(a.onInit){a.onInit()}}(jQuery,window.NL=(window.NL||{})));
/* module-key = 'com.atlassian.plugins.atlassian-nav-links-plugin:rotp-menu', location = 'appswitcher/appswitcher_old.soy' */
// This file was automatically generated from appswitcher_old.soy.
// Please don't edit this file by hand.

if (typeof navlinks == 'undefined') { var navlinks = {}; }
if (typeof navlinks.templates == 'undefined') { navlinks.templates = {}; }
if (typeof navlinks.templates.appswitcher_old == 'undefined') { navlinks.templates.appswitcher_old = {}; }


navlinks.templates.appswitcher_old.applications = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.apps, listClass: 'nav-links', showDescription: opt_data.showDescription}, output);
  if (opt_data.custom) {
    navlinks.templates.appswitcher_old.applicationsSection({list: opt_data.custom, showDescription: opt_data.showDescription}, output);
  }
  if (opt_data.showAdminLink) {
    navlinks.templates.appswitcher_old.adminSection(opt_data, output);
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.applicationsSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (opt_data.list.length > 0) {
    var param19 = new soy.StringBuilder('<ul', (opt_data.listClass) ? ' class="' + soy.$$escapeHtml(opt_data.listClass) + '"' : '', '>');
    var linkList27 = opt_data.list;
    var linkListLen27 = linkList27.length;
    for (var linkIndex27 = 0; linkIndex27 < linkListLen27; linkIndex27++) {
      var linkData27 = linkList27[linkIndex27];
      navlinks.templates.appswitcher_old.applicationsItem(soy.$$augmentData(linkData27, {showDescription: opt_data.showDescription}), param19);
    }
    param19.append('</ul>');
    aui.dropdown2.section({content: param19.toString()}, output);
  }
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.applicationsItem = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<li class="nav-link', (opt_data.self) ? ' nav-link-local' : '', '"><a href="', soy.$$escapeHtml(opt_data.link), '" class="aui-dropdown2-radio interactive', (opt_data.self) ? ' checked' : '', '" title="', soy.$$escapeHtml(opt_data.link), '"><span class="nav-link-label">', soy.$$escapeHtml(opt_data.label), '</span>', (opt_data.showDescription && opt_data.description) ? '<span class="nav-link-description">' + soy.$$escapeHtml(opt_data.description) + '</span>' : '', '</a></li>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.adminSection = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  aui.dropdown2.section({content: '<ul class="nav-links"><li><a class="nav-link-edit-wrapper" href="' + soy.$$escapeHtml(opt_data.adminLink) + '"><span class="nav-link-edit">' + "Configure\x26hellip;" + '</span></a></li></ul>'}, output);
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.error = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="app-switcher-error">', "Something went wrong, please \x3cspan class\x3d\x22app-switcher-retry\x22\x3etry again\x3c/span\x3e.", '</div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.loading = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<div class="app-switcher-loading">', "Loading\x26hellip;", '</div>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.trigger = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<span class="aui-icon aui-icon-small aui-iconfont-appswitcher">', soy.$$escapeHtml("Linked Applications"), '</span>');
  return opt_sb ? '' : output.toString();
};


navlinks.templates.appswitcher_old.switcher = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  if (true) {
    var loadingContent__soy81 = new soy.StringBuilder();
    navlinks.templates.appswitcher_old.loading(null, loadingContent__soy81);
    loadingContent__soy81 = loadingContent__soy81.toString();
    var triggerContent__soy83 = new soy.StringBuilder();
    navlinks.templates.appswitcher_old.trigger(null, triggerContent__soy83);
    triggerContent__soy83 = triggerContent__soy83.toString();
    aui.dropdown2.dropdown2({menu: {'id': 'app-switcher', 'content': loadingContent__soy81, 'extraClasses': 'aui-style-default'}, trigger: {'showIcon': false, 'content': triggerContent__soy83, 'extraClasses': 'app-switcher-trigger'}}, output);
    output.append('<script>\n            (function (NL) {\n                var initialise = function () {\n                    // For some milestones of AUI, the atlassian soy namespace was renamed to aui. Handle that here by ensuring that window.atlassian is defined.\n                    window.atlassian = window.atlassian || window.aui;\n                    new NL.AppSwitcher({\n                        dropdownContents: \'#app-switcher\'\n                    });\n                };\n                if (NL.AppSwitcher) {\n                    initialise();\n                } else {\n                    NL.onInit = initialise;\n                }\n            }(window.NL = (window.NL || {})));\n            window.NL.isUserAdmin = ', soy.$$escapeHtml(false), '<\/script>');
  }
  return opt_sb ? '' : output.toString();
};

/* module-key = 'com.atlassian.jira.jira-header-plugin:jira-header', location = 'js/init-dropdown2.js' */
/**
 * Binds all the header implementations of Dropdown2. Including global nav and user profile.
 */
JIRA.Dropdowns.bindHeaderDropdown2 = function () {
    AJS.$(".jira-ajax-menu").each(function() {
        var $ddtrigger = AJS.$(this);
        var $dd = AJS.$("#" + $ddtrigger.attr("aria-owns"));
        var $ajaxkey = $dd.data("aui-dropdown2-ajax-key");

        if ($ajaxkey) {
            $dd.bind("aui-dropdown2-show", function(event, options) {
                $dd.empty();
                $dd.addClass("aui-dropdown2-loading");
                JIRA.SmartAjax.makeRequest({
                    url: contextPath + "/rest/api/1.0/menus/" + $ajaxkey,
                    data: {
                        inAdminMode: AJS.Meta.getBoolean("in-admin-mode")
                    },
                    dataType: "json",
                    cache: false,
                    success: function (data) {
                        $dd.removeClass("aui-dropdown2-loading");
                        $dd.html(JIRA.FRAGMENTS.dropdown2Fragment(data));

                        if (options && options.selectFirst) {
                            $dd.find("a:not(.disabled)").filter(":first").addClass("active")
                        }                    }
                });
            });
        }
    });
};

AJS.$(function(){
    JIRA.Dropdowns.bindHeaderDropdown2();
});

JIRA.FRAGMENTS.dropdown2Fragment = function (response) {
    var container = AJS.$("<div />");
    AJS.$(response.sections).each(function()
    {
        var section = AJS.$('<div class="aui-dropdown2-section" />');
        var list = AJS.$("<ul class='aui-list-truncate' />");
        var listItem;
        var listItemLink;

        if (this.id)
        {
            list.attr("id", this.id);
        }
        if (this.style)
        {
            list.addClass(this.style);
        }
        if (this.items  && this.items.length != 0)
        {
            if (this.label)
            {
                section.append(AJS.$("<strong/>").text(this.label));
            }
            AJS.$(this.items).each(function()
            {
                listItem = AJS.$("<li />");
                if (this.id)
                {
                    listItem.attr("id", this.id);
                }
                if (this.style)
                {
                    listItem.addClass(this.style);
                }
                listItemLink = AJS.$("<a />").attr("href", this.url);

                _.each(this.parameters, function (value, key) {
                    listItemLink.attr(key, value);
                });

                if (this.id)
                {
                    listItemLink.attr("id", this.id + "_lnk");
                }
                if (this.title)
                {
                    listItemLink.attr("title", this.title);
                }
                if (this.label)
                {
                    listItemLink.text(this.label);
                }
                if (this.iconUrl)
                {
                    listItemLink.addClass("aui-icon-container").prepend('<img class="icon" src="' + this.iconUrl + '"></span>');
                }
                listItem.append(listItemLink);
                list.append(listItem);

            });
            section.append(list);
            container.append(section);
        }
    });
    return container.children();
};


/* module-key = 'com.atlassian.jira.jira-header-plugin:jira-header', location = 'js/aui-header-responsive.js' */
(function(){
    var headerZeroWidth = "<style>.aui-header-primary .aui-nav{width: 0px;}</style>";
    var head = AJS.$('head');
    if (head.length) {
        head.append(headerZeroWidth);
    }
})();
AJS.$(function($){
    if (!$('.aui-header').length) {
        return;
    }
    $('.aui-header').attr('data-aui-responsive', 'true');
    var menuItems = [];
    var availableWidth = 0;
    var totalWidth = 0;
    var moreMenu;
    var previousIndex;
    var secondaryNav = $(".aui-header-secondary .aui-nav");
    var applicationLogo = $("#logo");
    var moreMenuWidth = 0;
    //to cache the selector and give .find convenience
    var inHeader = (function(){
        var header = $(".aui-header-primary");
        return function(selector){
            return header.find(selector);
        }
    })();

    var primaryButtonsWidth = 0;
    inHeader(".aui-button-primary").each(function(index, element){
        primaryButtonsWidth += $(element).parent().outerWidth(true);
    });

    //remember the widths of all the menu items
    inHeader(".aui-nav > li > a:not(.aui-button)").each(function(index, element){
        var $element = $(element).parent();
        var itemWidth = $element.outerWidth(true);
        menuItems.push({itemElement: $element, itemWidth: itemWidth});
        totalWidth += itemWidth;
    });

    previousIndex = menuItems.length;

    // attach resize handler
    $(window).resize(function(){
        previousIndex = constructResponsiveDropdown();
    });
    //So that the header logo doesn't mess things up. (size is unknown before the image loads)
    applicationLogo.find('img').load(function(){
        previousIndex = constructResponsiveDropdown();
    });

    //create the elements for the show more menu

    createResponsiveDropdownTrigger();

    //construct the show more dropdown
    previousIndex = constructResponsiveDropdown();

    //show the aui nav (hidden via css on load)
    inHeader('.aui-nav').css("width", "auto");

    //HELPER FUNCTIONS
    //function that constructs the show more dropdown menu content
    function constructResponsiveDropdown(){
        var remaining;
        calculateAvailableWidth();
        if (availableWidth > totalWidth){
            showAll();
        } else {
            moreMenu.show();
            remaining = availableWidth - moreMenuWidth;

            // loop through menu items until no more remaining space
            //i represents the index of the last item in the header
            for (var i = 0; remaining >= 0; i++) {
                remaining -= menuItems[i].itemWidth;
            }
            //Subtract one for fencepost
            i = i-1;
            //move everything after the last index into the show more dropdown
            moveToResponsiveDropdown(i);

            //move everything between the previous index and the current index out of the dropdown
            moveOutOfResponsiveDropdown(i, previousIndex);

            //return the index of the last last item in the header so we can remember it for next time
            return i;
        }
    }

    //calculate widths based on the current state of the page
    function calculateAvailableWidth(){
        var secondaryNavLeft = secondaryNav.position().left;
        var primaryNavRight = applicationLogo.position().left + applicationLogo.outerWidth(true) + primaryButtonsWidth;

        availableWidth = secondaryNavLeft - primaryNavRight;
    }

    //creates the trigger and content elements for the show more dropdown
    function createResponsiveDropdownTrigger(){
        //create the trigger
        var $responsiveTrigger = $("<li>" + aui.dropdown2.trigger({
            menu: {id: "aui-responsive-header-dropdown-content"},
            text: "More",
            extraAttributes: {
                href: "#"
            },
            id: "aui-responsive-header-dropdown-trigger"
        }) + "</li>");

        //create the dropdown content container
        $responsiveTrigger.append(aui.dropdown2.contents({
            id: "aui-responsive-header-dropdown-content",
            extraClasses: "aui-style-default",
            content: aui.dropdown2.section({content: "<ul id='aui-responsive-header-dropdown-list'></ul>"})
        }));

        $responsiveTrigger.insertBefore(inHeader(".aui-nav > li > a.aui-button")
                .first().parent());
        moreMenu = $responsiveTrigger;
        moreMenuWidth = moreMenu.outerWidth(true);
    }

    //function that handles moving items out of the show more menu into the app header
    function moveOutOfResponsiveDropdown (index, previousIndex) {
        if (index < 0 || previousIndex < 0 || index === previousIndex)
            return;

        var $responsiveTrigger = $("#aui-responsive-header-dropdown-trigger");
        var $responsiveTriggerItem = $responsiveTrigger.parent();
        var current, currentItem;

        if($responsiveTrigger.hasClass("active")) {
            $responsiveTrigger.trigger("aui-button-invoke");
        }
        while (index > previousIndex) {
            current = menuItems[previousIndex]
            //Make sure things exist before accessing them.
            if (current && current.itemElement) {
                currentItem = current.itemElement;
                var $menuItemElements = inHeader(".aui-nav > li > a:not(.aui-button):not(#aui-responsive-header-dropdown-trigger)");
                if($menuItemElements.length != 0){
                    currentItem.insertAfter($menuItemElements.last().parent());
                } else {
                    currentItem.insertBefore($responsiveTriggerItem);
                }
                currentItem.children("a")
                        .removeClass("aui-dropdown2-sub-trigger active")
                        .removeClass("active");
                previousIndex = previousIndex+1;
            }
        }
    }

    //function that handles moving itesm into the show more menu
    function moveToResponsiveDropdown(index) {
        if (index < 0)
            return;
        var dropdownContainer = $("#aui-responsive-header-dropdown-list");

        for(var i = index; i < menuItems.length; i++) {
            menuItems[i].itemElement.appendTo(dropdownContainer);
            var $itemTrigger = menuItems[i].itemElement.children("a");
            if($itemTrigger.hasClass("aui-dropdown2-trigger")){
                $itemTrigger.addClass("aui-dropdown2-sub-trigger");
            }
        }
    }

    //function that handles show everything
    function showAll() {
        moreMenu.hide();
        moveOutOfResponsiveDropdown(menuItems.length, previousIndex)
    }
});
/* module-key = 'com.atlassian.plugins.helptips.jira-help-tips:common', location = 'js/HelpTip.js' */
(function(F){function B(){return false
}function D(){return true
}var L=0,G=new Date().getTime();
var K=AJS.contextPath()+"/rest/helptips/1.0/tips";
function H(N){N=""+(N||"");
return N.replace(/\./g,"-")
}function J(O,N){if(AJS.EventQueue&&N&&N.attributes.id){var Q={};
var P=H(N.attributes.id);
Q.name="helptips."+P+"."+O;
Q.properties={};
AJS.EventQueue.push(Q)
}}function C(){return"c"+G+(L++)
}var A={dismissedTipIds:[],loaded:F.Deferred(),url:function(){return K
},sync:function(O,N){O||(O="get");
N||(N=null);
return F.ajax(this.url(),{type:O,context:this,dataType:"json",contentType:"application/json",data:N&&JSON.stringify(N),processData:false}).promise()
},fetch:function(){var N=this.sync();
N.done(function(O){F.merge(this.dismissedTipIds,O);
this.loaded.resolve()
});
return N.promise()
},show:function(N){this.loaded.done(N)
},dismiss:function(N){var O=N.attributes.id;
if(!O){N._dismissed=true
}else{this.dismissedTipIds.push(O);
this.sync("post",{id:O})
}},undismiss:function(N){var O=N.attributes.id;
if(!O){N._dismissed=false
}else{this.dismissedTipIds.splice(F.inArray(O,this.dismissedTipIds),1);
this.sync("delete",{id:O})
}},isDismissed:function(N){var O=N.attributes.id;
return(O)?F.inArray(O,this.dismissedTipIds)>=0:N._dismissed
}};
var E=AJS.HelpTip=function(N){var O;
this.attributes=F.extend({},N);
this.attributes.id||(this.attributes.id=false);
if(this.attributes.body){this.attributes.bodyHtml=this.attributes.body;
delete this.attributes.body
}this.cid=C();
O=this.attributes.anchor;
delete this.attributes.anchor;
this.view=(O)?new I(this,O):new M(this);
this.view.$el.addClass("aui-help-tip")
};
AJS.HelpTip.Manager=A;
F.extend(E.prototype,{show:function(){var N=this;
AJS.HelpTip.Manager.show(function(){if(!N.isDismissed()){if(AJS.Popups&&AJS.Popups.DisplayController){AJS.Popups.DisplayController.request({name:N.id,weight:1000,show:function(){N.view.show()
}})
}else{N.view.show()
}J("shown",N)
}})
},dismiss:function(){var N=H(arguments[0]||"programmatically");
this.view.dismiss();
if(!this.isDismissed()){AJS.HelpTip.Manager.dismiss(this);
J("dismissed."+N,this)
}},isVisible:function(){return this.view.$el.is(":visible")
},isDismissed:function(){return AJS.HelpTip.Manager.isDismissed(this)
}});
var I=function(O,N){this.initialize(O,N)
};
F.extend(I.prototype,{initialize:function(P,O){var N=this;
this.model=P;
this.beforeHide=B;
this.closeButton=F(AJS.Templates.HelpTip.tipClose());
this.closeButton.click(function(Q){P.dismiss("close-button");
Q.preventDefault()
});
this.popup=AJS.InlineDialog(O,P.cid,function(S,R,Q){S.html(AJS.Templates.HelpTip.tipContent(P.attributes));
S.prepend(N.closeButton);
S.unbind("mouseover mouseout");
S.find(".helptip-link").click(function(){J("learn-more.clicked",P)
});
Q()
},{container:"#content",noBind:true,preHideCallback:function(){return N.beforeHide()
},calculatePositions:function(Q,T,U,S){var R=AJS.InlineDialog.opts.calculatePositions(Q,T,U,S);
R.popupCss.top-=F("#content").offset().top;
return R
},addActiveClass:false});
this._popupHide=this.popup.hide;
this.popup.hide=B;
this.$el=F(this.popup[0]);
AJS.$(document).bind("showLayer",function(S,R,Q){if(R==="inlineDialog"&&Q.id===P.cid){AJS.InlineDialog.current=null;
AJS.$(document.body).unbind("click."+P.cid+".inline-dialog-check");
Q._validateClickToClose=B;
Q.hide=B
}})
},show:function(){this.popup.show()
},dismiss:function(){this.beforeHide=D;
this._popupHide()
}});
var M=function(N){this.initialize(N)
};
F.extend(M.prototype,{initialize:function(){this.$el=F("<div></div>")
},show:function(){},dismiss:function(){}});
A.fetch()
})(AJS.$);
/* module-key = 'com.atlassian.plugins.helptips.jira-help-tips:common', location = 'templates/HelpTip.soy' */
// This file was automatically generated from HelpTip.soy.
// Please don't edit this file by hand.

if (typeof AJS == 'undefined') { var AJS = {}; }
if (typeof AJS.Templates == 'undefined') { AJS.Templates = {}; }
if (typeof AJS.Templates.HelpTip == 'undefined') { AJS.Templates.HelpTip = {}; }


AJS.Templates.HelpTip.tipContent = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append((opt_data.title) ? '<h4 class="helptip-title">' + soy.$$escapeHtml(opt_data.title) + '</h4>' : '', '<div class="helptip-body">', opt_data.bodyHtml, '</div>', (opt_data.url) ? '<a class="helptip-link" href="' + soy.$$escapeHtml(opt_data.url) + '" target="_blank">' + soy.$$escapeHtml("Learn more") + '</a>' : '');
  return opt_sb ? '' : output.toString();
};


AJS.Templates.HelpTip.tipClose = function(opt_data, opt_sb) {
  var output = opt_sb || new soy.StringBuilder();
  output.append('<button class="helptip-close"><span class="assistive">', soy.$$escapeHtml("Dismiss this tip"), '</span></button>');
  return opt_sb ? '' : output.toString();
};

