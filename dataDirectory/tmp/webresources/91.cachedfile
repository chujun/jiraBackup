/* module-key = 'com.atlassian.jira.jira-issue-nav-plugin:init.jqlautocomplete', location = 'content/js/util/JQLAutoCompleteView.js' */
Backbone.define("JIRA.Issues.JQLAutoCompleteView",JIRA.Issues.BaseView.extend({events:{focus:"_onFocus"},initialize:function(){},getJqlAutoCompleteData:function(){var b=jQuery.Deferred();if(this.jqlFieldNames==null||this.jqlFunctionNames==null||this.jqlReservedWords==null){var c=jQuery("#jqlFieldz");var d=jQuery("#jqlFunctionNamez");var a=jQuery("#jqlReservedWordz");if(c.length>0&&d.length>0&&a.length>0){this.jqlFieldNames=JSON.parse(c.text());this.jqlFunctionNames=JSON.parse(d.text());this.jqlReservedWords=JSON.parse(a.text())}else{AJS.$.ajax({url:AJS.contextPath()+"/rest/issueNav/latest/jqlAutoComplete"}).done(_.bind(function(f){var e=JSON.parse(f);this.jqlFieldNames=JSON.parse(e.jqlFieldz);this.jqlFunctionNames=JSON.parse(e.jqlFunctionNamez);this.jqlReservedWords=JSON.parse(e.jqlReservedWordz);b.resolve()},this));return b.promise()}}return b.resolve().promise()},_initJQLAutoComplete:function(){var b=this.$el;var a=JIRA.JQLAutoComplete({fieldID:b.attr("id"),parser:JIRA.JQLAutoComplete.MyParser(this.jqlReservedWords),queryDelay:0.65,jqlFieldNames:this.jqlFieldNames,jqlFunctionNames:this.jqlFunctionNames,minQueryLength:0,allowArrowCarousel:true,autoSelectFirst:false,errorID:"jqlerrormsg"});a.buildResponseContainer();a.parse(b.text());a.updateColumnLineCount();b.keypress(function(c){if(a.dropdownController===null||!a.dropdownController.displayed||a.selectedIndex<0){if(c.keyCode==13&&!c.ctrlKey&&!c.shiftKey){c.preventDefault();a.dropdownController.hideDropdown();jQuery(this.form).submit()}}}).bind("expandedOnInput",function(){a.positionResponseContainer()}).bind("updateParseIndicator",function(){a.parse(b.val())}).click(function(){a.dropdownController.hideDropdown()})},_onFocus:function(){if(!AJS.params.autocompleteEnabled||this.$el.data("JQLAutoComplete_init")){return}this.$el.data("JQLAutoComplete_init",true);this.getJqlAutoCompleteData().done(_.bind(this._initJQLAutoComplete,this))}}));
