/* module-key = 'com.atlassian.auiplugin:aui-experimental-restfultable', location = 'experimental/js/atlassian/events/events.js' */
(function(A){AJS.triggerEvt=function(C,B){A(AJS).trigger(C,B)};AJS.bindEvt=function(B,C){A(AJS).bind(B,C)};AJS.triggerEvtForInst=function(B,D,C){A(D).trigger(B,C);AJS.triggerEvt(B,C);if(D.id){AJS.triggerEvt(D.id+"_"+B,C)}}})(AJS.$);
/* module-key = 'com.atlassian.auiplugin:aui-experimental-restfultable', location = 'experimental/js/atlassian/jquery/serializetoobject.js' */
jQuery.fn.serializeObject=function(){var A={};this.find(":input:not(:button):not(:submit):not(:radio):not('select[multiple]')").each(function(){if(this.name===""){return }if(this.value===null){this.value=""}A[this.name]=this.value.match(/^(tru|fals)e$/i)?this.value.toLowerCase()=="true":this.value});this.find("input:radio:checked").each(function(){A[this.name]=this.value});this.find("select[multiple]").each(function(){var B=jQuery(this),C=B.val();if(B.data("aui-ss")){if(C){A[this.name]=C[0]}else{A[this.name]=""}}else{if(C!==null){A[this.name]=C}else{A[this.name]=[]}}});return A};
/* module-key = 'com.atlassian.auiplugin:aui-experimental-restfultable', location = 'experimental/js/atlassian/jquery/color.js' */
(function(D){D.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(F,E){D.fx.step[E]=function(G){if(G.state==0){G.start=C(G.elem,E);G.end=B(G.end)}G.elem.style[E]="rgb("+[Math.max(Math.min(parseInt((G.pos*(G.end[0]-G.start[0]))+G.start[0]),255),0),Math.max(Math.min(parseInt((G.pos*(G.end[1]-G.start[1]))+G.start[1]),255),0),Math.max(Math.min(parseInt((G.pos*(G.end[2]-G.start[2]))+G.start[2]),255),0)].join(",")+")"}});function B(F){var E;if(F&&F.constructor==Array&&F.length==3){return F}if(E=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(F)){return[parseInt(E[1]),parseInt(E[2]),parseInt(E[3])]}if(E=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(F)){return[parseFloat(E[1])*2.55,parseFloat(E[2])*2.55,parseFloat(E[3])*2.55]}if(E=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(F)){return[parseInt(E[1],16),parseInt(E[2],16),parseInt(E[3],16)]}if(E=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(F)){return[parseInt(E[1]+E[1],16),parseInt(E[2]+E[2],16),parseInt(E[3]+E[3],16)]}return A[D.trim(F).toLowerCase()]}function C(G,E){var F;do{F=D.curCSS(G,E);if(F!=""&&F!="transparent"||D.nodeName(G,"body")){break}E="backgroundColor"}while(G=G.parentNode);return B(F)}var A={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}})(jQuery);
/* module-key = 'com.atlassian.auiplugin:aui-experimental-restfultable', location = 'experimental/js/atlassian/restfultable/restfultable.js' */
(function(A){AJS.RestfulTable=Backbone.View.extend({initialize:function(C){var B=this;B.options=A.extend(true,B._getDefaultOptions(C),C);B.id=this.options.id;B._events=AJS.RestfulTable.Events;B.classNames=AJS.RestfulTable.ClassNames;B.dataKeys=AJS.RestfulTable.DataKeys;this.$table=A(C.el).addClass(this.classNames.RESTFUL_TABLE).addClass(this.classNames.ALLOW_HOVER).addClass("aui").addClass(B.classNames.LOADING);this.$table.wrapAll("<form class='aui' action='#' />");this.$thead=A("<thead/>");this.$theadRow=A("<tr />").appendTo(this.$thead);this.$tbody=A("<tbody/>");if(!this.$table.length){throw new Error("AJS.RestfulTable: Init failed! The table you have specified ["+this.$table.selector+"] cannot be found.")}if(!this.options.columns){throw new Error("AJS.RestfulTable: Init failed! You haven't provided any columns to render.")}this.showGlobalLoading();A.each(this.options.columns,function(D,E){var F=A.isFunction(E.header)?E.header():E.header;if(typeof F==="undefined"){console.warn("You have not specified [header] for column ["+E.id+"]. Using id for now...");F=E.id}B.$theadRow.append("<th>"+F+"</th>")});B.$theadRow.append("<th></th><th></th>");this._models=this._createCollection();this._rowClass=this.options.views.row;this.editRows=[];this.$table.closest("form").submit(function(D){if(B.focusedRow){B.focusedRow.trigger(B._events.SAVE)}D.preventDefault()});if(this.options.allowReorder){this.$theadRow.prepend("<th />");this.$tbody.sortable({handle:"."+this.classNames.DRAG_HANDLE,helper:function(F,D){var E=D.clone(true).addClass(B.classNames.MOVEABLE);E.children().each(function(G){A(this).width(D.children().eq(G).width())});return E},start:function(D,E){var F=E.placeholder.find("td");E.item.addClass(B.classNames.MOVEABLE).children().each(function(G){A(this).width(F.eq(G).width())});E.placeholder.html('<td colspan="'+B.getColumnCount()+'">&nbsp;</td>').css("visibility","visible");B.getRowFromElement(E.item[0]).trigger(B._events.MODAL)},stop:function(D,E){if(jQuery(E.item[0]).is(":visible")){E.item.removeClass(B.classNames.MOVEABLE).children().attr("style","");E.placeholder.removeClass(B.classNames.ROW);B.getRowFromElement(E.item[0]).trigger(B._events.MODELESS)}},update:function(F,H){var D,E,G={},I=B.getRowFromElement(H.item[0]);if(I){if(B.options.reverseOrder){E=H.item.next();if(!E.length){G.position="First"}else{D=B.getRowFromElement(E).model;G.after=D.url()}}else{E=H.item.prev();if(!E.length){G.position="First"}else{D=B.getRowFromElement(E).model;G.after=D.url()}}A.ajax({url:I.model.url()+"/move",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(G),complete:function(){I.hideLoading()},success:function(J){AJS.triggerEvtForInst(B._events.REORDER_SUCCESS,B,[J])},error:function(K){var J=A.parseJSON(K.responseText||K.data);AJS.triggerEvtForInst(B._events.SERVER_ERROR,B,[J,K,this])}});I.showLoading()}},axis:"y",delay:0,containment:"document",cursor:"move",scroll:true,zIndex:8000});this.$tbody.bind("selectstart mousedown",function(D){return !A(D.target).is("."+B.classNames.DRAG_HANDLE)})}if(this.options.allowCreate!==false){this._createRow=new this.options.views.editRow({columns:this.options.columns,isCreateRow:true,model:this.options.model.extend({url:function(){return B.options.resources.self}}),cancelAccessKey:this.options.cancelAccessKey,submitAccessKey:this.options.submitAccessKey,allowReorder:this.options.allowReorder}).bind(this._events.CREATED,function(D){if(B.options.createPosition==="bottom"){B.addRow(D)}else{B.addRow(D,0)}}).bind(this._events.VALIDATION_ERROR,function(){this.trigger(B._events.FOCUS)}).render({errors:{},values:{}});this.$create=A('<tbody class="'+this.classNames.CREATE+'" />').append(this._createRow.el);this._applyFocusCoordinator(this._createRow);this._createRow.trigger(this._events.FOCUS)}this._models.bind("remove",function(D){A.each(B.getRows(),function(E,F){if(F.model===D){if(F.hasFocus()&&B._createRow){B._createRow.trigger(B._events.FOCUS)}B.removeRow(F)}})});if(A.isFunction(this.options.resources.all)){this.options.resources.all(function(D){B.populate(D)})}else{A.get(this.options.resources.all,function(D){B.populate(D)})}},_createCollection:function(){var B=this;var C=this.options.Collection.extend({sort:function(D){D||(D={});if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}this.tableRows=B.getRows();this.models=this.sortBy(this.comparator);this.tableRows=undefined;if(!D.silent){this.trigger("refresh",this,D)}return this},remove:function(E,D){this.tableRows=B.getRows();Backbone.Collection.prototype.remove.apply(this,arguments);this.tableRows=undefined;return this}});return new C([],{comparator:function(E){var D;A.each(this.tableRows!==undefined?this.tableRows:B.getRows(),function(F){if(this.model.id===E.id){D=F;return false}});return D}})},populate:function(B){if(this.options.reverseOrder){B.reverse()}this.hideGlobalLoading();if(B&&B.length){this._models.reset([],{silent:true});this.renderRows(B);if(this.isEmpty()){this.showNoEntriesMsg()}}else{this.showNoEntriesMsg()}this.$table.append(this.$thead);if(this.options.createPosition==="bottom"){this.$table.append(this.$tbody).append(this.$create)}else{this.$table.append(this.$create).append(this.$tbody)}this.$table.removeClass(this.classNames.LOADING).trigger(this._events.INITIALIZED,[this]);AJS.triggerEvtForInst(this._events.INITIALIZED,this,[this]);if(this.options.autoFocus){this.$table.find(":input:text:first").focus()}},showGlobalLoading:function(){if(!this.$loading){this.$loading=A('<div class="aui-restfultable-init"><span class="aui-restfultable-throbber"></span><span class="aui-restfultable-loading">'+this.options.loadingMsg+"</span></div>")}if(!this.$loading.is(":visible")){this.$loading.insertAfter(this.$table)}return this},hideGlobalLoading:function(){if(this.$loading){this.$loading.remove()}return this},addRow:function(C,E){var B,D;if(!C.id){throw new Error("AJS.RestfulTable.addRow: to add a row values object must contain an id. Maybe you are not returning it from your restend point?Recieved:"+JSON.stringify(C))}D=new this.options.model(C);B=this._renderRow(D,E);this._models.add(D);this.removeNoEntriesMsg();AJS.triggerEvtForInst(this._events.ROW_ADDED,this,[B,this]);return this},removeRow:function(B){this._models.remove(B.model);B.remove();if(this.isEmpty()){this.showNoEntriesMsg()}AJS.triggerEvtForInst(this._events.ROW_REMOVED,this,[B,this])},isEmpty:function(){return this._models.length===0},getModels:function(){return this._models},getTable:function(){return this.$table},getTableBody:function(){return this.$tbody},getCreateRow:function(){return this._createRow},getColumnCount:function(){return this.options.columns.length+2},getRowFromElement:function(B){return A(B).data(this.dataKeys.ROW_VIEW)},showNoEntriesMsg:function(){if(this.$noEntries){this.$noEntries.remove()}this.$noEntries=A("<tr>").addClass(this.classNames.NO_ENTRIES).append(A("<td>").attr("colspan",this.getColumnCount()).text(this.options.noEntriesMsg)).appendTo(this.$tbody);return this},removeNoEntriesMsg:function(){if(this.$noEntries&&this._models.length>0){this.$noEntries.remove()}return this},getRows:function(){var B=this,C=[];this.$tbody.find("."+this.classNames.READ_ONLY).each(function(){var D=A(this),E=D.data(B.dataKeys.ROW_VIEW);if(E){C.push(E)}});return C},_renderRow:function(G,F){var C=this,E=this.$tbody.find("."+this.classNames.READ_ONLY),B,D;D=new this._rowClass({model:G,columns:this.options.columns,allowEdit:this.options.allowEdit,allowDelete:this.options.allowDelete,allowReorder:this.options.allowReorder,deleteConfirmation:this.options.deleteConfirmation});this.removeNoEntriesMsg();D.bind(this._events.EDIT_ROW,function(H){C.edit(this,H)});B=D.render().$el;if(F!==-1){if(typeof F==="number"&&E.length!==0){B.insertBefore(E[F])}else{this.$tbody.append(B)}}B.data(this.dataKeys.ROW_VIEW,D);D.bind(this._events.MODAL,function(){C.$table.removeClass(C.classNames.ALLOW_HOVER);C.$tbody.sortable("disable");A.each(C.getRows(),function(){if(!C.isRowBeingEdited(this)){this.delegateEvents({})}})});D.bind(this._events.ANIMATION_STARTED,function(){C.$table.removeClass(C.classNames.ALLOW_HOVER)});D.bind(this._events.ANIMATION_FINISHED,function(){C.$table.addClass(C.classNames.ALLOW_HOVER)});D.bind(this._events.MODELESS,function(){C.$table.addClass(C.classNames.ALLOW_HOVER);C.$tbody.sortable("enable");A.each(C.getRows(),function(){if(!C.isRowBeingEdited(this)){this.delegateEvents()}})});this._applyFocusCoordinator(D);this.trigger(this._events.ROW_INITIALIZED,D);return D},isRowBeingEdited:function(C){var B=false;A.each(this.editRows,function(){if(this.el===C.el){B=true;return false}});return B},_applyFocusCoordinator:function(C){var B=this;if(!C.hasFocusBound){C.hasFocusBound=true;C.bind(this._events.FOCUS,function(){if(B.focusedRow&&B.focusedRow!==C){B.focusedRow.trigger(B._events.BLUR)}B.focusedRow=C;if(C instanceof AJS.RestfulTable.Row&&B._createRow){B._createRow.enable()}})}return this},_removeEditRow:function(C){var B=A.inArray(C,this.editRows);this.editRows.splice(B,1);return this},_shiftFocusAfterEdit:function(){if(this.editRows.length>0){this.editRows[this.editRows.length-1].trigger(this._events.FOCUS)}else{if(this._createRow){this._createRow.trigger(this._events.FOCUS)}}return this},_saveEditRowOnBlur:function(){return this.editRows.length<=1},dismissEditRows:function(){var B=this;A.each(this.editRows,function(){if(!this.hasUpdates()){this.trigger(B._events.FINISHED_EDITING)}})},edit:function(F,E){var B=this,D=new this.options.views.editRow({el:F.el,columns:this.options.columns,isUpdateMode:true,allowReorder:this.options.allowReorder,model:F.model,cancelAccessKey:this.options.cancelAccessKey,submitAccessKey:this.options.submitAccessKey}),C=F.model.toJSON();C.update=true;D.render({errors:{},update:true,values:C}).bind(B._events.UPDATED,function(G,H){B._removeEditRow(this);this.unbind();F.render().delegateEvents();F.trigger(B._events.UPDATED);if(H!==false){B._shiftFocusAfterEdit()}}).bind(B._events.VALIDATION_ERROR,function(){this.trigger(B._events.FOCUS)}).bind(B._events.FINISHED_EDITING,function(){B._removeEditRow(this);F.render().delegateEvents();this.unbind()}).bind(B._events.CANCEL,function(){B._removeEditRow(this);this.unbind();F.render().delegateEvents();B._shiftFocusAfterEdit()}).bind(B._events.BLUR,function(){B.dismissEditRows();if(B._saveEditRowOnBlur()){this.trigger(B._events.SAVE,false)}});this._applyFocusCoordinator(D);D.trigger(B._events.FOCUS,E);if(B._createRow){B._createRow.disable()}this.editRows.push(D);return D},renderRows:function(D){var B=this._models.comparator,C=[];this._models.comparator=undefined;var E=_.map(D,function(G){var F=new this.options.model(G);C.push(this._renderRow(F,-1).el);return F},this);this._models.add(E,{silent:true});this._models.comparator=B;this.removeNoEntriesMsg();this.$tbody.append(C);return this},_getDefaultOptions:function(B){return{model:B.model||AJS.RestfulTable.EntryModel,allowEdit:true,views:{editRow:AJS.RestfulTable.EditRow,row:AJS.RestfulTable.Row},Collection:Backbone.Collection.extend({url:B.resources.self,model:B.model||AJS.RestfulTable.EntryModel}),allowReorder:false,loadingMsg:B.loadingMsg||"Loading"}}});AJS.RestfulTable.DataKeys={ENABLED_SUBMIT:"enabledSubmit",ROW_VIEW:"RestfulTable_Row_View"};AJS.RestfulTable.ClassNames={NO_VALUE:"aui-restfultable-editable-no-value",NO_ENTRIES:"aui-restfultable-no-entires",RESTFUL_TABLE:"aui-restfultable",ROW:"aui-restfultable-row",READ_ONLY:"aui-restfultable-readonly",ACTIVE:"aui-restfultable-active",ALLOW_HOVER:"aui-restfultable-allowhover",FOCUSED:"aui-restfultable-focused",MOVEABLE:"aui-restfultable-movable",ANIMATING:"aui-restfultable-animate",DISABLED:"aui-restfultable-disabled",SUBMIT:"aui-restfultable-submit",CANCEL:"aui-restfultable-cancel",EDIT_ROW:"aui-restfultable-editrow",CREATE:"aui-restfultable-create",DRAG_HANDLE:"aui-restfultable-draghandle",ORDER:"aui-restfultable-order",EDITABLE:"aui-restfultable-editable",ERROR:"error",DELETE:"aui-restfultable-delete",LOADING:"loading"};AJS.RestfulTable.Events={REORDER_SUCCESS:"RestfulTable.reorderSuccess",ROW_ADDED:"RestfulTable.rowAdded",ROW_REMOVED:"RestfulTable.rowRemoved",EDIT_ROW:"RestfulTable.switchedToEditMode",SERVER_ERROR:"RestfulTable.serverError",CREATED:"created",UPDATED:"updated",FOCUS:"focus",BLUR:"blur",SUBMIT:"submit",SAVE:"save",MODAL:"modal",MODELESS:"modeless",CANCEL:"cancel",CONTENT_REFRESHED:"contentRefreshed",RENDER:"render",FINISHED_EDITING:"finishedEditing",VALIDATION_ERROR:"validationError",SUBMIT_STARTED:"submitStarted",SUBMIT_FINISHED:"submitFinished",ANIMATION_STARTED:"animationStarted",ANIMATION_FINISHED:"animationFinisehd",INITIALIZED:"initialized",ROW_INITIALIZED:"rowInitialized"}})(AJS.$);
/* module-key = 'com.atlassian.auiplugin:aui-experimental-restfultable', location = 'experimental/js/atlassian/restfultable/restfultable.entrymodel.js' */
(function(A){AJS.RestfulTable.EntryModel=Backbone.Model.extend({sync:function(F,D,C){var B=this;var E=C.error;C.error=function(G){B._serverErrorHandler(G,this);if(E){E.apply(this,arguments)}};return Backbone.sync.apply(Backbone,arguments)},save:function(D,F){F=F||{};var C=this,H,B,E=F.error,G=F.success;F.error=function(I,K){var J=A.parseJSON(K.responseText||K.data);if(E){E.call(C,C,J,K)}};if(this.isNew()){Backbone.Model.prototype.save.call(this,D,F)}else{if(D){H=AJS.RestfulTable.EntryModel.extend({url:this.url()});B=new H({id:this.id});B.save=Backbone.Model.prototype.save;F.success=function(I,J){C.clear().set(I.toJSON());if(G){G.call(C,C,J)}};B.save(D,F)}}},destroy:function(D){D=D||{};var B=this,C=this.url(),E;if(D.data){E=A.param(D.data)}if(E!==""){C=C+"?"+E}A.ajax({url:C,type:"DELETE",dataType:"json",contentType:"application/json",success:function(F){if(B.collection){B.collection.remove(B)}if(D.success){D.success.call(B,F)}},error:function(F){B._serverErrorHandler(F,this);if(D.error){D.error.call(B,F)}}});return this},changedAttributes:function(B){var D={},C=this.toJSON();A.each(B,function(E,F){if(!C[E]){if(typeof F==="string"){if(A.trim(F)!==""){D[E]=F}}else{if(A.isArray(F)){if(F.length!==0){D[E]=F}}else{D[E]=F}}}else{if(C[E]&&C[E]!==F){if(typeof F==="object"){if(!_.isEqual(F,C[E])){D[E]=F}}else{D[E]=F}}}});if(!_.isEmpty(D)){this.addExpand(D);return D}},addExpand:function(B){},_serverErrorHandler:function(D,B){var C;if(D.status!==400){C=A.parseJSON(D.responseText||D.data);AJS.triggerEvtForInst(AJS.RestfulTable.Events.SERVER_ERROR,this,[C,D,B])}},fetch:function(B){B=B||{};this.clear();Backbone.Model.prototype.fetch.call(this,B)}})})(AJS.$);
/* module-key = 'com.atlassian.auiplugin:aui-experimental-restfultable', location = 'experimental/js/atlassian/restfultable/restfultable.editrow.js' */
(function(A){AJS.RestfulTable.EditRow=Backbone.View.extend({tagName:"tr",events:{focusin:"_focus",click:"_focus",keyup:"_handleKeyUpEvent"},initialize:function(B){this.$el=A(this.el);this._events=AJS.RestfulTable.Events;this.classNames=AJS.RestfulTable.ClassNames;this.dataKeys=AJS.RestfulTable.DataKeys;this.columns=B.columns;this.isCreateRow=B.isCreateRow;this.allowReorder=B.allowReorder;this.events["click ."+this.classNames.CANCEL]="_cancel";this.delegateEvents();if(B.isUpdateMode){this.isUpdateMode=true}else{this._modelClass=B.model;this.model=new this._modelClass()}this.bind(this._events.CANCEL,function(){this.disabled=true}).bind(this._events.SAVE,function(C){if(!this.disabled){this.submit(C)}}).bind(this._events.FOCUS,function(C){this.focus(C)}).bind(this._events.BLUR,function(){this.$el.removeClass(this.classNames.FOCUSED);this.disable()}).bind(this._events.SUBMIT_STARTED,function(){this._submitStarted()}).bind(this._events.SUBMIT_FINISHED,function(){this._submitFinished()})},defaultColumnRenderer:function(B){if(B.allowEdit!==false){return A("<input type='text' />").addClass("text").attr({name:B.name,value:B.value})}else{if(B.value){return document.createTextNode(B.value)}}},renderDragHandle:function(){return'<span class="'+this.classNames.DRAG_HANDLE+'"></span></td>'},_handleKeyUpEvent:function(B){if(B.keyCode===27){this.trigger(this._events.CANCEL)}},_cancel:function(B){this.trigger(this._events.CANCEL);B.preventDefault();return this},_submitStarted:function(){this.submitting=true;this.showLoading().disable().delegateEvents({});return this},_submitFinished:function(){this.submitting=false;this.hideLoading().enable().delegateEvents(this.events);return this},_focus:function(B){if(!this.hasFocus()){this.trigger(this._events.FOCUS,B.target.name)}return this},hasFocus:function(){return this.$el.hasClass(this.classNames.FOCUSED)},focus:function(C){var D,B;this.enable();if(C){D=this.$el.find(":input[name="+C+"], #"+C)}else{B=this.$el.find(this.classNames.ERROR+":first");if(B.length===0){D=this.$el.find(":input:text:first")}else{D=B.parent().find(":input")}}this.$el.addClass(this.classNames.FOCUSED);D.focus().trigger("select");return this},disable:function(){var C,B;if(A.browser.mozilla){B=this.$el.find(":submit");if(B.length){C=A("<input type='submit' class='"+this.classNames.SUBMIT+"' />").addClass(B.attr("class")).val(B.val()).data(this.dataKeys.ENABLED_SUBMIT,B);B.replaceWith(C)}}this.$el.addClass(this.classNames.DISABLED).find(":submit").attr("disabled","disabled");return this},enable:function(){var B,C;if(A.browser.mozilla){B=this.$el.find(this.classNames.SUBMIT),C=B.data(this.dataKeys.ENABLED_SUBMIT);if(C&&B.length){B.replaceWith(C)}}this.$el.removeClass(this.classNames.DISABLED).find(":submit").removeAttr("disabled");return this},showLoading:function(){this.$el.addClass(this.classNames.LOADING);return this},hideLoading:function(){this.$el.removeClass(this.classNames.LOADING);return this},hasUpdates:function(){return !!this.mapSubmitParams(this.$el.serializeObject())},mapSubmitParams:function(B){return this.model.changedAttributes(B)},submit:function(D){var B=this,C;if(document.activeElement!==window){A(document.activeElement).blur()}if(this.isUpdateMode){C=this.mapSubmitParams(this.$el.serializeObject());if(!C){return B.trigger(B._events.CANCEL)}}else{this.model.clear();C=this.mapSubmitParams(this.$el.serializeObject())}this.trigger(this._events.SUBMIT_STARTED);this.model.save(C,{success:function(){if(B.isUpdateMode){B.trigger(B._events.UPDATED,B.model,D)}else{B.trigger(B._events.CREATED,B.model.toJSON());B.model=new B._modelClass();B.render({errors:{},values:{}});B.trigger(B._events.FOCUS)}B.trigger(B._events.SUBMIT_FINISHED)},error:function(E,F,G){if(G.status===400){B.renderErrors(F.errors).trigger(B._events.VALIDATION_ERROR,F.errors)}B.trigger(B._events.SUBMIT_FINISHED)},silent:true});return this},renderError:function(B,C){return A("<div />").attr("data-field",B).addClass(this.classNames.ERROR).text(C)},renderErrors:function(C){var B=this;this.$("."+this.classNames.ERROR).remove();if(C){A.each(C,function(D,E){B.$el.find("[name='"+D+"']").closest("td").append(B.renderError(D,E))})}return this},render:function(C){var B=this;this.$el.empty();if(this.allowReorder){A('<td  class="'+this.classNames.ORDER+'" />').append(this.renderDragHandle()).appendTo(B.$el)}A.each(this.columns,function(E,F){var G,I,H=C.values[F.id],D=[{name:F.id,value:H,allowEdit:F.allowEdit},C.values,B.model];if(H){B.$el.attr("data-"+F.id,H)}if(B.isCreateRow&&F.createView){G=new F.createView({model:B.model}).render(D[0])}else{if(F.editView){G=new F.editView({model:B.model}).render(D[0])}else{G=B.defaultColumnRenderer.apply(B,D)}}I=A("<td />");if(typeof G==="object"&&G.done){G.done(function(J){I.append(J)})}else{I.append(G)}if(F.styleClass){I.addClass(F.styleClass)}I.appendTo(B.$el)});this.$el.append(this.renderOperations(C.update,C.values)).addClass(this.classNames.ROW+" "+this.classNames.EDIT_ROW);this.trigger(this._events.RENDER,this.$el,C.values);this.$el.trigger(this._events.CONTENT_REFRESHED,[this.$el]);return this},renderOperations:function(C){var B=A('<td class="aui-restfultable-operations" />');if(C){B.append(A('<input class="aui-button" type="submit" />').attr({accesskey:this.submitAccessKey,value:"Update"})).append(A('<a class="aui-button aui-button-link" href="#" />').addClass(this.classNames.CANCEL).text("Cancel").attr({accesskey:this.cancelAccessKey}))}else{B.append(A('<input class="aui-button" type="submit" />').attr({accesskey:this.submitAccessKey,value:"Add"}))}return B.add(A('<td class="aui-restfultable-throbber" />'))}})})(AJS.$);
/* module-key = 'com.atlassian.auiplugin:aui-experimental-restfultable', location = 'experimental/js/atlassian/restfultable/restfultable.customview.js' */
AJS.RestfulTable.CustomEditView=AJS.RestfulTable.CustomCreateView=AJS.RestfulTable.CustomReadView=Backbone.View;
/* module-key = 'com.atlassian.auiplugin:aui-experimental-restfultable', location = 'experimental/js/atlassian/restfultable/restfultable.row.js' */
(function(A){AJS.RestfulTable.Row=Backbone.View.extend({tagName:"tr",events:{"click .aui-restfultable-editable":"edit"},initialize:function(C){var B=this;C=C||{};this._events=AJS.RestfulTable.Events;this.classNames=AJS.RestfulTable.ClassNames;this.dataKeys=AJS.RestfulTable.DataKeys;this.columns=C.columns;this.allowEdit=C.allowEdit;this.allowDelete=C.allowDelete;if(!this.events["click .aui-restfultable-editable"]){throw new Error("It appears you have overridden the events property. To add events you will need to usea work around. https://github.com/documentcloud/backbone/issues/244")}this.index=C.index||0;this.deleteConfirmation=C.deleteConfirmation;this.allowReorder=C.allowReorder;this.$el=A(this.el);this.bind(this._events.CANCEL,function(){this.disabled=true}).bind(this._events.FOCUS,function(D){this.focus(D)}).bind(this._events.BLUR,function(){this.unfocus()}).bind(this._events.UPDATED,function(){this._showUpdated()}).bind(this._events.MODAL,function(){this.$el.addClass(this.classNames.ACTIVE)}).bind(this._events.MODELESS,function(){this.$el.removeClass(this.classNames.ACTIVE)})},renderDragHandle:function(){return'<span class="'+this.classNames.DRAG_HANDLE+'"></span></td>'},defaultColumnRenderer:function(B){if(B.value){return document.createTextNode(B.value.toString())}},_showUpdated:function(){var B=this,C=this.$el.addClass(this.classNames.ANIMATING).find("td").css("backgroundColor","#ebf1fd");this.trigger(this._events.ANIMATION_STARTED);B.delegateEvents({});setTimeout(function(){C.animate({backgroundColor:"white"},function(){C.css("backgroundColor","");B.trigger(B._events.ANIMATION_FINISHED);A(document).one("mousemove",function(){B.delegateEvents();B.$el.removeClass(B.classNames.ANIMATING)})})},500)},sync:function(C){this.model.addExpand(C);var B=this;this.showLoading();this.model.save(C,{success:function(){B.hideLoading().render();B.trigger(B._events.UPDATED)},error:function(){B.hideLoading()}});return this},refresh:function(D,C){var B=this;this.showLoading();this.model.fetch({success:function(){B.hideLoading().render();if(D){D.apply(this,arguments)}},error:function(){B.hideLoading();if(C){C.apply(this,arguments)}}});return this},hasFocus:function(){return this.$el.hasClass(this.classNames.FOCUSED)},focus:function(){A(this.el).addClass(this.classNames.FOCUSED);return this},unfocus:function(){A(this.el).removeClass(this.classNames.FOCUSED);return this},showLoading:function(){this.$el.addClass(this.classNames.LOADING);return this},hideLoading:function(){this.$el.removeClass(this.classNames.LOADING);return this},edit:function(C){var B;if(A(C.target).is("."+this.classNames.EDITABLE)){B=A(C.target).attr("data-field-name")}else{B=A(C.target).closest("."+this.classNames.EDITABLE).attr("data-field-name")}this.trigger(AJS.RestfulTable.Events.EDIT_ROW,B);return this},renderOperations:function(){var B=this;if(this.allowDelete!==false){return A("<a href='#' class='aui-button' />").addClass(this.classNames.DELETE).text("Delete").click(function(C){C.preventDefault();B.destroy()})}},destroy:function(){if(this.deleteConfirmation){var B=AJS.popup(400,200,"delete-entity-"+this.model.get("id"));B.element.html(this.deleteConfirmation(this.model.toJSON()));B.show();B.element.find(".cancel").click(function(){B.hide()});B.element.find("form").submit(_.bind(function(C){B.hide();this.model.destroy();C.preventDefault()},this))}else{this.model.destroy()}},render:function(){var B=this,D=this.model.toJSON(),E=A("<td class='aui-restfultable-operations' />").append(this.renderOperations({},D)),C=A("<td class='aui-restfultable-throbber' />");this.$el.removeClass(this.classNames.DISABLED+" "+this.classNames.FOCUSED+" "+this.classNames.LOADING+" "+this.classNames.EDIT_ROW).addClass(this.classNames.READ_ONLY).empty();if(this.allowReorder){A('<td  class="'+this.classNames.ORDER+'" />').append(this.renderDragHandle()).appendTo(B.$el)}this.$el.attr("data-id",this.model.id);A.each(this.columns,function(G,I){var J,L=A("<td />"),K=D[I.id],M=I.fieldName||I.id,F=[{name:M,value:K,allowEdit:I.allowEdit},D,B.model];if(K){B.$el.attr("data-"+I.id,K)}if(I.readView){J=new I.readView({model:B.model}).render(F[0])}else{J=B.defaultColumnRenderer.apply(B,F)}if(B.allowEdit!==false&&I.allowEdit!==false){var H=A("<span />").addClass(B.classNames.EDITABLE).append('<span class="aui-icon icon-edit-sml" />').append(J).attr("data-field-name",M);L=A("<td />").append(H).appendTo(B.$el);if(!J||A.trim(J)==""){L.addClass(B.classNames.NO_VALUE);H.html(A("<em />").text(this.emptyText||"Enter value"))}}else{L.append(J)}if(I.styleClass){L.addClass(I.styleClass)}L.appendTo(B.$el)});this.$el.append(E).append(C).addClass(this.classNames.ROW+" "+this.classNames.READ_ONLY);this.trigger(this._events.RENDER,this.$el,D);this.$el.trigger(this._events.CONTENT_REFRESHED,[this.$el]);return this}})})(AJS.$);
