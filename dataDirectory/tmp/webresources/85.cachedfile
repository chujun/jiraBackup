/* module-key = 'com.atlassian.streams:streamsWebResources', location = '/js/gadgets-json-fix.js' */
(function(){AJS.$.ajaxSetup({jsonp:null,jsonpCallback:null})})();
/* module-key = 'com.atlassian.streams:streamsWebResources', location = '/js/gadget-config-override.js' */
var ActivityStreams=ActivityStreams||{};ActivityStreams.hijackGadgetConfig=function(B){var A=B.getPrefs().getModuleId();B.showConfig=function(){AJS.$("#"+A).trigger("showConfiguration.streams")}};
/* module-key = 'com.atlassian.streams:streamsWebResources', location = '/js/atom/jatom.js' */
function jAtom(E){function A(K){if(typeof K=="string"){try{var J=new ActiveXObject("Microsoft.XMLDOM");J.async=false;J.loadXML(K);return J}catch(L){AJS.log("Failed to create an xml object from string: "+L);return K}}else{return K}}function I(){var J=new Array();return{authors:J,title:"",links:{},timedOutSources:[],summary:"",content:"",updated:"",timezoneOffset:"",id:"",category:"",type:"",generator:""}}function D(){return{name:"",email:"",uri:"",username:"",photos:""}}function H(){return{id:"",appName:"",appUri:"",authUri:""}}function G(L){var K=D(),O,N;L=AJS.$(L);K.name=L.find("> name").text();K.email=L.find("> email").text();K.uri=L.find("> uri").text();K.username=L.find('> [nodeName="usr:username"]').text();O=L.find("> link[rel='photo']");N=O.length;if(N){K.photos=[];for(var M=0;M<N;M++){var J=AJS.$(O[M]);K.photos.push({uri:J.attr("href"),width:J.attr("media:width"),height:J.attr("media:height")})}}return K}function F(K){var J={};K.find("> link").each(function(){var O=AJS.$(this),L=O.attr("rel"),N=O.attr("href"),M=J[L]||[];M.push(N);J[L]=M});return J}function C(J){var K=[];J.find('> [nodeName="atlassian:authorisation-message"]').each(function(){var L=AJS.$(this),M=H();M.id=L.find('> [nodeName="atlassian:application-id"]').text();M.appName=L.find('> [nodeName="atlassian:application-name"]').text();M.appUri=L.find('> [nodeName="atlassian:application-uri"]').text();M.authUri=L.find('> [nodeName="atlassian:authorisation-uri"]').text();K.push(M)});return K}function B(K){var L=AJS.$("feed:first",K),M={version:"1.0",title:L.find("> title").text(),self:L.find('> link[rel="self"]').attr("href"),description:L.find("> subtitle").text(),language:L.attr("xml:lang"),updated:L.find("> updated").text(),timezoneOffset:L.find('> [nodeName="atlassian:timezone-offset"]').text(),timedOutSources:AJS.$.makeArray(L.find('> [nodeName="atlassian:timed-out-source-list"]').children().map(function(){return AJS.$(this).text()})),links:F(L),authMessages:C(L),items:new Array()},J;AJS.$("entry",K).each(function(){var P=I(),O=AJS.$(this),N,Q;P.title=O.find("> title").text();P.links=F(O);P.iconTitle=O.find('> link[rel="http://streams.atlassian.com/syndication/icon"]').attr("title");P.summary=O.find("> summary").text();P.content=O.find("> content").text();P.updated=O.find("> updated").text();P.timezoneOffset=O.find('> [nodeName="atlassian:timezone-offset"]').text();P.id=O.find("> id").text();P.category=O.find("> category").attr("term");P.generator=O.find("> generator").attr("uri");N=O.find('> [nodeName="activity:object"]');J=N.find('> [nodeName="activity:object-type"]').text();if(J.indexOf("http://streams.atlassian.com/syndication/types/")==0){P.type=J.substring("http://streams.atlassian.com/syndication/types/".length,J.length)}else{if(J.indexOf("http://activitystrea.ms/schema/1.0/")==0){P.type=J.substring("http://activitystrea.ms/schema/1.0/".length,J.length)}else{P.type=J}}if(N.length){P.object={id:N.find("> id").text(),link:N.find("> link").attr("href"),type:N.find('> [nodeName="activity:object-type"]').text()}}Q=O.find('> [nodeName="activity:target"]');if(Q.length){P.target={id:Q.find("> id").text(),title:Q.find("> title").text(),summary:Q.find("> summary").text(),link:Q.find("> link").attr("href"),type:Q.find('> [nodeName="activity:object-type"]').text()}}P.application=O.find('> [nodeName="atlassian:application"]').text();P.verb=O.find('> [nodeName="activity:verb"]').text();O.find("author").each(function(){P.authors.push(G(this))});M.items.push(P)});return M}return B(A(E))};
/* module-key = 'com.atlassian.streams:streamsWebResources', location = '/js/ajs.json.js' */
if(!AJS.json){AJS.json={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&Object.prototype.toString.apply(value)!=="[object Array]"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof AJS.json.stringify!=="function"){AJS.json.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("AJS.json.stringify")}return str("",{"":value})}}if(typeof AJS.json.parse!=="function"){AJS.json.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("AJS.json.parse")}}}());
/* module-key = 'com.atlassian.streams:streamsWebResources', location = '/js/ajs.date.js' */
(function(){AJS=AJS||{};AJS.Date=AJS.Date||{};var D="t",B="D";function I(O){return ActivityStreams.getMsg("gadget.activity.stream.time."+O)}function L(O){return O.getTime&&O.getTime()+O.getTimezoneOffset()*60}function F(P,R,O,Q){if(O==0){return(Q&&(R<60&&I("past.moment")||R<120&&I("past.minute")||R<3600&&AJS.format(I("past.minutes"),Math.floor(R/60))||R<7200&&I("past.hour")||R<86400&&AJS.format(I("past.hours"),Math.floor(R/3600))))||I("today")}else{return O<=1&&(Q&&AJS.format(I("past.dayWithTime"),P.toString(D))||I("past.day"))||O<7&&(Q&&AJS.format(I("datetime"),P.toString("dddd"),P.toString(D))||P.toString("dddd"))||O<365&&(Q&&AJS.format(I("datetime"),P.toString("m"),P.toString(D))||P.toString("m"))||O>=365&&(Q&&P.toString(B)||P.toString("y"))}}function N(P,R,O,Q){if(O==0){return Q&&(R<60&&I("future.minute")||R<3600&&AJS.format(I("future.minutes"),Math.floor(R/60))||R<7200&&I("future.hour")||R<86400&&AJS.format(I("future.hours"),Math.floor(R/3600)))||""}else{return O<=1&&(Q&&AJS.format(I("future.dayWithTime"),P.toString(D))||I("future.day"))||O<7&&(Q&&AJS.format(I("datetime"),P.toString("dddd"),P.toString(D))||P.toString("dddd"))||O<365&&(Q&&AJS.format(I("datetime"),P.toString("m"),P.toString(D))||P.toString("m"))||O>=365&&(Q&&P.toString(B)||P.toString("y"))}}function H(Q){var O,P=0;if(Q){O=Q.toString().match(/([-+])([0-9][0-9])([0-9][0-9])/);P+=O[2]*60;P+=Number(O[3]);if(O[1]==="-"){P=-P}}return P}function M(P,O){return H(P)-H(O)}function E(O){return O&&!(O.toString()==="Invalid Date"||O.toString()==="NaN")}function J(O,Q){var P;if(E(O)&&Q){P=O.getUTCOffset();O.addMinutes(M(Q,P))}return O}function A(Q,P){if(Q instanceof Date){return Q}var R=/([0-9])T([0-9])/,O=new Date(Q);if(E(O)){return J(O,P)}if(Q.match(R)){Q=Q.replace(/\.[0-9]*/g,"").replace(/Z$/," -00:00").replace(R,"$1 $2")}Q=Q.replace(/([0-9]{4})-([0-9]{2})-([0-9]{2})/g,"$1/$2/$3").replace(/\s?([-\+][0-9]{2}):([0-9]{2})/," $1$2");O=new Date(Q||"");return J(O,P)}function K(R,P){var O=new Date(R),Q;if(!O){O=A(R)}P=P||new Date();Q=(L(P)-L(O))/1000;if(isNaN(Q)){return null}return Q}function C(O){return Math.floor(Math.abs(O)/86400)}function G(T,Q,R){Q=Q||new Date();var P=A(T),S=K(P,Q),O;if(S){O=C(S);if(O==0&&P.getDate()!=Q.getDate()){O=1}if(S<0){return AJS.format(I("datetime"),P.toString(B),P.toString(D))}else{return F(P,S,O,R)}}return null}AJS.Date.getFineRelativeDate=function(P,O){return G(P,O,true)};AJS.Date.getCoarseRelativeDate=function(P,O){return G(P,O,false)};AJS.Date.parse=A;AJS.Date.handleTimezoneOffset=J;AJS.Date.setDateFormat=function(O){B=O?O:B};AJS.Date.setTimeFormat=function(O){D=O?O.replace(/a/g,"tt"):D}})();
/* module-key = 'com.atlassian.streams:streamsWebResources', location = '/js/smart-config.js' */
var AJS=AJS||{};AJS.smartConfig=function(G,U){var l=[],j={},e,s={parent:AJS.$(document),addText:"Add",removeText:"Remove",dateRangeSeparatorText:"to",allowZeroRules:false,hidden:false},t=AJS.$.browser.msie&&parseFloat(AJS.$.browser.version)<8,I={defaultText:ActivityStreams.getMsg("gadget.activity.stream.config.chosen.default.placeholder"),noResultsText:ActivityStreams.getMsg("gadget.activity.stream.config.chosen.default.noresults")};U=AJS.$.extend(s,U);function L(){var u=0,v=G[u];while(AJS.$.inArray(v.key,l)>-1){v=G[++u]}return v}function X(u){u=u||L();if(typeof (u)==="string"){u=j[u]}return u.operators[0]}function H(u){return u?C(u).replace(/\./g,"\\.").replace(/#/g,"\\#").replace(/:/g,"\\:"):u}function C(u){return u.replace(/\s/g,"_")}function f(u){AJS.$("select.rule option."+H(u),e).not(":selected").addClass("hidden disabled").attr("disabled",true)}function Z(u){l.splice(AJS.$.inArray(u,l),1);AJS.$("select.rule option."+H(u),e).removeClass("hidden disabled").removeAttr("disabled")}function D(w,u){w=w.key?w:j[w];var v=w.key;if(w.unique){l.push(v);f(v);u.bind("change."+C(v),function(x){Z(v);u.unbind("change."+C(v))})}}function P(v,u,w){w=C(w||v);return AJS.$('<option value=""></option>').addClass(w).val(v).text(u)}function n(AC,x,u,AD){var AA=AJS.$("<select></select>").addClass(u);x=x?x.key||x:x;if(AD){AA.attr("name",AD.replace(/\s/,"-"))}if(AJS.$.isArray(AC)){for(var v=0,y=AC.length;v<y;v++){var AB=AC[v],z,w;z=AB.name;AB=AB.key;w=P(AB,z);if(AB==x){w.attr("selected","selected")}w.appendTo(AA)}}else{for(var AB in AC){var z=AC[AB],w;w=P(AB,z);if(AB==x||z==x){w.attr("selected","selected")}w.appendTo(AA)}}return AA}function m(v,x,u){m.input=m.input||AJS.$('<input class="text" type="text" value="">');var w=m.input.clone();if(v){w.val(v)}if(x){w.attr("name",x.replace(/\s/,"-"))}if(u){w.attr("title",u)}return w}function A(z,x,u,AC,AB){var y=n(z,"",u,AC).attr("multiple","multiple").addClass("multi-select").attr("rows",5),AA=AJS.$("option",y);if(x){if(typeof x==="string"){x=[x]}AA.filter(":first").removeAttr("selected");for(var v=0,w=x.length;v<w;v++){AA.filter('[value="'+x[v]+'"]').attr("selected","selected")}}else{for(var v=0,w=AA.length;v<w;v++){AA[v].selected=false}}if(AB){y.attr("title",AB)}return y}function S(z,v,AA,y){var w=AA.find(":input.user-input"),u=Y(z,v.key?v.key:v,y?w.val():""),x=y&&w.attr("data-parsed-time");w.unchosen().datepicker("destroy");if(w.length>1){w.not(":first").remove();w.nextAll("span.date-range-joiner").remove();w.filter(":first").replaceWith(u)}else{w.replaceWith(u)}R(u);if(!y){u.trigger("change");u.focus()}else{if(u.val()){if(x){u.attr("data-parsed-time",x)}u.trigger("change")}else{u.focus()}}}function B(w,v){if(typeof w==="string"){w=j[w]}var u=w.operators;return n(u,v,"operator").change(function(AA){var z=AJS.$(AA.target),AB=z.closest("div.config-row"),y=AB.find("select.rule").val(),x=z.val();S(y,x,AB,true)})}function a(u,v){v.find("select.operator").replaceWith(B(u));S(u,X(u),v)}function F(x){var v=n(G,x,"rule").change(function(AB){var AA=AJS.$(AB.target),z=AA.val(),y=t&&v.find("[value="+z+"]").hasClass("disabled"),AC=AA.closest("div.config-row").addClass(z.key);if(y){AA.find("option:not(.disabled):first").attr("selected","selected");AA.change()}else{a(z,AC);D(z,AA)}});for(var w=0,u=l.length;w<u;w++){AJS.$("option."+H(l[w]),v).addClass("hidden disabled").attr("disabled",true)}D(v.find("option:selected").val(),v);return v}function d(){var u=AJS.$('<span class="add-remove-buttons"></span>');AJS.$('<button class="add" type="button"></button>').attr("title",U.addText).append(AJS.$("<span></span>").text(U.addText)).click(k).appendTo(u);AJS.$('<button class="remove" type="button"></button>').attr("title",U.removeText).append(AJS.$("<span></span>").text(U.removeText)).click(K).appendTo(u);return u}function c(u){u.datepicker({onSelect:function(){r(u);u.trigger("change")}});u.bind("change",function(v){if(v.target!==document.activeElement){q(AJS.$(v.target))}});u.bind("keyup",function(v){AJS.$(v.target).datepicker("hide")});return u}function Y(AA,x,y){var v,z,w=y,u;if(x!=="between"){return J(AA,x,y)}else{v=AJS.$('<span class="date-range-container"></span>');if(y.indexOf(" ")!=-1){y=y.split(" ");w=y[0];u=y[1]}z=J(AA,x,u).addClass("date-range");if(w){z.datepicker("option","defaultDate",w)}J(AA,x,w).addClass("date-range").datepicker("option","onClose",function(AC,AB){if(AC){z.datepicker("option","defaultDate",AC);if(!z.val()){z.datepicker("show")}}}).appendTo(v);AJS.$('<span class="date-range-joiner"></span>').text(U.dateRangeSeparatorText).appendTo(v);z.appendTo(v);return v}}function q(u,w){var v,x=ActivityStreams.getDatepickerDefaults().dateFormat;if(w){u.attr("data-parsed-time",w)}else{w=r(u)}w=parseInt(w);if(w.toString()!="NaN"){v=AJS.$.datepicker.formatDate(x,new Date(w));u.val(v)}return u}function J(z,w,x){var y,v,u;if(typeof (z)==="string"){z=j[z]}y=z.values;u=z.key+"-"+w;if(z.type=="select"){v=A(y,x,z,u,z.helpText).removeClass(z)}else{v=m(x,u,z.helpText)}v.attr("data-rule",z.key).attr("data-operator",w);if(z.type==="date"){if(x&&typeof (x)==="number"){q(v,x)}c(v)}return v.addClass("update-on-change user-input")}function M(){return AJS.$('<div class="clearer"></div>')}function g(x,v,w){var y=AJS.$('<div class="config-row"></div>'),u;F(x).appendTo(y);B(x,v).appendTo(y);u=Y(x,v.key||v,w).appendTo(y);d().appendTo(y);M().appendTo(y);R(u);return y}function b(){var u=L();return g(u,X(u),"")}function V(w){var y=AJS.$.grep(w.rules||[],function(AA){return j[AA.rule]}),z=AJS.$('<div class="smart-config"></div>').toggleClass("hidden",w.hidden);l=[];if(!y.length&&!w.allowZeroRules){z.append(b())}else{for(var v=0,u=y.length;v<u;v++){var x=y[v];g(x.rule,x.operator,x.value).appendTo(z)}}return z}function h(){var w=e.find("div.config-row"),x=w.find("button.add"),v=w.find("button.remove"),u=U.allowZeroRules;if(u&&w.length===0){e.addClass("hidden")}else{if(w.length==1&&!u){v.attr("disabled","disabled").addClass("disabled")}else{v.removeAttr("disabled").removeClass("disabled")}if(l.length===G.length){x.attr("disabled","disabled").addClass("disabled")}else{x.removeAttr("disabled").removeClass("disabled")}}}function R(v,u){var w=u||"select.multi-select";if(t){return false}if(!v.is(w)){v=v.find(w)}if(v.length){v.chosen(I).data("chosen").bind("show",function(){v.parents(".config-row").addClass("chosen-dropdown")}).bind("hide",function(){v.parents(".config-row").removeClass("chosen-dropdown")});return true}return false}function k(u){var v=b();if(u&&u.preventDefault){u.preventDefault();AJS.$(u.target).closest("div.config-row").after(v)}else{e.append(v)}h();v.find(".user-input:first").focus();v.trigger("rowAdded.smartConfig");o();T()}function K(x){x.preventDefault();var y=AJS.$(x.target).closest("div.config-row"),u=y.find("select.rule"),w=u.find("option:selected").val(),v=y.closest("div.smart-config");v.unchosen();u.trigger("change."+C(w));y.remove();h();v.trigger("rowRemoved.smartConfig");T()}function W(){AJS.$("div.config-row",e).each(function(v,w){var y=AJS.$(w),x=y.find("button.remove"),u=y.find(".user-input");if(!x.hasClass("disabled")){x.click()}else{u.val("")}})}function r(u){var x=u.val(),w=u.attr("data-parsed-time"),v;if(x){v=Date.parse(x);x=(v&&v.getTime)?v.getTime():NaN;if(w!=x){u.attr("data-parsed-time",x)}}else{u.removeAttr("data-parsed-time")}return x}function O(){return AJS.$.map(AJS.$("div.config-row",e),function(AE,x){var z=AJS.$(AE).find(":input.user-input"),v=z.filter(":first"),AB=v.attr("data-rule"),w=v.attr("data-operator"),AD=v.val(),AA;AA=j[AB].type;if(AA==="date"){AD=r(v)}if(z.length>1){AD=[];for(var y=0;y<z.length;y++){var AC=z.filter(":nth("+y+")"),u=(AA==="date")?r(AC):AC.val();AD.push(u)}AD=AD.join(" ")}if(!AD){return }return{rule:AB,operator:w,value:AD,type:AA}})}function Q(u){var v;u=AJS.$.extend(U,u);v=V(u);e.replaceWith(v);e=v;h()}function i(u){e.toggleClass("hidden",u)}function E(){i(true)}function o(){if(AJS.$("div.config-row",e).length){i(false)}}function T(){e.trigger("contentResize.smartConfig")}function N(u,v){throw {key:u,message:v,toString:function(){return"Smart Config: "+v}}}function p(){var v=G.slice(0);for(var u=0,w=v.length;u<w;u++){var x=v[u];if(x.type==="select"&&(!x.values||AJS.$.isEmptyObject(x.values))){G.splice(u,1)}else{j[x.key]=x}}e=V(U).appendTo(U.parent);h()}p();AJS.$(document).bind("dateLocalizationLoaded.streams",function(){AJS.$("input.hasDatepicker","#config-form").each(function(v,u){u=AJS.$(u);q(u,u.attr("data-parsed-time"))})});return{apply:Q,getRules:O,getElement:function(){return e},hide:E,show:o,toggle:i,add:function(){if(l.length!=G.length){k()}else{N("smart.config.max.rules.reached","The maximum number of rules have already been added.")}},clear:W}};
/* module-key = 'com.atlassian.streams:streamsWebResources', location = '/js/streams-config.js' */
var ActivityStreams=ActivityStreams||{};ActivityStreams.config=function(AH,d,v){var M=ActivityStreams.setPref,p=ActivityStreams.getMsg,n={},K=[],w=ActivityStreams.getPref("maxProviderLabelCharacters");function q(AL){return p("gadget.activity.stream.config."+AL)}function AB(AN,AM){var AL=AM?AM+"."+AN:AN;return q(AL)}function b(){v.trigger("contentResize.streams")}function L(){M("rules",AJS.json.stringify({rules:[]}))}function J(AN,AL){var AM=AJS.$('<input type="checkbox" class="checkbox" value="">');AM.attr("checked",AN);if(AL){AM.attr("name",AL.replace(/\s/,"-"))}return AM}function T(AM,AL,AN){AN=AN||AM;return AJS.$('<option value=""></option>').addClass(AN).val(AM).text(AL)}function AG(AT,AO,AL,AU){var AR=AJS.$('<select class="select"></select>').addClass(AL);if(AU){AR.attr("name",AU.replace(/\s/,"-"))}if(AJS.$.isArray(AT)){for(var AM=0,AP=AT.length;AM<AP;AM++){var AS=AT[AM],AQ,AN;if(typeof AS==="string"){AQ=AB(AS,AL)}else{AQ=AS.name;AS=AS.key}AN=T(AS,AQ);if(AS==AO){AN.attr("selected","selected")}AN.appendTo(AR)}}else{for(var AS in AT){var AQ=AT[AS],AN;AN=T(AS,AQ);if(AS==AO||AQ==AO){AN.attr("selected","selected")}AN.appendTo(AR)}}return AR}function AF(AL,AN){AF.input=AF.input||AJS.$('<input class="text" type="text" value="">');var AM=AF.input.clone();if(AL){AM.val(AL)}if(AN){AM.attr("name",AN.replace(/\s/,"-"))}return AM}function B(){var AL=AJS.$('<div class="buttons-container"></div>'),AN=AJS.$('<div class="buttons"></div>'),AM=AJS.$('<button class="submit button" type="submit"></button>').text(q("save")).click(function(AO){AO.preventDefault();f()});AM.appendTo(AN);AJS.$('<a href="#" class="streams-cancel cancel"></a>').text(q("cancel")).click(function(AO){AO.preventDefault();g();V();r(d);O()}).appendTo(AN);AN.appendTo(AL);return AL}function u(AM){var AN=AJS.$('<div class="field-group"></div>').attr("id","max-results-container"),AL=AF(AM||10,"numofentries").attr("maxlength",2).attr("id","numofentries").addClass("numofentries update-on-change");AN.html(q("numofentries"));AN.find("span.input-container").append(AL);return AN}function AE(AM){var AP=AJS.$('<div class="field-group refresh-container"></div>'),AL=AJS.$('<div class="checkbox"></div>'),AN=AM!=="false",AO="refresh-checkbox";if(AN){AP.addClass("do-refresh")}J(AN,"refresh").attr("id",AO).change(function(AR){var AQ=AJS.$(AR.target);AQ.closest("div.refresh-container").toggleClass("do-refresh",AQ.is(":checked"))}).appendTo(AL);AJS.$("<label></label>").text(q("refresh")).attr("for",AO).appendTo(AL);AL.appendTo(AP);AG(["15","30","60","120"],AM,"refresh","refresh-interval").attr("id","refresh-select").appendTo(AP);return AP}function AA(AL){return AJS.$("<legend></legend>").text(AL)}function W(AM){var AL=AJS.$(AM.target).attr("checked");n.streams.toggle(!AL)}function Z(AO){var AM=AO?q("global.filters.single.description"):q("global.filters.description"),AL=AO?q("global.filters.single.add"):q("global.filters.add"),AN=AJS.$('<div class="global-filter-description stream-provider"></div>').text(AM+" ").attr("data-key","streams");AJS.$('<a href="#" class="add-filter-link" id="add-global-filter"></a>').text(AL).click(m).appendTo(AN);return AN}function AJ(AP,AO,AS){var AL=AJS.$('<fieldset id="streams-global-filters"></fieldset>'),AM=AP.options,AQ=AO&&AO.rules,AR=AQ&&AQ.length,AN=AS?q("global.filters.single"):q("global.filters");AA(AN).appendTo(AL);Z(AS).appendTo(AL);AM=s(AM);n[AP.key]=AJS.smartConfig(AM,{parent:AL,allowZeroRules:true,hidden:!AR,addText:q("add"),removeText:q("remove"),dateRangeSeparatorText:q("date.range.to"),rules:AQ});return AL}function N(AN){var AM=AJS.$(AN.target),AQ=AM.attr("checked"),AL=AM.closest("div.stream-provider"),AP=AL.attr("data-key"),AO=n[AP];if(AQ){AL.removeClass("provider-disabled");AM.attr("title",q("stream.disable"));AO&&AO.show()}else{AL.addClass("provider-disabled");AM.attr("title",q("stream.enable"));AO&&AO.hide()}}function c(AM,AL){AL=AL||2500;setTimeout(function(){AM.fadeOut(250,function(){AM.remove()})},AL)}function D(AN,AP,AL){var AM=AP.closest("div.stream-provider").find("span.add-filter-message"),AO=AJS.$('<span class="add-filter-message"></span>').text(AN).addClass(AL);if(AM.length){AM.replaceWith(AO)}else{AO.insertAfter(AP)}c(AO)}function m(AN){AN.preventDefault();var AM=AJS.$(AN.target),AL=AM.closest("div.stream-provider").attr("data-key");try{n[AL].add()}catch(AN){D(q(AN.key),AM,"filter-error")}}function t(){return AJS.$('<div class="available-streams-description"></div>').text(q("available.streams.description"))}function U(AN,AM){var AO=AJS.$('<div class="stream-provider-header checkbox"></div>'),AL=AN.key+"-enable";J(AM,AL).attr({id:AL,title:AM?q("stream.disable"):q("stream.enable")}).addClass("provider-enable").change(N).appendTo(AO);AC(AJS.$("<label></label>").attr("for",AL).attr("title",AN.title||"").text(AN.name).appendTo(AO));if(AN.options&&AN.options.length){AJS.$('<a href="#" class="stream-provider-customize-link"></a>').text("("+q("add.filter")+")").click(m).appendTo(AO)}return AO}function G(AO,AN){var AL=AO.key,AP=AN?AN.rules:[],AM=!(AN&&AN.disabled),AQ=AJS.$('<div class="stream-provider"></div>').attr("data-key",AL).toggleClass("provider-disabled",!AM);U(AO,AM).appendTo(AQ);if(AO.options&&AO.options.length){n[AL]=AJS.smartConfig(AO.options,{parent:AQ,allowZeroRules:true,hidden:!(AP&&AP.length),addText:q("add"),removeText:q("remove"),dateRangeSeparatorText:q("date.range.to"),rules:AP})}return AQ}function R(AQ){var AN=AQ.providerAliasOptionKey,AM=AQ.options;for(var AO=0,AL=AM.length;AO<AL;AO++){var AP=AM[AO];if(AP.key===AN){return AP}}return null}function i(AN,AP){var AX=AN.key,AM=AN.name,AR=AN.applinkName,AS=R(AN),AQ=(AP&&AP.rules&&AP.rules.length&&AP.rules[0].value)||[],AL=AJS.$('<div class="aliased-providers"></div>');if(AS){AL.attr({"data-key":AX,"data-option":AS.key,"data-type":AS.type});for(var AT in AS.values){var AO=AS.values[AT],AW=!AP||((AP&&!AP.disabled)&&(!AQ.length||AJS.$.inArray(AT,AQ)!==-1)),AU=AJS.$('<div class="stream-provider"></div>');AO=AR?AJS.format(p("gadget.activity.stream.config.option.name"),AO,AR):AO;AU.attr({"data-key":AT,"data-name":AO});var AV=AT.replace(/@[^@]+$/,"");U({key:AX+"-"+AT,name:AO,title:AV},AW).appendTo(AU);AU.appendTo(AL)}}return AL}function AD(AR,AQ){var AM=AJS.$('<fieldset id="streams-available-streams"></fieldset>');AA(q("available.streams")).appendTo(AM);t().appendTo(AM);for(var AO=0,AL=AR.length;AO<AL;AO++){var AP=AR[AO],AN=AP.key;if(AP.providerAliasOptionKey){i(AP,AQ[AN]).appendTo(AM)}else{G(AP,AQ[AN]).appendTo(AM)}K.push(AN)}return AM}function H(AM,AN){var AL=AJS.$('<fieldset id="streams-display-options"></fieldset>');AA(q("display.options")).appendTo(AL);u(AM).appendTo(AL);AE(AN).appendTo(AL);return AL}function s(AM){for(var AN=0,AL=AM.length;AN<AL;AN++){if(AM[AN].type==="date"){AM[AN].operators.splice(0,0,{key:"is",name:q("is.operator")});return AM}}return AM}function Y(AN){var AO=[];for(var AM=0,AL=AN.length;AM<AL;AM++){if(AN[AM].key==="streams"){AN[AM].options=s(AN[AM].options)}AO=AO.concat(AN[AM].options)}return AO}function Q(AN,AM,AL){AJ(AN[0],AM.streams).appendTo(AL);AN.splice(0,1);delete AM.streams;AD(AN,AM).appendTo(AL)}function j(AM,AS,AL){var AN={key:"streams",name:"",options:[]},AP={provider:"streams",rules:[]};for(var AR=0,AW=AM.length;AR<AW;AR++){var AV=AM[AR],AO=AV.key,AX=AV.options;for(var AQ=0,AU=AX.length;AQ<AU;AQ++){var AT=AX[AQ];AT.key=AO+" "+AT.key;AN.options.push(AT)}}AJS.$.each(AS,function(Ac,Aa){var Ab=Aa.rules;for(var AZ=0,AY=Ab.length;AZ<AY;AZ++){Ab[AZ].rule=Ac+" "+Ab[AZ].rule}AP.rules=AP.rules.concat(Ab)});AJ(AN,AP,true).appendTo(AL)}function l(AR){for(var AN=0;AN<AR.length;AN++){var AP=AR[AN],AM=AP.providerAliasOptionKey;if(AM){for(var AL=0,AQ=AP.options.length;AL<AQ;AL++){var AO=AP.options[AL];if(AO.key===AM&&(!AO.values||AJS.$.isEmptyObject(AO.values))){AR.splice(AN--,1)}}}}return AR}function a(AO,AR){var AN=AJS.$('<form action="" id="config-form" class="aui top-label"></form>'),AP={};AR=AR||[];for(var AM=0,AL=AR.length;AM<AL;AM++){var AQ=AR[AM];AP[AQ.provider]=AQ}l(AO);if(AO.length>2){Q(AO,AP,AN)}else{j(AO,AP,AN)}H(d.numofentries,d.refresh).appendTo(AN);B().appendTo(AN);return AN}function X(AM){var AL=AM&&AM.target?AJS.$(AM.target):AJS.$("#stream-title-edit"),AN=AL.val();AJS.$("#stream-title").text(AN)}function I(AN){var AM=AJS.$("#stream-title"),AL=AJS.$('<input id="stream-title-edit" value="">');AN=AN||AJS.$("#stream-title").text();AL.val(AN).insertAfter(AM);return AL}function V(){AJS.$("div.activity-stream-container").removeClass("filter-view").addClass("filter-hidden");b()}function P(AN){for(var AM=0,AL=AN.length;AM<AL;AM++){var AP=AN[AM],AO;if(AP.disabled){AO=n[AP.provider];AO&&AO.clear()}}}function F(AL){return AL?AL.replace(/\./g,"\\.").replace(/#/g,"\\#").replace(/:/g,"\\:").replace(/@/g,"\\@"):AL}function h(AL){if(AL==="streams"){return n.streams.getElement().find("div.config-row").length>0}else{return AJS.$("#"+F(AL)+"-enable").attr("checked")}}function k(){var AM=AJS.$("div.aliased-providers","#config-form"),AS=[];for(var AO=0,AL=AM.length;AO<AL;AO++){var AR=AJS.$(AM[AO]),AP=AR.find("input.checkbox"),AN=[],AQ={provider:AR.attr("data-key"),rules:[]};AP.each(function(AV,AU){AU=AJS.$(AU);var AT;if(AU.attr("checked")){AN.push(AU.closest("div.stream-provider").attr("data-key"))}});if(AP.length&&!AN.length){AQ.disabled=true}else{if(AP.length!==AN.length){AQ.rules.push({rule:AR.attr("data-option"),operator:"IS",value:AN,type:AR.attr("data-type")})}}AS.push(AQ)}return AS}function E(){var AS=[],AO,AP={};if(K.length){AJS.$.each(n,function(AT,AW){var AU=h(AT),AV={provider:AT,rules:AU?AW.getRules():[]};if(!AU){AV.disabled=true}AS.push(AV)});AS=AS.concat(k())}else{AO=n.streams.getRules()||[];for(var AN=0,AL=AO.length;AN<AL;AN++){var AR=AO[AN],AQ=AR.rule.split(" "),AM=AQ[0];AR.rule=AQ[1];AP[AM]=AP[AM]||[];AP[AM].push(AR)}AJS.$.each(AP,function(AT,AV){var AU=h("streams"),AW={provider:AT,rules:AU?AV:[]};if(!AU){AW.disabled=true}AS.push(AW)})}return AS}function A(AN,AL){var AM=AJS.$.inArray(AN,AL);if(AM!=-1){AL.splice(AM,1)}}function o(AM){var Aa={maxResults:AJS.$("#numofentries").val()},Ad={},Ac=K.concat([]);AM=AM||E();for(var AX=0,AU=AM.length;AX<AU;AX++){var Ae=AM[AX],Ab=Ae.provider,AT=Ae.rules||[];if(Ae.disabled){A(Ab,Ac)}else{for(var AW=0,AZ=AT.length;AW<AZ;AW++){var AL=AT[AW],AQ=AL.rule,AV=AL.value,AR,AO=AL.type,AN,AS,AY,AP;if(AV){AV=AJS.$.isArray(AV)?AV:AJS.$.trim(AV);if(AV.length){AN=ActivityStreams.handleSpecialCases(AL);AV=AN.value;AR=AN.operator;AS=Ab+" "+AQ+" "+AR;AY=[AQ,AR.toUpperCase(),AV].join(" ");AP=Ad[AS];if(AP){Aa[Ab][AP-1]=Aa[Ab][AP-1]+" "+AV}else{Aa[Ab]=Aa[Ab]||[];Aa[Ab].push(AY);Ad[AS]=Aa[Ab].length}}}}}}if(Ac.length<K.length){Aa.providers=Ac.join(" ")}return Aa}function g(){AJS.$("div.activity-stream-validation-error","#config-form").remove()}function AK(AL){var AM=p("gadget.activity.stream.error."+AL);if(arguments.length>1){AM=AJS.format(AM,Array.prototype.slice.call(arguments,1))}return AJS.$('<div class="activity-stream-validation-error"></div>').text(AM)}function z(AL){AL=parseInt(AL);if(isNaN(AL)||AL<1){AK("pref.numofentries.number").appendTo(AJS.$("#max-results-container"));return false}return true}function C(){var AM=true,AL=ActivityStreams.getDatepickerDefaults().dateFormat;AJS.$("input.hasDatePicker:visible","#config-form").each(function(AN,AO){AO=AJS.$(AO);var AP=AO.attr("data-parsed-time");if(AP&&AP.toString()==="NaN"){AK("invalid.date",AJS.$.datepicker.formatDate(AL,new Date())).appendTo(AO.closest("div.config-row"));AM=false;return false}});return AM}function e(AM){var AL=true;g();AL=AL&&C()&&z(AM.numofentries||AM.maxResults);b();return AL}function x(AL){e(o())}function f(){var AM=E(),AL=AJS.$("#numofentries").val(),AO=AJS.$("#stream-title-edit").val(),AN={numofentries:AL};if(AM.length){AJS.$.extend(AN,o(AM));M("rules",AJS.json.stringify({providers:AM}))}else{L()}if(!O()){return }M("refresh",AJS.$("#refresh-checkbox").is(":checked")?AJS.$("#refresh-select").val():"false");M("numofentries",AL);M("title",AO);X();M("isConfigured",true);M("isReallyConfigured",true);d=AJS.$.extend(d,{title:AO,numofentries:AL,rules:AM});V();P(AM);AJS.$("#config-form").trigger("saveFilter.streams")}function O(){var AL=o();if(!e(AL)){return false}v.trigger("contentUpdate.streams",AL);b();return true}function S(AL){var AM=[];for(var AN=0;AN<AL.length;AN++){AM=AM.concat(AL[AN].rules)}return[{provider:"streams",rules:AM}]}function r(AM){var AR=AM.refresh,AS=AM.title,AL=AM.rules||{};if(!K.length&&AL.length>1){AL=S(AL)}for(var AP=0,AQ=AL.length;AP<AQ;AP++){var AO=AL[AP],AT=AO.provider,AN=n[AT];AN.apply(AO);AJS.$("#"+F(AT)+"-enable").attr("checked",!AO.disabled).trigger("change");if(AO.rules&&AO.rules.length){AN.show()}}AJS.$("#stream-title").text(AS);AJS.$("#stream-title-edit").val(AS);AJS.$("#numofentries").val(AM.numofentries);AJS.$("#refresh-checkbox").attr("checked",AR!=="false").trigger("change");AJS.$("#refresh-select").val(AR)}function y(){if(y.shouldRun){AJS.$(":input.update-on-change","#config-form").live("change",x);AJS.$(document).unbind("contentLoaded.streams")}else{y.shouldRun=true}}function AC(AM,AL){var AN=AM.text();AL=AL||w||50;if(AN.length>AL&&new RegExp("[^-\\s]{"+AL+",}").test(AN)){AM.html(AN.substring(0,AL)+"&#133").attr("title",AN)}return AM}function AI(){I(d.title);a(AH,d.rules).appendTo(v);y();O()}AI();AJS.$(document).bind("contentLoaded.streams",y);return{}};
/* module-key = 'com.atlassian.streams:streamsWebResources', location = '/js/activity-stream.js' */
var ActivityStreams=ActivityStreams||{};AJS.EventQueue=AJS.EventQueue||[];ActivityStreams.stream=function(T){var L=ActivityStreams.getPref,M=ActivityStreams.setPref,X=ActivityStreams.getMsg,l=T.id,F=T.baseUrl||"",i=T.container,N,O=T.loaded||function(){},c=T.resized||function(){},q=!!T.isConfigurable,e=L("isReallyConfigured")==="true",C=!T.hideHeader,w=L("renderingContext"),h,d=(T.maxResults&&parseInt(T.maxResults))||25,f={maxResults:d},u={title:L("title"),numofentries:L("numofentries"),refresh:L("refresh"),rules:n()};ActivityStreams.setBaseUrl(F);function n(){var x=L("rules"),y;if(x){y=a(x);return y&&y.providers}return""}function a(x){if(!x){return undefined}return AJS.json.parse(x.replace(/&#34;/g,'"'))}function k(){N.addClass("filter-view").removeClass("filter-hidden").trigger("contentResize.streams")}function K(){return AJS.$('<a href="#" id="activity-stream-feed" target="_top"></a>').attr("title",X("gadget.activity.stream.feed"))}function G(AA){var y=AJS.$('<div class="activity-stream-header"></div>'),x=AJS.$('<div class="activity-stream-title-container"></div>').appendTo(y),z;AA=AA||u.title;AJS.$('<h2 id="stream-title"></h2>').text(AA).appendTo(x);K().appendTo(y);z=AJS.$('<div class="activity-stream-views"></div>').append(AJS.$('<span class="activity-stream-view full-view-icon"></span>').attr("title",X("gadget.activity.stream.full.view"))).append(AJS.$('<span class="activity-stream-view list-view-icon"></span>').attr("title",X("gadget.activity.stream.list.view")));if(q){z.append(AJS.$('<span class="activity-stream-view filter-view-icon" id="filter-icon"></span>').attr("title",X("gadget.activity.stream.filter")))}z.appendTo(y);AJS.$('<div class="clearer"></div>').appendTo(y);return y}function v(){return AJS.$('<div class="activity-stream-sparse-header"></div>').append(K()).append('<div class="throbber-placeholder"></div>').append('<div class="clearer"></div>')}function H(z){var x=AJS.$('<div class="applinks-auth-messages"></div>'),y=AJS.$('<div class="aui-message warning closeable shadowed applinks-auth-request"></div>');y.append(J());y.append(r(z));ActivityStreams.makeMessageCloseable(y);x.append(y);return x}function r(AB){var AA=AJS.$("<ul></ul>");for(var y=0,x=AB.length;y<x;y++){var AC=AB[y],z=ActivityStreamsApplinks.createAuthRequestBanner(AC);AA.append(z)}return AA}function J(){var x=AJS.$('<p><span class="aui-icon icon-applinks-key"></span></p>');x.append(ActivityStreams.getMsg("gadget.activity.stream.auth.request.header"));return x}function W(){return AJS.$('<div class="activity-item no-activity"></div>').text(X("gadget.activity.stream.no.activity.found"))}function Z(z,AC){var y=AJS.$('<div class="activity-item-actions"></div>'),AA=AJS.$('<span class="activity-item-action"></span>');for(var AB=0,x=AC.length;AB<x;AB++){var AD=AC[AB](z);AD&&AD.clone&&AA.clone().append(AD.clone(true)).appendTo(y)}return y}function p(y,AB){var AA=AJS.$('<div class="activity-item-info"></div>'),AD=ActivityStreams.getActions(y.type),x=y.links["http://streams.atlassian.com/syndication/icon"],z=y.links.alternate,AC;if(x){AJS.$('<img class="icon" height="16" width="16" alt="">').attr({src:x,alt:y.iconTitle,title:y.iconTitle}).appendTo(AA)}if(z){AC=AJS.$("<a></a>").attr("href",z)}else{AC=AJS.$("<span></span>")}AC.addClass("timestamp").text(AB||"").appendTo(AA);if(z){AJS.$('<input type="hidden" class="activity-item-link">').attr("value",z).appendTo(AA)}if(AD&&w!=="view-issue"){Z(y,AD).appendTo(AA)}AJS.$('<div class="activity-item-action-status-container hidden">').appendTo(AA);return AA}function U(AM){var y=AM.now||AJS.Date.handleTimezoneOffset(new Date()),AE=AJS.$('<div class="activity-item"></div>'),AG=AJS.Date.getFineRelativeDate(AM.date||AJS.Date.parse(AM.updated,AM.timezoneOffset),y),AJ=AJS.$('<span class="user-icon"></span>').appendTo(AE),AB=AM.authors[0],AD=AB&&(AB.name||AB.username),AI=AM.summary||AM.content,AK=AM.application,AH=48,AA,x,AF=AJS.$('<div class="activity-item-summary"></div>'),z;if(AK){AK=AK.replace("com.atlassian.","").replace(/\./,"-");AE.addClass(AK+"-activity-item")}if(AB&&AB.photos){for(var AC=0,AL=AB.photos.length;AC<AL;AC++){x=AB.photos[AC];if(x.width==AH){break}}AA=AJS.$('<img alt="">').attr({alt:AD,title:AD,src:x.uri,width:x.width,height:x.height});if(AB.uri){AJS.$('<a href=""></a>').attr("href",AB.uri).append(AA).appendTo(AJ)}else{AA.appendTo(AJ)}}if(AJS.$("<div/>").html(AI).find("div.activity-item-description").size()>0||AM.title==AI){AF.html(AI)}else{AF.html(AM.title).append(AJS.$("<div class='activity-item-description'></div>").html(AI))}z=AF.find("ul.commit-list");if(z.length){z.addClass("modified")}AF.appendTo(AE);AE.append(p(AM,AG));AJS.$('<div class="clearer"></div>').appendTo(AE);return AE}function E(x){return AJS.$('<div class="date-header"></div>').text(x)}function I(){var x=AJS.$('<a href="#" id="activity-stream-show-more" class="hidden"></a>').click(function(y){y.preventDefault();AJS.$("#activity-stream-show-more").addClass("loading");f.maxResults=parseInt(f.maxResults)+d;Y()});AJS.$("<span></span>").text(X("gadget.activity.stream.show.more")).appendTo(x);return x}function b(x){x.empty();AJS.$.ajax({url:ActivityStreams.getBaseUrl()+"/rest/activity-stream/1.0/config",type:"get",dataType:"json",global:false,success:function(y){h=ActivityStreams.config(y.filters,u,x);N.addClass("is-configurable");k()},error:function(y){AJS.messages.error(x,{body:X("gadget.activity.stream.error.loading.filters"),closeable:false});N.trigger("contentUpdate.streams",t());k()}})}function R(){var y=ActivityStreams.getPrefArray("keys"),AA=L("username"),z=L("itemKeys"),x;if(y&&y.length){x={keys:y}}if(AA){x=x||{};x.username=AA}if(z){x=x||{};x.itemKeys=z}return x}function B(){var AA=R(),x,z,AB=q?M:function(){},y;if(AA){x={keys:"key",username:"user",itemKeys:"issue-key"};AJS.$.each(AA,function(AC,AD){z=z||[];if(AD!="__all_projects__"){z.push({rule:x[AC],operator:"is",value:AD})}AB(AC,"")});if(z){y=[{provider:"streams",rules:z}];AB("rules",AJS.json.stringify({providers:y}));u.rules=y}e=true;AB("isReallyConfigured",true)}}function t(){var AA={maxResults:f.maxResults},AD=u.rules||[],AF=[];for(var AE=0,AL=AD.length;AE<AL;AE++){var AI=AD[AE],z=AI.provider,AK=AI.rules,x=[];if(!AI.disabled){if(z!=="streams"){AF.push(z)}for(var AB=0,AG=AK.length;AB<AG;AB++){var AH=AK[AB],AC=ActivityStreams.handleSpecialCases(AH),y=AC.operator,AJ=AC.value;x.push([AH.rule,y.toUpperCase(),AJ].join(" "))}AA[z]=x}}if(AF.length<(AD.length-1)){AA.providers=AF.join(" ")}return AA}function V(z){var y=AJS.Cookie.read("streams.view."+l)||"full-view",x=AJS.$('<div class="activity-stream-container"></div>').attr("id",z).addClass(y);if(C){x.append(G())}else{x.append(v());AJS.$("body").addClass("no-title")}if(!e){B()}AJS.$('<div id="filter-options"></div>').appendTo(x);AJS.$('<div class="blanket-container"></div>').append(AJS.$('<div class="aui-blanket"></div>')).append(AJS.$('<div class="applinks-auth-confirmation-container"></div>')).append(AJS.$('<div id="activity-stream"></div>')).append(I()).appendTo(x);return x}function Q(x){var z='@import url("'+x+'");',y=AJS.$('<style type="text/css"></style>');if(y[0].styleSheet){y[0].styleSheet.cssText=z;return y}else{return AJS.$('<link media="all" rel="stylesheet" type="text/css">').attr("href",x)}}function s(y,x,AA){var z=U(y);if(AA){z.addClass("activity-item-grouped")}z.appendTo(x)}function S(y){var x=AJS.$(y.target);if(x.hasClass("full-view-icon")){N.addClass("full-view filter-hidden").removeClass("list-view filter-view");AJS.Cookie.save("streams.view."+l,"full-view")}else{if(x.hasClass("list-view-icon")){N.removeClass("full-view filter-view").addClass("list-view filter-hidden");AJS.Cookie.save("streams.view."+l,"list-view")}else{N.toggleClass("filter-view").toggleClass("filter-hidden")}}c()}function A(x){AJS.$("#activity-stream-feed").attr("href",x)}function Y(z,y){var x,AB=!!y,AA=D();if(AB){f=y;d=parseInt(y.maxResults)||d}else{y=f}x=ActivityStreams.getStreamUrl(y);if(AB&&Y.url==x&&Y.title==AA){return }Y.url=x;Y.title=AA;g(x)}function g(x){if(Y.xhr){Y.xhr.abort&&Y.xhr.abort()}N.addClass("loading");Y.xhr=AJS.$.ajax({type:"get",url:x,global:false,dataType:(AJS.$.browser.msie)?"text":"xml",success:function(AY,AM){if(AM!=="parsererror"){var AE=jAtom(AY),AL,AV,AC,AI,AW,AO,AS={},AR,z=AJS.Date.handleTimezoneOffset(new Date(),AE.timezoneOffset);if(typeof (ActivityStreams.sortActivityItems)==="function"){AE=ActivityStreams.sortActivityItems(AE)||AE}AR=(typeof (ActivityStreams.groupActivityItems)==="function")?ActivityStreams.groupActivityItems:function(Aa,AZ){var Ab=Aa.authors[0].username;if(Ab==="anonymous"){return false}return Ab&&Ab===AZ.authors[0].username};AL=AE.items;AV=AL.length;AI=AE.authMessages;A(AE.self+"&title="+encodeURIComponent(D()));AC=AJS.$("#activity-stream");AW=AC.empty().clone();if(AE.links["http://streams.atlassian.com/syndication/timedout-increase"]||AE.links["http://streams.atlassian.com/syndication/timedout-retry"]){var AG,AX,AK;AK=AE.timedOutSources.length>1?".plural":"";if(AE.links["http://streams.atlassian.com/syndication/timedout-increase"]){AG=AE.links["http://streams.atlassian.com/syndication/timedout-increase"][0];AX=X("gadget.activity.stream.error.timeout.increase"+AK)}else{AG=AE.links["http://streams.atlassian.com/syndication/timedout-retry"][0];AX=X("gadget.activity.stream.error.timeout.retry"+AK)}var y=AJS.$.makeArray(AJS.$.map(AE.timedOutSources,function(AZ){return AJS.$("<div/>").text(AZ).html()})).join(", ");var AD=AJS.$("<div></div>").html(AJS.format(AX,AE.timedOutSources.length,y,AG)),AN=AJS.messages.warning(AW,{body:AD.html(),closeable:true});ActivityStreams.makeMessageCloseable(AN.find("div.aui-message"));AN&&AN.find("a").click(function(AZ){AZ.preventDefault();g(AG)})}if(AE&&AI&&AI.length>0){H(AI).appendTo(AW)}if(!AE||!AV){W().appendTo(AW)}else{for(var AQ=0;AQ<AV;AQ++){var AU=AL[AQ],AF=false,AB=AU.authors[0].username,AA=AU.date=AJS.Date.parse(AU.updated,AU.timezoneOffset),AP=AJS.Date.getCoarseRelativeDate(AA,z),AH=AU.links["http://streams.atlassian.com/syndication/css"];AU.now=z;if(AP&&AP!==AO){E(AP).appendTo(AW);AO=AP}else{AF=AQ&&AR(AU,AL[AQ-1])}if(AH){AJS.$.each(AH,function(Aa,AZ){AS[AZ]=AS[AZ]||AZ})}s(AU,AW,AF)}AJS.$("div.activity-item",AW).mouseover(function(){AJS.$(this).addClass("hover")}).mouseout(function(){AJS.$(this).removeClass("hover")})}for(var AT in AS){var AJ=AJS.$('link[href="'+AT+'"][rel="stylesheet"]');if(!AJ.length){Q(AT).appendTo(AJS.$("head"))}}AJS.$("#activity-stream-show-more").removeClass("loading").toggleClass("hidden",(AV<f.maxResults));AC.replaceWith(AW);N.trigger("contentLoaded.streams");O();if(AJS.$("img:uncached",AW).length>0){if(AJS.debug){console.log("At least one uncached image is in the stream. We will have to delay resize until they are loaded.")}AJS.$("#activity-stream").waitForImages(function(){if(AJS.debug){console.log("All images in stream have now loaded. Proceeding with resize...")}c()})}else{if(AJS.debug){console.log("All images are loaded, so no need to wait to resize.")}c()}}AJS.$(".activity-item a").bind("click",m)},error:function(y){AJS.messages.error(AJS.$("#activity-stream"),{body:X("gadget.activity.stream.error.loading.feed"),closeable:true});AJS.$("#activity-stream-show-more").removeClass("loading").addClass("hidden");N.trigger("contentLoaded.streams");O();c()},complete:function(){N.removeClass("loading");delete Y.xhr}})}function m(x){var AA=AJS.$(x.currentTarget.offsetParent);var z=AJS.$(x.currentTarget.parentNode);var AB=z.attr("class").replace(" ","_");var y=AJS.$(x.currentTarget).attr("class").replace(" ","_");var AC="streams";if(AA.hasClass("confluence-activity-item")){AC=AC+".confluence"}else{if(AA.hasClass("jira-activity-item")){AC=AC+".jira"}else{if(AA.hasClass("bamboo-activity-item")){AC=AC+".bamboo"}else{if(AA.hasClass("fisheye-activity-item")){AC=AC+".fisheye"}else{if(AA.hasClass("crucible-activity-item")){AC=AC+".crucible"}}}}}if(AB){AC=AC+"."+AB}if(y){AC=AC+"."+y}AJS.EventQueue.push({name:AC,properties:{itemText:AJS.$(x.currentTarget).text()}})}function j(){var x=AJS.$("body").addClass("initializing");N=V(l).appendTo(i);N.bind("contentLoaded.streams",function(){x.removeClass("initializing")});AJS.$("span.activity-stream-view",N).click(S).mouseover(function(){AJS.$(this).addClass("hover")}).mouseout(function(){AJS.$(this).removeClass("hover")});N.bind("contentResize.streams contentResize.smartConfig",c).bind("contentUpdate.streams",Y).bind("showConfiguration.streams",function(){if(!N.hasClass("is-configurable")){b(AJS.$("#filter-options",N))}else{k()}});AJS.$(document).bind("applinks.auth.approved",function(y){y.preventDefault();Y()});if(q){if(!e){N.trigger("showConfiguration.streams");N.bind("saveFilter.streams",function(){M("isConfigured",true);M("isReallyConfigured",true);N.unbind("saveFilter.streams")});N.addClass("filter-view")}else{N.trigger("contentUpdate.streams",t());N.addClass("filter-hidden")}}else{N.trigger("contentUpdate.streams",t());N.addClass("not-configurable")}}function o(){AJS.$("#activity-stream .activity-item, #activity-stream .date-header").css("display","none").addClass("streams-animate-hidden");P()}function D(){var x=AJS.$("#stream-title-edit");return x.css("display")=="none"?AJS.$("#stream-title").text():x.val()}function P(){var z=AJS.$("#activity-stream .streams-animate-hidden"),y,x;if(z.length){y=z.filter(".activity-item:last");x=y.prevAll(".date-header:first");if(x.hasClass("streams-animate-hidden")){x.fadeIn("slow",function(){x.removeClass("streams-animate-hidden")})}y.fadeIn("slow",function(){y.removeClass("streams-animate-hidden")});setTimeout(P,3000)}}j();return{load:j,update:Y,getMaxResults:function(){return f.maxResults},animate:o}};function ActivityFeed(C,B,A){return ActivityStreams.stream({id:C,url:B,maxResults:A})};
/* module-key = 'com.atlassian.streams:streamsWebResources', location = '/js/chosen.jquery.js' */
(function(){var D,E,C,A;var B=function(F,G){return function(){return F.apply(G,arguments)}};A=this;D=jQuery;D.fn.extend({chosen:function(F){return D(this).each(function(H){var G,I;I=D(this);G=I.data("chosen");if(!G){G=new E(this,F);return I.data("chosen",G)}})},unchosen:function(){return D(this).each(function(G){var F,H;H=D(this);F=H.data("chosen");if(F){F.remove();return H.data("chosen",null)}})}});E=(function(){function F(H,G){this.settings={defaultText:"Select some options",defaultTextSingle:"Select an option",noResultsText:'No results match "{0}"'};D.extend(this.settings,G);this.set_default_values();this.form_field=H;this.form_field_jq=D(this.form_field).addClass("chosen-active");this.is_multiple=this.form_field.multiple;this.is_rtl=this.form_field_jq.hasClass("chzn-rtl");this.default_text_default=this.form_field.multiple?this.settings.defaultText:this.settings.defaultTextSingle;this.set_up_html();this.register_observers()}F.prototype.set_default_values=function(){this.click_test_action=B(function(G){return this.test_active_click(G)},this);this.active_field=false;this.mouse_on_container=false;this.results_showing=false;this.result_highlighted=null;this.result_single_selected=null;return this.choices=0};F.prototype.set_up_html=function(){this.container_id=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,"_"):this.generate_field_id();this.container_id+="_chzn";this.default_text=this.form_field_jq.data("placeholder")?this.form_field_jq.data("placeholder"):this.default_text_default;this.container=D("<div />",{id:this.container_id,"class":"chzn-container "+(this.is_rtl?"chzn-rtl":"")});if(this.is_multiple){this.container.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>')}else{this.container.html('<a href="javascript:void(0)" class="chzn-single"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>')}this.form_field_jq.hide().after(this.container);this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single"));this.dropdown=this.container.find("div.chzn-drop").first();this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chzn-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();if(this.is_multiple){this.search_choices=this.container.find("ul.chzn-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chzn-search").first();this.selected_item=this.container.find(".chzn-single").first()}this.results_build();return this.set_tab_index()};F.prototype.register_observers=function(){this.dispatcher=D({});this.container.click(B(function(G){return this.container_click(G)},this));this.container.mouseenter(B(function(G){return this.mouse_enter(G)},this));this.container.mouseleave(B(function(G){return this.mouse_leave(G)},this));this.search_results.click(B(function(G){return this.search_results_click(G)},this));this.search_results.mouseover(B(function(G){return this.search_results_mouseover(G)},this));this.search_results.mouseout(B(function(G){return this.search_results_mouseout(G)},this));this.form_field_jq.bind("liszt:updated",B(function(G){return this.results_update_field(G)},this));this.search_field.blur(B(function(G){return this.input_blur(G)},this));this.search_field.keyup(B(function(G){return this.keyup_checker(G)},this));this.search_field.keydown(B(function(G){return this.keydown_checker(G)},this));if(this.is_multiple){this.search_choices.click(B(function(G){return this.choices_click(G)},this));return this.search_field.focus(B(function(G){return this.input_focus(G)},this))}else{return this.selected_item.focus(B(function(G){return this.activate_field(G)},this))}};F.prototype.unregister_observers=function(){return this.form_field_jq.unbind("liszt:updated")};F.prototype.remove_html=function(){this.form_field_jq.show();return this.container.remove()};F.prototype.trigger=function(){this.dispatcher.trigger.apply(this.dispatcher,arguments);return this};F.prototype.bind=function(){this.dispatcher.bind.apply(this.dispatcher,arguments);return this};F.prototype.container_click=function(G){if(G&&G.type==="click"){G.stopPropagation()}if(!this.pending_destroy_click){if(!this.active_field){if(this.is_multiple){this.search_field.val("").attr("title",null)}D(document).click(this.click_test_action);this.results_show()}else{if(!this.is_multiple&&G&&(D(G.target)===this.selected_item||D(G.target).parents("a.chzn-single").length)){G.preventDefault();this.results_toggle()}}return this.activate_field()}else{return this.pending_destroy_click=false}};F.prototype.mouse_enter=function(){return this.mouse_on_container=true};F.prototype.mouse_leave=function(){return this.mouse_on_container=false};F.prototype.input_focus=function(G){if(!this.active_field){return setTimeout((B(function(){return this.container_click()},this)),50)}};F.prototype.input_blur=function(G){if(!this.mouse_on_container){this.active_field=false;return setTimeout((B(function(){return this.blur_test()},this)),100)}};F.prototype.blur_test=function(G){if(!this.active_field&&this.container.hasClass("chzn-container-active")){return this.close_field()}};F.prototype.close_field=function(){D(document).unbind("click",this.click_test_action);if(!this.is_multiple){this.selected_item.attr("tabindex",this.search_field.attr("tabindex"));this.search_field.attr("tabindex",-1)}this.active_field=false;this.results_hide();this.trigger("hide");this.container.removeClass("chzn-container-active");this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};F.prototype.activate_field=function(){if(!this.is_multiple&&!this.active_field){this.search_field.attr("tabindex",this.selected_item.attr("tabindex"));this.selected_item.attr("tabindex",-1)}this.trigger("show");this.container.addClass("chzn-container-active");this.active_field=true;this.search_field.val(this.search_field.val());return this.search_field.focus()};F.prototype.test_active_click=function(G){if(D(G.target).parents("#"+this.container_id).length){return this.active_field=true}else{return this.close_field()}};F.prototype.results_build=function(){var I,L,H,K,G,J;H=new Date();this.parsing=true;this.results_data=A.SelectParser.select_to_array(this.form_field);if(this.is_multiple&&this.choices>0){this.search_choices.find("li.search-choice").remove();this.choices=0}else{if(!this.is_multiple){this.selected_item.find("span").text(this.default_text)}}I="";J=this.results_data;for(K=0,G=J.length;K<G;K++){L=J[K];if(L.group){I+=this.result_add_group(L)}else{if(!L.empty){I+=this.result_add_option(L);if(L.selected&&this.is_multiple){this.choice_build(L)}else{if(L.selected&&!this.is_multiple){this.selected_item.find("span").text(L.text)}}}}}this.show_search_field_default();this.search_field_scale();this.search_results.html(I);return this.parsing=false};F.prototype.result_add_group=function(G){if(!G.disabled){G.dom_id=this.container_id+"_g_"+G.array_index;return'<li id="'+G.dom_id+'" class="group-result">'+D("<div />").text(G.label).html()+"</li>"}else{return""}};F.prototype.result_add_option=function(H){var G;if(!H.disabled){H.dom_id=this.container_id+"_o_"+H.array_index;G=H.selected&&this.is_multiple?[]:["active-result"];if(H.selected){G.push("result-selected")}if(H.group_array_index!=null){G.push("group-option")}return'<li id="'+H.dom_id+'" class="'+G.join(" ")+'">'+H.html+"</li>"}else{return""}};F.prototype.results_update_field=function(){this.result_clear_highlight();this.result_single_selected=null;return this.results_build()};F.prototype.result_do_highlight=function(H){var L,K,I,J,G;if(H.length){this.result_clear_highlight();this.result_highlight=H;this.result_highlight.addClass("highlighted");I=parseInt(this.search_results.css("maxHeight"),10);G=this.search_results.scrollTop();J=I+G;K=this.result_highlight.position().top+this.search_results.scrollTop();L=K+this.result_highlight.outerHeight();if(L>=J){return this.search_results.scrollTop((L-I)>0?L-I:0)}else{if(K<G){return this.search_results.scrollTop(K)}}}};F.prototype.result_clear_highlight=function(){if(this.result_highlight){this.result_highlight.removeClass("highlighted")}return this.result_highlight=null};F.prototype.results_toggle=function(){if(this.results_showing){return this.results_hide()}else{return this.results_show()}};F.prototype.results_show=function(){var I,H,G;if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");if(this.result_single_selected){this.result_do_highlight(this.result_single_selected)}}I=this.is_multiple?this.container.height():this.container.height()-1;H=this.container.outerWidth()-C(this.dropdown);this.dropdown.css({width:H+"px",top:I,left:0});this.container.addClass("chzn-showing");G=H-C(this.search_container);this.results_showing=true;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results()};F.prototype.results_hide=function(){if(!this.is_multiple){this.selected_item.removeClass("chzn-single-with-drop")}this.result_clear_highlight();this.dropdown.css({left:"-9000px"});this.container.removeClass("chzn-showing");return this.results_showing=false};F.prototype.set_tab_index=function(H){var G;if(this.form_field_jq.attr("tabindex")){G=this.form_field_jq.attr("tabindex");this.form_field_jq.attr("tabindex",-1);if(this.is_multiple){return this.search_field.attr("tabindex",G)}else{this.selected_item.attr("tabindex",G);return this.search_field.attr("tabindex",-1)}}};F.prototype.reset_tab_index=function(){if(this.search_field.tabIndex){this.form_field_jq.tabIndex=this.search_field.tabIndex;return this.search_field.tabIndex=-1}};F.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices<1&&!this.active_field){return this.search_field.val(this.default_text).attr("title",this.default_text).addClass("default")}else{return this.search_field.val("").attr("title",null).removeClass("default")}};F.prototype.search_results_click=function(G){var H;H=D(G.target).hasClass("active-result")?D(G.target):D(G.target).parents(".active-result").first();if(H.length){this.result_highlight=H;return this.result_select()}};F.prototype.search_results_mouseover=function(G){var H;H=D(G.target).hasClass("active-result")?D(G.target):D(G.target).parents(".active-result").first();if(H){return this.result_do_highlight(H)}};F.prototype.search_results_mouseout=function(G){if(D(G.target).hasClass("active-result"||D(G.target).parents(".active-result").first())){return this.result_clear_highlight()}};F.prototype.choices_click=function(G){var H;G.preventDefault();H=D(G.target).parents(".search-choice");if(H.length){return this.focus_choice(H)}else{if(this.active_field&&(!this.results_showing)){return this.results_show()}}};F.prototype.choice_build=function(I){var G,H;G=this.container_id+"_c_"+I.array_index;this.choices+=1;this.search_container.before('<li class="search-choice" id="'+G+'" title="'+I.html+'"><span>'+I.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+I.array_index+'"></a></li>');H=this.search_container.parent().find("#"+G).find("a").first();H.click(B(function(J){return this.choice_destroy_link_click(J)},this));return this.clear_backstroke()};F.prototype.choice_destroy_link_click=function(G){G.preventDefault();this.pending_destroy_click=true;return this.choice_destroy(D(G.target))};F.prototype.choice_destroy=function(G){this.choices-=1;this.show_search_field_default();if(this.is_multiple&&this.choices>0&&this.search_field.val().length<1){this.results_hide()}this.result_deselect(G.attr("rel"));G.parents("li").first().remove();return this.search_field.focus()};F.prototype.result_select=function(){var J,I,H,G;if(this.result_highlight){J=this.result_highlight;I=J.attr("id");this.result_clear_highlight();J.addClass("result-selected");if(this.is_multiple){this.result_deactivate(J)}else{this.result_single_selected=J}G=I.substr(I.lastIndexOf("_")+1);H=this.results_data[G];H.selected=true;this.form_field.options[H.options_index].selected=true;if(this.is_multiple){this.choice_build(H)}else{this.selected_item.find("span").first().text(H.text)}this.results_hide();this.search_field.val("").attr("title",null);this.form_field_jq.trigger("change");return this.search_field_scale()}};F.prototype.result_activate=function(G){return G.addClass("active-result").show()};F.prototype.result_deactivate=function(G){return G.removeClass("active-result").hide()};F.prototype.result_deselect=function(I){var G,H;H=this.results_data[I];H.selected=false;this.form_field.options[H.options_index].selected=false;G=D("#"+this.container_id+"_o_"+I);G.removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change");return this.search_field_scale()};F.prototype.results_search=function(G){if(this.results_showing){return this.winnow_results()}else{return this.results_show()}};F.prototype.winnow_results=function(){var W,P,J,M,T,R,O,V,I,Q,U,H,L,K,S,G,N;I=new Date();this.no_results_clear();O=0;V=this.search_field.val()===this.default_text?"":D("<div/>").text(D.trim(this.search_field.val())).html();T=new RegExp("^"+V.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");H=new RegExp(V.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");N=this.results_data;for(L=0,S=N.length;L<S;L++){P=N[L];if(!P.disabled&&!P.empty){if(P.group){D("#"+P.dom_id).hide()}else{if(!(this.is_multiple&&P.selected)){W=false;R=P.dom_id;if(T.test(P.html)){W=true;O+=1}else{if(P.html.indexOf(" ")>=0||P.html.indexOf("[")===0){M=P.html.replace(/\[|\]/g,"").split(" ");if(M.length){for(K=0,G=M.length;K<G;K++){J=M[K];if(T.test(J)){W=true;O+=1}}}}}if(W){if(V.length){Q=P.html.search(H);U=P.html.substr(0,Q+V.length)+"</em>"+P.html.substr(Q+V.length);U=U.substr(0,Q)+"<em>"+U.substr(Q)}else{U=P.html}if(D("#"+R).html!==U){D("#"+R).html(U)}this.result_activate(D("#"+R));if(P.group_array_index!=null){D("#"+this.results_data[P.group_array_index].dom_id).show()}}else{if(this.result_highlight&&R===this.result_highlight.attr("id")){this.result_clear_highlight()}this.result_deactivate(D("#"+R))}}}}}if(O<1&&V.length){return this.no_results(V)}else{return this.winnow_results_set_highlight()}};F.prototype.winnow_results_clear=function(){var G,J,K,I,H;this.search_field.val("");J=this.search_results.find("li");H=[];for(K=0,I=J.length;K<I;K++){G=J[K];G=D(G);H.push(G.hasClass("group-result")?G.show():!this.is_multiple||!G.hasClass("result-selected")?this.result_activate(G):void 0)}return H};F.prototype.winnow_results_set_highlight=function(){var G,H;if(!this.result_highlight){H=!this.is_multiple?this.search_results.find(".result-selected"):[];G=H.length?H.first():this.search_results.find(".active-result").first();if(G!=null){return this.result_do_highlight(G)}}};F.prototype.no_results=function(G){return this.search_results.append(D(('<li class="no-results">'+this.settings.noResultsText+"</li>").replace("{0}",G)))};F.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};F.prototype.remove=function(){this.reset_tab_index();this.unregister_observers();this.remove_html();return this.form_field_jq.removeClass("chosen-active")};F.prototype.keydown_arrow=function(){var H,G;if(!this.result_highlight){H=this.search_results.find("li.active-result").first();if(H){this.result_do_highlight(D(H))}}else{if(this.results_showing){G=this.result_highlight.nextAll("li.active-result").first();if(G){this.result_do_highlight(G)}}}if(!this.results_showing){return this.results_show()}};F.prototype.keyup_arrow=function(){var G;if(!this.results_showing&&!this.is_multiple){return this.results_show()}else{if(this.result_highlight){G=this.result_highlight.prevAll("li.active-result");if(G.length){return this.result_do_highlight(G.first())}else{if(this.choices>0){this.results_hide()}return this.result_clear_highlight()}}}};F.prototype.keydown_backstroke=function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}else{return this.focus_choice(this.search_container.siblings("li.search-choice").last())}};F.prototype.clear_backstroke=function(){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus")}return this.pending_backstroke=null};F.prototype.focus_choice=function(G){if(this.pending_backstroke){this.pending_backstroke.removeClass("search-choice-focus")}return this.pending_backstroke=G.addClass("search-choice-focus")};F.prototype.keyup_checker=function(G){var I,H;I=(H=G.which)!=null?H:G.keyCode;this.search_field_scale();switch(I){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0){return this.keydown_backstroke()}else{if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}}break;case 13:G.preventDefault();if(this.results_showing){return this.result_select()}break;case 27:if(this.results_showing){return this.results_hide()}break;case 9:case 38:case 40:case 16:break;default:return this.results_search()}};F.prototype.keydown_checker=function(G){var I,H;I=(H=G.which)!=null?H:G.keyCode;this.search_field_scale();if(I!==8&&this.pending_backstroke){this.clear_backstroke()}switch(I){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=false;break;case 13:G.preventDefault();break;case 38:G.preventDefault();this.keyup_arrow();break;case 40:this.keydown_arrow();break}};F.prototype.search_field_scale=function(){var O,G,J,H,M,N,L,I,K;if(this.is_multiple){J=0;L=0;M="position:absolute; left: -1000px; top: -1000px; display:none;";N=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(I=0,K=N.length;I<K;I++){H=N[I];M+=H+":"+this.search_field.css(H)+";"}G=D("<div />",{style:M});G.text(this.search_field.val());D("body").append(G);L=G.width()+25;G.remove();if(L>this.f_width-10){L=this.f_width-10}this.search_field.css({width:L+"px"});O=this.container.height();return this.dropdown.css({top:O+"px"})}};F.prototype.generate_field_id=function(){var G;G=this.generate_random_id();this.form_field.id=G;return G};F.prototype.generate_random_id=function(){var G;G="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while(D("#"+G).length>0){G+=this.generate_random_char()}return G};F.prototype.generate_random_char=function(){var I,H,G;I="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";G=Math.floor(Math.random()*I.length);return H=I.substring(G,G+1)};return F})();C=function(F){var G;return G=F.outerWidth()-F.width()};A.get_side_border_padding=C}).call(this);(function(){var A;A=(function(){function B(){this.options_index=0;this.parsed=[]}B.prototype.add_node=function(C){if(C.nodeName==="OPTGROUP"){return this.add_group(C)}else{return this.add_option(C)}};B.prototype.add_group=function(I){var H,E,G,D,F,C;H=this.parsed.length;this.parsed.push({array_index:H,group:true,label:I.label,children:0,disabled:I.disabled});F=I.childNodes;C=[];for(G=0,D=F.length;G<D;G++){E=F[G];C.push(this.add_option(E,H,I.disabled))}return C};B.prototype.add_option=function(D,E,C){if(D.nodeName==="OPTION"){if(D.text!==""){if(E!=null){this.parsed[E].children+=1}this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:D.value,text:D.text,html:D.innerHTML,selected:D.selected,disabled:C===true?C:D.disabled,group_array_index:E})}else{this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:true})}return this.options_index+=1}};return B})();A.select_to_array=function(B){var G,F,E,C,D;F=new A();D=B.childNodes;for(E=0,C=D.length;E<C;E++){G=D[E];F.add_node(G)}return F.parsed};this.SelectParser=A}).call(this);
