AJS.whenIType=function(shortcut,ctx){return new AJS.KeyboardShortcut(shortcut,ctx)};AJS.disableKeyboardShortcuts=function(){AJS.keyboardShortcutsDisabled=true};AJS.enableKeyboardShortcuts=function(){AJS.keyboardShortcutsDisabled=false};AJS.KeyboardShortcut=function(shortcut,ctx){this._executer=null;this.shortcuts=[shortcut];this._bindShortcut(shortcut,ctx)};AJS.KeyboardShortcut.prototype._bindShortcut=function(shortcut,ctx){if(typeof shortcut!=="string"){throw new TypeError("AJS.KeyboardShortcut expects string; received "+typeof shortcut)}if(/^(?:ctrl|alt|shift|meta)+/i.test(shortcut)){throw new SyntaxError('AJS.KeyboardShortcut cannot bind the shortcut "'+shortcut+'" because it uses a modifier')}var self=this;jQuery(document).bind("shortcut",shortcut,function(event){if(self._executer&&!self._ignoreShortcut(event,shortcut,ctx)){if(AJS.InlineDialog.current){AJS.InlineDialog.current.hide()}self._executer(event);event.preventDefault()}})};AJS.KeyboardShortcut.prototype._ignoreShortcut=function(event,shortcut,ctx){var ignore=false;_.each(AJS.KeyboardShortcut._ignoreConditions,function(condition){if(condition(event,shortcut,ctx)){ignore=true}});return ignore};AJS.KeyboardShortcut.prototype._addShortcutTitle=function(selector){var elem=jQuery(selector);var title=elem.attr("title")||"";var typeStr=AJS.I18n.getText("keyboard.shortcuts.type");var thenStr=AJS.I18n.getText("keyboard.shortcuts.then");var orStr=AJS.I18n.getText("keyboard.shortcuts.or");var shortcuts=jQuery.map(this.shortcuts,function(shortcut){return" '"+shortcut.split("").join("' "+thenStr+" '")+"'"});title+=" ( "+typeStr+shortcuts.join(" "+orStr+" ")+" )";elem.attr("title",title)};AJS.KeyboardShortcut.prototype.moveToNextItem=function(selector){this._executer=function(){var index,items=jQuery(selector),focusedElem=jQuery(selector+".focused");if(!this._executer.blurHandler){jQuery(document).one("keypress",function(e){if(e.keyCode===27&&focusedElem){focusedElem.removeClass("focused")}})}if(focusedElem.length===0){focusedElem=jQuery(selector).eq(0)}else{focusedElem.removeClass("focused");index=jQuery.inArray(focusedElem.get(0),items);if(index<items.length-1){index=index+1;focusedElem=items.eq(index)}else{focusedElem.removeClass("focused");focusedElem=jQuery(selector).eq(0)}}if(focusedElem&&focusedElem.length>0){focusedElem.addClass("focused");focusedElem.scrollIntoView();focusedElem.find("a:first").focus()}}};AJS.KeyboardShortcut.prototype.moveToPrevItem=function(selector){this._executer=function(){var index,items=jQuery(selector),focusedElem=jQuery(selector+".focused");if(!this._executer.blurHandler){jQuery(document).one("keypress",function(e){if(e.keyCode===27&&focusedElem){focusedElem.removeClass("focused")}})}if(focusedElem.length===0){focusedElem=jQuery(selector+":last")}else{focusedElem.removeClass("focused");index=jQuery.inArray(focusedElem.get(0),items);if(index>0){index=index-1;focusedElem=items.eq(index)}else{focusedElem.removeClass("focused");focusedElem=jQuery(selector+":last")}}if(focusedElem&&focusedElem.length>0){focusedElem.addClass("focused");focusedElem.scrollIntoView();focusedElem.find("a:first").focus()}}};AJS.KeyboardShortcut.prototype.click=function(selector){this._addShortcutTitle(selector);this._executer=function(){var elem=jQuery(selector).eq(0);if(elem.length>0){elem.click()}}};AJS.KeyboardShortcut.prototype.goTo=function(location){this._executer=function(){window.location.href=contextPath+location}};AJS.KeyboardShortcut.prototype.followLink=function(selector){this._addShortcutTitle(selector);this._executer=function(){var elem=jQuery(selector).eq(0);if(elem.length>0&&(elem.prop("nodeName").toLowerCase()==="a"||elem.prop("nodeName").toLowerCase()==="link")){elem.click();window.location.href=elem.attr("href")}}};AJS.KeyboardShortcut.prototype.moveToAndClick=function(selector){this._addShortcutTitle(selector);this._executer=function(){var elem=jQuery(selector).eq(0);if(elem.length>0){elem.click();elem.scrollIntoView()}}};AJS.KeyboardShortcut.prototype.moveToAndFocus=function(selector){this._addShortcutTitle(selector);this._executer=function(e){var $elem=jQuery(selector).eq(0);if($elem.length>0){$elem.focus();$elem.scrollIntoView();if($elem.is(":input")){e.preventDefault()}}}};AJS.KeyboardShortcut.prototype.evaluate=function(command){if(typeof command!=="function"){command=new Function(command)}command.call(this)};AJS.KeyboardShortcut.prototype.execute=function(func){var self=this;this._executer=function(){if(typeof func!=="function"){func=new Function(func)}func.call(self)}};AJS.KeyboardShortcut.prototype.or=function(shortcut){this.shortcuts.push(shortcut);this._bindShortcut(shortcut);return this};AJS.KeyboardShortcut._ignoreConditions=[];AJS.KeyboardShortcut.addIgnoreCondition=function(func){AJS.KeyboardShortcut._ignoreConditions.push(func)};AJS.KeyboardShortcut.addIgnoreCondition(function(){return AJS.popup.current||AJS.dropDown.current||JIRA.Dialog.current||AJS.keyboardShortcutsDisabled});AJS.KeyboardShortcut.getKeyboardShortcutKeys=function(moduleKey){for(var index in AJS.keys.shortcuts){var shortcut=AJS.keys.shortcuts[index];if(shortcut.moduleKey===moduleKey){return shortcut.keys.toString()}}return null};AJS.$(function(){AJS.keyboardShortcutsDisabled=!AJS.Meta.get("keyboard-shortcuts-enabled")});